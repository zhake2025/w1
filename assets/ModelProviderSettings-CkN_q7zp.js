const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/avatarUtils-xfampngn.js","assets/index-BFQp9Otg.js","assets/index-ow1R_qFW.css"])))=>i.map(i=>d[i]);
import{c as Jt,eB as Zt,eC as Qt,eD as tt,eE as Xt,r as l,j as e,B as d,d as b,H as mt,J as xt,S as gt,K as ee,f as _,g as Ve,X as ft,Y as He,Z as Ue,eg as er,ac as pe,bu as tr,af as he,_ as rr,aj as ce,I as B,br as bt,an as Ne,k as re,m as se,n as ne,G as $,o as oe,dF as We,e4 as sr,bH as Re,eF as nr,eG as rt,dL as or,a0 as $e,a1 as ir,l as ar,C as ke,a9 as st,e as yt,a2 as lr,eH as nt,a as y,bw as cr,Q as dr,D as ur,i as ye,aO as ot,ak as pr,ag as Fe,a_ as fe,P as Te,L as vt,p as ve,a5 as jt,b7 as hr,u as mr,a6 as xr,a$ as gr,bn as fr,eI as _e,dJ as Q,eJ as br,A as yr,T as vr,b as jr,aR as Cr,eK as Sr,eL as Ir,eM as wr}from"./index-BFQp9Otg.js";import{A as Ct,a as Er}from"./AvatarUploader-D5lh_rEa.js";import{C as we}from"./Card-IUdLwBcS.js";import{C as Ee}from"./CardContent-DXovnOt-.js";import{P as de}from"./plus-kwQ_QrJb.js";import{E as St}from"./eye-off-dxYQvFn2.js";import{S as Rr}from"./search-Bv7nWCFj.js";import{M as it}from"./minus-AxQmW5Ho.js";import{M as h}from"./index-BkGzE-oi.js";import{I as Tr}from"./image-B0DGh2HR.js";import{T as Mr,a as at}from"./Tabs-DpUCVX9A.js";import{I as kr}from"./InputAdornment-2unSRdg3.js";import{Z as Ar}from"./zap-CsRzbzY6.js";import"./camera-8wkI6VD5.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]],Pr=Jt("delete",zr);async function Dr(o){try{Zt("获取模型列表","INFO",{provider:o.id});const s=await Qt(o);return tt("获取模型列表",200,{provider:o.id,modelsCount:s.length}),s}catch(s){return Xt(s,"APIService.fetchModels",{logLevel:"ERROR",additionalData:{provider:o.id}}),tt("获取模型列表",500,{provider:o.id,error:s instanceof Error?s.message:"未知错误"}),[]}}const Or=({providerName:o,providerType:s,apiKeys:i,strategy:x,onKeysChange:t,onStrategyChange:O})=>{const[k,C]=l.useState(!1),[M,z]=l.useState(null),[W,N]=l.useState(""),[P,A]=l.useState(""),[w,n]=l.useState(5),[c,u]=l.useState({}),[v,p]=l.useState(""),R=Ct.getInstance(),T=f=>{switch(f){case"active":return{icon:e.jsx(Re,{size:16}),color:"success",text:"正常"};case"error":return{icon:e.jsx(sr,{size:16}),color:"error",text:"错误"};case"disabled":return{icon:e.jsx(We,{size:16}),color:"warning",text:"禁用"};case"rate_limited":return{icon:e.jsx(We,{size:16}),color:"warning",text:"限流"};default:return{icon:e.jsx(We,{size:16}),color:"default",text:"未知"}}},D=()=>{z(null),N(""),A(""),n(5),p(""),C(!0)},a=f=>{z(f),N(f.key),A(f.name||""),n(f.priority),p(""),C(!0)},m=()=>{if(!R.validateApiKey(W,s)){p(`无效的 ${o} API Key 格式`);return}if(i.some(F=>F.key===W&&F.id!==M?.id)){p("该 API Key 已存在");return}let H;if(M)H=i.map(F=>F.id===M.id?{...F,key:W,name:P||`API Key ${Date.now()}`,priority:w,updatedAt:Date.now()}:F);else{const F=R.createApiKeyConfig(W,P||`API Key ${Date.now()}`,w);H=[...i,F]}t(H),C(!1)},j=f=>{const H=i.filter(F=>F.id!==f);t(H),R.resetRoundRobinState()},K=(f,H)=>{const F=i.map(Y=>Y.id===f?{...Y,isEnabled:H,updatedAt:Date.now()}:Y);t(F)},U=f=>{u(H=>({...H,[f]:!H[f]}))},q=(f,H)=>H?f:f.length<=8?"••••••••":`${f.substring(0,4)}••••${f.substring(f.length-4)}`,V=R.getKeyStats(i);return e.jsxs(d,{children:[e.jsxs(d,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:2,mb:3},children:[e.jsx(we,{children:e.jsxs(Ee,{sx:{textAlign:"center",py:2},children:[e.jsx(b,{variant:"h6",color:"primary",children:V.total}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"总数"})]})}),e.jsx(we,{children:e.jsxs(Ee,{sx:{textAlign:"center",py:2},children:[e.jsx(b,{variant:"h6",color:"success.main",children:V.active}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"正常"})]})}),e.jsx(we,{children:e.jsxs(Ee,{sx:{textAlign:"center",py:2},children:[e.jsx(b,{variant:"h6",color:"error.main",children:V.error}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"错误"})]})}),e.jsx(we,{children:e.jsxs(Ee,{sx:{textAlign:"center",py:2},children:[e.jsxs(b,{variant:"h6",color:"text.primary",children:[V.successRate,"%"]}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"成功率"})]})})]}),e.jsx(d,{sx:{mb:3},children:e.jsxs(mt,{fullWidth:!0,children:[e.jsx(xt,{children:"负载均衡策略"}),e.jsxs(gt,{value:x,label:"负载均衡策略",onChange:f=>O(f.target.value),children:[e.jsx(ee,{value:"round_robin",children:"轮询 (Round Robin)"}),e.jsx(ee,{value:"priority",children:"优先级 (Priority)"}),e.jsx(ee,{value:"least_used",children:"最少使用 (Least Used)"}),e.jsx(ee,{value:"random",children:"随机 (Random)"})]})]})}),e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(b,{variant:"h6",children:["API Keys (",i.length,")"]}),e.jsx(_,{variant:"contained",startIcon:e.jsx(de,{size:16}),onClick:D,size:"small",children:"添加 Key"})]}),i.length===0?e.jsx(Ve,{severity:"info",children:'还没有配置 API Key。点击"添加 Key"开始配置。'}):e.jsx(ft,{children:i.map((f,H)=>{const F=T(f.status),Y=c[f.id]||!1;return e.jsxs(He,{divider:!0,children:[e.jsx(Ue,{primary:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{variant:"subtitle2",children:f.name||`Key ${H+1}`}),e.jsx(pe,{icon:F.icon,label:F.text,size:"small",color:F.color}),e.jsx(pe,{label:`优先级: ${f.priority}`,size:"small",variant:"outlined"})]}),secondary:e.jsxs(d,{children:[e.jsx(b,{variant:"body2",sx:{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},children:q(f.key,Y)}),e.jsxs(b,{variant:"caption",color:"text.secondary",children:["请求: ",f.usage.totalRequests," | 成功: ",f.usage.successfulRequests," | 失败: ",f.usage.failedRequests]}),f.usage.totalRequests>0&&e.jsx(er,{variant:"determinate",value:f.usage.successfulRequests/f.usage.totalRequests*100,sx:{mt:1,height:4,borderRadius:2}})]})}),e.jsx(tr,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{control:e.jsx(rr,{checked:f.isEnabled,onChange:Z=>K(f.id,Z.target.checked),size:"small"}),label:""}),e.jsx(ce,{title:Y?"隐藏 Key":"显示 Key",children:e.jsx(B,{size:"small",onClick:()=>U(f.id),children:Y?e.jsx(St,{size:16}):e.jsx(bt,{size:16})})}),e.jsx(ce,{title:"编辑",children:e.jsx(B,{size:"small",onClick:()=>a(f),children:e.jsx(Ne,{size:16})})}),e.jsx(ce,{title:"删除",children:e.jsx(B,{size:"small",color:"error",onClick:()=>j(f.id),children:e.jsx(Pr,{size:16})})})]})})]},f.id)})}),e.jsxs(re,{open:k,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:M?"编辑 API Key":"添加 API Key"}),e.jsxs(ne,{children:[e.jsx($,{autoFocus:!0,margin:"dense",label:"API Key",type:"password",fullWidth:!0,variant:"outlined",value:W,onChange:f=>{N(f.target.value),p("")},error:!!v,helperText:v||`请输入有效的 ${o} API Key`,sx:{mb:2}}),e.jsx($,{margin:"dense",label:"名称 (可选)",fullWidth:!0,variant:"outlined",value:P,onChange:f=>A(f.target.value),placeholder:"例如：主要账户、备用账户",sx:{mb:2}}),e.jsx($,{margin:"dense",label:"优先级",type:"number",fullWidth:!0,variant:"outlined",value:w,onChange:f=>n(Number(f.target.value)),inputProps:{min:1,max:10},helperText:"1-10，数字越小优先级越高"})]}),e.jsxs(oe,{children:[e.jsx(_,{onClick:()=>C(!1),children:"取消"}),e.jsx(_,{onClick:m,variant:"contained",children:M?"保存":"添加"})]})]})]})};var lt=Number.isNaN||function(s){return typeof s=="number"&&s!==s};function Wr(o,s){return!!(o===s||lt(o)&&lt(s))}function _r(o,s){if(o.length!==s.length)return!1;for(var i=0;i<o.length;i++)if(!Wr(o[i],s[i]))return!1;return!0}function Le(o,s){s===void 0&&(s=_r);var i,x=[],t,O=!1;function k(){for(var C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];return O&&i===this&&s(C,x)||(t=o.apply(this,C),O=!0,i=this,x=C),t}return k}var Lr=typeof performance=="object"&&typeof performance.now=="function",ct=Lr?function(){return performance.now()}:function(){return Date.now()};function dt(o){cancelAnimationFrame(o.id)}function Kr(o,s){var i=ct();function x(){ct()-i>=s?o.call(null):t.id=requestAnimationFrame(x)}var t={id:requestAnimationFrame(x)};return t}var Ke=-1;function ut(o){if(o===void 0&&(o=!1),Ke===-1||o){var s=document.createElement("div"),i=s.style;i.width="50px",i.height="50px",i.overflow="scroll",document.body.appendChild(s),Ke=s.offsetWidth-s.clientWidth,document.body.removeChild(s)}return Ke}var ue=null;function pt(o){if(o===void 0&&(o=!1),ue===null||o){var s=document.createElement("div"),i=s.style;i.width="50px",i.height="50px",i.overflow="scroll",i.direction="rtl";var x=document.createElement("div"),t=x.style;return t.width="100px",t.height="100px",s.appendChild(x),document.body.appendChild(s),s.scrollLeft>0?ue="positive-descending":(s.scrollLeft=1,s.scrollLeft===0?ue="negative":ue="positive-ascending"),document.body.removeChild(s),ue}return ue}var Nr=150,Fr=function(s,i){return s};function Br(o){var s,i=o.getItemOffset,x=o.getEstimatedTotalSize,t=o.getItemSize,O=o.getOffsetForIndexAndAlignment,k=o.getStartIndexForOffset,C=o.getStopIndexForStartIndex,M=o.initInstanceProps,z=o.shouldResetStyleCacheOnItemSizeChange,W=o.validateProps;return s=(function(N){nr(P,N);function P(w){var n;return n=N.call(this,w)||this,n._instanceProps=M(n.props,rt(n)),n._outerRef=void 0,n._resetIsScrollingTimeoutId=null,n.state={instance:rt(n),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof n.props.initialScrollOffset=="number"?n.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},n._callOnItemsRendered=void 0,n._callOnItemsRendered=Le(function(c,u,v,p){return n.props.onItemsRendered({overscanStartIndex:c,overscanStopIndex:u,visibleStartIndex:v,visibleStopIndex:p})}),n._callOnScroll=void 0,n._callOnScroll=Le(function(c,u,v){return n.props.onScroll({scrollDirection:c,scrollOffset:u,scrollUpdateWasRequested:v})}),n._getItemStyle=void 0,n._getItemStyle=function(c){var u=n.props,v=u.direction,p=u.itemSize,R=u.layout,T=n._getItemStyleCache(z&&p,z&&R,z&&v),D;if(T.hasOwnProperty(c))D=T[c];else{var a=i(n.props,c,n._instanceProps),m=t(n.props,c,n._instanceProps),j=v==="horizontal"||R==="horizontal",K=v==="rtl",U=j?a:0;T[c]=D={position:"absolute",left:K?void 0:U,right:K?U:void 0,top:j?0:a,height:j?"100%":m,width:j?m:"100%"}}return D},n._getItemStyleCache=void 0,n._getItemStyleCache=Le(function(c,u,v){return{}}),n._onScrollHorizontal=function(c){var u=c.currentTarget,v=u.clientWidth,p=u.scrollLeft,R=u.scrollWidth;n.setState(function(T){if(T.scrollOffset===p)return null;var D=n.props.direction,a=p;if(D==="rtl")switch(pt()){case"negative":a=-p;break;case"positive-descending":a=R-v-p;break}return a=Math.max(0,Math.min(a,R-v)),{isScrolling:!0,scrollDirection:T.scrollOffset<a?"forward":"backward",scrollOffset:a,scrollUpdateWasRequested:!1}},n._resetIsScrollingDebounced)},n._onScrollVertical=function(c){var u=c.currentTarget,v=u.clientHeight,p=u.scrollHeight,R=u.scrollTop;n.setState(function(T){if(T.scrollOffset===R)return null;var D=Math.max(0,Math.min(R,p-v));return{isScrolling:!0,scrollDirection:T.scrollOffset<D?"forward":"backward",scrollOffset:D,scrollUpdateWasRequested:!1}},n._resetIsScrollingDebounced)},n._outerRefSetter=function(c){var u=n.props.outerRef;n._outerRef=c,typeof u=="function"?u(c):u!=null&&typeof u=="object"&&u.hasOwnProperty("current")&&(u.current=c)},n._resetIsScrollingDebounced=function(){n._resetIsScrollingTimeoutId!==null&&dt(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=Kr(n._resetIsScrolling,Nr)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},function(){n._getItemStyleCache(-1,null)})},n}P.getDerivedStateFromProps=function(n,c){return Vr(n,c),W(n),null};var A=P.prototype;return A.scrollTo=function(n){n=Math.max(0,n),this.setState(function(c){return c.scrollOffset===n?null:{scrollDirection:c.scrollOffset<n?"forward":"backward",scrollOffset:n,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},A.scrollToItem=function(n,c){c===void 0&&(c="auto");var u=this.props,v=u.itemCount,p=u.layout,R=this.state.scrollOffset;n=Math.max(0,Math.min(n,v-1));var T=0;if(this._outerRef){var D=this._outerRef;p==="vertical"?T=D.scrollWidth>D.clientWidth?ut():0:T=D.scrollHeight>D.clientHeight?ut():0}this.scrollTo(O(this.props,n,c,R,this._instanceProps,T))},A.componentDidMount=function(){var n=this.props,c=n.direction,u=n.initialScrollOffset,v=n.layout;if(typeof u=="number"&&this._outerRef!=null){var p=this._outerRef;c==="horizontal"||v==="horizontal"?p.scrollLeft=u:p.scrollTop=u}this._callPropsCallbacks()},A.componentDidUpdate=function(){var n=this.props,c=n.direction,u=n.layout,v=this.state,p=v.scrollOffset,R=v.scrollUpdateWasRequested;if(R&&this._outerRef!=null){var T=this._outerRef;if(c==="horizontal"||u==="horizontal")if(c==="rtl")switch(pt()){case"negative":T.scrollLeft=-p;break;case"positive-ascending":T.scrollLeft=p;break;default:var D=T.clientWidth,a=T.scrollWidth;T.scrollLeft=a-D-p;break}else T.scrollLeft=p;else T.scrollTop=p}this._callPropsCallbacks()},A.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&dt(this._resetIsScrollingTimeoutId)},A.render=function(){var n=this.props,c=n.children,u=n.className,v=n.direction,p=n.height,R=n.innerRef,T=n.innerElementType,D=n.innerTagName,a=n.itemCount,m=n.itemData,j=n.itemKey,K=j===void 0?Fr:j,U=n.layout,q=n.outerElementType,V=n.outerTagName,f=n.style,H=n.useIsScrolling,F=n.width,Y=this.state.isScrolling,Z=v==="horizontal"||U==="horizontal",me=Z?this._onScrollHorizontal:this._onScrollVertical,ie=this._getRangeToRender(),ae=ie[0],le=ie[1],S=[];if(a>0)for(var E=ae;E<=le;E++)S.push(l.createElement(c,{data:m,key:K(E,m),index:E,isScrolling:H?Y:void 0,style:this._getItemStyle(E)}));var I=x(this.props,this._instanceProps);return l.createElement(q||V||"div",{className:u,onScroll:me,ref:this._outerRefSetter,style:or({position:"relative",height:p,width:F,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:v},f)},l.createElement(T||D||"div",{children:S,ref:R,style:{height:Z?"100%":I,pointerEvents:Y?"none":void 0,width:Z?I:"100%"}}))},A._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var n=this.props.itemCount;if(n>0){var c=this._getRangeToRender(),u=c[0],v=c[1],p=c[2],R=c[3];this._callOnItemsRendered(u,v,p,R)}}if(typeof this.props.onScroll=="function"){var T=this.state,D=T.scrollDirection,a=T.scrollOffset,m=T.scrollUpdateWasRequested;this._callOnScroll(D,a,m)}},A._getRangeToRender=function(){var n=this.props,c=n.itemCount,u=n.overscanCount,v=this.state,p=v.isScrolling,R=v.scrollDirection,T=v.scrollOffset;if(c===0)return[0,0,0,0];var D=k(this.props,T,this._instanceProps),a=C(this.props,D,T,this._instanceProps),m=!p||R==="backward"?Math.max(1,u):1,j=!p||R==="forward"?Math.max(1,u):1;return[Math.max(0,D-m),Math.max(0,Math.min(c-1,a+j)),D,a]},P})(l.PureComponent),s.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},s}var Vr=function(s,i){s.children,s.direction,s.height,s.layout,s.innerTagName,s.outerTagName,s.width,i.instance},Hr=Br({getItemOffset:function(s,i){var x=s.itemSize;return i*x},getItemSize:function(s,i){var x=s.itemSize;return x},getEstimatedTotalSize:function(s){var i=s.itemCount,x=s.itemSize;return x*i},getOffsetForIndexAndAlignment:function(s,i,x,t,O,k){var C=s.direction,M=s.height,z=s.itemCount,W=s.itemSize,N=s.layout,P=s.width,A=C==="horizontal"||N==="horizontal",w=A?P:M,n=Math.max(0,z*W-w),c=Math.min(n,i*W),u=Math.max(0,i*W-w+W+k);switch(x==="smart"&&(t>=u-w&&t<=c+w?x="auto":x="center"),x){case"start":return c;case"end":return u;case"center":{var v=Math.round(u+(c-u)/2);return v<Math.ceil(w/2)?0:v>n+Math.floor(w/2)?n:v}case"auto":default:return t>=u&&t<=c?t:t<u?u:c}},getStartIndexForOffset:function(s,i){var x=s.itemCount,t=s.itemSize;return Math.max(0,Math.min(x-1,Math.floor(i/t)))},getStopIndexForStartIndex:function(s,i,x){var t=s.direction,O=s.height,k=s.itemCount,C=s.itemSize,M=s.layout,z=s.width,W=t==="horizontal"||M==="horizontal",N=i*C,P=W?z:O,A=Math.ceil((P+x-N)/C);return Math.max(0,Math.min(k-1,i+A-1))},initInstanceProps:function(s){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(s){s.itemSize}});const Ur=lr.memo(({index:o,style:s,data:i})=>{const x=$e(),{items:t,isModelInProvider:O,handleAddSingleModel:k,handleRemoveSingleModel:C,handleAddGroup:M,handleRemoveGroup:z,groupedModels:W,collapsedGroups:N,toggleGroupCollapse:P}=i,A=t[o];if(A.type==="group"){const n=W[A.name]||[],c=n.filter(p=>!O(p.id)),u=n.filter(p=>O(p.id)),v=N.has(A.name);return e.jsxs(d,{style:s,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pl:2,pr:2,backgroundColor:p=>y(p.palette.background.default,.95),borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{backgroundColor:p=>y(p.palette.background.default,.85)}},onClick:()=>P(A.name),children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{size:"small",sx:{mr:1,p:.5,color:"text.secondary","&:hover":{bgcolor:"transparent"}},onClick:p=>{p.stopPropagation(),P(A.name)},children:v?e.jsx(cr,{size:16}):e.jsx(dr,{size:16})}),e.jsx(b,{variant:"subtitle2",fontWeight:600,sx:{textTransform:"uppercase",letterSpacing:"0.5px"},children:A.name}),e.jsx(pe,{label:A.modelCount,size:"small",sx:{ml:1.5,height:20,fontSize:"0.7rem"}})]}),e.jsxs(d,{sx:{display:"flex",gap:1},onClick:p=>p.stopPropagation(),children:[c.length>0&&e.jsx(B,{size:"small",onClick:()=>M(A.name),sx:{border:"1px solid",borderColor:"primary.light",color:"primary.main","&:hover":{bgcolor:p=>y(p.palette.primary.main,.1)}},title:`添加 ${c.length} 个模型`,children:e.jsx(de,{size:14})}),u.length>0&&e.jsx(B,{size:"small",onClick:()=>z(A.name),sx:{border:"1px solid",borderColor:"error.light",color:"error.main","&:hover":{bgcolor:p=>y(p.palette.error.main,.1)}},title:`移除 ${u.length} 个模型`,children:e.jsx(it,{size:14})})]})]})}const w=A.data;return e.jsx(d,{style:s,sx:{display:"flex",alignItems:"center"},children:e.jsxs(He,{sx:{pl:2,pr:2,"&:hover":{backgroundColor:n=>y(n.palette.primary.main,.04)}},secondaryAction:O(w.id)?e.jsx(B,{edge:"end",size:"small",onClick:()=>C(w.id),sx:{border:"1px solid",borderColor:"error.light",color:"error.main","&:hover":{bgcolor:n=>y(n.palette.error.main,.1)}},children:e.jsx(it,{size:16})}):e.jsx(B,{edge:"end",size:"small",onClick:()=>k(w),sx:{border:"1px solid",borderColor:"primary.light",color:"primary.main","&:hover":{bgcolor:n=>y(n.palette.primary.main,.1)}},children:e.jsx(de,{size:16})}),children:[e.jsx(ur,{size:20,color:x.palette.text.secondary,style:{marginRight:x.spacing(2)}}),e.jsx(Ue,{primary:e.jsx(b,{variant:"body1",fontWeight:500,sx:{lineHeight:1.4},children:w.name||w.id}),secondary:e.jsx(b,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.25},children:w.id})})]},w.id)})}),$r=({open:o,onClose:s,provider:i,onAddModel:x,onAddModels:t,onRemoveModel:O,onRemoveModels:k,existingModels:C})=>{const M=$e(),z=ir(M.breakpoints.down("sm")),[W,N]=l.useState(!1),[P,A]=l.useState([]),[w,n]=l.useState(""),[c,u]=l.useState(""),[v,p]=l.useState(new Map),[R,T]=l.useState(new Set),[D,a]=l.useTransition(),m=l.useRef(null),j=l.useCallback(S=>C.some(E=>E.id===S)||v.get(S)===!0,[C,v]),K=l.useMemo(()=>ar.debounce(S=>{a(()=>{u(S)})},300),[]);l.useEffect(()=>()=>{K.cancel()},[K]);const U=l.useCallback(S=>{const E=S.target.value;n(E),K(E)},[K]),q=l.useMemo(()=>{const S=c.toLowerCase(),E={};for(const I of P){const G=I.name||I.id;if(!S||G.toLowerCase().includes(S)||I.id.toLowerCase().includes(S)){const J=I.group||"其他模型";E[J]||(E[J]=[]),E[J].push(I)}}return E},[P,c]),V=l.useMemo(()=>{const S=[],E=Object.keys(q).sort((I,G)=>I.localeCompare(G));for(const I of E){const G=q[I];S.push({type:"group",name:I,modelCount:G.length}),R.has(I)||G.forEach(J=>{S.push({type:"model",data:J})})}return S},[q,R]),f=l.useCallback(S=>{j(S.id)||(p(E=>new Map(E).set(S.id,!0)),x(S))},[j,x]),H=l.useCallback(S=>{p(E=>{const I=new Map(E);return I.delete(S),I}),O(S)},[O]),F=l.useCallback(S=>{const E=q[S]?.filter(I=>!j(I.id))||[];if(E.length>0)if(p(I=>{const G=new Map(I);return E.forEach(J=>{G.set(J.id,!0)}),G}),t){const I=E.map(G=>({...G}));t(I)}else E.forEach(I=>{x({...I})})},[q,j,t,x]),Y=l.useCallback(S=>{const E=q[S]?.filter(I=>j(I.id))||[];if(E.length>0)if(p(I=>{const G=new Map(I);return E.forEach(J=>{G.delete(J.id)}),G}),k){const I=E.map(G=>G.id);k(I)}else E.forEach(I=>{O(I.id)})},[q,j,k,O]),Z=l.useCallback(S=>{T(E=>{const I=new Set(E);return I.has(S)?I.delete(S):I.add(S),I})},[]),me=l.useMemo(()=>({items:V,isModelInProvider:j,handleAddSingleModel:f,handleRemoveSingleModel:H,handleAddGroup:F,handleRemoveGroup:Y,groupedModels:q,collapsedGroups:R,toggleGroupCollapse:Z}),[V,j,f,H,F,Y,q,R,Z]),ie=async()=>{try{N(!0);const S=m.current||i,I=[...await Dr(S)];A(I)}catch(S){console.error("加载模型失败:",S)}finally{N(!1)}};l.useEffect(()=>{o&&i&&(!m.current||m.current.id!==i.id)&&(m.current=i,ie())},[o,i]),l.useEffect(()=>{o||(n(""),u(""),K.cancel())},[o,K]);const ae=l.useMemo(()=>window.innerHeight*(z?.85:.9)-140,[z]),le=()=>e.jsx(d,{sx:{p:2},children:[1,2,3].map(S=>e.jsxs(d,{sx:{mb:2},children:[e.jsx(nt,{variant:"rectangular",height:48,sx:{borderRadius:2,mb:1}}),e.jsx(d,{sx:{pl:2},children:[1,2,3].map(E=>e.jsx(nt,{variant:"rectangular",height:60,sx:{borderRadius:1,mb:1}},E))})]},S))});return e.jsxs(re,{open:o,onClose:s,fullWidth:!0,maxWidth:"md",fullScreen:z,PaperProps:{sx:{borderRadius:z?0:2,height:z?"100%":"90vh",maxHeight:"90vh",display:"flex",flexDirection:"column"}},children:[e.jsxs(se,{sx:{fontWeight:700,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent",display:"flex",alignItems:"center",justifyContent:"space-between",p:3,flexShrink:0},children:[i.name,"模型管理",W&&e.jsx(ke,{size:24,sx:{ml:2}})]}),e.jsxs(d,{sx:{px:3,pb:2,flexShrink:0},children:[e.jsx($,{fullWidth:!0,placeholder:"搜索模型...",size:"small",value:w,onChange:U,autoComplete:"off",spellCheck:!1,InputProps:{startAdornment:e.jsx(Rr,{size:20,color:"var(--mui-palette-text-secondary)",style:{marginRight:8}}),sx:{borderRadius:2}},sx:{"& .MuiInputBase-input":{transition:"none",padding:"8px 14px"}}}),D&&e.jsx(st,{in:D,children:e.jsx(d,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(ke,{size:16})})})]}),e.jsx(yt,{sx:{flexShrink:0}}),e.jsx(ne,{sx:{flex:1,overflow:"hidden",p:0},children:W?le():e.jsx(st,{in:!D,timeout:300,children:e.jsx(d,{sx:{height:"100%"},children:V.length===0?e.jsx(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"200px",textAlign:"center"},children:e.jsx(b,{variant:"body1",sx:{color:"text.secondary"},children:c?"找不到匹配的模型":"暂无模型"})}):e.jsx(Hr,{height:ae,itemCount:V.length,itemSize:56,width:"100%",itemData:me,children:Ur})})})}),e.jsx(oe,{sx:{p:z?2:3,flexShrink:0},children:e.jsx(_,{onClick:s,variant:"outlined",children:"关闭"})})]})},Be=[{pattern:"VL|vision|visual|image",types:[h.Vision,h.Chat]},{pattern:"gpt-4-vision|gpt-4v",types:[h.Vision,h.Chat],provider:"openai"},{pattern:"gpt-4o",types:[h.Vision,h.Chat,h.FunctionCalling,h.WebSearch],provider:"openai"},{pattern:"gemini-(pro|ultra)-vision",types:[h.Vision,h.Chat],provider:"google"},{pattern:"claude-3-(opus|sonnet|haiku)",types:[h.Vision,h.Chat,h.FunctionCalling],provider:"anthropic"},{pattern:"qwen.*vl",types:[h.Vision,h.Chat],provider:"siliconflow"},{pattern:"FLUX|flux|black-forest|stable-diffusion|sd|dalle|midjourney",types:[h.ImageGen]},{pattern:"image|img|picture|generate",types:[h.ImageGen]},{pattern:"HunyuanVideo|Wan.*T2V|Wan.*I2V|video.*gen|video.*generation",types:[h.VideoGen]},{pattern:"video|movie|film|motion",types:[h.VideoGen]},{pattern:"embedding|text-embedding|embeddings",types:[h.Embedding]},{pattern:"text-embedding-.*|embedding-.*",types:[h.Embedding],provider:"openai"},{pattern:".*-embedding-.*",types:[h.Embedding],provider:"google"},{pattern:"tts|whisper|audio|speech",types:[h.Audio,h.Transcription]},{pattern:"tool|function|plugin",types:[h.Tool,h.Chat,h.FunctionCalling]},{pattern:"function.*calling|function-calling",types:[h.FunctionCalling,h.Chat]},{pattern:"gpt-4-turbo|gpt-3.5-turbo",types:[h.Chat,h.FunctionCalling],provider:"openai"},{pattern:"web.*search|search|browse",types:[h.WebSearch,h.Chat]},{pattern:"gpt-4-turbo-search|gpt-4o-search",types:[h.WebSearch,h.Chat],provider:"openai"},{pattern:"rerank|rank",types:[h.Rerank]},{pattern:"code|codex|coder|copilot|starcoder|codellama",types:[h.CodeGen,h.Chat]},{pattern:"translate|translation",types:[h.Translation,h.Chat]},{pattern:"reasoning|think|coder|math",types:[h.Reasoning,h.Chat]},{pattern:".*-thinking-.*",types:[h.Reasoning,h.Chat]},{pattern:"deepseek-reasoner|deepseek-r1",types:[h.Reasoning,h.Chat],provider:"deepseek"},{pattern:".*",types:[h.Chat]}];function Me(o,s,i=Be){for(const x of i)if(!(x.provider&&x.provider!==s))try{if(new RegExp(x.pattern,"i").test(o))return x.types}catch{if(o.toLowerCase().includes(x.pattern.toLowerCase()))return x.types}return[h.Chat]}function be(o){return{[h.Chat]:"聊天",[h.Vision]:"视觉",[h.Audio]:"语音",[h.Embedding]:"嵌入向量",[h.Tool]:"工具使用",[h.Reasoning]:"推理",[h.ImageGen]:"图像生成",[h.VideoGen]:"视频生成",[h.FunctionCalling]:"函数调用",[h.WebSearch]:"网络搜索",[h.Rerank]:"重排序",[h.CodeGen]:"代码生成",[h.Translation]:"翻译",[h.Transcription]:"转录"}[o]||o}const Gr=({open:o,onClose:s,rules:i,onSave:x,modelId:t,provider:O})=>{const[k,C]=l.useState([]),[M,z]=l.useState({pattern:"",types:[h.Chat]}),[W,N]=l.useState([]),[P,A]=l.useState(!1);l.useEffect(()=>{o&&(C(i||[]),A(!1))},[o,i]);const w=(a,m,j)=>{const K=[...k];m==="types"?K[a]={...K[a],types:j}:K[a]={...K[a],[m]:j},C(K)},n=(a,m)=>{z(a==="types"?{...M,types:m}:{...M,[a]:m})},c=()=>{if(M.pattern.trim()!==""){if(M.types.length===0){z({...M,types:[h.Chat]});return}C([...k,M]),z({pattern:"",types:[h.Chat]})}},u=a=>{const m=[...k];m.splice(a,1),C(m)},v=()=>{if(t&&O){const a=Me(t,O,k);N(a)}},p=(a,m,j)=>{let U=[...k[a].types];j?U.includes(m)||U.push(m):(U=U.filter(q=>q!==m),U.length===0&&(U=[h.Chat])),w(a,"types",U)},R=(a,m)=>{let j=[...M.types];m?j.includes(a)||j.push(a):(j=j.filter(K=>K!==a),j.length===0&&(j=[h.Chat])),n("types",j)},T=()=>{x(k),s()},D=()=>{A(!P)};return e.jsxs(re,{open:o,onClose:s,maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(b,{variant:"h6",children:"模型类型管理"}),e.jsx(_,{color:P?"primary":"secondary",onClick:D,children:P?"完成编辑":"编辑规则"})]})}),e.jsx(ne,{children:P?e.jsxs(d,{children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"编辑模型类型匹配规则"}),e.jsx(b,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"规则按顺序匹配，第一条匹配成功的规则将被应用。"}),e.jsx(d,{sx:{mb:3},children:k.map((a,m)=>e.jsxs(d,{sx:{p:2,mb:2,border:"1px solid #e0e0e0",borderRadius:1,backgroundColor:"#f9f9f9"},children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{children:e.jsx($,{fullWidth:!0,label:"匹配模式",value:a.pattern,onChange:j=>w(m,"pattern",j.target.value),helperText:"支持正则表达式或简单字符串",size:"small"})}),e.jsx(B,{color:"error",onClick:()=>u(m),children:e.jsx(ye,{})})]}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mt:1},children:[e.jsx(d,{children:e.jsx($,{fullWidth:!0,label:"提供商限制（可选）",value:a.provider||"",onChange:j=>w(m,"provider",j.target.value||void 0),placeholder:"例如: openai, google",size:"small"})}),e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.values(h).map(j=>e.jsx(he,{control:e.jsx(ot,{checked:a.types.includes(j),onChange:K=>p(m,j,K.target.checked),size:"small"}),label:be(j)},j))})]})]},m))}),e.jsxs(d,{sx:{p:2,mb:2,border:"1px dashed #a0a0a0",borderRadius:1},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"添加新规则"}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{children:e.jsx($,{fullWidth:!0,label:"匹配模式",value:M.pattern,onChange:a=>n("pattern",a.target.value),helperText:"支持正则表达式或简单字符串",size:"small"})}),e.jsx(B,{color:"primary",onClick:c,children:e.jsx(de,{})})]}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mt:1},children:[e.jsx(d,{children:e.jsx($,{fullWidth:!0,label:"提供商限制（可选）",value:M.provider||"",onChange:a=>n("provider",a.target.value||void 0),placeholder:"例如: openai, google",size:"small"})}),e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.values(h).map(a=>e.jsx(he,{control:e.jsx(ot,{checked:M.types.includes(a),onChange:m=>R(a,m.target.checked),size:"small"}),label:be(a)},a))})]})]})]}):e.jsxs(d,{children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"当前模型类型匹配规则"}),k.length>0?k.map((a,m)=>e.jsxs(d,{sx:{p:2,mb:2,border:"1px solid #e0e0e0",borderRadius:1,backgroundColor:"#f9f9f9"},children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(d,{children:[e.jsxs(b,{variant:"body2",children:[e.jsx("strong",{children:"匹配模式:"})," ",a.pattern]}),a.provider&&e.jsxs(b,{variant:"body2",children:[e.jsx("strong",{children:"提供商:"})," ",a.provider]})]}),e.jsx(B,{color:"error",onClick:()=>u(m),children:e.jsx(ye,{})})]}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mt:1},children:[e.jsx(d,{children:e.jsx(b,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"适用类型:"})})}),e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.types.map(j=>e.jsx(pe,{label:be(j),size:"small",sx:{mr:.5,mb:.5}},j))})]})]},m)):e.jsx(Ve,{severity:"info",sx:{mt:2},children:"尚未配置任何类型匹配规则，将使用默认规则。"}),t&&O&&e.jsxs(d,{sx:{mt:4,p:2,border:"1px solid #e0e0e0",borderRadius:1},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"测试模型类型匹配"}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(b,{variant:"body2",sx:{mr:1},children:[e.jsx("strong",{children:"模型ID:"})," ",t]}),e.jsxs(b,{variant:"body2",children:[e.jsx("strong",{children:"提供商:"})," ",O]})]}),e.jsx(_,{variant:"outlined",color:"primary",onClick:v,size:"small",children:"测试匹配"}),W.length>0&&e.jsxs(d,{sx:{mt:2},children:[e.jsx(b,{variant:"body2",children:"匹配结果:"}),e.jsx(d,{display:"flex",flexWrap:"wrap",gap:.5,sx:{mt:1},children:W.map(a=>e.jsx(pe,{label:be(a),color:"primary",size:"small",sx:{mr:.5,mb:.5}},a))})]})]})]})}),e.jsxs(oe,{children:[e.jsx(_,{onClick:s,children:"取消"}),e.jsx(_,{onClick:T,variant:"contained",color:"primary",children:"保存"})]})]})},qr={basic:["chat"],input:["vision","audio"],output:["image_gen","video_gen","transcription","translation"],advanced:["reasoning","function_calling","web_search","tool","code_gen"],data:["embedding","rerank"]},Yr={chat:{description:"基础聊天功能，支持文本对话",color:"#4285F4"},vision:{description:"支持图像理解和分析",color:"#EA4335"},audio:{description:"支持音频处理和理解",color:"#FBBC05"},embedding:{description:"生成文本的向量表示，用于相似度搜索",color:"#34A853"},tool:{description:"支持使用外部工具和API",color:"#8E44AD"},reasoning:{description:"增强的推理能力，适合复杂问题解决",color:"#1ABC9C"},image_gen:{description:"生成图像的能力",color:"#E74C3C"},function_calling:{description:"支持函数调用，可与代码交互",color:"#3498DB"},web_search:{description:"支持网络搜索，获取实时信息",color:"#F39C12"},rerank:{description:"重新排序搜索结果或文档",color:"#16A085"},code_gen:{description:"代码生成和编程辅助",color:"#2C3E50"},translation:{description:"文本翻译功能",color:"#27AE60"},transcription:{description:"语音转文字功能",color:"#D35400"},video_gen:{description:"视频生成功能",color:"#8E44AD"}},Jr=({modelTypes:o,onChange:s,autoDetect:i,onAutoDetectChange:x,modelId:t,provider:O})=>{const k=$e(),[C,M]=l.useState(!1),[z,W]=l.useState([]);l.useEffect(()=>{(async()=>{try{const u=await ve.getSetting("modelTypeRules");W(u||Be)}catch(u){console.error("[EnhancedModelTypeSelector] 加载模型类型规则失败:",u),W(Be)}})()},[]);const N=c=>{if(!i){const u=[...o],v=u.indexOf(c);v===-1?u.push(c):u.splice(v,1),u.length===0&&u.push(h.Chat),s(u)}},P=()=>{M(!0)},A=async c=>{W(c);try{await ve.saveSetting("modelTypeRules",c),console.log("[EnhancedModelTypeSelector] 模型类型规则已保存")}catch(u){console.error("[EnhancedModelTypeSelector] 保存模型类型规则失败:",u)}},w=()=>Object.entries(qr).map(([c,u])=>e.jsxs(d,{sx:{mb:2},children:[e.jsx(b,{variant:"subtitle2",sx:{mb:1,color:"text.secondary",fontSize:"0.8rem",textTransform:"uppercase"},children:n(c)}),e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:u.map(v=>{const p=v,R=Yr[p]||{description:"",color:k.palette.primary.main};return e.jsx(ce,{title:R.description,arrow:!0,placement:"top",children:e.jsx(pe,{label:be(p),color:o.includes(p)?"primary":"default",onClick:()=>!i&&N(p),sx:{mr:.5,mb:.5,bgcolor:o.includes(p)?y(R.color,.2):"default",color:o.includes(p)?R.color:"text.secondary",borderColor:o.includes(p)?R.color:"divider","&:hover":{bgcolor:o.includes(p)?y(R.color,.3):y(k.palette.action.hover,.1)}},disabled:i,variant:o.includes(p)?"filled":"outlined"})},p)})})]},c)),n=c=>({basic:"基础功能",input:"输入能力",output:"输出能力",advanced:"高级功能",data:"数据处理"})[c]||c;return e.jsxs(d,{sx:{mt:3},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{variant:"subtitle2",children:"模型类型"}),e.jsx(ce,{title:"模型类型决定了模型的能力和适用场景。您可以根据需要选择多种类型。",children:e.jsx(B,{size:"small",sx:{ml:.5},children:e.jsx(pr,{fontSize:"small"})})})]}),e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(he,{control:e.jsx(Fe,{checked:i,onChange:c=>x(c.target.checked)}),label:"自动检测"}),e.jsx(ce,{title:"管理模型类型规则",children:e.jsx(B,{size:"small",onClick:P,sx:{ml:1},children:e.jsx(fe,{fontSize:"small"})})})]})]}),e.jsx(Te,{elevation:0,sx:{p:2,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:k.palette.mode==="dark"?y(k.palette.background.paper,.6):y(k.palette.background.paper,.8)},children:w()}),e.jsx(vt,{children:i?"根据模型ID和提供商自动检测模型类型":"点击类型标签来添加或移除"}),e.jsx(Gr,{open:C,onClose:()=>M(!1),rules:z,onSave:A,modelId:t,provider:O})]})},Zr=({open:o,onClose:s,onSave:i,editModel:x})=>{const[t,O]=l.useState({id:"",name:"",provider:"openai",enabled:!0,isDefault:!1}),[k,C]=l.useState({}),[M,z]=l.useState([h.Chat]),[W,N]=l.useState(!0),[P,A]=l.useState(""),[w,n]=l.useState(!1);l.useEffect(()=>{if(x){if(O(x),x.modelTypes)z(x.modelTypes),N(!1);else{const m=Me(x.id,x.provider);z(m),N(!0)}(async()=>{try{const m=await ve.getModel(x.id);m?.avatar&&A(m.avatar)}catch(m){console.error("[SimpleModelDialog] 加载模型头像失败:",m)}})()}},[x,o]);const c=(a,m)=>{if(O({...t,[a]:m}),(a==="id"||a==="provider")&&W){const j={...t,[a]:m},K=Me(j.id,j.provider);z(K)}k[a]&&C({...k,[a]:""})},u=()=>{const a=!W;if(N(a),a){const m=Me(t.id,t.provider);z(m)}},v=()=>{n(!0)},p=()=>{n(!1)},R=async a=>{if(A(a),t.id)try{const{saveModelAvatar:m}=await hr(async()=>{const{saveModelAvatar:j}=await import("./avatarUtils-xfampngn.js");return{saveModelAvatar:j}},__vite__mapDeps([0,1,2]));await m(t.id,a),console.log(`[SimpleModelDialog] 模型头像已保存: ${t.id}`)}catch(m){console.error("[SimpleModelDialog] 保存模型头像失败:",m)}},T=()=>{const a={};return t.name.trim()||(a.name="请输入模型名称"),C(a),Object.keys(a).length===0},D=async()=>{if(T()){const a={...t,modelTypes:W?void 0:M,capabilities:{...t.capabilities,multimodal:M.includes(h.Vision)}};if(x&&x.id!==t.id&&P)try{await ve.saveModel(t.id,{id:t.id,avatar:P,updatedAt:new Date().toISOString()})}catch(m){console.error("[SimpleModelDialog] 保存模型头像到数据库失败:",m)}try{const m={...a,avatar:P,updatedAt:new Date().toISOString()};await ve.saveModel(a.id,m),console.log(`[SimpleModelDialog] 模型配置已保存到数据库: ${a.id}`)}catch(m){console.error("[SimpleModelDialog] 保存模型配置到数据库失败:",m)}i(a),s()}};return e.jsxs(re,{open:o,onClose:s,maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:x?"编辑模型":"添加模型"}),e.jsxs(ne,{children:[e.jsxs(d,{sx:{mb:3,mt:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,p:2,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px solid rgba(25, 118, 210, 0.2)"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(jt,{src:P,sx:{width:48,height:48,mr:2,bgcolor:"#1677ff"},children:!P&&t.name.charAt(0)}),e.jsxs(d,{children:[e.jsx(b,{variant:"body2",fontWeight:"medium",children:"模型头像"}),e.jsx(b,{variant:"caption",color:"text.secondary",children:"为此模型设置自定义头像"})]})]}),e.jsx(ce,{title:"设置头像",children:e.jsx(B,{color:"primary",onClick:v,size:"small",sx:{bgcolor:"rgba(25, 118, 210, 0.12)","&:hover":{bgcolor:"rgba(25, 118, 210, 0.2)"}},children:e.jsx(Tr,{})})})]}),e.jsx($,{fullWidth:!0,label:"模型名称",value:t.name,onChange:a=>c("name",a.target.value),margin:"normal",error:!!k.name,helperText:k.name,required:!0}),e.jsxs(mt,{fullWidth:!0,margin:"normal",children:[e.jsx(xt,{id:"provider-label",children:"提供商"}),e.jsxs(gt,{labelId:"provider-label",value:t.provider,onChange:a=>c("provider",a.target.value),label:"提供商",children:[e.jsx(ee,{value:"openai",children:"OpenAI"}),e.jsx(ee,{value:"anthropic",children:"Anthropic"}),e.jsx(ee,{value:"google",children:"Google"}),e.jsx(ee,{value:"deepseek",children:"DeepSeek"}),e.jsx(ee,{value:"siliconflow",children:"SiliconFlow"}),e.jsx(ee,{value:"volcengine",children:"火山引擎"}),e.jsx(ee,{value:"custom",children:"自定义"})]}),e.jsx(vt,{children:"选择API提供商，可以与模型ID自由组合"})]}),e.jsx($,{fullWidth:!0,label:"模型ID",value:t.id,onChange:a=>c("id",a.target.value),margin:"normal",helperText:"模型的唯一标识符，例如：gpt-4、claude-3-opus"}),e.jsx(Jr,{modelTypes:M,onChange:z,autoDetect:W,onAutoDetectChange:u,modelId:t.id,provider:t.provider})]}),e.jsx(Er,{open:w,onClose:p,onSave:R,currentAvatar:P,title:"设置模型头像"})]}),e.jsxs(oe,{children:[e.jsx(_,{onClick:s,children:"取消"}),e.jsx(_,{onClick:D,variant:"contained",color:"primary",children:"保存"})]})]})},je={MESSAGE_LENGTH_THRESHOLD:80,DEBOUNCE_DELAY:300,SPECIAL_ENDPOINTS:{VOLCES:"volces.com/api/v3",OPENAI_RESPONSE:"openai-response"}},ht={primaryButton:{bgcolor:o=>y(o.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:o=>y(o.palette.primary.main,.2)},borderRadius:2},errorButton:{bgcolor:o=>y(o.palette.error.main,.1),color:"error.main","&:hover":{bgcolor:o=>y(o.palette.error.main,.2)},borderRadius:2}},Qr=(o,s)=>{if(!o.trim())return"";let i=o.trim();return i.endsWith("#")?i.slice(0,-1):(i=i.replace(/\/$/,""),i.includes("/chat/completions")||i.includes("/completions")||i.includes("/models")||i.includes("/v1/")||i.includes("/v2/")||i.includes("/v3/")||i.includes("/v4/")||i.includes("/api/")||i.endsWith("/v1")||i.endsWith("/v2")||i.endsWith("/v3")||i.endsWith("/v4")||i.endsWith(je.SPECIAL_ENDPOINTS.VOLCES)||s===je.SPECIAL_ENDPOINTS.OPENAI_RESPONSE?i:`${i}/v1`)},Xr=(o,s)=>{if(!o.trim())return"";const i=Qr(o,s);return i.includes("/chat/completions")||i.includes("/completions")||i.includes("/models")?i:s===je.SPECIAL_ENDPOINTS.OPENAI_RESPONSE?`${i}/responses`:`${i}/chat/completions`},es=o=>!["anthropic","gemini"].includes(o||""),ts=(o,s)=>o.trim()?o.endsWith("#")?o.slice(0,-1):Xr(o,s):"",rs=(o,s)=>{const[i,x]=l.useState(o);return l.useEffect(()=>{const t=setTimeout(()=>{x(o)},s);return()=>{clearTimeout(t)}},[o,s]),i},fs=()=>{const o=mr(),s=xr(),{providerId:i}=gr(),x=l.useRef(null),t=fr(r=>r.settings.providers.find(g=>g.id===i)),[O,k]=l.useState(""),[C,M]=l.useState(""),[z,W]=l.useState(!0),[N,P]=l.useState(!1),[A,w]=l.useState(!1),[n,c]=l.useState(!1),[u,v]=l.useState(void 0),[p,R]=l.useState(""),[T,D]=l.useState(""),[a,m]=l.useState(""),[j,K]=l.useState(!1),[U,q]=l.useState(!1),[V,f]=l.useState(null),[H,F]=l.useState(null),[Y,Z]=l.useState(!1),[me,ie]=l.useState(!1),[ae,le]=l.useState(""),[S,E]=l.useState({}),[I,G]=l.useState(""),[J,Ge]=l.useState(""),[It,Ce]=l.useState(!1),[Ae,qe]=l.useState(""),[wt,Se]=l.useState(!1),[Ye,Ie]=l.useState(""),[ze,Et]=l.useState(0),[xe,Je]=l.useState(!1),[Pe,Rt]=l.useState(!1),Tt=Ct.getInstance(),De=rs(C,je.DEBOUNCE_DELAY),Oe=l.useMemo(()=>({primary:ht.primaryButton,error:ht.errorButton}),[]);l.useEffect(()=>{t&&(k(t.apiKey||""),M(t.baseUrl||""),W(t.isEnabled),E(t.extraHeaders||{}),Je(!!(t.apiKeys&&t.apiKeys.length>0)))},[t]),l.useEffect(()=>()=>{x.current&&x.current.abort()},[]),l.useEffect(()=>{De&&!_e(De)?m("请输入有效的URL"):m("")},[De]);const Mt=r=>{t&&s(Q({id:t.id,updates:{apiKeys:r,apiKey:r.find(g=>g.isEnabled)?.key||r[0]?.key||""}}))},kt=r=>{t&&s(Q({id:t.id,updates:{keyManagement:{strategy:r,maxFailuresBeforeDisable:t.keyManagement?.maxFailuresBeforeDisable||3,failureRecoveryTime:t.keyManagement?.failureRecoveryTime||5,enableAutoRecovery:t.keyManagement?.enableAutoRecovery||!0}}}))},At=r=>{if(Je(r),t)if(r){const g=t.apiKey;if(g){const L=[Tt.createApiKeyConfig(g,"主要密钥",1)];s(Q({id:t.id,updates:{apiKeys:L,keyManagement:{strategy:"round_robin",maxFailuresBeforeDisable:3,failureRecoveryTime:5,enableAutoRecovery:!0}}}))}}else{const g=t.apiKeys?.[0];s(Q({id:t.id,updates:{apiKey:g?.key||"",apiKeys:void 0,keyManagement:void 0}}))}},zt=()=>{Rt(!Pe)},Ze=l.useCallback(()=>{o("/settings/default-model",{replace:!0})},[o]),ge=l.useCallback(()=>{if(!t)return!1;if(C&&!_e(C))return m("请输入有效的URL"),!1;try{return s(Q({id:t.id,updates:{apiKey:O,baseUrl:C.trim(),isEnabled:z,extraHeaders:S}})),!0}catch(r){return console.error("保存配置失败:",r),m("保存配置失败，请重试"),!1}},[t,C,O,z,S,s]),Pt=l.useCallback(()=>{ge()&&setTimeout(()=>{o("/settings/default-model",{replace:!0})},0)},[ge,o]),Dt=()=>{t&&s(wr(t.id)),w(!1),o("/settings/default-model",{replace:!0})},Ot=()=>{t&&(le(t.name),ie(!0))},Wt=()=>{t&&ae.trim()&&(s(Q({id:t.id,updates:{name:ae.trim()}})),ie(!1),le(""))},_t=()=>{I.trim()&&J.trim()&&(E(r=>({...r,[I.trim()]:J.trim()})),G(""),Ge(""))},Lt=r=>{E(g=>{const L={...g};return delete L[r],L})},Qe=(r,g,L)=>{E(te=>{const X={...te};return r!==g&&delete X[r],X[g]=L,X})},Kt=()=>{qe(""),Ie(""),Se(!0)},Nt=()=>{const r=Ae.trim();if(!r){Ie("请输入端点URL");return}if(!_e(r)){Ie("请输入有效的完整URL");return}t&&(s(Q({id:t.id,updates:{customModelEndpoint:r}})),Se(!1),K(!0))},Ft=()=>{if(t&&p&&T){const r={id:T,name:p,provider:t.id,providerType:t.providerType,enabled:!0,isDefault:!1},g=[...t.models,r];s(Q({id:t.id,updates:{models:g}})),R(""),D(""),P(!1)}},Bt=r=>{if(t&&r){const g=t.models.filter(L=>u?L.id!==u.id:!0);g.push(r),s(Q({id:t.id,updates:{models:g}})),v(void 0),c(!1)}},Xe=r=>{if(t){const g=t.models.filter(L=>L.id!==r);s(Q({id:t.id,updates:{models:g}}))}},Vt=r=>{v(r),R(r.name),D(r.id),c(!0)},Ht=l.useCallback(r=>{if(t){const g={...r,provider:t.id,providerType:t.providerType,enabled:!0};if(t.models.some(X=>X.id===r.id))return;const te=[...t.models,g];s(Q({id:t.id,updates:{models:te}}))}},[t,s]),Ut=l.useCallback(r=>{if(t&&r.length>0){const g=r.filter(te=>!t.models.some(X=>X.id===te.id)).map(te=>({...te,provider:t.id,providerType:t.providerType,enabled:!0}));if(g.length===0)return;const L=[...t.models,...g];s(Q({id:t.id,updates:{models:L}}))}},[t,s]),$t=l.useCallback(r=>{if(t&&r.length>0){const g=t.models.filter(L=>!r.includes(L.id));s(Q({id:t.id,updates:{models:g}}))}},[t,s]),Gt=()=>{ge()?K(!0):a&&alert("请输入有效的基础URL")},qt=l.useCallback(async()=>{if(!t)return;if(!ge()&&a){f({success:!1,message:"请输入有效的基础URL"});return}x.current&&x.current.abort(),x.current=new AbortController,q(!0),f(null);try{const g={id:t.models.length>0?t.models[0].id:"gpt-3.5-turbo",name:t.name,provider:t.id,providerType:t.providerType,apiKey:O,baseUrl:C,enabled:!0},L=await br(g);if(x.current?.signal.aborted)return;f(L?{success:!0,message:"连接成功！API配置有效。"}:{success:!1,message:"连接失败，请检查API密钥和基础URL是否正确。"})}catch(g){if(g instanceof Error&&g.name==="AbortError")return;console.error("测试API连接时出错:",g),f({success:!1,message:`连接错误: ${g instanceof Error?g.message:String(g)}`})}finally{q(!1),x.current=null}},[t,ge,a,O,C]),Yt=async r=>{if(t){F(r.id),f(null);try{const g={...r,apiKey:O,baseUrl:C,enabled:!0};let L;if(t.providerType==="openai-response")try{const X=await new Sr(g).sendChatMessage([{role:"user",content:"这是一条API测试消息，请简短回复以验证连接。"}],{assistant:{temperature:.7,maxTokens:50}});L={success:!0,content:typeof X=="string"?X:X.content}}catch(te){L={success:!1,error:te.message||"测试失败"}}else L=await Ir({messages:[{role:"user",content:"这是一条API测试消息，请简短回复以验证连接。"}],modelId:g.id});L.success?f({success:!0,message:`模型 ${r.name} 连接成功!

响应内容: "${L.content?.substring(0,100)}${L.content&&L.content.length>100?"...":""}"`}):f({success:!1,message:`模型 ${r.name} 连接失败：${L.error||"未知错误"}`})}catch(g){console.error("测试模型连接时出错:",g),f({success:!1,message:`连接错误: ${g instanceof Error?g.message:String(g)}`})}finally{F(null)}}},et=l.useMemo(()=>V&&V.message&&V.message.length>je.MESSAGE_LENGTH_THRESHOLD,[V]);return l.useEffect(()=>{et&&Z(!0)},[et]),t?e.jsxs(d,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:r=>r.palette.mode==="light"?y(r.palette.primary.main,.02):y(r.palette.background.default,.9)},children:[e.jsx(yr,{position:"fixed",elevation:0,sx:{zIndex:r=>r.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(vr,{children:[e.jsx(B,{edge:"start",onClick:Ze,"aria-label":"back",sx:{color:r=>r.palette.primary.main},children:e.jsx(jr,{size:20})}),e.jsx(b,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:t.name}),e.jsx(_,{onClick:Pt,sx:Oe.primary,children:"保存"})]})}),e.jsxs(d,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:[e.jsxs(Te,{elevation:0,sx:{p:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)",mb:3},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(jt,{sx:{width:56,height:56,bgcolor:t.color||"#9333EA",fontSize:"1.5rem",mr:2,boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:t.avatar}),e.jsxs(d,{children:[e.jsx(b,{variant:"h6",sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:t.name}),e.jsx(b,{variant:"body2",color:"text.secondary",children:t.isSystem?"系统供应商":`${t.providerType||"Custom"} API`})]}),e.jsx(d,{sx:{ml:"auto",display:"flex",gap:1},children:!t.isSystem&&e.jsxs(e.Fragment,{children:[e.jsx(B,{onClick:Ot,sx:{bgcolor:r=>y(r.palette.info.main,.1),"&:hover":{bgcolor:r=>y(r.palette.info.main,.2)}},children:e.jsx(Ne,{size:20,color:"#0288d1"})}),e.jsx(B,{color:"error",onClick:()=>w(!0),sx:Oe.error,children:e.jsx(ye,{size:20})})]})})]}),t.isSystem?e.jsxs(d,{sx:{p:2,bgcolor:r=>y(r.palette.info.main,.1),borderRadius:2,border:"1px solid",borderColor:r=>y(r.palette.info.main,.3)},children:[e.jsx(b,{variant:"body2",color:"info.main",sx:{fontWeight:500},children:"🧠 系统供应商说明"}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"模型组合供应商是系统内置的虚拟供应商，它使用您配置的模型组合来提供服务。 模型组合中的各个模型会使用它们各自配置的 API 密钥和基础 URL。"})]}):e.jsxs(e.Fragment,{children:[e.jsx(yt,{sx:{my:3}}),e.jsx(b,{variant:"subtitle1",sx:{mb:2,fontWeight:600,color:"text.primary"},children:"API配置"}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"启用状态"}),e.jsx(he,{control:e.jsx(Fe,{checked:z,onChange:r=>W(r.target.checked)}),label:z?"已启用":"已禁用"})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"API Key 管理模式"}),e.jsx(he,{control:e.jsx(Fe,{checked:xe,onChange:r=>At(r.target.checked)}),label:xe?"多 Key 负载均衡模式":"单 Key 模式"}),e.jsx(b,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:xe?"启用多个 API Key 进行负载均衡和故障转移":"使用单个 API Key（传统模式）"})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsxs(Mr,{value:ze,onChange:(r,g)=>Et(g),sx:{mb:2},children:[e.jsx(at,{label:xe?"多 Key 管理":"API 密钥"}),e.jsx(at,{label:"基础配置"})]}),ze===0&&e.jsx(d,{children:xe?e.jsx(Or,{providerName:t.name,providerType:t.providerType||"openai",apiKeys:t.apiKeys||[],strategy:t.keyManagement?.strategy||"round_robin",onKeysChange:Mt,onStrategyChange:kt}):e.jsxs(d,{children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"API密钥"}),e.jsx($,{fullWidth:!0,placeholder:"输入API密钥",value:O,onChange:r=>k(r.target.value),variant:"outlined",type:Pe?"text":"password",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},slotProps:{input:{"aria-invalid":!1,"aria-describedby":"provider-settings-api-key-helper-text",endAdornment:e.jsx(kr,{position:"end",children:e.jsx(B,{"aria-label":"切换API密钥可见性",onClick:zt,edge:"end",size:"small",sx:{"&:hover":{bgcolor:"action.hover",transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"},children:Pe?e.jsx(St,{size:16}):e.jsx(bt,{size:16})})})},formHelperText:{id:"provider-settings-api-key-helper-text"}}})]})}),ze===1&&e.jsxs(d,{children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"基础URL (可选)"}),e.jsx($,{fullWidth:!0,placeholder:"输入基础URL，例如: https://tow.bt6.top",value:C,onChange:r=>{M(r.target.value),m("")},error:!!a,helperText:e.jsxs("span",{children:[a&&e.jsx("span",{style:{display:"block",color:"error.main",marginBottom:"4px",fontSize:"0.75rem"},children:a}),e.jsx("span",{style:{display:"block",color:"text.secondary",marginBottom:"4px",fontSize:"0.75rem"},children:"支持基础URL（如 https://api.example.com）或完整API路径（如 https://api.suanli.cn/v3/chat/completions）"}),e.jsx("span",{style:{display:"block",color:"text.secondary",marginBottom:"4px",fontSize:"0.75rem"},children:"在URL末尾添加#可强制使用原始格式，不进行任何路径处理"}),C&&es(t?.providerType)&&e.jsxs("span",{style:{display:"inline-block",color:C.endsWith("#")?"#ed6c02":C.includes("/chat/completions")||C.includes("/completions")?"#2e7d32":"#666",fontFamily:"monospace",fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.04)",padding:"2px 6px",borderRadius:"4px",marginTop:"4px"},children:[C.endsWith("#")?"强制原始格式: ":C.includes("/chat/completions")||C.includes("/completions")?"检测到完整路径: ":"将使用: ",ts(C,t?.providerType)]})]}),variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})]}),e.jsxs(d,{sx:{mb:3},children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,color:"text.secondary",children:"自定义请求头 (可选)"}),e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(_,{variant:"outlined",startIcon:e.jsx(fe,{size:16}),onClick:()=>Ce(!0),sx:{borderRadius:2,borderColor:r=>y(r.palette.secondary.main,.5),color:"secondary.main","&:hover":{borderColor:"secondary.main",bgcolor:r=>y(r.palette.secondary.main,.1)}},children:"配置请求头"}),Object.keys(S).length>0&&e.jsxs(b,{variant:"caption",color:"text.secondary",children:["已配置 ",Object.keys(S).length," 个请求头"]})]})]}),e.jsx(d,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(_,{variant:"outlined",startIcon:U?e.jsx(ke,{size:16}):e.jsx(Re,{size:16}),onClick:qt,disabled:U||!O&&(!t.apiKeys||t.apiKeys.length===0),sx:{borderRadius:2,borderColor:r=>y(r.palette.info.main,.5),color:"info.main","&:hover":{borderColor:"info.main",bgcolor:r=>y(r.palette.info.main,.1)}},children:U?"测试中...":"测试连接"})})]})]})]})]}),e.jsxs(Te,{elevation:0,sx:{p:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(b,{variant:"subtitle1",sx:{fontWeight:600,flex:1,color:"text.primary"},children:t.isSystem?"模型组合":"可用模型"}),t.isSystem?e.jsx(_,{variant:"outlined",startIcon:e.jsx(fe,{size:16}),onClick:()=>window.location.href="/settings/model-combo",sx:{borderRadius:2,borderColor:r=>y(r.palette.primary.main,.5),color:"primary.main","&:hover":{borderColor:"primary.main",bgcolor:r=>y(r.palette.primary.main,.1)}},children:"管理组合"}):e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"caption",color:"text.secondary",sx:{mr:2,display:{xs:"none",sm:"block"}},children:"点击✓测试单个模型"}),e.jsxs(d,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(_,{variant:"outlined",startIcon:e.jsx(Ar,{size:16}),onClick:Gt,sx:{borderRadius:2,borderColor:r=>y(r.palette.info.main,.5),color:"info.main","&:hover":{borderColor:"info.main",bgcolor:r=>y(r.palette.info.main,.1)}},children:"自动获取"}),e.jsx(B,{size:"small",onClick:Kt,sx:{ml:.5,color:"info.main","&:hover":{bgcolor:r=>y(r.palette.info.main,.1)}},title:"配置自定义模型端点",children:e.jsx(fe,{size:16})})]}),e.jsx(_,{startIcon:e.jsx(de,{size:16}),onClick:()=>P(!0),sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"手动添加"})]})]}),e.jsxs(ft,{sx:{width:"100%"},children:[t.models.map(r=>e.jsx(Te,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.05)",borderColor:g=>y(g.palette.primary.main,.3)}},children:e.jsx(He,{secondaryAction:t.isSystem?e.jsx(d,{children:e.jsx(B,{"aria-label":"edit-combo",onClick:()=>o("/settings/model-combo"),sx:Oe.primary,children:e.jsx(fe,{size:20,color:"#1976d2"})})}):e.jsxs(d,{children:[e.jsx(B,{"aria-label":"test",onClick:()=>Yt(r),disabled:H!==null,sx:{mr:1,bgcolor:g=>y(g.palette.success.main,.1),"&:hover":{bgcolor:g=>y(g.palette.success.main,.2)}},children:H===r.id?e.jsx(ke,{size:16,color:"success"}):e.jsx(Re,{size:16,color:"#2e7d32"})}),e.jsx(B,{"aria-label":"edit",onClick:()=>Vt(r),sx:{mr:1,bgcolor:g=>y(g.palette.info.main,.1),"&:hover":{bgcolor:g=>y(g.palette.info.main,.2)}},children:e.jsx(Ne,{size:20,color:"#0288d1"})}),e.jsx(B,{"aria-label":"delete",onClick:()=>Xe(r.id),sx:{bgcolor:g=>y(g.palette.error.main,.1),"&:hover":{bgcolor:g=>y(g.palette.error.main,.2)}},children:e.jsx(ye,{size:20,color:"#d32f2f"})})]}),children:e.jsx(Ue,{primary:e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{variant:"subtitle2",fontWeight:600,children:r.name}),r.isDefault&&e.jsx(d,{sx:{ml:1,px:1,py:.2,borderRadius:1,fontSize:"0.7rem",fontWeight:600,bgcolor:g=>y(g.palette.success.main,.1),color:"success.main"},children:"默认"})]}),secondary:e.jsxs(b,{variant:"body2",color:"text.secondary",fontSize:"0.8rem",children:["ID: ",r.id]})})})},r.id)),t.models.length===0&&e.jsxs(d,{sx:{textAlign:"center",py:3},children:[e.jsx(b,{color:"text.secondary",children:t.isSystem?"尚未创建任何模型组合":"尚未添加任何模型"}),t.isSystem&&e.jsx(_,{variant:"outlined",startIcon:e.jsx(de,{size:16}),onClick:()=>window.location.href="/settings/model-combo",sx:{mt:2},children:"创建模型组合"})]})]})]}),e.jsx(Cr,{open:V!==null&&!Y,autoHideDuration:6e3,onClose:()=>f(null),anchorOrigin:{vertical:"bottom",horizontal:"center"},action:e.jsx(_,{color:"inherit",size:"small",onClick:()=>Z(!0),children:"查看详情"}),children:e.jsx(Ve,{onClose:()=>f(null),severity:V?.success?"success":"error",variant:"filled",sx:{width:"100%"},children:V?.success?"连接测试成功!":"连接测试失败"})}),e.jsxs(re,{open:Y,onClose:()=>Z(!1),maxWidth:"md",slotProps:{paper:{sx:{width:"100%",maxWidth:500,borderRadius:2}}},children:[e.jsxs(se,{sx:{fontWeight:600,color:V?.success?"success.main":"error.main",display:"flex",alignItems:"center"},children:[V?.success?e.jsx(Re,{size:20,style:{marginRight:8},color:"#2e7d32"}):null,"API测试结果"]}),e.jsx(ne,{children:e.jsx(b,{sx:{whiteSpace:"pre-wrap"},children:V?.message||""})}),e.jsx(oe,{sx:{p:2},children:e.jsx(_,{onClick:()=>Z(!1),variant:"contained",color:V?.success?"success":"primary",sx:{borderRadius:2},children:"确定"})})]})]}),e.jsxs(re,{open:N,onClose:()=>P(!1),children:[e.jsx(se,{sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"添加模型"}),e.jsxs(ne,{children:[e.jsx($,{autoFocus:!0,margin:"dense",label:"模型名称",placeholder:"例如: GPT-4o",type:"text",fullWidth:!0,variant:"outlined",value:p,onChange:r=>R(r.target.value),sx:{mb:2,mt:2}}),e.jsx($,{margin:"dense",label:"模型ID",placeholder:"例如: gpt-4o",type:"text",fullWidth:!0,variant:"outlined",value:T,onChange:r=>D(r.target.value)})]}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(_,{onClick:()=>P(!1),children:"取消"}),e.jsx(_,{onClick:Ft,disabled:!p||!T,sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"添加"})]})]}),e.jsx(Zr,{open:n,onClose:()=>c(!1),onSave:Bt,editModel:u}),e.jsxs(re,{open:A,onClose:()=>w(!1),children:[e.jsx(se,{fontWeight:600,children:"删除提供商"}),e.jsx(ne,{children:e.jsxs(b,{children:["确定要删除 ",e.jsx("b",{children:t.name})," 提供商吗？这将同时删除所有相关的模型配置。"]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(_,{onClick:()=>w(!1),children:"取消"}),e.jsx(_,{onClick:Dt,color:"error",sx:{bgcolor:r=>y(r.palette.error.main,.1),"&:hover":{bgcolor:r=>y(r.palette.error.main,.2)},borderRadius:2},children:"删除"})]})]}),e.jsxs(re,{open:me,onClose:()=>ie(!1),children:[e.jsx(se,{sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"编辑供应商名称"}),e.jsx(ne,{children:e.jsx($,{autoFocus:!0,margin:"dense",label:"供应商名称",placeholder:"例如: 我的智谱AI",type:"text",fullWidth:!0,variant:"outlined",value:ae,onChange:r=>le(r.target.value),sx:{mb:2,mt:2}})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(_,{onClick:()=>ie(!1),children:"取消"}),e.jsx(_,{onClick:Wt,disabled:!ae.trim(),sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"保存"})]})]}),e.jsxs(re,{open:It,onClose:()=>Ce(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"配置自定义请求头"}),e.jsxs(ne,{children:[e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"用于解决 CORS 问题或添加特殊认证头"}),e.jsxs(d,{sx:{mb:3,p:2,bgcolor:"grey.50",borderRadius:2},children:[e.jsx(b,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"快速操作"}),e.jsxs(d,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(_,{size:"small",variant:"outlined",onClick:()=>{E(r=>({...r,"x-stainless-timeout":"REMOVE"}))},sx:{fontSize:"0.75rem"},children:"禁用 x-stainless-timeout"}),e.jsx(_,{size:"small",variant:"outlined",onClick:()=>{E(r=>({...r,"x-stainless-retry-count":"REMOVE"}))},sx:{fontSize:"0.75rem"},children:"禁用 x-stainless-retry-count"}),e.jsx(_,{size:"small",variant:"outlined",color:"error",onClick:()=>{E(r=>({...r,"x-stainless-timeout":"REMOVE","x-stainless-retry-count":"REMOVE","x-stainless-arch":"REMOVE","x-stainless-lang":"REMOVE","x-stainless-os":"REMOVE","x-stainless-package-version":"REMOVE","x-stainless-runtime":"REMOVE","x-stainless-runtime-version":"REMOVE"}))},sx:{fontSize:"0.75rem"},children:"禁用所有 stainless 头部"})]}),e.jsx(b,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:'设置值为 "REMOVE" 可以禁用默认的请求头'})]}),Object.entries(S).map(([r,g])=>e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2,gap:1},children:[e.jsx($,{size:"small",label:"请求头名称",value:r,onChange:L=>Qe(r,L.target.value,g),sx:{flex:1}}),e.jsx($,{size:"small",label:"请求头值",value:g,onChange:L=>Qe(r,r,L.target.value),sx:{flex:1,"& .MuiInputBase-input":{color:g==="REMOVE"?"error.main":"inherit"}},helperText:g==="REMOVE"?"此头部将被禁用":"",slotProps:{formHelperText:{sx:{color:"error.main",fontSize:"0.7rem"}}}}),e.jsx(B,{onClick:()=>Lt(r),sx:{color:"error.main","&:hover":{bgcolor:L=>y(L.palette.error.main,.1)}},children:e.jsx(ye,{size:20})})]},r)),e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1,mt:3,p:2,bgcolor:"grey.50",borderRadius:2},children:[e.jsx($,{size:"small",label:"新请求头名称",placeholder:"例如: x-stainless-timeout",value:I,onChange:r=>G(r.target.value),sx:{flex:1}}),e.jsx($,{size:"small",label:"新请求头值",placeholder:"例如: 30000",value:J,onChange:r=>Ge(r.target.value),sx:{flex:1}}),e.jsx(_,{startIcon:e.jsx(de,{size:16}),onClick:_t,disabled:!I.trim()||!J.trim(),sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"添加"})]})]}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(_,{onClick:()=>Ce(!1),children:"取消"}),e.jsx(_,{onClick:()=>Ce(!1),sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"确定"})]})]}),e.jsxs(re,{open:wt,onClose:()=>Se(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"配置自定义模型端点"}),e.jsxs(ne,{children:[e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"输入完整的模型端点URL，系统将同时从默认端点和自定义端点获取模型列表并合并。"}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:2,fontWeight:500},children:"示例：https://api.example.com/v1/models"}),e.jsx($,{autoFocus:!0,margin:"dense",label:"自定义端点URL",placeholder:"https://api.example.com/v1/models",type:"url",fullWidth:!0,variant:"outlined",value:Ae,onChange:r=>{qe(r.target.value),Ie("")},error:!!Ye,helperText:Ye||"请输入完整的URL，包括协议（http://或https://）",sx:{mt:2}})]}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(_,{onClick:()=>Se(!1),children:"取消"}),e.jsx(_,{onClick:Nt,disabled:!Ae.trim(),sx:{bgcolor:r=>y(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>y(r.palette.primary.main,.2)},borderRadius:2},children:"确定"})]})]}),t&&e.jsx($r,{open:j,onClose:()=>K(!1),provider:t,onAddModel:Ht,onAddModels:Ut,onRemoveModel:Xe,onRemoveModels:$t,existingModels:t.models||[]})]}):e.jsxs(d,{sx:{p:3},children:[e.jsx(b,{children:"未找到该提供商，请返回设置页面"}),e.jsx(_,{onClick:Ze,children:"返回"})]})};export{fs as default};
