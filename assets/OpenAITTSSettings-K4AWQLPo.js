import{r,j as e,d as f,H as v,G as L,I as E,br as N,J as j,S as k,K as w,L as T,N as H,af as M,_ as G,u as J,ae as n,B as I,A as Y,T as q,b as Q,f as X,a as C,g as K,P as Z,ag as $,e as ee,ad as p}from"./index-5OteHtpV.js";import{TTSService as ae}from"./TTSService-Dt-r3wSN.js";import{S as se}from"./Stack-6qTbuoMo.js";import{E as te}from"./eye-off-C7c48bdq.js";import{T as le}from"./TTSTestSection-CuWdXfnt.js";import"./useThemeProps-CP38LDNq.js";import"./volume-2-CZ9kkBnD.js";const re=[{value:"tts-1",label:"TTS-1 - 标准质量，速度快"},{value:"tts-1-hd",label:"TTS-1-HD - 高清质量，更自然"}],oe=[{value:"alloy",label:"Alloy - 中性，平衡"},{value:"echo",label:"Echo - 男性，深沉"},{value:"fable",label:"Fable - 英式，优雅"},{value:"onyx",label:"Onyx - 男性，深沉有力"},{value:"nova",label:"Nova - 女性，年轻活泼"},{value:"shimmer",label:"Shimmer - 女性，温柔"}],ie=[{value:"mp3",label:"MP3 - 通用格式，兼容性好"},{value:"opus",label:"Opus - 高压缩比，适合网络传输"},{value:"aac",label:"AAC - 高质量，适合移动设备"},{value:"flac",label:"FLAC - 无损压缩，最高质量"},{value:"wav",label:"WAV - 无压缩，最大兼容性"},{value:"pcm",label:"PCM - 原始音频数据"}],ne=({settings:t,onSettingsChange:a})=>{const x=r.useCallback(s=>{a({...t,apiKey:s})},[t,a]),i=r.useCallback(()=>{a({...t,showApiKey:!t.showApiKey})},[t,a]),A=r.useCallback(s=>{a({...t,selectedModel:s})},[t,a]),l=r.useCallback(s=>{a({...t,selectedVoice:s})},[t,a]),y=r.useCallback(s=>{a({...t,selectedFormat:s})},[t,a]),c=r.useCallback(s=>{a({...t,speed:s})},[t,a]),m=r.useCallback(s=>{a({...t,useStream:s})},[t,a]),b=r.useCallback(s=>{s.preventDefault()},[]);return e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"OpenAI TTS API 设置"}),e.jsx("form",{onSubmit:b,children:e.jsxs(se,{spacing:3,children:[e.jsx(v,{fullWidth:!0,variant:"outlined",children:e.jsx(L,{label:"OpenAI API密钥",variant:"outlined",value:t.apiKey,onChange:s=>x(s.target.value),type:t.showApiKey?"text":"password",placeholder:"请输入OpenAI API密钥",helperText:"获取API密钥请访问：https://platform.openai.com/api-keys",slotProps:{input:{endAdornment:e.jsx(E,{onClick:i,edge:"end",children:t.showApiKey?e.jsx(te,{}):e.jsx(N,{})})}},sx:{mb:2}})}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(j,{children:"TTS模型"}),e.jsx(k,{value:t.selectedModel,onChange:s=>A(s.target.value),label:"TTS模型",MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:re.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))}),e.jsx(T,{children:"TTS-1适合快速生成，TTS-1-HD质量更高但速度较慢"})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(j,{children:"语音选择"}),e.jsx(k,{value:t.selectedVoice,onChange:s=>l(s.target.value),label:"语音选择",MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:oe.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))}),e.jsx(T,{children:"选择您喜欢的语音风格，每种语音都有独特的特色"})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(j,{children:"输出格式"}),e.jsx(k,{value:t.selectedFormat,onChange:s=>y(s.target.value),label:"输出格式",MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:ie.map(s=>e.jsx(w,{value:s.value,children:s.label},s.value))}),e.jsx(T,{children:"推荐使用MP3格式，兼容性最好"})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(f,{gutterBottom:!0,children:"语速控制"}),e.jsx(H,{value:t.speed,min:.25,max:4,step:.05,onChange:(s,h)=>c(h),valueLabelDisplay:"auto",marks:[{value:.25,label:"0.25x"},{value:1,label:"1.0x"},{value:4,label:"4.0x"}]}),e.jsx(T,{children:"调整语音播放速度 (0.25x - 4.0x，默认1.0x)"})]}),e.jsx(M,{control:e.jsx(G,{checked:t.useStream,onChange:s=>m(s.target.checked),color:"primary"}),label:"启用流式传输"}),e.jsx(T,{children:"流式传输可以更快地开始播放，但可能影响音质"})]})})]})},he=()=>{const t=J(),a=r.useMemo(()=>ae.getInstance(),[]),x=r.useRef(null),i=r.useRef(null),A=r.useRef(null),[l,y]=r.useState({apiKey:"",showApiKey:!1,selectedModel:"tts-1",selectedVoice:"alloy",selectedFormat:"mp3",speed:1,useStream:!1}),[c,m]=r.useState({isSaved:!1,saveError:"",isTestPlaying:!1}),[b,s]=r.useState("你好，我是OpenAI语音合成服务，感谢你的使用！"),[h,R]=r.useState(!0),[S,O]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const u=await p("openai_tts_api_key")||"",d=await p("openai_tts_model")||"tts-1",g=await p("openai_tts_voice")||"alloy",_=await p("openai_tts_format")||"mp3",P=Number(await p("openai_tts_speed")||"1.0"),F=await p("openai_tts_stream")==="true",z=await p("enable_tts")!=="false",D=await p("selected_tts_service")||"siliconflow";y({apiKey:u,showApiKey:!1,selectedModel:d,selectedVoice:g,selectedFormat:_,speed:P,useStream:F}),R(z),O(D==="openai"),a.setOpenAIApiKey(u),a.setOpenAIModel(d),a.setOpenAIVoice(g),a.setOpenAIResponseFormat(_),a.setOpenAISpeed(P),a.setUseOpenAIStream(F)}catch(u){console.error("加载OpenAI TTS设置失败:",u)}})()},[a]);const V=r.useCallback(async()=>{try{await n("openai_tts_api_key",l.apiKey),await n("openai_tts_model",l.selectedModel),await n("openai_tts_voice",l.selectedVoice),await n("openai_tts_format",l.selectedFormat),await n("openai_tts_speed",l.speed.toString()),await n("openai_tts_stream",l.useStream.toString()),await n("enable_tts",h.toString()),S?(await n("selected_tts_service","openai"),await n("use_openai_tts","true"),await n("use_azure_tts","false")):await n("use_openai_tts","false"),a.setOpenAIApiKey(l.apiKey),a.setOpenAIModel(l.selectedModel),a.setOpenAIVoice(l.selectedVoice),a.setOpenAIResponseFormat(l.selectedFormat),a.setOpenAISpeed(l.speed),a.setUseOpenAIStream(l.useStream),S?(a.setUseOpenAI(!0),a.setUseAzure(!1)):a.setUseOpenAI(!1),x.current&&clearTimeout(x.current),setTimeout(()=>{t("/settings/voice")},0)}catch(o){console.error("保存OpenAI TTS设置失败:",o),m(u=>({...u,saveError:"保存设置失败，请重试"}))}},[l,h,S,a]),B=r.useCallback(o=>{O(o)},[]),W=r.useCallback(async()=>{if(c.isTestPlaying){a.stop(),i.current&&clearInterval(i.current),m(d=>({...d,isTestPlaying:!1}));return}m(d=>({...d,isTestPlaying:!0})),a.setUseOpenAI(!0),a.setUseAzure(!1),a.setOpenAIApiKey(l.apiKey),a.setOpenAIModel(l.selectedModel),a.setOpenAIVoice(l.selectedVoice),a.setOpenAIResponseFormat(l.selectedFormat),a.setOpenAISpeed(l.speed),a.setUseOpenAIStream(l.useStream),await a.speak(b)||m(d=>({...d,isTestPlaying:!1})),i.current&&clearInterval(i.current);const u=()=>{a.getIsPlaying()?i.current=setTimeout(u,1e3):(m(d=>({...d,isTestPlaying:!1})),i.current&&(clearInterval(i.current),i.current=null))};setTimeout(u,1e3)},[c.isTestPlaying,l,b,a]),U=()=>{t("/settings/voice")};return r.useEffect(()=>()=>{x.current&&clearTimeout(x.current),i.current&&clearInterval(i.current),A.current&&clearTimeout(A.current),c.isTestPlaying&&a.stop()},[c.isTestPlaying,a]),e.jsxs(I,{sx:{display:"flex",flexDirection:"column",height:"100vh",width:"100vw",overflow:"hidden",bgcolor:"background.default"},children:[e.jsx(Y,{position:"fixed",elevation:0,sx:{zIndex:o=>o.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",background:"rgba(255, 255, 255, 0.8)","@media (prefers-color-scheme: dark)":{background:"rgba(18, 18, 18, 0.8)"}},children:e.jsxs(q,{sx:{minHeight:{xs:56,sm:64},px:{xs:1,sm:2,md:3}},children:[e.jsx(E,{edge:"start",onClick:U,"aria-label":"返回",size:"large",sx:{color:"primary.main",mr:{xs:1,sm:2},"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"},children:e.jsx(Q,{size:20})}),e.jsx(f,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:"OpenAI TTS 设置"}),e.jsx(X,{onClick:V,variant:"contained",sx:{bgcolor:"primary.main",color:"primary.contrastText","&:hover":{bgcolor:"primary.dark"},borderRadius:2,px:3},children:"保存"})]})}),e.jsx(I,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,bgcolor:o=>o.palette.mode==="light"?C(o.palette.primary.main,.02):C(o.palette.background.default,.9),"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:e.jsxs(I,{sx:{width:"100%"},children:[c.isSaved&&e.jsx(K,{severity:"success",sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:"设置已保存成功"}),c.saveError&&e.jsx(K,{severity:"error",sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:c.saveError}),e.jsxs(Z,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",background:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsx(f,{variant:"h6",sx:{mb:3,fontWeight:600},children:"API配置"}),e.jsxs(I,{sx:{mb:3},children:[e.jsx(M,{control:e.jsx($,{checked:S,onChange:o=>B(o.target.checked)}),label:"启用 OpenAI TTS 服务"}),e.jsx(f,{variant:"body2",color:"text.secondary",sx:{mt:1,ml:4},children:"启用后，此服务将成为默认的文本转语音服务。启用其他TTS服务会自动禁用此服务。"})]}),e.jsx(ee,{sx:{mb:3}}),e.jsx(ne,{settings:l,onSettingsChange:y})]}),e.jsx(le,{testText:b,setTestText:s,handleTestTTS:W,isTestPlaying:c.isTestPlaying,enableTTS:h,selectedTTSService:"openai",openaiApiKey:l.apiKey,azureApiKey:"",siliconFlowApiKey:""})]})})]})};export{he as default};
