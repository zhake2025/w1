import{u as P,r as l,ae as o,j as e,B as s,A as N,T as W,I as M,b as q,d,f as p,a as R,g as h,P as f,af as b,ag as m,H as D,J as H,S as U,K as i,L as j,ad as n}from"./index-5OteHtpV.js";import{u as G}from"./useVoiceRecognition-DXvl9yRD.js";import{v as J}from"./VoiceRecognitionService-CIHxMX2o.js";import{S as K}from"./square-BA8MCZc2.js";import{M as V}from"./mic-CkhU9HLo.js";const re=()=>{const x=P(),[t,v]=l.useState({enabled:!0,language:"zh-CN",autoStart:!1,silenceTimeout:2e3,maxResults:5,partialResults:!0,permissionStatus:"unknown",provider:"capacitor"}),[S,w]=l.useState({saveError:""}),[Y,O]=l.useState(!0),{isListening:c,recognitionText:k,permissionStatus:y,error:_,startRecognition:C,stopRecognition:I}=G();l.useEffect(()=>{(async()=>{try{const a=await n("speech_recognition_enabled")!=="false",g=await n("speech_recognition_language")||"zh-CN",B=await n("speech_recognition_auto_start")==="true",z=Number(await n("speech_recognition_silence_timeout")||"2000"),F=Number(await n("speech_recognition_max_results")||"5"),L=await n("speech_recognition_partial_results")!=="false";v({enabled:a,language:g,autoStart:B,silenceTimeout:z,maxResults:F,partialResults:L,permissionStatus:"unknown",provider:"capacitor"})}catch(a){console.error("加载Capacitor ASR设置失败:",a)}})()},[]);const E=l.useCallback(async()=>{try{await o("speech_recognition_enabled",t.enabled.toString()),await o("speech_recognition_language",t.language),await o("speech_recognition_auto_start",t.autoStart.toString()),await o("speech_recognition_silence_timeout",t.silenceTimeout.toString()),await o("speech_recognition_max_results",t.maxResults.toString()),await o("speech_recognition_partial_results",t.partialResults.toString()),await o("speech_recognition_provider","capacitor"),setTimeout(()=>{x("/settings/voice")},0)}catch(r){console.error("保存Capacitor ASR设置失败:",r),w(a=>({...a,saveError:"保存设置失败，请重试"}))}},[t,x]),A=async()=>{try{const r=await J.requestPermissions();console.log("权限状态:",r)}catch(r){console.error("请求权限失败:",r)}},T=()=>{x("/settings/voice")},u=(r,a)=>{v(g=>({...g,[r]:a}))};return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",height:"100vh",width:"100vw",overflow:"hidden",bgcolor:"background.default"},children:[e.jsx(N,{position:"fixed",elevation:0,sx:{zIndex:r=>r.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",background:"rgba(255, 255, 255, 0.8)","@media (prefers-color-scheme: dark)":{background:"rgba(18, 18, 18, 0.8)"}},children:e.jsxs(W,{sx:{minHeight:{xs:56,sm:64},px:{xs:1,sm:2,md:3}},children:[e.jsx(M,{edge:"start",onClick:T,"aria-label":"返回",size:"large",sx:{color:"primary.main",mr:{xs:1,sm:2},"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"},children:e.jsx(q,{size:20})}),e.jsx(d,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:"Capacitor 语音识别设置"}),e.jsx(p,{onClick:E,variant:"contained",sx:{bgcolor:"primary.main",color:"primary.contrastText","&:hover":{bgcolor:"primary.dark"},borderRadius:2,px:3},children:"保存"})]})}),e.jsx(s,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,bgcolor:r=>r.palette.mode==="light"?R(r.palette.primary.main,.02):R(r.palette.background.default,.9),"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:e.jsxs(s,{sx:{width:"100%"},children:[S.saveError&&e.jsx(h,{severity:"error",sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:S.saveError}),e.jsxs(f,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",background:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsx(d,{variant:"h6",sx:{mb:3,fontWeight:600},children:"语音识别配置"}),e.jsx(s,{sx:{mb:3},children:e.jsx(b,{control:e.jsx(m,{checked:t.enabled,onChange:r=>u("enabled",r.target.checked)}),label:"启用语音识别功能"})}),e.jsxs(D,{fullWidth:!0,sx:{mb:3},children:[e.jsx(H,{children:"默认语言"}),e.jsxs(U,{value:t.language,onChange:r=>u("language",r.target.value),label:"默认语言",MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(i,{value:"zh-CN",children:"中文 (普通话)"}),e.jsx(i,{value:"en-US",children:"English (US)"}),e.jsx(i,{value:"ja-JP",children:"日本語"}),e.jsx(i,{value:"ko-KR",children:"한국어"}),e.jsx(i,{value:"fr-FR",children:"Français"}),e.jsx(i,{value:"de-DE",children:"Deutsch"}),e.jsx(i,{value:"es-ES",children:"Español"})]}),e.jsx(j,{children:"选择语音识别的默认语言。"})]}),e.jsxs(s,{sx:{mb:3},children:[e.jsx(b,{control:e.jsx(m,{checked:t.autoStart,onChange:r=>u("autoStart",r.target.checked)}),label:"自动开始识别"}),e.jsx(j,{children:"启用后，打开聊天页面时会自动开始语音识别。"})]}),e.jsxs(s,{sx:{mb:3},children:[e.jsx(b,{control:e.jsx(m,{checked:t.partialResults,onChange:r=>u("partialResults",r.target.checked)}),label:"显示部分识别结果"}),e.jsx(j,{children:"启用后，会实时显示语音识别的中间结果。"})]}),e.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["权限状态: ",y]}),e.jsx(p,{variant:"outlined",onClick:A,sx:{mb:3},children:"检查并请求麦克风权限"})]}),e.jsxs(f,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",background:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsx(d,{variant:"h6",sx:{mb:3,fontWeight:600},children:"语音识别测试"}),e.jsx(s,{sx:{display:"flex",gap:2,mb:3},children:e.jsx(p,{variant:c?"outlined":"contained",startIcon:c?e.jsx(K,{size:16}):e.jsx(V,{size:16}),onClick:c?I:C,disabled:!t.enabled,color:c?"error":"primary",children:c?"停止识别":"开始识别"})}),k&&e.jsxs(h,{severity:"info",sx:{mb:3},children:["实时识别结果: ",k]}),_&&e.jsxs(h,{severity:"error",sx:{mb:3},children:["语音识别错误: ",_.message||"未知错误"]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:'点击"开始识别"按钮测试语音识别功能。请确保已授予麦克风权限。'})]})]})})]})};export{re as default};
