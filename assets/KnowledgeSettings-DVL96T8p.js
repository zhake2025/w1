import{u as N,r as x,j as e,B as r,a as z,A as J,T as Y,I as $,b as q,d as o,P as u,D as H,e as f,C,f as a,E as Q,g as w,h as X,i as Z,k as A,m as I,n as W,o as K,p as h,t as g,M as ee}from"./index-BFQp9Otg.js";import{C as se}from"./CreateKnowledgeDialog-Buf9n4Fh.js";import{C as y}from"./Card-IUdLwBcS.js";import{C as v}from"./CardContent-DXovnOt-.js";import{P as O}from"./plus-kwQ_QrJb.js";import"./Stack-CItDq_hs.js";import"./useThemeProps-CgvgVSEB.js";const de=()=>{const B=N(),[t,n]=x.useState(!1),[i,E]=x.useState({totalKnowledgeBases:0,totalDocuments:0,totalVectors:0,storageSize:"0 MB"}),[R,b]=x.useState(!1),[M,j]=x.useState(!1),[L,k]=x.useState(!1),T=()=>{B("/settings")},S=async()=>{try{n(!0);const l=(await h.knowledge_bases.toArray()).length,d=(await h.knowledge_documents.toArray()).length,p=d,c=1536*4,U=p*c,V=_(U);E({totalKnowledgeBases:l,totalDocuments:d,totalVectors:p,storageSize:V})}catch(s){console.error("加载知识库统计信息失败:",s)}finally{n(!1)}},_=s=>{if(s===0)return"0 B";const l=1024,m=["B","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(l));return parseFloat((s/Math.pow(l,d)).toFixed(2))+" "+m[d]},P=async()=>{try{n(!0),await h.knowledge_bases.clear(),await h.knowledge_documents.clear(),await S(),b(!1),g.success("知识库数据已清理完成","清理成功")}catch(s){console.error("清理知识库数据失败:",s),g.error("清理失败，请重试","清理失败")}finally{n(!1)}},D=()=>{k(!0)},F=async s=>{try{n(!0),await ee.getInstance().createKnowledgeBase(s),k(!1),await S(),g.success("知识库创建成功！","创建成功")}catch(l){console.error("创建知识库失败:",l),g.error("创建失败，请重试","创建失败")}finally{n(!1)}},G=async()=>{try{n(!0);const s=await h.knowledge_bases.toArray(),l=await h.knowledge_documents.toArray(),m={version:"1.0",timestamp:new Date().toISOString(),knowledgeBases:s,documents:l},d=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),p=URL.createObjectURL(d),c=document.createElement("a");c.href=p,c.download=`knowledge-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(p),j(!1),g.success("知识库数据导出成功","导出成功")}catch(s){console.error("导出知识库数据失败:",s),g.error("导出失败，请重试","导出失败")}finally{n(!1)}};return x.useEffect(()=>{S()},[]),e.jsxs(r,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:s=>s.palette.mode==="light"?z(s.palette.primary.main,.02):z(s.palette.background.default,.9)},children:[e.jsx(J,{position:"fixed",elevation:0,sx:{zIndex:s=>s.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(Y,{children:[e.jsx($,{edge:"start",color:"inherit",onClick:T,"aria-label":"back",sx:{color:s=>s.palette.primary.main},children:e.jsx(q,{})}),e.jsx(o,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"知识库设置"})]})}),e.jsxs(r,{sx:{flexGrow:1,overflowY:"auto",p:{xs:1,sm:2},mt:8,"&::-webkit-scrollbar":{width:{xs:"4px",sm:"6px"}},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:[e.jsxs(u,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(r,{sx:{p:{xs:1.5,sm:2},bgcolor:"rgba(0,0,0,0.01)"},children:[e.jsxs(o,{variant:"subtitle1",sx:{fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem"},display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{size:20,color:"#059669"}),"知识库统计"]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"查看知识库的使用情况和存储统计"})]}),e.jsx(f,{}),e.jsx(r,{sx:{p:{xs:1.5,sm:2}},children:t?e.jsx(r,{display:"flex",justifyContent:"center",py:3,children:e.jsx(C,{})}):e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",margin:-1},children:[e.jsx(r,{sx:{width:{xs:"50%",sm:"25%"},p:1},children:e.jsx(y,{variant:"outlined",children:e.jsxs(v,{sx:{textAlign:"center",py:2},children:[e.jsx(o,{variant:"h4",color:"primary",fontWeight:"bold",children:i.totalKnowledgeBases}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"知识库数量"})]})})}),e.jsx(r,{sx:{width:{xs:"50%",sm:"25%"},p:1},children:e.jsx(y,{variant:"outlined",children:e.jsxs(v,{sx:{textAlign:"center",py:2},children:[e.jsx(o,{variant:"h4",color:"success.main",fontWeight:"bold",children:i.totalDocuments}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"文档数量"})]})})}),e.jsx(r,{sx:{width:{xs:"50%",sm:"25%"},p:1},children:e.jsx(y,{variant:"outlined",children:e.jsxs(v,{sx:{textAlign:"center",py:2},children:[e.jsx(o,{variant:"h4",color:"warning.main",fontWeight:"bold",children:i.totalVectors}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"向量数量"})]})})}),e.jsx(r,{sx:{width:{xs:"50%",sm:"25%"},p:1},children:e.jsx(y,{variant:"outlined",children:e.jsxs(v,{sx:{textAlign:"center",py:2},children:[e.jsx(o,{variant:"h4",color:"info.main",fontWeight:"bold",children:i.storageSize}),e.jsx(o,{variant:"body2",color:"textSecondary",children:"存储大小"})]})})})]})})]}),e.jsxs(u,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(r,{sx:{p:{xs:1.5,sm:2},bgcolor:"rgba(0,0,0,0.01)"},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem"}},children:"快速操作"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"创建和管理知识库的快捷操作"})]}),e.jsx(f,{}),e.jsxs(r,{sx:{p:{xs:1.5,sm:2}},children:[e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",margin:-1},children:[e.jsx(r,{sx:{width:{xs:"100%",sm:"50%"},p:1},children:e.jsx(a,{fullWidth:!0,variant:"contained",startIcon:e.jsx(O,{}),onClick:D,disabled:t,sx:{py:1.5,background:"linear-gradient(45deg, #059669 30%, #10b981 90%)","&:hover":{background:"linear-gradient(45deg, #047857 30%, #059669 90%)"}},children:"创建知识库"})}),e.jsx(r,{sx:{width:{xs:"100%",sm:"50%"},p:1},children:e.jsx(a,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Q,{}),onClick:()=>B("/knowledge"),sx:{py:1.5},children:"管理知识库"})})]}),i.totalKnowledgeBases===0&&e.jsx(w,{severity:"info",sx:{mt:2},children:'您还没有创建任何知识库。点击"创建知识库"开始使用知识库功能。'})]})]}),e.jsxs(u,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(r,{sx:{p:{xs:1.5,sm:2},bgcolor:"rgba(0,0,0,0.01)"},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem"}},children:"知识库配置说明"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"了解知识库的各项配置参数和使用说明"})]}),e.jsx(f,{}),e.jsxs(r,{sx:{p:{xs:1.5,sm:2}},children:[e.jsx(w,{severity:"info",sx:{mb:2},children:"知识库的嵌入模型、分块大小、相似度阈值等参数在创建知识库时设置，每个知识库可以有不同的配置。"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["• ",e.jsx("strong",{children:"嵌入模型"}),"：用于将文本转换为向量，不同模型有不同的效果和维度",e.jsx("br",{}),"• ",e.jsx("strong",{children:"分块大小"}),"：文档分割的块大小，影响搜索精度和上下文长度",e.jsx("br",{}),"• ",e.jsx("strong",{children:"相似度阈值"}),"：搜索结果的最低相似度，越高结果越精确",e.jsx("br",{}),"• ",e.jsx("strong",{children:"文档数量"}),"：搜索时返回的文档段数量，影响回答的详细程度"]})]})]}),e.jsxs(u,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(r,{sx:{p:{xs:1.5,sm:2},bgcolor:"rgba(0,0,0,0.01)"},children:[e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem"}},children:"数据管理"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",sm:"0.875rem"}},children:"导出备份和清理知识库数据"})]}),e.jsx(f,{}),e.jsxs(r,{sx:{p:{xs:1.5,sm:2}},children:[i.totalKnowledgeBases===0?e.jsx(w,{severity:"warning",sx:{mb:3},children:"您还没有创建任何知识库。请先创建知识库后再进行数据管理操作。"}):e.jsx(w,{severity:"info",sx:{mb:3},children:"数据管理操作会影响所有知识库，请谨慎操作。建议在操作前先导出备份。"}),e.jsx(r,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:i.totalKnowledgeBases===0?e.jsx(a,{variant:"contained",startIcon:e.jsx(O,{}),onClick:D,disabled:t,sx:{background:"linear-gradient(45deg, #059669 30%, #10b981 90%)","&:hover":{background:"linear-gradient(45deg, #047857 30%, #059669 90%)"}},children:"创建第一个知识库"}):e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"outlined",startIcon:e.jsx(X,{}),onClick:()=>j(!0),disabled:t,children:"导出数据"}),e.jsx(a,{variant:"outlined",color:"error",startIcon:e.jsx(Z,{}),onClick:()=>b(!0),disabled:t,children:"清理所有数据"})]})})]})]})]}),e.jsxs(A,{open:R,onClose:()=>b(!1),children:[e.jsx(I,{children:"确认清理所有知识库数据"}),e.jsx(W,{children:e.jsx(o,{children:"此操作将删除所有知识库、文档和向量数据，且无法恢复。确定要继续吗？"})}),e.jsxs(K,{children:[e.jsx(a,{onClick:()=>b(!1),children:"取消"}),e.jsx(a,{onClick:P,color:"error",disabled:t,children:t?e.jsx(C,{size:20}):"确认清理"})]})]}),e.jsxs(A,{open:M,onClose:()=>j(!1),children:[e.jsx(I,{children:"导出知识库数据"}),e.jsx(W,{children:e.jsx(o,{children:"将导出所有知识库和文档数据为JSON文件，可用于备份或迁移。"})}),e.jsxs(K,{children:[e.jsx(a,{onClick:()=>j(!1),children:"取消"}),e.jsx(a,{onClick:G,disabled:t,children:t?e.jsx(C,{size:20}):"确认导出"})]})]}),e.jsx(se,{open:L,onClose:()=>k(!1),onSave:F,isEditing:!1})]})};export{de as default};
