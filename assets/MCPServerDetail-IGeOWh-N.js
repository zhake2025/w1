import{u as Z,a$ as _,b0 as Q,r as i,aZ as c,j as e,B as o,C as h,A as X,T as $,I as q,b as V,a5 as ee,a as se,d as n,f as J,b1 as te,P as re,a_ as N,af as O,ag as ae,ac as ne,G as x,H as le,J as ie,S as oe,K as D,aO as ce,b2 as m,b3 as j,b4 as G,Q as g,b5 as y,X as T,Y as k,Z as A,aR as xe,g as de,D as he,ah as ue}from"./index-BFQp9Otg.js";import{P as pe}from"./play-B08f1lLf.js";import{F as me}from"./file-text-WktVSpFc.js";import{F as je}from"./folder-BBx9XbIr.js";const be=()=>{const R=Z(),{serverId:v}=_(),u=Q(),[t,a]=i.useState(null),[f,P]=i.useState([]),[b,L]=i.useState([]),[S,B]=i.useState([]),[C,E]=i.useState(!1),[W,z]=i.useState(!1),[d,l]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{if(u.state?.server)a(u.state.server),p(u.state.server);else if(v){const s=c.getServerById(v);s&&(a(s),p(s))}},[v,u.state]);const p=async s=>{if(s.isActive){E(!0);try{const[r,I,w]=await Promise.all([c.listTools(s),c.listPrompts(s),c.listResources(s)]);P(r),L(I),B(w)}catch(r){console.error("加载服务器数据失败:",r)}finally{E(!1)}}},M=()=>{R("/settings/mcp-server")},U=async()=>{if(t)try{await c.updateServer(t),l({open:!0,message:"保存成功",severity:"success"})}catch{l({open:!0,message:"保存失败",severity:"error"})}},H=async()=>{if(t){z(!0);try{const s=await c.testConnection(t);l({open:!0,message:s?"连接测试成功":"连接测试失败",severity:s?"success":"error"}),s&&t.isActive&&await p(t)}catch{l({open:!0,message:"连接测试失败",severity:"error"})}finally{z(!1)}}},K=async s=>{if(t)try{await c.toggleServer(t.id,s),a({...t,isActive:s}),s?await p({...t,isActive:s}):(P([]),L([]),B([])),l({open:!0,message:s?"服务器已启用":"服务器已停用",severity:"success"})}catch{l({open:!0,message:"操作失败",severity:"error"})}},Y=s=>{switch(s){case"httpStream":return e.jsx(ue,{});case"inMemory":return e.jsx(he,{});default:return e.jsx(N,{})}},F=s=>{switch(s){case"httpStream":return"#9c27b0";case"inMemory":return"#ff9800";default:return"#9e9e9e"}};return t?e.jsxs(o,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:"background.default"},children:[e.jsx(X,{position:"fixed",elevation:0,sx:{zIndex:s=>s.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider"},children:e.jsxs($,{children:[e.jsx(q,{edge:"start",onClick:M,"aria-label":"back",sx:{color:"primary.main"},children:e.jsx(V,{})}),e.jsx(ee,{sx:{bgcolor:se(F(t.type),.1),color:F(t.type),mr:2,width:32,height:32},children:Y(t.type)}),e.jsx(n,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600},children:t.name}),e.jsx(J,{startIcon:W?e.jsx(h,{size:16}):e.jsx(pe,{}),onClick:H,disabled:W,size:"small",sx:{mr:1},children:"测试"}),e.jsx(J,{startIcon:e.jsx(te,{}),onClick:U,variant:"contained",size:"small",children:"保存"})]})}),e.jsxs(o,{sx:{flexGrow:1,overflow:"auto",mt:8,px:2,py:2},children:[e.jsxs(re,{sx:{p:3,mb:2},children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{}),"基本信息"]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(O,{control:e.jsx(ae,{checked:t.isActive,onChange:s=>K(s.target.checked)}),label:"启用服务器"}),t.isActive&&e.jsx(ne,{label:"运行中",size:"small",color:"success",variant:"outlined",sx:{ml:2}})]}),e.jsx(x,{fullWidth:!0,label:"服务器名称",value:t.name,onChange:s=>a({...t,name:s.target.value}),sx:{mb:2}}),e.jsxs(le,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ie,{children:"服务器类型"}),e.jsxs(oe,{value:t.type,label:"服务器类型",onChange:s=>a({...t,type:s.target.value}),children:[e.jsx(D,{value:"httpStream",children:"HTTP Stream (支持SSE+HTTP)"}),e.jsx(D,{value:"inMemory",children:"内存服务器"})]})]}),t.type==="httpStream"&&e.jsx(x,{fullWidth:!0,label:"服务器 URL",value:t.baseUrl||"",onChange:s=>a({...t,baseUrl:s.target.value}),placeholder:"https://example.com/mcp",sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"描述",value:t.description||"",onChange:s=>a({...t,description:s.target.value}),multiline:!0,rows:2,sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"超时时间（秒）",type:"number",value:t.timeout||60,onChange:s=>a({...t,timeout:parseInt(s.target.value)||60}),inputProps:{min:1,max:300},sx:{mb:2}}),t.type==="httpStream"&&e.jsx(O,{control:e.jsx(ce,{checked:t.enableSSE===!0,onChange:s=>a({...t,enableSSE:s.target.checked})}),label:"启用SSE流（Server-Sent Events）"})]}),e.jsxs(m,{sx:{mb:2},children:[e.jsx(j,{expandIcon:e.jsx(g,{}),children:e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{}),"高级设置"]})}),e.jsxs(y,{children:[e.jsx(x,{fullWidth:!0,label:"请求头（JSON 格式）",value:JSON.stringify(t.headers||{},null,2),onChange:s=>{try{const r=JSON.parse(s.target.value);a({...t,headers:r})}catch{}},multiline:!0,rows:4,sx:{mb:2},placeholder:'{\\n  "Authorization": "Bearer token",\\n  "Content-Type": "application/json"\\n}'}),e.jsx(x,{fullWidth:!0,label:"环境变量（JSON 格式）",value:JSON.stringify(t.env||{},null,2),onChange:s=>{try{const r=JSON.parse(s.target.value);a({...t,env:r})}catch{}},multiline:!0,rows:4,sx:{mb:2},placeholder:'{\\n  "API_KEY": "your-api-key",\\n  "DEBUG": "true"\\n}'}),e.jsx(x,{fullWidth:!0,label:"参数（每行一个）",value:(t.args||[]).join(`
`),onChange:s=>{const I=(s.target.value||"").split(`
`).filter(w=>w.trim());a({...t,args:I})},multiline:!0,rows:3,placeholder:"--verbose\\n--config=/path/to/config"})]})]}),t.isActive&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(j,{expandIcon:e.jsx(g,{}),children:e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{}),"可用工具 (",f.length,")"]})}),e.jsx(y,{children:C?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(h,{})}):f.length===0?e.jsx(n,{color:"text.secondary",sx:{textAlign:"center",py:2},children:"暂无可用工具"}):e.jsx(T,{children:f.map((s,r)=>e.jsx(k,{divider:!0,children:e.jsx(A,{primary:s.name,secondary:s.description||"无描述"})},r))})})]}),t.isActive&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(j,{expandIcon:e.jsx(g,{}),children:e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(me,{}),"可用提示词 (",b.length,")"]})}),e.jsx(y,{children:C?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(h,{})}):b.length===0?e.jsx(n,{color:"text.secondary",sx:{textAlign:"center",py:2},children:"暂无可用提示词"}):e.jsx(T,{children:b.map((s,r)=>e.jsx(k,{divider:!0,children:e.jsx(A,{primary:s.name,secondary:s.description||"无描述"})},r))})})]}),t.isActive&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(j,{expandIcon:e.jsx(g,{}),children:e.jsxs(n,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{}),"可用资源 (",S.length,")"]})}),e.jsx(y,{children:C?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(h,{})}):S.length===0?e.jsx(n,{color:"text.secondary",sx:{textAlign:"center",py:2},children:"暂无可用资源"}):e.jsx(T,{children:S.map((s,r)=>e.jsx(k,{divider:!0,children:e.jsx(A,{primary:s.name,secondary:e.jsxs(o,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:s.description||"无描述"}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:["URI: ",s.uri]})]})})},r))})})]})]}),e.jsx(xe,{open:d.open,autoHideDuration:3e3,onClose:()=>l({...d,open:!1}),children:e.jsx(de,{severity:d.severity,onClose:()=>l({...d,open:!1}),children:d.message})})]}):e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(h,{})})};export{be as default};
