import{r as p,j as e,k as V,m as ee,d as n,n as re,g as H,B as w,C as G,G as P,o as te,f as W,bA as R,el as ae,em as ie,u as ne,a as j,A as le,T as ce,I as Z,b as de,P as B,e as I,X as U,a2 as xe,a5 as z,Z as F,ac as ue,en as M,i as he,Y as X}from"./index-5OteHtpV.js";import{w as N}from"./WorkspaceService-C1nKYN-L.js";import{C as me}from"./Card-0S04eo67.js";import{C as pe}from"./CardActionArea-BnWg72HT.js";import{C as fe}from"./CardContent-CZNsHkoT.js";import{F as se}from"./folder-open-CoOuwxCz.js";import{F as oe}from"./folder-czwo2eRW.js";import{S as J}from"./shield-fgA2f2CF.js";import{P as q}from"./plus-CNFnFWu4.js";import{L as E}from"./ListItemButton-B_D_P2EP.js";import{L as $}from"./ListItemAvatar-Tzweey2j.js";import{C as ge}from"./clock-DDmGyxGY.js";import{L as be}from"./ListSubheader-Cn05qfee.js";const je=({open:C,onClose:Y,onSuccess:g})=>{const[l,f]=p.useState(""),[c,t]=p.useState(""),[x,a]=p.useState(""),[i,d]=p.useState(""),[u,y]=p.useState(!1),[k,h]=p.useState(null),[b,v]=p.useState(!1),S=()=>{f(""),t(""),a(""),d(""),h(null),y(!1),v(!1)},D=()=>{!u&&!b&&(S(),Y())},T=async()=>{try{if(v(!0),h(null),!(await R.checkPermissions()).granted&&(console.log("权限未授予，尝试请求权限..."),!(await R.requestPermissions()).granted)){h('需要文件访问权限才能选择文件夹。Android 11+需要在设置中授予"所有文件访问权限"。'),v(!1);return}const s=await R.openSystemFilePicker({type:"directory",multiple:!1,title:"选择工作区文件夹"});if(!s.cancelled&&s.directories.length>0){const m=s.directories[0];console.log("选择的目录信息:",m);const O=m.displayPath||m.path||m.uri||(typeof m=="string"?m:"");f(O),t(O),x||a(m.name||"新工作区")}}catch(o){console.error("选择文件夹失败:",o),h("选择文件夹失败，请手动输入路径")}finally{v(!1)}},_=async()=>{if(!l.trim()||!x.trim()){h("请填写完整信息");return}y(!0),h(null);try{const o={name:x.trim(),path:l.trim(),description:i.trim()||void 0},s=await N.createWorkspace(o);s.success?(S(),g()):h(s.error||"创建工作区失败")}catch(o){h("创建工作区失败，请重试"),console.error("创建工作区失败:",o)}finally{y(!1)}},r=l.trim()&&x.trim();return e.jsxs(V,{open:C,onClose:D,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ee,{children:e.jsx(n,{variant:"h6",children:"创建新工作区"})}),e.jsxs(re,{children:[k&&e.jsx(H,{severity:"error",sx:{mb:2},onClose:()=>h(null),children:k}),e.jsxs(w,{sx:{mb:3},children:[e.jsx(n,{variant:"body1",gutterBottom:!0,children:"选择工作区文件夹："}),e.jsx(me,{variant:"outlined",sx:{mb:2},children:e.jsx(pe,{onClick:T,disabled:b,children:e.jsxs(fe,{sx:{textAlign:"center",py:3},children:[b?e.jsx(G,{size:40}):e.jsx(se,{size:40,style:{color:"#1976d2",marginBottom:8}}),e.jsx(n,{variant:"body1",color:b?"text.secondary":"primary",children:b?"选择中...":"点击选择文件夹"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"使用系统文件管理器选择"})]})})}),e.jsx(P,{fullWidth:!0,label:"文件夹路径",placeholder:"例如: /storage/emulated/0/Download",value:c||l,onChange:o=>{const s=o.target.value;if(f(s),t(s),!x&&s&&typeof s=="string"){const m=s.split("/").pop()||"新工作区";a(m)}},helperText:"请输入完整的文件夹路径"})]}),e.jsxs(w,{children:[e.jsx(n,{variant:"body1",gutterBottom:!0,children:"工作区信息："}),e.jsx(P,{fullWidth:!0,label:"工作区名称",value:x,onChange:o=>a(o.target.value),sx:{mb:2},required:!0}),e.jsx(P,{fullWidth:!0,label:"描述（可选）",value:i,onChange:o=>d(o.target.value),multiline:!0,rows:3,placeholder:"描述这个工作区的用途..."})]}),(c||l)&&e.jsx(H,{severity:"info",sx:{mt:2},children:e.jsxs(n,{variant:"body2",children:[e.jsx("strong",{children:"文件夹路径："})," ",c||l]})})]}),e.jsxs(te,{children:[e.jsx(W,{onClick:D,disabled:u,children:"取消"}),e.jsx(W,{onClick:_,variant:"contained",disabled:!r||u,startIcon:u?e.jsx(G,{size:16}):e.jsx(oe,{}),children:u?"创建中...":"创建工作区"})]})]})};var A={exports:{}},ye=A.exports,K;function ve(){return K||(K=1,(function(C,Y){(function(g,l){C.exports=l()})(ye,(function(){return function(g,l,f){g=g||{};var c=l.prototype,t={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function x(i,d,u,y){return c.fromToBase(i,d,u,y)}f.en.relativeTime=t,c.fromToBase=function(i,d,u,y,k){for(var h,b,v,S=u.$locale().relativeTime||t,D=g.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],T=D.length,_=0;_<T;_+=1){var r=D[_];r.d&&(h=y?f(i).diff(u,r.d,!0):u.diff(i,r.d,!0));var o=(g.rounding||Math.round)(Math.abs(h));if(v=h>0,o<=r.r||!r.r){o<=1&&_>0&&(r=D[_-1]);var s=S[r.l];k&&(o=k(""+o)),b=typeof s=="string"?s.replace("%d",o):s(o,d,r.l,v);break}}if(d)return b;var m=v?S.future:S.past;return typeof m=="function"?m(b):m.replace("%s",b)},c.to=function(i,d){return x(i,d,this,!0)},c.from=function(i,d){return x(i,d,this)};var a=function(i){return i.$u?f.utc():f()};c.toNow=function(i){return this.to(a(this),i)},c.fromNow=function(i){return this.from(a(this),i)}}}))})(A)),A.exports}var Ce=ve();const ke=ae(Ce);var L={exports:{}},_e=L.exports,Q;function we(){return Q||(Q=1,(function(C,Y){(function(g,l){C.exports=l(ie())})(_e,(function(g){function l(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var f=l(g),c={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(t,x){return x==="W"?t+"周":t+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(t,x){var a=100*t+x;return a<600?"凌晨":a<900?"早上":a<1100?"上午":a<1300?"中午":a<1800?"下午":"晚上"}};return f.default.locale(c,null,!0),c}))})(L)),L.exports}we();M.extend(ke);M.locale("zh-cn");const Fe=()=>{const C=ne(),[Y,g]=p.useState([]),[l,f]=p.useState(!0),[c,t]=p.useState(null),[x,a]=p.useState(!1),[i,d]=p.useState(!1),[u,y]=p.useState(null),k=async()=>{try{f(!0),t(null);const r=await N.getWorkspaces();g(r.workspaces)}catch(r){t("加载工作区列表失败"),console.error("加载工作区失败:",r)}finally{f(!1)}};p.useEffect(()=>{k()},[]);const h=()=>{C("/settings")},b=()=>{a(!1),k()},v=async()=>{if(u)try{const r=await N.deleteWorkspace(u.id);r.success?(d(!1),y(null),k()):t(r.error||"删除工作区失败")}catch(r){t("删除工作区失败"),console.error("删除工作区失败:",r)}},S=r=>{y(r),d(!0)},D=r=>{C(`/settings/workspace/${r.id}`)},T=()=>{C("/settings/file-permission")},_=r=>r.length>30?`...${r.slice(-27)}`:r;return e.jsxs(w,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:r=>r.palette.mode==="light"?j(r.palette.primary.main,.02):j(r.palette.background.default,.9)},children:[e.jsx(le,{position:"fixed",elevation:0,sx:{zIndex:r=>r.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(ce,{children:[e.jsx(Z,{edge:"start",color:"inherit",onClick:h,"aria-label":"back",sx:{color:r=>r.palette.primary.main},children:e.jsx(de,{})}),e.jsx(n,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"工作区管理"}),e.jsx(W,{startIcon:e.jsx(J,{}),onClick:T,sx:{bgcolor:r=>j(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>j(r.palette.primary.main,.2)},borderRadius:2,mr:1},children:"权限管理"}),e.jsx(W,{startIcon:e.jsx(q,{}),onClick:()=>a(!0),sx:{bgcolor:r=>j(r.palette.primary.main,.1),color:"primary.main","&:hover":{bgcolor:r=>j(r.palette.primary.main,.2)},borderRadius:2},children:"添加"})]})}),e.jsxs(w,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:[c&&e.jsx(H,{severity:"error",sx:{mb:2},onClose:()=>t(null),children:c}),l?e.jsx(w,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(n,{children:"加载中..."})}):Y.length===0?e.jsxs(B,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)",textAlign:"center",p:6},children:[e.jsx(se,{size:64,style:{color:"#666",marginBottom:16}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"还没有工作区"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"创建工作区来管理您的文件和文档"}),e.jsx(W,{variant:"contained",startIcon:e.jsx(q,{}),onClick:()=>a(!0),sx:{bgcolor:"primary.main",color:"white",fontWeight:600,borderRadius:2,boxShadow:"0 4px 12px rgba(79, 70, 229, 0.3)","&:hover":{bgcolor:"primary.dark",boxShadow:"0 6px 16px rgba(79, 70, 229, 0.4)"}},children:"创建第一个工作区"})]}):e.jsxs(B,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(w,{sx:{p:2,bgcolor:"rgba(0,0,0,0.01)"},children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:600},children:"工作区列表"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"管理您的工作区，点击对应的工作区进行访问和管理"})]}),e.jsx(I,{}),e.jsx(U,{disablePadding:!0,children:Y.map((r,o)=>e.jsxs(xe.Fragment,{children:[e.jsxs(E,{onClick:()=>D(r),sx:{transition:"all 0.2s","&:hover":{bgcolor:s=>j(s.palette.primary.main,.05)},py:2},children:[e.jsx($,{children:e.jsx(z,{sx:{bgcolor:"#1976d2",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:e.jsx(oe,{})})}),e.jsx(F,{primary:e.jsx(n,{sx:{fontWeight:600,color:"text.primary"},children:r.name}),secondary:e.jsxs(w,{children:[r.description&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:r.description}),e.jsx(w,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:e.jsx(ue,{label:_(r.path),size:"small",sx:{backgroundColor:"#333333",color:"#cccccc",height:"20px","& .MuiChip-label":{fontSize:"0.65rem",px:.5}}})}),e.jsxs(w,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ge,{size:14,style:{marginRight:4,color:"#666"}}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r.lastAccessedAt?`最后访问 ${M(r.lastAccessedAt).fromNow()}`:`创建于 ${M(r.createdAt).fromNow()}`})]})]})}),e.jsx(Z,{size:"small",onClick:s=>{s.stopPropagation(),S(r)},sx:{mr:1,color:"text.secondary","&:hover":{color:"error.main",bgcolor:s=>j(s.palette.error.main,.1)}},children:e.jsx(he,{size:16})})]}),o<Y.length-1&&e.jsx(I,{variant:"inset",component:"li",sx:{ml:0}})]},r.id))})]}),e.jsx(B,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:e.jsxs(U,{subheader:e.jsx(be,{component:"div",sx:{bgcolor:"rgba(0,0,0,0.01)",py:1,fontWeight:600,color:"text.primary"},children:"推荐操作"}),children:[e.jsx(X,{disablePadding:!0,children:e.jsxs(E,{onClick:()=>a(!0),sx:{transition:"all 0.2s","&:hover":{bgcolor:r=>j(r.palette.primary.main,.05)}},children:[e.jsx($,{children:e.jsx(z,{sx:{bgcolor:j("#4f46e5",.12),color:"#4f46e5",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:e.jsx(q,{})})}),e.jsx(F,{primary:e.jsx(n,{sx:{fontWeight:600,color:"text.primary"},children:"创建新工作区"}),secondary:"添加新的工作区来管理您的文件和文档"})]})}),e.jsx(I,{variant:"inset",component:"li",sx:{ml:0}}),e.jsx(X,{disablePadding:!0,children:e.jsxs(E,{onClick:T,sx:{transition:"all 0.2s","&:hover":{bgcolor:r=>j(r.palette.primary.main,.05)}},children:[e.jsx($,{children:e.jsx(z,{sx:{bgcolor:j("#06b6d4",.12),color:"#06b6d4",boxShadow:"0 2px 6px rgba(0,0,0,0.05)"},children:e.jsx(J,{})})}),e.jsx(F,{primary:e.jsx(n,{sx:{fontWeight:600,color:"text.primary"},children:"文件权限管理"}),secondary:"管理文件访问权限和安全设置"})]})})]})})]}),e.jsx(je,{open:x,onClose:()=>a(!1),onSuccess:b}),e.jsxs(V,{open:i,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(ee,{sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"删除工作区"}),e.jsxs(re,{sx:{pt:2},children:[e.jsxs(n,{children:['确定要删除工作区 "',u?.name,'" 吗？']}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"这只会删除工作区配置，不会删除实际的文件。"})]}),e.jsxs(te,{sx:{p:2},children:[e.jsx(W,{onClick:()=>d(!1),children:"取消"}),e.jsx(W,{onClick:v,color:"error",variant:"contained",sx:{borderRadius:2},children:"删除"})]})]})]})};export{Fe as default};
