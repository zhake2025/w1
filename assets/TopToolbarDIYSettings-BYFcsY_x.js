import{df as ce,r as T,d4 as le,j as e,bd as de,ei as ue,be as me,da as ge,db as pe,bc as he,b8 as xe,a0 as fe,c as be,u as ye,a6 as je,bn as Te,$ as L,B as x,b as Se,d as g,f as U,aQ as Ce,P as J,aj as V,I as v,ak as q,A as we,T as ve,a2 as Z,a_ as F,bo as Pe,af as ee,bp as ne,bk as K,i as se,d0 as ze,ej as ke}from"./index-Bp4oiTTd.js";import{C as Y}from"./CustomIcon-BwQ5xTbP.js";import{u as Be}from"./useScrollPosition-DKqdkmjy.js";import{W as De}from"./wand-sparkles-BMUWR8aP.js";import{s as Ge,u as Ee}from"./useThemeProps-KfL3eMu5.js";import{C as $e}from"./Card-CqCVDSy1.js";import{E as Le}from"./eye-off-D4qHSTw4.js";import{P as te}from"./plus-DzgKc2iD.js";const Me=(n,s)=>n.filter(r=>s.includes(r)),$=(n,s,r)=>{const a=n.keys[0];Array.isArray(s)?s.forEach((c,i)=>{r((m,j)=>{i<=n.keys.length-1&&(i===0?Object.assign(m,j):m[n.up(n.keys[i])]=j)},c)}):s&&typeof s=="object"?(Object.keys(s).length>n.keys.length?n.keys:Me(n.keys,Object.keys(s))).forEach(i=>{if(n.keys.includes(i)){const m=s[i];m!==void 0&&r((j,o)=>{a===i?Object.assign(j,o):j[n.up(i)]=o},m)}}):(typeof s=="number"||typeof s=="string")&&r((c,i)=>{Object.assign(c,i)},s)};function W(n){return`--Grid-${n}Spacing`}function A(n){return`--Grid-parent-${n}Spacing`}const oe="--Grid-columns",E="--Grid-parent-columns",Re=({theme:n,ownerState:s})=>{const r={};return $(n.breakpoints,s.size,(a,c)=>{let i={};c==="grow"&&(i={flexBasis:0,flexGrow:1,maxWidth:"100%"}),c==="auto"&&(i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof c=="number"&&(i={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${c} / var(${E}) - (var(${E}) - ${c}) * (var(${A("column")}) / var(${E})))`}),a(r,i)}),r},Ne=({theme:n,ownerState:s})=>{const r={};return $(n.breakpoints,s.offset,(a,c)=>{let i={};c==="auto"&&(i={marginLeft:"auto"}),typeof c=="number"&&(i={marginLeft:c===0?"0px":`calc(100% * ${c} / var(${E}) + var(${A("column")}) * ${c} / var(${E}))`}),a(r,i)}),r},Ye=({theme:n,ownerState:s})=>{if(!s.container)return{};const r={[oe]:12};return $(n.breakpoints,s.columns,(a,c)=>{const i=c??12;a(r,{[oe]:i,"> *":{[E]:i}})}),r},We=({theme:n,ownerState:s})=>{if(!s.container)return{};const r={};return $(n.breakpoints,s.rowSpacing,(a,c)=>{const i=typeof c=="string"?c:n.spacing?.(c);a(r,{[W("row")]:i,"> *":{[A("row")]:i}})}),r},Ae=({theme:n,ownerState:s})=>{if(!s.container)return{};const r={};return $(n.breakpoints,s.columnSpacing,(a,c)=>{const i=typeof c=="string"?c:n.spacing?.(c);a(r,{[W("column")]:i,"> *":{[A("column")]:i}})}),r},Oe=({theme:n,ownerState:s})=>{if(!s.container)return{};const r={};return $(n.breakpoints,s.direction,(a,c)=>{a(r,{flexDirection:c})}),r},Xe=({ownerState:n})=>({minWidth:0,boxSizing:"border-box",...n.container&&{display:"flex",flexWrap:"wrap",...n.wrap&&n.wrap!=="wrap"&&{flexWrap:n.wrap},gap:`var(${W("row")}) var(${W("column")})`}}),Ie=n=>{const s=[];return Object.entries(n).forEach(([r,a])=>{a!==!1&&a!==void 0&&s.push(`grid-${r}-${String(a)}`)}),s},_e=(n,s="xs")=>{function r(a){return a===void 0?!1:typeof a=="string"&&!Number.isNaN(Number(a))||typeof a=="number"&&a>0}if(r(n))return[`spacing-${s}-${String(n)}`];if(typeof n=="object"&&!Array.isArray(n)){const a=[];return Object.entries(n).forEach(([c,i])=>{r(i)&&a.push(`spacing-${c}-${String(i)}`)}),a}return[]},He=n=>n===void 0?[]:typeof n=="object"?Object.entries(n).map(([s,r])=>`direction-${s}-${r}`):[`direction-xs-${String(n)}`];function Ue(n,s){n.item!==void 0&&delete n.item,n.zeroMinWidth!==void 0&&delete n.zeroMinWidth,s.keys.forEach(r=>{n[r]!==void 0&&delete n[r]})}const Ve=pe(),qe=Ge("div",{name:"MuiGrid",slot:"Root"});function Fe(n){return Ee({props:n,name:"MuiGrid",defaultTheme:Ve})}function Ke(n={}){const{createStyledComponent:s=qe,useThemeProps:r=Fe,useTheme:a=ce,componentName:c="MuiGrid"}=n,i=(f,h)=>{const{container:C,direction:b,spacing:S,wrap:p,size:k}=f,P={root:["root",C&&"container",p!=="wrap"&&`wrap-xs-${String(p)}`,...He(b),...Ie(k),...C?_e(S,h.breakpoints.keys[0]):[]]};return me(P,B=>ge(c,B),{})};function m(f,h,C=()=>!0){const b={};return f===null||(Array.isArray(f)?f.forEach((S,p)=>{S!==null&&C(S)&&h.keys[p]&&(b[h.keys[p]]=S)}):typeof f=="object"?Object.keys(f).forEach(S=>{const p=f[S];p!=null&&C(p)&&(b[S]=p)}):b[h.keys[0]]=f),b}const j=s(Ye,Ae,We,Re,Oe,Xe,Ne),o=T.forwardRef(function(h,C){const b=a(),S=r(h),p=le(S);Ue(p,b.breakpoints);const{className:k,children:P,columns:B=12,container:M=!1,component:O="div",direction:X="row",wrap:I="wrap",size:t={},offset:d={},spacing:l=0,rowSpacing:u=l,columnSpacing:w=l,unstable_level:y=0,...D}=p,_=m(t,b.breakpoints,z=>z!==!1),G=m(d,b.breakpoints),R=h.columns??(y?void 0:B),N=h.spacing??(y?void 0:l),H=h.rowSpacing??h.spacing??(y?void 0:u),ie=h.columnSpacing??h.spacing??(y?void 0:w),Q={...p,level:y,columns:R,container:M,direction:X,wrap:I,spacing:N,rowSpacing:H,columnSpacing:ie,size:_,offset:G},ae=i(Q,b);return e.jsx(j,{ref:C,as:O,ownerState:Q,className:de(ae.root,k),...D,children:T.Children.map(P,z=>T.isValidElement(z)&&ue(z,["Grid"])&&M&&z.props.container?T.cloneElement(z,{unstable_level:z.props?.unstable_level??y+1}):z)})});return o.muiName="Grid",o}const re=Ke({createStyledComponent:he("div",{name:"MuiGrid",slot:"Root",overridesResolver:(n,s)=>{const{ownerState:r}=n;return[s.root,r.container&&s.container]}}),componentName:"MuiGrid",useThemeProps:n=>xe({props:n,name:"MuiGrid"}),useTheme:fe});/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],Je=be("hand",Qe),cn=()=>{const n=ye(),s=je(),r=Te(t=>t.settings),a=T.useRef(null),{containerRef:c,handleScroll:i}=Be("settings-top-toolbar",{autoRestore:!0,restoreDelay:100}),m=r.topToolbar||{showSettingsButton:!0,showModelSelector:!0,modelSelectorStyle:"dialog",showChatTitle:!0,showTopicName:!1,showNewTopicButton:!1,showClearButton:!1,showSearchButton:!1,showMenuButton:!0,componentPositions:[]},j=m.componentPositions||[],[o,f]=T.useState({isDragging:!1,draggedComponent:null,isLongPressing:!1,longPressTimer:null}),[h,C]=T.useState({x:0,y:0}),b={menuButton:{name:"菜单按钮",icon:e.jsx(Y,{name:"documentPanel",size:20}),key:"showMenuButton"},chatTitle:{name:"对话标题",icon:e.jsx(ke,{size:20}),key:"showChatTitle"},topicName:{name:"话题名称",icon:e.jsx(ze,{size:20}),key:"showTopicName"},newTopicButton:{name:"新建话题",icon:e.jsx(te,{size:20}),key:"showNewTopicButton"},clearButton:{name:"清空按钮",icon:e.jsx(se,{size:20}),key:"showClearButton"},searchButton:{name:"搜索按钮",icon:e.jsx(Y,{name:"search",size:20}),key:"showSearchButton"},modelSelector:{name:"模型选择器",icon:e.jsx(K,{size:20}),key:"showModelSelector"},settingsButton:{name:"设置按钮",icon:e.jsx(F,{size:20}),key:"showSettingsButton"}},S=()=>{n("/settings/appearance")},p=T.useCallback((t,d)=>{d.preventDefault();const l="touches"in d?d.touches[0].clientX:d.clientX,u="touches"in d?d.touches[0].clientY:d.clientY;o.longPressTimer&&clearTimeout(o.longPressTimer);const w=setTimeout(()=>{f(y=>({...y,isDragging:!0,draggedComponent:t,isLongPressing:!1,longPressTimer:null})),C({x:l,y:u})},300);f(y=>({...y,isLongPressing:!0,longPressTimer:w}))},[o.longPressTimer]),k=T.useCallback(()=>{o.isDragging||(o.longPressTimer&&clearTimeout(o.longPressTimer),f(t=>({...t,isLongPressing:!1,longPressTimer:null})))},[o.longPressTimer,o.isDragging]),P=T.useCallback(()=>{o.longPressTimer&&clearTimeout(o.longPressTimer),f({isDragging:!1,draggedComponent:null,isLongPressing:!1,longPressTimer:null})},[o.longPressTimer]);T.useEffect(()=>()=>{o.longPressTimer&&clearTimeout(o.longPressTimer)},[o.longPressTimer]),T.useEffect(()=>{const t=u=>{o.isDragging&&C({x:u.clientX,y:u.clientY})},d=u=>{o.isDragging&&u.touches[0]&&(C({x:u.touches[0].clientX,y:u.touches[0].clientY}),u.preventDefault())},l=u=>{if(o.isDragging&&a.current){const w=a.current.getBoundingClientRect(),y="touches"in u?u.changedTouches[0].clientX:u.clientX,D="touches"in u?u.changedTouches[0].clientY:u.clientY;if(y>=w.left&&y<=w.right&&D>=w.top&&D<=w.bottom){B(u);return}}(o.isDragging||o.isLongPressing)&&P()};return o.isDragging&&(document.addEventListener("mousemove",t),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("mouseup",l),document.addEventListener("touchend",l),document.addEventListener("touchcancel",l)),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",l),document.removeEventListener("touchend",l),document.removeEventListener("touchcancel",l)}},[o.isDragging,o.isLongPressing,P]);const B=T.useCallback(t=>{if(!o.isDragging||!o.draggedComponent||!a.current)return;const d=a.current.getBoundingClientRect(),l="touches"in t?t.changedTouches[0].clientX:t.clientX,u="touches"in t?t.changedTouches[0].clientY:t.clientY,w=(l-d.left)/d.width*100,y=(u-d.top)/d.height*100,D=Math.max(0,Math.min(100,w)),_=Math.max(0,Math.min(100,y)),G=[...m.componentPositions||[]],R=G.findIndex(H=>H.id===o.draggedComponent),N={id:o.draggedComponent,x:D,y:_};R>=0?G[R]=N:G.push(N),s(L({topToolbar:{...m,componentPositions:G}})),P()},[o,m,s,P]),M=(t,d)=>{const l={position:"absolute",left:`${d.x}%`,top:`${d.y}%`,transform:"translate(-50%, -50%)",zIndex:10};switch(t){case"menuButton":return e.jsx(v,{edge:"start",color:"inherit",sx:{...l,mr:0},size:"small",children:e.jsx(Y,{name:"documentPanel",size:20})},t);case"chatTitle":return e.jsx(g,{variant:"h6",noWrap:!0,component:"div",sx:l,children:"对话"},t);case"topicName":return e.jsx(g,{variant:"body1",noWrap:!0,sx:{...l,color:"text.secondary"},children:"示例话题"},t);case"newTopicButton":return e.jsx(v,{color:"inherit",size:"small",sx:l,children:e.jsx(te,{size:20})},t);case"clearButton":return e.jsx(v,{color:"inherit",size:"small",sx:l,children:e.jsx(se,{size:20})},t);case"searchButton":return e.jsx(v,{color:"inherit",size:"small",sx:l,children:e.jsx(Y,{name:"search",size:20})},t);case"modelSelector":return(m.modelSelectorDisplayStyle||"icon")==="icon"?e.jsx(v,{color:"inherit",size:"small",sx:l,children:e.jsx(K,{size:20})},t):e.jsx(U,{variant:"outlined",size:"small",startIcon:e.jsx(K,{size:16}),sx:{...l,borderColor:"divider",color:"text.primary",textTransform:"none",minWidth:"auto",fontSize:"0.75rem"},children:"GPT-4"},t);case"settingsButton":return e.jsx(v,{color:"inherit",size:"small",sx:l,children:e.jsx(F,{size:20})},t);default:return null}},O=t=>{const d=b[t];return d?e.jsx(x,{sx:{width:32,height:32,backgroundColor:"rgba(25, 118, 210, 0.9)",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",border:"2px solid white"},children:Z.cloneElement(d.icon,{size:16,color:"white"})}):null},X=()=>{s(L({topToolbar:{...m,componentPositions:[]}}))},I=t=>{const d=(m.componentPositions||[]).filter(l=>l.id!==t);s(L({topToolbar:{...m,componentPositions:d}}))};return e.jsxs(x,{sx:{height:"100vh",backgroundColor:"background.default",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",padding:2,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",zIndex:10,flexShrink:0},children:[e.jsx(Se,{size:20,style:{marginRight:16,cursor:"pointer"},onClick:S}),e.jsx(g,{variant:"h6",color:"primary",sx:{flexGrow:1},children:"顶部工具栏 DIY 设置"}),e.jsx(U,{startIcon:e.jsx(Ce,{size:16}),onClick:X,size:"small",variant:"outlined",children:"重置布局"})]}),e.jsxs(x,{ref:c,onScroll:i,sx:{p:2,flex:1,overflow:"auto"},children:[e.jsxs(J,{elevation:2,sx:{mb:3,overflow:"hidden"},children:[e.jsxs(x,{sx:{p:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{size:20,color:"primary"}),e.jsx(g,{variant:"subtitle1",sx:{fontWeight:600},children:"DIY 布局预览"}),e.jsx(V,{title:"拖拽下方组件到此区域进行自由布局",children:e.jsx(v,{size:"small",children:e.jsx(q,{size:16})})})]}),e.jsxs(x,{ref:a,sx:{position:"relative",border:"2px dashed",borderColor:o.isDragging?"success.main":"primary.main",borderBottom:"none",borderLeft:"none",borderRight:"none",overflow:"hidden",transition:"border-color 0.2s"},onMouseUp:B,onTouchEnd:B,children:[e.jsx(we,{position:"static",elevation:0,sx:{bgcolor:"background.paper",color:"text.primary",borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(ve,{sx:{position:"relative",minHeight:"56px !important",justifyContent:j.length>0?"center":"space-between",userSelect:"none",px:0,"&.MuiToolbar-root":{paddingLeft:0,paddingRight:0}},children:[j.map(t=>M(t.id,t)),j.length===0&&e.jsxs(x,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",color:"text.secondary"},children:[e.jsx(Je,{size:24,style:{marginBottom:4,opacity:.5}}),e.jsx(g,{variant:"body2",children:"拖拽下方组件到此区域"})]})]})}),o.isDragging&&o.draggedComponent&&e.jsx(x,{sx:{position:"fixed",left:h.x,top:h.y,transform:"translate(-50%, -50%)",zIndex:1e3,opacity:.8,pointerEvents:"none"},children:O(o.draggedComponent)})]}),e.jsxs(x,{sx:{p:2,borderTop:"1px solid #ddd",bgcolor:"background.default"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"subtitle1",children:"可用组件"}),e.jsx(V,{title:"长按组件拖拽到上方预览区域进行布局",children:e.jsx(v,{size:"small",sx:{ml:1},children:e.jsx(q,{size:16})})})]}),e.jsx(re,{container:!0,spacing:2,children:Object.entries(b).map(([t,d])=>{const l=(m.componentPositions||[]).some(u=>u.id===t);return e.jsxs(re,{size:{xs:3,sm:2,md:1.5},children:[e.jsxs($e,{sx:{p:.5,textAlign:"center",cursor:"grab",opacity:1,border:l?"2px solid":"1px solid",borderColor:l?"success.main":o.isLongPressing&&o.draggedComponent===t?"warning.main":"divider",bgcolor:l?"background.paper":o.isLongPressing&&o.draggedComponent===t?"warning.light":"background.paper",transition:"all 0.2s ease",minHeight:60,maxWidth:80,mx:"auto",position:"relative",transform:o.isLongPressing&&o.draggedComponent===t?"scale(1.05)":"none",userSelect:"none","&:hover":{transform:"translateY(-1px)",boxShadow:1},"&:active":{cursor:"grabbing",transform:"scale(0.9)"}},onMouseDown:u=>p(t,u),onTouchStart:u=>p(t,u),onMouseUp:k,onTouchEnd:k,onTouchCancel:k,children:[e.jsx(x,{sx:{mb:.25,color:"primary.main"},children:Z.cloneElement(d.icon,{size:14})}),e.jsx(g,{variant:"caption",sx:{fontWeight:500,color:"text.primary",fontSize:"0.6rem",lineHeight:1.1,display:"block"},children:d.name}),l&&e.jsx(g,{variant:"caption",color:"success.main",sx:{display:"block",mt:.1,fontSize:"0.55rem"},children:"已放置"})]}),l&&e.jsx(x,{sx:{display:"flex",justifyContent:"center",mt:.5},children:e.jsx(v,{size:"small",onClick:u=>{u.stopPropagation(),I(t)},sx:{width:20,height:20,bgcolor:"action.hover",color:"text.secondary","&:hover":{bgcolor:"error.light",color:"error.main"}},children:e.jsx(Le,{size:12})})})]},t)})}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"💡 提示：长按组件0.3秒后开始拖拽到上方预览区域。长按时卡片会变黄色提示。已放置的组件下方有小眼睛按钮，点击可隐藏。"})]}),e.jsx(x,{sx:{p:2,borderTop:"1px solid #ddd",bgcolor:"background.paper",display:"flex",justifyContent:"center"},children:e.jsx(U,{variant:"outlined",startIcon:e.jsx(F,{size:16}),onClick:()=>{const t=j.map(d=>({...d,y:50}));s(L({topToolbar:{...m,componentPositions:t}}))},disabled:j.length===0,sx:{textTransform:"none",borderColor:"primary.main",color:"primary.main"},children:"矫正对齐"})}),e.jsxs(x,{sx:{p:2,borderTop:"1px solid #ddd",bgcolor:"background.default"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"subtitle1",children:"模型选择器显示样式"}),e.jsx(V,{title:"选择模型选择器在DIY布局中的显示样式",children:e.jsx(v,{size:"small",sx:{ml:1},children:e.jsx(q,{size:16})})})]}),e.jsxs(Pe,{value:m.modelSelectorDisplayStyle||"icon",onChange:t=>{s(L({topToolbar:{...m,modelSelectorDisplayStyle:t.target.value}}))},children:[e.jsx(ee,{value:"icon",control:e.jsx(ne,{size:"small"}),label:"图标模式（只显示机器人图标）"}),e.jsx(ee,{value:"text",control:e.jsx(ne,{size:"small"}),label:"文字模式（显示模型名+供应商名）"})]}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"图标模式更紧凑，文字模式更直观显示当前模型。"})]})]}),e.jsxs(J,{elevation:0,sx:{p:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper"},children:[e.jsx(g,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"🎨 DIY 布局使用说明"}),e.jsxs(x,{component:"ul",sx:{pl:2,m:0},children:[e.jsx(g,{component:"li",variant:"body2",sx:{mb:.5},children:'首先在"组件显示设置"中开启需要的组件'}),e.jsx(g,{component:"li",variant:"body2",sx:{mb:.5},children:'长按"可用组件"中的组件并拖拽到预览区域'}),e.jsx(g,{component:"li",variant:"body2",sx:{mb:.5},children:"可以将组件放置在工具栏的任意位置"}),e.jsx(g,{component:"li",variant:"body2",sx:{mb:.5},children:"点击已放置组件右上角的红色关闭按钮可移除单个组件"}),e.jsx(g,{component:"li",variant:"body2",sx:{mb:.5},children:'点击"重置布局"可以清除所有自定义位置'}),e.jsx(g,{component:"li",variant:"body2",children:"设置会实时保存并应用到聊天页面"})]})]})]})]})};export{cn as default};
