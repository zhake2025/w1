const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BFQp9Otg.js","assets/index-ow1R_qFW.css"])))=>i.map(i=>d[i]);
import{gH as tl,b7 as rl}from"./index-BFQp9Otg.js";var se={},oe={},Ne={},ae={},k={},Yi={},ce={},en={},je={},Ki={},qs;function $p(){if(qs)return Ki;qs=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.default=i;let e;const t=new Uint8Array(16);function i(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}return Ki}var De={},Le={},qe={},Bs;function il(){if(Bs)return qe;Bs=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return qe.default=e,qe}var Fs;function Gi(){if(Fs)return Le;Fs=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.default=void 0;var e=t(il());function t(s){return s&&s.__esModule?s:{default:s}}function i(s){return typeof s=="string"&&e.default.test(s)}var u=i;return Le.default=u,Le}var xs;function Qi(){if(xs)return De;xs=1,Object.defineProperty(De,"__esModule",{value:!0}),De.default=void 0,De.unsafeStringify=u;var e=t(Gi());function t(n){return n&&n.__esModule?n:{default:n}}const i=[];for(let n=0;n<256;++n)i.push((n+256).toString(16).slice(1));function u(n,r=0){return i[n[r+0]]+i[n[r+1]]+i[n[r+2]]+i[n[r+3]]+"-"+i[n[r+4]]+i[n[r+5]]+"-"+i[n[r+6]]+i[n[r+7]]+"-"+i[n[r+8]]+i[n[r+9]]+"-"+i[n[r+10]]+i[n[r+11]]+i[n[r+12]]+i[n[r+13]]+i[n[r+14]]+i[n[r+15]]}function s(n,r=0){const o=u(n,r);if(!(0,e.default)(o))throw TypeError("Stringified UUID is invalid");return o}var a=s;return De.default=a,De}var Us;function nl(){if(Us)return je;Us=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var e=i($p()),t=Qi();function i(c){return c&&c.__esModule?c:{default:c}}let u,s,a=0,n=0;function r(c,p,h){let l=p&&h||0;const d=p||new Array(16);c=c||{};let g=c.node||u,f=c.clockseq!==void 0?c.clockseq:s;if(g==null||f==null){const R=c.random||(c.rng||e.default)();g==null&&(g=u=[R[0]|1,R[1],R[2],R[3],R[4],R[5]]),f==null&&(f=s=(R[6]<<8|R[7])&16383)}let S=c.msecs!==void 0?c.msecs:Date.now(),v=c.nsecs!==void 0?c.nsecs:n+1;const m=S-a+(v-n)/1e4;if(m<0&&c.clockseq===void 0&&(f=f+1&16383),(m<0||S>a)&&c.nsecs===void 0&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=S,n=v,s=f,S+=122192928e5;const C=((S&268435455)*1e4+v)%4294967296;d[l++]=C>>>24&255,d[l++]=C>>>16&255,d[l++]=C>>>8&255,d[l++]=C&255;const y=S/4294967296*1e4&268435455;d[l++]=y>>>8&255,d[l++]=y&255,d[l++]=y>>>24&15|16,d[l++]=y>>>16&255,d[l++]=f>>>8|128,d[l++]=f&255;for(let R=0;R<6;++R)d[l+R]=g[R];return p||(0,t.unsafeStringify)(d)}var o=r;return je.default=o,je}var Be={},ee={},Fe={},Ws;function Jp(){if(Ws)return Fe;Ws=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var e=t(Gi());function t(s){return s&&s.__esModule?s:{default:s}}function i(s){if(!(0,e.default)(s))throw TypeError("Invalid UUID");let a;const n=new Uint8Array(16);return n[0]=(a=parseInt(s.slice(0,8),16))>>>24,n[1]=a>>>16&255,n[2]=a>>>8&255,n[3]=a&255,n[4]=(a=parseInt(s.slice(9,13),16))>>>8,n[5]=a&255,n[6]=(a=parseInt(s.slice(14,18),16))>>>8,n[7]=a&255,n[8]=(a=parseInt(s.slice(19,23),16))>>>8,n[9]=a&255,n[10]=(a=parseInt(s.slice(24,36),16))/1099511627776&255,n[11]=a/4294967296&255,n[12]=a>>>24&255,n[13]=a>>>16&255,n[14]=a>>>8&255,n[15]=a&255,n}var u=i;return Fe.default=u,Fe}var Vs;function Gp(){if(Vs)return ee;Vs=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.URL=ee.DNS=void 0,ee.default=n;var e=Qi(),t=i(Jp());function i(r){return r&&r.__esModule?r:{default:r}}function u(r){r=unescape(encodeURIComponent(r));const o=[];for(let c=0;c<r.length;++c)o.push(r.charCodeAt(c));return o}const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";ee.DNS=s;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";ee.URL=a;function n(r,o,c){function p(h,l,d,g){var f;if(typeof h=="string"&&(h=u(h)),typeof l=="string"&&(l=(0,t.default)(l)),((f=l)===null||f===void 0?void 0:f.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let S=new Uint8Array(16+h.length);if(S.set(l),S.set(h,l.length),S=c(S),S[6]=S[6]&15|o,S[8]=S[8]&63|128,d){g=g||0;for(let v=0;v<16;++v)d[g+v]=S[v];return d}return(0,e.unsafeStringify)(S)}try{p.name=r}catch{}return p.DNS=s,p.URL=a,p}return ee}var xe={},Hs;function sl(){if(Hs)return xe;Hs=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.default=void 0;function e(d){if(typeof d=="string"){const g=unescape(encodeURIComponent(d));d=new Uint8Array(g.length);for(let f=0;f<g.length;++f)d[f]=g.charCodeAt(f)}return t(u(s(d),d.length*8))}function t(d){const g=[],f=d.length*32,S="0123456789abcdef";for(let v=0;v<f;v+=8){const m=d[v>>5]>>>v%32&255,C=parseInt(S.charAt(m>>>4&15)+S.charAt(m&15),16);g.push(C)}return g}function i(d){return(d+64>>>9<<4)+14+1}function u(d,g){d[g>>5]|=128<<g%32,d[i(g)-1]=g;let f=1732584193,S=-271733879,v=-1732584194,m=271733878;for(let C=0;C<d.length;C+=16){const y=f,R=S,I=v,w=m;f=o(f,S,v,m,d[C],7,-680876936),m=o(m,f,S,v,d[C+1],12,-389564586),v=o(v,m,f,S,d[C+2],17,606105819),S=o(S,v,m,f,d[C+3],22,-1044525330),f=o(f,S,v,m,d[C+4],7,-176418897),m=o(m,f,S,v,d[C+5],12,1200080426),v=o(v,m,f,S,d[C+6],17,-1473231341),S=o(S,v,m,f,d[C+7],22,-45705983),f=o(f,S,v,m,d[C+8],7,1770035416),m=o(m,f,S,v,d[C+9],12,-1958414417),v=o(v,m,f,S,d[C+10],17,-42063),S=o(S,v,m,f,d[C+11],22,-1990404162),f=o(f,S,v,m,d[C+12],7,1804603682),m=o(m,f,S,v,d[C+13],12,-40341101),v=o(v,m,f,S,d[C+14],17,-1502002290),S=o(S,v,m,f,d[C+15],22,1236535329),f=c(f,S,v,m,d[C+1],5,-165796510),m=c(m,f,S,v,d[C+6],9,-1069501632),v=c(v,m,f,S,d[C+11],14,643717713),S=c(S,v,m,f,d[C],20,-373897302),f=c(f,S,v,m,d[C+5],5,-701558691),m=c(m,f,S,v,d[C+10],9,38016083),v=c(v,m,f,S,d[C+15],14,-660478335),S=c(S,v,m,f,d[C+4],20,-405537848),f=c(f,S,v,m,d[C+9],5,568446438),m=c(m,f,S,v,d[C+14],9,-1019803690),v=c(v,m,f,S,d[C+3],14,-187363961),S=c(S,v,m,f,d[C+8],20,1163531501),f=c(f,S,v,m,d[C+13],5,-1444681467),m=c(m,f,S,v,d[C+2],9,-51403784),v=c(v,m,f,S,d[C+7],14,1735328473),S=c(S,v,m,f,d[C+12],20,-1926607734),f=p(f,S,v,m,d[C+5],4,-378558),m=p(m,f,S,v,d[C+8],11,-2022574463),v=p(v,m,f,S,d[C+11],16,1839030562),S=p(S,v,m,f,d[C+14],23,-35309556),f=p(f,S,v,m,d[C+1],4,-1530992060),m=p(m,f,S,v,d[C+4],11,1272893353),v=p(v,m,f,S,d[C+7],16,-155497632),S=p(S,v,m,f,d[C+10],23,-1094730640),f=p(f,S,v,m,d[C+13],4,681279174),m=p(m,f,S,v,d[C],11,-358537222),v=p(v,m,f,S,d[C+3],16,-722521979),S=p(S,v,m,f,d[C+6],23,76029189),f=p(f,S,v,m,d[C+9],4,-640364487),m=p(m,f,S,v,d[C+12],11,-421815835),v=p(v,m,f,S,d[C+15],16,530742520),S=p(S,v,m,f,d[C+2],23,-995338651),f=h(f,S,v,m,d[C],6,-198630844),m=h(m,f,S,v,d[C+7],10,1126891415),v=h(v,m,f,S,d[C+14],15,-1416354905),S=h(S,v,m,f,d[C+5],21,-57434055),f=h(f,S,v,m,d[C+12],6,1700485571),m=h(m,f,S,v,d[C+3],10,-1894986606),v=h(v,m,f,S,d[C+10],15,-1051523),S=h(S,v,m,f,d[C+1],21,-2054922799),f=h(f,S,v,m,d[C+8],6,1873313359),m=h(m,f,S,v,d[C+15],10,-30611744),v=h(v,m,f,S,d[C+6],15,-1560198380),S=h(S,v,m,f,d[C+13],21,1309151649),f=h(f,S,v,m,d[C+4],6,-145523070),m=h(m,f,S,v,d[C+11],10,-1120210379),v=h(v,m,f,S,d[C+2],15,718787259),S=h(S,v,m,f,d[C+9],21,-343485551),f=a(f,y),S=a(S,R),v=a(v,I),m=a(m,w)}return[f,S,v,m]}function s(d){if(d.length===0)return[];const g=d.length*8,f=new Uint32Array(i(g));for(let S=0;S<g;S+=8)f[S>>5]|=(d[S/8]&255)<<S%32;return f}function a(d,g){const f=(d&65535)+(g&65535);return(d>>16)+(g>>16)+(f>>16)<<16|f&65535}function n(d,g){return d<<g|d>>>32-g}function r(d,g,f,S,v,m){return a(n(a(a(g,d),a(S,m)),v),f)}function o(d,g,f,S,v,m,C){return r(g&f|~g&S,d,g,v,m,C)}function c(d,g,f,S,v,m,C){return r(g&S|f&~S,d,g,v,m,C)}function p(d,g,f,S,v,m,C){return r(g^f^S,d,g,v,m,C)}function h(d,g,f,S,v,m,C){return r(f^(g|~S),d,g,v,m,C)}var l=e;return xe.default=l,xe}var Ks;function ol(){if(Ks)return Be;Ks=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.default=void 0;var e=i(Gp()),t=i(sl());function i(a){return a&&a.__esModule?a:{default:a}}var s=(0,e.default)("v3",48,t.default);return Be.default=s,Be}var Ue={},We={},$s;function al(){if($s)return We;$s=1,Object.defineProperty(We,"__esModule",{value:!0}),We.default=void 0;var t={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return We.default=t,We}var Js;function cl(){if(Js)return Ue;Js=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var e=u(al()),t=u($p()),i=Qi();function u(n){return n&&n.__esModule?n:{default:n}}function s(n,r,o){if(e.default.randomUUID&&!r&&!n)return e.default.randomUUID();n=n||{};const c=n.random||(n.rng||t.default)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,r){o=o||0;for(let p=0;p<16;++p)r[o+p]=c[p];return r}return(0,i.unsafeStringify)(c)}var a=s;return Ue.default=a,Ue}var Ve={},He={},Gs;function ul(){if(Gs)return He;Gs=1,Object.defineProperty(He,"__esModule",{value:!0}),He.default=void 0;function e(s,a,n,r){switch(s){case 0:return a&n^~a&r;case 1:return a^n^r;case 2:return a&n^a&r^n&r;case 3:return a^n^r}}function t(s,a){return s<<a|s>>>32-a}function i(s){const a=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const p=unescape(encodeURIComponent(s));s=[];for(let h=0;h<p.length;++h)s.push(p.charCodeAt(h))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const r=s.length/4+2,o=Math.ceil(r/16),c=new Array(o);for(let p=0;p<o;++p){const h=new Uint32Array(16);for(let l=0;l<16;++l)h[l]=s[p*64+l*4]<<24|s[p*64+l*4+1]<<16|s[p*64+l*4+2]<<8|s[p*64+l*4+3];c[p]=h}c[o-1][14]=(s.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(s.length-1)*8&4294967295;for(let p=0;p<o;++p){const h=new Uint32Array(80);for(let v=0;v<16;++v)h[v]=c[p][v];for(let v=16;v<80;++v)h[v]=t(h[v-3]^h[v-8]^h[v-14]^h[v-16],1);let l=n[0],d=n[1],g=n[2],f=n[3],S=n[4];for(let v=0;v<80;++v){const m=Math.floor(v/20),C=t(l,5)+e(m,d,g,f)+S+a[m]+h[v]>>>0;S=f,f=g,g=t(d,30)>>>0,d=l,l=C}n[0]=n[0]+l>>>0,n[1]=n[1]+d>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+f>>>0,n[4]=n[4]+S>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var u=i;return He.default=u,He}var Qs;function pl(){if(Qs)return Ve;Qs=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.default=void 0;var e=i(Gp()),t=i(ul());function i(a){return a&&a.__esModule?a:{default:a}}var s=(0,e.default)("v5",80,t.default);return Ve.default=s,Ve}var Ke={},Xs;function hl(){if(Xs)return Ke;Xs=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.default=void 0;var e="00000000-0000-0000-0000-000000000000";return Ke.default=e,Ke}var $e={},Zs;function dl(){if(Zs)return $e;Zs=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.default=void 0;var e=t(Gi());function t(s){return s&&s.__esModule?s:{default:s}}function i(s){if(!(0,e.default)(s))throw TypeError("Invalid UUID");return parseInt(s.slice(14,15),16)}var u=i;return $e.default=u,$e}var Ys;function ll(){return Ys||(Ys=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return n.default}});var t=p(nl()),i=p(ol()),u=p(cl()),s=p(pl()),a=p(hl()),n=p(dl()),r=p(Gi()),o=p(Qi()),c=p(Jp());function p(h){return h&&h.__esModule?h:{default:h}}})(en)),en}var eo;function be(){if(eo)return ce;eo=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.createNoDashGuid=ce.createGuid=void 0;const e=ll(),t=()=>(0,e.v4)();ce.createGuid=t;const i=()=>t().replace(new RegExp("-","g"),"").toUpperCase();return ce.createNoDashGuid=i,ce}var to;function Wi(){return to||(to=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PlatformEvent=e.EventType=void 0;const t=be();(function(u){u[u.Debug=0]="Debug",u[u.Info=1]="Info",u[u.Warning=2]="Warning",u[u.Error=3]="Error",u[u.None=4]="None"})(e.EventType||(e.EventType={}));class i{constructor(s,a){this.privName=s,this.privEventId=(0,t.createNoDashGuid)(),this.privEventTime=new Date().toISOString(),this.privEventType=a,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}e.PlatformEvent=i})(Yi)),Yi}var ro;function vl(){if(ro)return k;ro=1,Object.defineProperty(k,"__esModule",{value:!0}),k.AudioStreamNodeErrorEvent=k.AudioStreamNodeDetachedEvent=k.AudioStreamNodeAttachedEvent=k.AudioStreamNodeAttachingEvent=k.AudioStreamNodeEvent=k.AudioSourceErrorEvent=k.AudioSourceOffEvent=k.AudioSourceReadyEvent=k.AudioSourceInitializingEvent=k.AudioSourceEvent=void 0;const e=Wi();class t extends e.PlatformEvent{constructor(l,d,g=e.EventType.Info){super(l,g),this.privAudioSourceId=d}get audioSourceId(){return this.privAudioSourceId}}k.AudioSourceEvent=t;class i extends t{constructor(l){super("AudioSourceInitializingEvent",l)}}k.AudioSourceInitializingEvent=i;class u extends t{constructor(l){super("AudioSourceReadyEvent",l)}}k.AudioSourceReadyEvent=u;class s extends t{constructor(l){super("AudioSourceOffEvent",l)}}k.AudioSourceOffEvent=s;class a extends t{constructor(l,d){super("AudioSourceErrorEvent",l,e.EventType.Error),this.privError=d}get error(){return this.privError}}k.AudioSourceErrorEvent=a;class n extends t{constructor(l,d,g){super(l,d),this.privAudioNodeId=g}get audioNodeId(){return this.privAudioNodeId}}k.AudioStreamNodeEvent=n;class r extends n{constructor(l,d){super("AudioStreamNodeAttachingEvent",l,d)}}k.AudioStreamNodeAttachingEvent=r;class o extends n{constructor(l,d){super("AudioStreamNodeAttachedEvent",l,d)}}k.AudioStreamNodeAttachedEvent=o;class c extends n{constructor(l,d){super("AudioStreamNodeDetachedEvent",l,d)}}k.AudioStreamNodeDetachedEvent=c;class p extends n{constructor(l,d,g){super("AudioStreamNodeErrorEvent",l,d),this.privError=g}get error(){return this.privError}}return k.AudioStreamNodeErrorEvent=p,k}var z={},io;function fl(){if(io)return z;io=1,Object.defineProperty(z,"__esModule",{value:!0}),z.ConnectionRedirectEvent=z.ConnectionMessageSentEvent=z.ConnectionMessageReceivedEvent=z.ConnectionEstablishErrorEvent=z.ConnectionErrorEvent=z.ConnectionClosedEvent=z.ConnectionEstablishedEvent=z.ConnectionStartEvent=z.ConnectionEvent=z.ServiceEvent=void 0;const e=Wi();class t extends e.PlatformEvent{constructor(l,d,g=e.EventType.Info){super(l,g),this.privJsonResult=d}get jsonString(){return this.privJsonResult}}z.ServiceEvent=t;class i extends e.PlatformEvent{constructor(l,d,g=e.EventType.Info){super(l,g),this.privConnectionId=d}get connectionId(){return this.privConnectionId}}z.ConnectionEvent=i;class u extends i{constructor(l,d,g){super("ConnectionStartEvent",l),this.privUri=d,this.privHeaders=g}get uri(){return this.privUri}get headers(){return this.privHeaders}}z.ConnectionStartEvent=u;class s extends i{constructor(l){super("ConnectionEstablishedEvent",l)}}z.ConnectionEstablishedEvent=s;class a extends i{constructor(l,d,g){super("ConnectionClosedEvent",l,e.EventType.Debug),this.privReason=g,this.privStatusCode=d}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}z.ConnectionClosedEvent=a;class n extends i{constructor(l,d,g){super("ConnectionErrorEvent",l,e.EventType.Debug),this.privMessage=d,this.privType=g}get message(){return this.privMessage}get type(){return this.privType}}z.ConnectionErrorEvent=n;class r extends i{constructor(l,d,g){super("ConnectionEstablishErrorEvent",l,e.EventType.Error),this.privStatusCode=d,this.privReason=g}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}z.ConnectionEstablishErrorEvent=r;class o extends i{constructor(l,d,g){super("ConnectionMessageReceivedEvent",l),this.privNetworkReceivedTime=d,this.privMessage=g}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}z.ConnectionMessageReceivedEvent=o;class c extends i{constructor(l,d,g){super("ConnectionMessageSentEvent",l),this.privNetworkSentTime=d,this.privMessage=g}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}z.ConnectionMessageSentEvent=c;class p extends i{constructor(l,d,g,f){super("ConnectionRedirectEvent",l,e.EventType.Info),this.privRedirectUrl=d,this.privOriginalUrl=g,this.privContext=f}get redirectUrl(){return this.privRedirectUrl}get originalUrl(){return this.privOriginalUrl}get context(){return this.privContext}}return z.ConnectionRedirectEvent=p,z}var tn={},Q={},no;function G(){if(no)return Q;no=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.ObjectDisposedError=Q.InvalidOperationError=Q.ArgumentNullError=void 0;class e extends Error{constructor(s){super(s),this.name="ArgumentNull",this.message=s}}Q.ArgumentNullError=e;class t extends Error{constructor(s){super(s),this.name="InvalidOperation",this.message=s}}Q.InvalidOperationError=t;class i extends Error{constructor(s,a){super(a),this.name=s+"ObjectDisposed",this.message=a}}return Q.ObjectDisposedError=i,Q}var so;function Qp(){return so||(so=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionMessage=e.MessageType=void 0;const t=G(),i=be();var u;(function(a){a[a.Text=0]="Text",a[a.Binary=1]="Binary"})(u=e.MessageType||(e.MessageType={}));class s{constructor(n,r,o,c){if(this.privBody=null,n===u.Text&&r&&typeof r!="string")throw new t.InvalidOperationError("Payload must be a string");if(n===u.Binary&&r&&!(r instanceof ArrayBuffer))throw new t.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=n,this.privBody=r,this.privHeaders=o||{},this.privId=c||(0,i.createNoDashGuid)(),this.messageType){case u.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case u.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===u.Binary)throw new t.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===u.Text)throw new t.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}e.ConnectionMessage=s})(tn)),tn}var Je={},oo;function gl(){if(oo)return Je;oo=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.ConnectionOpenResponse=void 0;let e=class{constructor(i,u){this.privStatusCode=i,this.privReason=u}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}};return Je.ConnectionOpenResponse=e,Je}var Ge={},ao;function Sl(){if(ao)return Ge;ao=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.DeferralMap=void 0;let e=class{constructor(){this.privMap={}}add(i,u){this.privMap[i]=u}getId(i){return this.privMap[i]}complete(i,u){try{this.privMap[i].resolve(u)}catch(s){this.privMap[i].reject(s)}finally{this.privMap[i]=void 0}}};return Ge.DeferralMap=e,Ge}var ue={},co;function Xp(){if(co)return ue;co=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.SendingAgentContextMessageEvent=ue.DialogEvent=void 0;const e=Wi();class t extends e.PlatformEvent{constructor(s,a=e.EventType.Info){super(s,a)}}ue.DialogEvent=t;class i extends t{constructor(s){super("SendingAgentContextMessageEvent"),this.privAgentConfig=s}get agentConfig(){return this.privAgentConfig}}return ue.SendingAgentContextMessageEvent=i,ue}var Qe={},Xe={},uo;function Zp(){if(uo)return Xe;uo=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.EventSource=void 0;const e=G(),t=be();let i=class{constructor(s){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=s}onEvent(s){if(this.isDisposed())throw new e.ObjectDisposedError("EventSource");if(this.metadata)for(const a in this.metadata)a&&s.metadata&&(s.metadata[a]||(s.metadata[a]=this.metadata[a]));for(const a in this.privEventListeners)a&&this.privEventListeners[a]&&this.privEventListeners[a](s)}attach(s){const a=(0,t.createNoDashGuid)();return this.privEventListeners[a]=s,{detach:()=>(delete this.privEventListeners[a],Promise.resolve())}}attachListener(s){return this.attach(a=>s.onEvent(a))}attachConsoleListener(s){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(a=>s.onEvent(a)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}};return Xe.EventSource=i,Xe}var po;function ml(){if(po)return Qe;po=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.Events=void 0;const e=G(),t=Zp();let i=class Ss{static setEventSource(s){if(!s)throw new e.ArgumentNullError("eventSource");Ss.privInstance=s}static get instance(){return Ss.privInstance}};return Qe.Events=i,i.privInstance=new t.EventSource,Qe}var rn={},ho;function Cl(){return ho||(ho=1,Object.defineProperty(rn,"__esModule",{value:!0})),rn}var nn={},lo;function yl(){return lo||(lo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionState=void 0,(function(t){t[t.None=0]="None",t[t.Connected=1]="Connected",t[t.Connecting=2]="Connecting",t[t.Disconnected=3]="Disconnected"})(e.ConnectionState||(e.ConnectionState={}))})(nn)),nn}var sn={},vo;function Rl(){return vo||(vo=1,Object.defineProperty(sn,"__esModule",{value:!0})),sn}var on={},fo;function Pl(){return fo||(fo=1,Object.defineProperty(on,"__esModule",{value:!0})),on}var an={},go;function El(){return go||(go=1,Object.defineProperty(an,"__esModule",{value:!0})),an}var cn={},So;function Il(){return So||(So=1,Object.defineProperty(cn,"__esModule",{value:!0})),cn}var un={},mo;function Al(){return mo||(mo=1,Object.defineProperty(un,"__esModule",{value:!0})),un}var pn={},Co;function Tl(){return Co||(Co=1,Object.defineProperty(pn,"__esModule",{value:!0})),pn}var hn={},yo;function wl(){return yo||(yo=1,Object.defineProperty(hn,"__esModule",{value:!0})),hn}var dn={},Ro;function _l(){return Ro||(Ro=1,Object.defineProperty(dn,"__esModule",{value:!0})),dn}var Ze={},Po;function Yp(){if(Po)return Ze;Po=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.List=void 0;const e=G();let t=class we{constructor(u){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],u)for(const s of u)this.privList.push(s)}get(u){return this.throwIfDisposed(),this.privList[u]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(u){this.throwIfDisposed(),this.insertAt(this.privList.length,u)}insertAt(u,s){this.throwIfDisposed(),u===0?this.privList.unshift(s):u===this.privList.length?this.privList.push(s):this.privList.splice(u,0,s),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(u){return this.throwIfDisposed(),this.remove(u,1)[0]}remove(u,s){this.throwIfDisposed();const a=this.privList.splice(u,s);return this.triggerSubscriptions(this.privRemoveSubscriptions),a}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(u){this.throwIfDisposed();const s=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[s]=u,{detach:()=>(delete this.privAddSubscriptions[s],Promise.resolve())}}onRemoved(u){this.throwIfDisposed();const s=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[s]=u,{detach:()=>(delete this.privRemoveSubscriptions[s],Promise.resolve())}}onDisposed(u){this.throwIfDisposed();const s=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[s]=u,{detach:()=>(delete this.privDisposedSubscriptions[s],Promise.resolve())}}join(u){return this.throwIfDisposed(),this.privList.join(u)}toArray(){const u=Array();return this.privList.forEach(s=>{u.push(s)}),u}any(u){return this.throwIfDisposed(),u?this.where(u).length()>0:this.length()>0}all(u){return this.throwIfDisposed(),this.where(u).length()===this.length()}forEach(u){this.throwIfDisposed();for(let s=0;s<this.length();s++)u(this.privList[s],s)}select(u){this.throwIfDisposed();const s=[];for(let a=0;a<this.privList.length;a++)s.push(u(this.privList[a],a));return new we(s)}where(u){this.throwIfDisposed();const s=new we;for(let a=0;a<this.privList.length;a++)u(this.privList[a],a)&&s.add(this.privList[a]);return s}orderBy(u){this.throwIfDisposed();const a=this.toArray().sort(u);return new we(a)}orderByDesc(u){return this.throwIfDisposed(),this.orderBy((s,a)=>u(a,s))}clone(){return this.throwIfDisposed(),new we(this.toArray())}concat(u){return this.throwIfDisposed(),new we(this.privList.concat(u.toArray()))}concatArray(u){return this.throwIfDisposed(),new we(this.privList.concat(u))}isDisposed(){return this.privList==null}dispose(u){this.isDisposed()||(this.privDisposeReason=u,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new e.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(u){if(u)for(const s in u)s&&u[s]()}};return Ze.List=t,Ze}var ln={},Eo;function eh(){return Eo||(Eo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.marshalPromiseToCallbacks=e.Sink=e.Deferred=e.PromiseResultEventSource=e.PromiseResult=e.PromiseState=void 0;var t;(function(r){r[r.None=0]="None",r[r.Resolved=1]="Resolved",r[r.Rejected=2]="Rejected"})(t=e.PromiseState||(e.PromiseState={}));class i{constructor(o){this.throwIfError=()=>{if(this.isError)throw this.error},o.on(c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=c)},c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=c)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}e.PromiseResult=i;class u{constructor(){this.setResult=o=>{this.privOnSetResult(o)},this.setError=o=>{this.privOnSetError(o)},this.on=(o,c)=>{this.privOnSetResult=o,this.privOnSetError=c}}}e.PromiseResultEventSource=u;class s{constructor(){this.resolve=o=>(this.privResolve(o),this),this.reject=o=>(this.privReject(o),this),this.privPromise=new Promise((o,c)=>{this.privResolve=o,this.privReject=c})}get promise(){return this.privPromise}}e.Deferred=s;class a{constructor(){this.privState=t.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new u,this.privPromiseResult=new i(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(o){if(this.privState!==t.None)throw new Error("'Cannot resolve a completed promise'");this.privState=t.Resolved,this.privPromiseResultEvents.setResult(o);for(let c=0;c<this.privSuccessHandlers.length;c++)this.executeSuccessCallback(o,this.privSuccessHandlers[c],this.privErrorHandlers[c]);this.detachHandlers()}reject(o){if(this.privState!==t.None)throw new Error("'Cannot reject a completed promise'");this.privState=t.Rejected,this.privPromiseResultEvents.setError(o);for(const c of this.privErrorHandlers)this.executeErrorCallback(o,c);this.detachHandlers()}on(o,c){o==null&&(o=()=>{}),this.privState===t.None?(this.privSuccessHandlers.push(o),this.privErrorHandlers.push(c)):(this.privState===t.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,o,c):this.privState===t.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,c),this.detachHandlers())}executeSuccessCallback(o,c,p){try{c(o)}catch(h){this.executeErrorCallback(`'Unhandled callback error: ${h}'`,p)}}executeErrorCallback(o,c){if(c)try{c(o)}catch(p){throw new Error(`'Unhandled callback error: ${p}. InnerError: ${o}'`)}else throw new Error(`'Unhandled error: ${o}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}e.Sink=a;function n(r,o,c){r.then(p=>{try{o&&o(p)}catch(h){if(c)try{if(h instanceof Error){const l=h;c(l.name+": "+l.message)}else c(h)}catch{}}},p=>{if(c)try{if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}catch{}})}e.marshalPromiseToCallbacks=n})(ln)),ln}var Ye={},Io;function th(){if(Io)return Ye;Io=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Queue=void 0;const e=G(),t=Yp(),i=eh();var u;(function(a){a[a.Dequeue=0]="Dequeue",a[a.Peek=1]="Peek"})(u||(u={}));let s=class{constructor(n){this.privPromiseStore=new t.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=n||new t.List,this.privDetachables=[],this.privSubscribers=new t.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(n){this.throwIfDispose(),this.enqueueFromPromise(new Promise(r=>r(n)))}enqueueFromPromise(n){this.throwIfDispose(),n.then(r=>{this.privList.add(r)},()=>{})}dequeue(){this.throwIfDispose();const n=new i.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:n,type:u.Dequeue}),this.drain()),n.promise}peek(){this.throwIfDispose();const n=new i.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:n,type:u.Peek}),this.drain()),n.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(n,r){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=r,this.privIsDisposing=!0;const o=this.privSubscribers;if(o){for(;o.length()>0;)o.removeFirst().deferral.resolve(void 0);this.privSubscribers===o&&(this.privSubscribers=o)}for(const c of this.privDetachables)await c.detach();if(this.privPromiseStore.length()>0&&n){const c=[];return this.privPromiseStore.toArray().forEach(p=>{c.push(p)}),Promise.all(c).finally(()=>{this.privSubscribers=null,this.privList.forEach(p=>{n(p)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(n){await this.drainAndDispose(null,n)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const n=this.privSubscribers,r=this.privList;if(n&&r){for(;r.length()>0&&n.length()>0&&!this.privIsDisposing;){const o=n.removeFirst();if(o.type===u.Peek)o.deferral.resolve(r.first());else{const c=r.removeFirst();o.deferral.resolve(c)}}this.privSubscribers===n&&(this.privSubscribers=n),this.privList===r&&(this.privList=r)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new e.InvalidOperationError(this.privDisposeReason):new e.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new e.InvalidOperationError("Queue disposing")}};return Ye.Queue=s,Ye}var et={},Ao;function bl(){if(Ao)return et;Ao=1,Object.defineProperty(et,"__esModule",{value:!0}),et.RawWebsocketMessage=void 0;const e=Qp(),t=G(),i=be();let u=class{constructor(a,n,r){if(this.privPayload=null,!n)throw new t.ArgumentNullError("payload");if(a===e.MessageType.Binary&&Object.getPrototypeOf(n).constructor.name!=="ArrayBuffer")throw new t.InvalidOperationError("Payload must be ArrayBuffer");if(a===e.MessageType.Text&&typeof n!="string")throw new t.InvalidOperationError("Payload must be a string");this.privMessageType=a,this.privPayload=n,this.privId=r||(0,i.createNoDashGuid)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===e.MessageType.Binary)throw new t.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===e.MessageType.Text)throw new t.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}};return et.RawWebsocketMessage=u,et}var tt={},To;function Ml(){if(To)return tt;To=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.RiffPcmEncoder=void 0;let e=class{constructor(i,u){this.privActualSampleRate=i,this.privDesiredSampleRate=u}encode(i){const u=this.downSampleAudioFrame(i,this.privActualSampleRate,this.privDesiredSampleRate);if(!u)return null;const s=u.length*2,a=new ArrayBuffer(s),n=new DataView(a);return this.floatTo16BitPCM(n,0,u),a}setString(i,u,s){for(let a=0;a<s.length;a++)i.setUint8(u+a,s.charCodeAt(a))}floatTo16BitPCM(i,u,s){for(let a=0;a<s.length;a++,u+=2){const n=Math.max(-1,Math.min(1,s[a]));i.setInt16(u,n<0?n*32768:n*32767,!0)}}downSampleAudioFrame(i,u,s){if(!i)return null;if(s===u||s>u)return i;const a=u/s,n=Math.round(i.length/a),r=new Float32Array(n);let o=0,c=0;for(;c<n;){const p=Math.round((c+1)*a);let h=0,l=0;for(;o<p&&o<i.length;)h+=i[o++],l++;r[c++]=h/l}return r}};return tt.RiffPcmEncoder=e,tt}var rt={},wo;function Ol(){if(wo)return rt;wo=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.Stream=void 0;const e=G(),t=be(),i=th();let u=class{constructor(a){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=a||(0,t.createNoDashGuid)(),this.privReaderQueue=new i.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(a){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(a)}catch{}}read(){if(this.privIsReadEnded)throw new e.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(async a=>((a===void 0||a.isEnd)&&await this.privReaderQueue.dispose("End of stream reached"),a))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new i.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new e.InvalidOperationError("Stream closed")}};return rt.Stream=u,rt}var vn={},_o;function Ts(){return _o||(_o=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TranslationStatus=void 0,(function(t){t[t.Success=0]="Success",t[t.Error=1]="Error"})(e.TranslationStatus||(e.TranslationStatus={}))})(vn)),vn}var it={},bo;function Dl(){if(bo)return it;bo=1,Object.defineProperty(it,"__esModule",{value:!0}),it.ChunkedArrayBufferStream=void 0;const e=T();let t=class extends e.Stream{constructor(u,s){super(s),this.privTargetChunkSize=Math.round(u),this.privNextBufferReadyBytes=0}writeStreamChunk(u){if(u.isEnd||this.privNextBufferReadyBytes===0&&u.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(u);return}let s=0;for(;s<u.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=u.timeReceived);const a=Math.min(u.buffer.byteLength-s,this.privTargetChunkSize-this.privNextBufferReadyBytes),n=new Uint8Array(this.privNextBufferToWrite),r=new Uint8Array(u.buffer.slice(s,a+s));n.set(r,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=a,s+=a,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};return it.ChunkedArrayBufferStream=t,it}var fn={},Mo;function kl(){return Mo||(Mo=1,Object.defineProperty(fn,"__esModule",{value:!0})),fn}var nt={},Oo;function zl(){if(Oo)return nt;Oo=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.Timeout=void 0;let e=class te{static load(){const i=new Map([[0,()=>{}]]),u=new Map,a="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),n=new Worker(a);return n.addEventListener("message",({data:c})=>{if(te.isCallNotification(c)){const{params:{timerId:p}}=c,h=i.get(p);if(typeof h=="number"){const l=u.get(h);if(l===void 0||l!==p)throw new Error("The timer is in an undefined state.")}else if(typeof h<"u")h(),i.delete(p);else throw new Error("The timer is in an undefined state.")}else if(te.isClearResponse(c)){const{id:p}=c,h=u.get(p);if(h===void 0)throw new Error("The timer is in an undefined state.");u.delete(p),i.delete(h)}else{const{error:{message:p}}=c;throw new Error(p)}}),{clearTimeout:c=>{const p=Math.random();u.set(p,c),i.set(c,p),n.postMessage({id:p,method:"clear",params:{timerId:c}})},setTimeout:(c,p)=>{const h=Math.random();return i.set(h,c),n.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h}}),h}}}static loadWorkerTimers(){return()=>(te.workerTimers!==null||(te.workerTimers=te.load()),te.workerTimers)}static isCallNotification(i){return i.method!==void 0&&i.method==="call"}static isClearResponse(i){return i.error===null&&typeof i.id=="number"}};return nt.Timeout=e,e.workerTimers=null,e.clearTimeout=t=>e.timers().clearTimeout(t),e.setTimeout=(t,i)=>e.timers().setTimeout(t,i),e.timers=e.loadWorkerTimers(),nt}var b={},Do;function Nl(){if(Do)return b;Do=1,Object.defineProperty(b,"__esModule",{value:!0}),b.OCSPCacheUpdateErrorEvent=b.OCSPResponseRetrievedEvent=b.OCSPCacheFetchErrorEvent=b.OCSPVerificationFailedEvent=b.OCSPCacheHitEvent=b.OCSPCacheEntryNeedsRefreshEvent=b.OCSPCacheEntryExpiredEvent=b.OCSPWSUpgradeStartedEvent=b.OCSPStapleReceivedEvent=b.OCSPCacheUpdateCompleteEvent=b.OCSPDiskCacheStoreEvent=b.OCSPMemoryCacheStoreEvent=b.OCSPCacheUpdateNeededEvent=b.OCSPDiskCacheHitEvent=b.OCSPCacheMissEvent=b.OCSPMemoryCacheHitEvent=b.OCSPEvent=void 0;const e=Wi();class t extends e.PlatformEvent{constructor(C,y,R){super(C,y),this.privSignature=R}}b.OCSPEvent=t;class i extends t{constructor(C){super("OCSPMemoryCacheHitEvent",e.EventType.Debug,C)}}b.OCSPMemoryCacheHitEvent=i;class u extends t{constructor(C){super("OCSPCacheMissEvent",e.EventType.Debug,C)}}b.OCSPCacheMissEvent=u;class s extends t{constructor(C){super("OCSPDiskCacheHitEvent",e.EventType.Debug,C)}}b.OCSPDiskCacheHitEvent=s;class a extends t{constructor(C){super("OCSPCacheUpdateNeededEvent",e.EventType.Debug,C)}}b.OCSPCacheUpdateNeededEvent=a;class n extends t{constructor(C){super("OCSPMemoryCacheStoreEvent",e.EventType.Debug,C)}}b.OCSPMemoryCacheStoreEvent=n;class r extends t{constructor(C){super("OCSPDiskCacheStoreEvent",e.EventType.Debug,C)}}b.OCSPDiskCacheStoreEvent=r;class o extends t{constructor(C){super("OCSPCacheUpdateCompleteEvent",e.EventType.Debug,C)}}b.OCSPCacheUpdateCompleteEvent=o;class c extends t{constructor(){super("OCSPStapleReceivedEvent",e.EventType.Debug,"")}}b.OCSPStapleReceivedEvent=c;class p extends t{constructor(C){super("OCSPWSUpgradeStartedEvent",e.EventType.Debug,C)}}b.OCSPWSUpgradeStartedEvent=p;class h extends t{constructor(C,y){super("OCSPCacheEntryExpiredEvent",e.EventType.Debug,C),this.privExpireTime=y}}b.OCSPCacheEntryExpiredEvent=h;class l extends t{constructor(C,y,R){super("OCSPCacheEntryNeedsRefreshEvent",e.EventType.Debug,C),this.privExpireTime=R,this.privStartTime=y}}b.OCSPCacheEntryNeedsRefreshEvent=l;class d extends t{constructor(C,y,R){super("OCSPCacheHitEvent",e.EventType.Debug,C),this.privExpireTime=R,this.privExpireTimeString=new Date(R).toLocaleDateString(),this.privStartTime=y,this.privStartTimeString=new Date(y).toLocaleTimeString()}}b.OCSPCacheHitEvent=d;class g extends t{constructor(C,y){super("OCSPVerificationFailedEvent",e.EventType.Debug,C),this.privError=y}}b.OCSPVerificationFailedEvent=g;class f extends t{constructor(C,y){super("OCSPCacheFetchErrorEvent",e.EventType.Debug,C),this.privError=y}}b.OCSPCacheFetchErrorEvent=f;class S extends t{constructor(C){super("OCSPResponseRetrievedEvent",e.EventType.Debug,C)}}b.OCSPResponseRetrievedEvent=S;class v extends t{constructor(C,y){super("OCSPCacheUpdateErrorEvent",e.EventType.Debug,C),this.privError=y}}return b.OCSPCacheUpdateErrorEvent=v,b}var st={},ko;function jl(){if(ko)return st;ko=1,Object.defineProperty(st,"__esModule",{value:!0}),st.BackgroundEvent=void 0;const e=T();class t extends e.PlatformEvent{constructor(u){super("BackgroundEvent",e.EventType.Error),this.privError=u}get error(){return this.privError}}return st.BackgroundEvent=t,st}var zo;function T(){return zo||(zo=1,(function(e){var t=ae&&ae.__createBinding||(Object.create?(function(s,a,n,r){r===void 0&&(r=n),Object.defineProperty(s,r,{enumerable:!0,get:function(){return a[n]}})}):(function(s,a,n,r){r===void 0&&(r=n),s[r]=a[n]})),i=ae&&ae.__exportStar||function(s,a){for(var n in s)n!=="default"&&!Object.prototype.hasOwnProperty.call(a,n)&&t(a,s,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.TranslationStatus=void 0,i(vl(),e),i(fl(),e),i(Qp(),e),i(gl(),e),i(Sl(),e),i(Xp(),e),i(G(),e),i(ml(),e),i(Zp(),e),i(be(),e),i(Cl(),e),i(yl(),e),i(Rl(),e),i(Pl(),e),i(El(),e),i(Il(),e),i(Al(),e),i(Tl(),e),i(wl(),e),i(_l(),e),i(Yp(),e),i(Wi(),e),i(eh(),e),i(th(),e),i(bl(),e),i(Ml(),e),i(Ol(),e);var u=Ts();Object.defineProperty(e,"TranslationStatus",{enumerable:!0,get:function(){return u.TranslationStatus}}),i(Dl(),e),i(kl(),e),i(zl(),e),i(Nl(),e),i(jl(),e)})(ae)),ae}var ot={},No;function q(){if(No)return ot;No=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.HeaderNames=void 0;let e=class{};return ot.HeaderNames=e,e.AuthKey="Ocp-Apim-Subscription-Key",e.Authorization="Authorization",e.SpIDAuthKey="Apim-Subscription-Id",e.ConnectionId="X-ConnectionId",e.ContentType="Content-Type",e.CustomCommandsAppId="X-CommandsAppId",e.Path="Path",e.RequestId="X-RequestId",e.RequestStreamId="X-StreamId",e.RequestTimestamp="X-Timestamp",ot}var at={},jo;function ws(){if(jo)return at;jo=1,Object.defineProperty(at,"__esModule",{value:!0}),at.AuthInfo=void 0;class e{constructor(i,u){this.privHeaderName=i,this.privToken=u}get headerName(){return this.privHeaderName}get token(){return this.privToken}}return at.AuthInfo=e,at}var Lo;function Ll(){if(Lo)return Ne;Lo=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.CognitiveSubscriptionKeyAuthentication=void 0;const e=T(),t=q(),i=ws();let u=class{constructor(a){if(!a)throw new e.ArgumentNullError("subscriptionKey");this.privAuthInfo=new i.AuthInfo(t.HeaderNames.AuthKey,a)}fetch(a){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(a){return Promise.resolve(this.privAuthInfo)}};return Ne.CognitiveSubscriptionKeyAuthentication=u,Ne}var ct={},qo;function ql(){if(qo)return ct;qo=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.CognitiveTokenAuthentication=void 0;const e=T(),t=ws(),i=q();let u=class ms{constructor(a,n){if(!a)throw new e.ArgumentNullError("fetchCallback");if(!n)throw new e.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=a,this.privFetchOnExpiryCallback=n}fetch(a){return this.privFetchCallback(a).then(n=>new t.AuthInfo(i.HeaderNames.Authorization,n===void 0?void 0:ms.privTokenPrefix+n))}fetchOnExpiry(a){return this.privFetchOnExpiryCallback(a).then(n=>new t.AuthInfo(i.HeaderNames.Authorization,n===void 0?void 0:ms.privTokenPrefix+n))}};return ct.CognitiveTokenAuthentication=u,u.privTokenPrefix="Bearer ",ct}var gn={},Bo;function Bl(){return Bo||(Bo=1,Object.defineProperty(gn,"__esModule",{value:!0})),gn}var Sn={},Fo;function Fl(){return Fo||(Fo=1,Object.defineProperty(Sn,"__esModule",{value:!0})),Sn}var ut={},pe={},H={};const xl={},Ul=Object.freeze(Object.defineProperty({__proto__:null,default:xl},Symbol.toStringTag,{value:"Module"})),_e=tl(Ul);var mn={},xo;function rh(){return xo||(xo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LogLevel=void 0;const t=T();Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return t.EventType}})})(mn)),mn}var pt={},Uo;function _(){if(Uo)return pt;Uo=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.Contracts=void 0;let e=class re{static throwIfNullOrUndefined(i,u){if(i==null)throw new Error("throwIfNullOrUndefined:"+u)}static throwIfNull(i,u){if(i===null)throw new Error("throwIfNull:"+u)}static throwIfNullOrWhitespace(i,u){if(re.throwIfNullOrUndefined(i,u),(""+i).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+u)}static throwIfNullOrTooLong(i,u,s){if(re.throwIfNullOrUndefined(i,u),(""+i).length>s)throw new Error("throwIfNullOrTooLong:"+u+" (more than "+s.toString()+" characters)")}static throwIfNullOrTooShort(i,u,s){if(re.throwIfNullOrUndefined(i,u),(""+i).length<s)throw new Error("throwIfNullOrTooShort:"+u+" (less than "+s.toString()+" characters)")}static throwIfDisposed(i){if(i)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(i,u){if(re.throwIfNullOrUndefined(i,u),i.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+u);for(const s of i)re.throwIfNullOrWhitespace(s,u)}static throwIfFileDoesNotExist(i,u){re.throwIfNullOrWhitespace(i,u)}static throwIfNotUndefined(i,u){if(i!==void 0)throw new Error("throwIfNotUndefined:"+u)}static throwIfNumberOutOfRange(i,u,s,a){if(re.throwIfNullOrUndefined(i,u),i<s||i>a)throw new Error("throwIfNumberOutOfRange:"+u+" (must be between "+s.toString()+" and "+a.toString()+")")}};return pt.Contracts=e,pt}var Wo;function Wl(){if(Wo)return H;Wo=1;var e=H&&H.__createBinding||(Object.create?(function(r,o,c,p){p===void 0&&(p=c),Object.defineProperty(r,p,{enumerable:!0,get:function(){return o[c]}})}):(function(r,o,c,p){p===void 0&&(p=c),r[p]=o[c]})),t=H&&H.__setModuleDefault||(Object.create?(function(r,o){Object.defineProperty(r,"default",{enumerable:!0,value:o})}):function(r,o){r.default=o}),i=H&&H.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(r!=null)for(var c in r)c!=="default"&&Object.prototype.hasOwnProperty.call(r,c)&&e(o,r,c);return t(o,r),o};Object.defineProperty(H,"__esModule",{value:!0}),H.ConsoleLoggingListener=void 0;const u=i(_e),s=rh(),a=_();let n=class{constructor(o=s.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=o}set logPath(o){a.Contracts.throwIfNullOrUndefined(u.openSync,`
File System access not available`),this.privLogPath=o}set enableConsoleOutput(o){this.privEnableConsoleOutput=o}onEvent(o){if(o.eventType>=this.privLogLevelFilter){const c=this.toString(o);if(this.logCallback&&this.logCallback(c),this.privLogPath&&u.writeFileSync(this.privLogPath,c+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(o.eventType){case s.LogLevel.Debug:console.debug(c);break;case s.LogLevel.Info:console.info(c);break;case s.LogLevel.Warning:console.warn(c);break;case s.LogLevel.Error:console.error(c);break;default:console.log(c);break}}}toString(o){const c=[`${o.eventTime}`,`${o.name}`],p=o;for(const h in p)if(h&&o.hasOwnProperty(h)&&h!=="eventTime"&&h!=="eventType"&&h!=="eventId"&&h!=="name"&&h!=="constructor"){const l=p[h];let d="<NULL>";l!=null&&(typeof l=="number"||typeof l=="string"?d=l.toString():d=JSON.stringify(l)),c.push(`${h}: ${d}`)}return c.join(" | ")}};return H.ConsoleLoggingListener=n,H}var Cn={},Vo;function Vl(){return Vo||(Vo=1,Object.defineProperty(Cn,"__esModule",{value:!0})),Cn}var yn={},Rn={},Ho;function Me(){return Ho||(Ho=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AudioStreamFormatImpl=e.AudioStreamFormat=e.AudioFormatTag=void 0;var t;(function(s){s[s.PCM=1]="PCM",s[s.MuLaw=2]="MuLaw",s[s.Siren=3]="Siren",s[s.MP3=4]="MP3",s[s.SILKSkype=5]="SILKSkype",s[s.OGG_OPUS=6]="OGG_OPUS",s[s.WEBM_OPUS=7]="WEBM_OPUS",s[s.ALaw=8]="ALaw",s[s.FLAC=9]="FLAC",s[s.OPUS=10]="OPUS",s[s.AMR_WB=11]="AMR_WB",s[s.G722=12]="G722"})(t=e.AudioFormatTag||(e.AudioFormatTag={}));class i{static getDefaultInputFormat(){return u.getDefaultInputFormat()}static getWaveFormat(a,n,r,o){return new u(a,n,r,o)}static getWaveFormatPCM(a,n,r){return new u(a,n,r)}}e.AudioStreamFormat=i;class u extends i{constructor(a=16e3,n=16,r=1,o=t.PCM){super();let c=!0;switch(o){case t.PCM:this.formatTag=1;break;case t.ALaw:this.formatTag=6;break;case t.MuLaw:this.formatTag=7;break;default:c=!1}if(this.bitsPerSample=n,this.samplesPerSec=a,this.channels=r,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),c){this.privHeader=new ArrayBuffer(44);const p=new DataView(this.privHeader);this.setString(p,0,"RIFF"),p.setUint32(4,0,!0),this.setString(p,8,"WAVEfmt "),p.setUint32(16,16,!0),p.setUint16(20,this.formatTag,!0),p.setUint16(22,this.channels,!0),p.setUint32(24,this.samplesPerSec,!0),p.setUint32(28,this.avgBytesPerSec,!0),p.setUint16(32,this.channels*(this.bitsPerSample/8),!0),p.setUint16(34,this.bitsPerSample,!0),this.setString(p,36,"data"),p.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new u}static getAudioContext(a){const n=window.AudioContext||window.webkitAudioContext||!1;if(n)return a!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new n({sampleRate:a}):new n;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(a,n,r){for(let o=0;o<r.length;o++)a.setUint8(n+o,r.charCodeAt(o))}}e.AudioStreamFormatImpl=u})(Rn)),Rn}var Ko;function Hl(){return Ko||(Ko=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MicAudioSource=e.AudioWorkletSourceURLPropertyName=void 0;const t=A(),i=T(),u=Me();e.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";class s{constructor(n,r,o,c){this.privRecorder=n,this.deviceId=r,this.privStreams={},this.privOutputChunkSize=s.AUDIOFORMAT.avgBytesPerSec/10,this.privId=o||(0,i.createNoDashGuid)(),this.privEvents=new i.EventSource,this.privMediaStream=c||null,this.privIsClosing=!1}get format(){return Promise.resolve(s.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new i.Deferred;try{this.createAudioContext()}catch(o){if(o instanceof Error){const c=o;this.privInitializeDeferral.reject(c.name+": "+c.message)}else this.privInitializeDeferral.reject(o);return this.privInitializeDeferral.promise}const n=window.navigator;let r=n.getUserMedia||n.webkitGetUserMedia||n.mozGetUserMedia||n.msGetUserMedia;if(n.mediaDevices&&(r=(o,c,p)=>{n.mediaDevices.getUserMedia(o).then(c).catch(p)}),r){const o=()=>{this.onEvent(new i.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new i.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):r({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},c=>{this.privMediaStream=c,this.onEvent(new i.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},c=>{const p=`Error occurred during microphone initialization: ${c}`;this.privInitializeDeferral.reject(p),this.onEvent(new i.AudioSourceErrorEvent(this.privId,p))})};this.privContext.state==="suspended"?this.privContext.resume().then(o).catch(c=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${c}`)}):o()}else{const o="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(o),this.onEvent(new i.AudioSourceErrorEvent(o,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(n){return this.onEvent(new i.AudioStreamNodeAttachingEvent(this.privId,n)),this.listen(n).then(r=>(this.onEvent(new i.AudioStreamNodeAttachedEvent(this.privId,n)),{detach:async()=>(r.readEnded(),delete this.privStreams[n],this.onEvent(new i.AudioStreamNodeDetachedEvent(this.privId,n)),this.turnOff()),id:()=>n,read:()=>r.read()}))}detach(n){n&&this.privStreams[n]&&(this.privStreams[n].close(),delete this.privStreams[n],this.onEvent(new i.AudioStreamNodeDetachedEvent(this.privId,n)))}async turnOff(){for(const n in this.privStreams)if(n){const r=this.privStreams[n];r&&r.close()}this.onEvent(new i.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(await this.privInitializeDeferral,this.privInitializeDeferral=null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(n=>({bitspersample:s.AUDIOFORMAT.bitsPerSample,channelcount:s.AUDIOFORMAT.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:n,samplerate:s.AUDIOFORMAT.samplesPerSec,type:t.type.Microphones}))}setProperty(n,r){if(n===e.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(r);else throw new Error("Property '"+n+"' is not supported on Microphone.")}getMicrophoneLabel(){const n="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(n);this.privMicrophoneLabel=n;const r=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(r===void 0)return Promise.resolve(this.privMicrophoneLabel);const o=new i.Deferred;return navigator.mediaDevices.enumerateDevices().then(c=>{for(const p of c)if(p.deviceId===r){this.privMicrophoneLabel=p.label;break}o.resolve(this.privMicrophoneLabel)},()=>o.resolve(this.privMicrophoneLabel)),o.promise}async listen(n){await this.turnOn();const r=new i.ChunkedArrayBufferStream(this.privOutputChunkSize,n);this.privStreams[n]=r;try{this.privRecorder.record(this.privContext,this.privMediaStream,r)}catch(c){throw this.onEvent(new i.AudioStreamNodeErrorEvent(this.privId,n,c)),c}return r}onEvent(n){this.privEvents.onEvent(n),i.Events.instance.onEvent(n)}createAudioContext(){this.privContext||(this.privContext=u.AudioStreamFormatImpl.getAudioContext(s.AUDIOFORMAT.samplesPerSec))}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let n=!1;"close"in this.privContext&&(n=!0),n?this.privIsClosing||(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&await this.privContext.suspend()}}e.MicAudioSource=s,s.AUDIOFORMAT=u.AudioStreamFormat.getDefaultInputFormat()})(yn)),yn}var ht={},$o;function Kl(){if($o)return ht;$o=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.FileAudioSource=void 0;const e=A(),t=T(),i=Me();let u=class{constructor(a,n,r){this.privStreams={},this.privHeaderEnd=44,this.privId=r||(0,t.createNoDashGuid)(),this.privEvents=new t.EventSource,this.privSource=a,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=a.name:this.privFilename=n||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const a=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new t.AudioSourceErrorEvent(a,"")),Promise.reject(a)}this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(a){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,a));const n=await this.upload(a);return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,a)),Promise.resolve({detach:async()=>{n.readEnded(),delete this.privStreams[a],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,a)),await this.turnOff()},id:()=>a,read:()=>n.read()})}detach(a){a&&this.privStreams[a]&&(this.privStreams[a].close(),delete this.privStreams[a],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,a)))}turnOff(){for(const a in this.privStreams)if(a){const n=this.privStreams[a];n&&!n.isClosed&&n.close()}return this.onEvent(new t.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(a=>Promise.resolve({bitspersample:a.bitsPerSample,channelcount:a.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:a.samplesPerSec,type:e.type.File}))}readHeader(){const n=this.privSource.slice(0,4296),r=new t.Deferred,o=c=>{const p=new DataView(c),h=v=>String.fromCharCode(p.getUint8(v),p.getUint8(v+1),p.getUint8(v+2),p.getUint8(v+3));if(h(0)!=="RIFF"){r.reject("Invalid WAV header in file, RIFF was not found");return}if(h(8)!=="WAVE"||h(12)!=="fmt "){r.reject("Invalid WAV header in file, WAVEfmt was not found");return}const l=p.getInt32(16,!0),d=p.getUint16(22,!0),g=p.getUint32(24,!0),f=p.getUint16(34,!0);let S=36+Math.max(l-16,0);for(;h(S)!=="data";S+=2)if(S>4288){r.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=S+8,r.resolve(i.AudioStreamFormat.getWaveFormatPCM(g,f,d))};if(typeof window<"u"&&typeof Blob<"u"&&n instanceof Blob){const c=new FileReader;c.onload=p=>{const h=p.target.result;o(h)},c.readAsArrayBuffer(n)}else{const c=n;o(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength))}return r.promise}async upload(a){const n=r=>{const o=`Error occurred while processing '${this.privFilename}'. ${r}`;throw this.onEvent(new t.AudioStreamNodeErrorEvent(this.privId,a,o)),new Error(o)};try{await this.turnOn();const r=await this.privAudioFormatPromise,o=new t.ChunkedArrayBufferStream(r.avgBytesPerSec/10,a);this.privStreams[a]=o;const c=this.privSource.slice(this.privHeaderEnd),p=h=>{o.isClosed||(o.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()}),o.close())};if(typeof window<"u"&&typeof Blob<"u"&&c instanceof Blob){const h=new FileReader;h.onerror=l=>n(l.toString()),h.onload=l=>{const d=l.target.result;p(d)},h.readAsArrayBuffer(c)}else{const h=c;p(h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength))}return o}catch(r){n(r)}}onEvent(a){this.privEvents.onEvent(a),t.Events.instance.onEvent(a)}};return ht.FileAudioSource=u,ht}var dt={},Jo;function $l(){if(Jo)return dt;Jo=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.PcmRecorder=void 0;const e=T();class t{constructor(u){this.privStopInputOnRelease=u}record(u,s,a){const r=new e.RiffPcmEncoder(u.sampleRate,16e3),o=u.createMediaStreamSource(s),c=()=>{const h=(()=>{let l=0;try{return u.createScriptProcessor(l,1,1)}catch{l=2048;let g=u.sampleRate;for(;l<16384&&g>=32e3;)l<<=1,g>>=1;return u.createScriptProcessor(l,1,1)}})();h.onaudioprocess=l=>{const d=l.inputBuffer.getChannelData(0);if(a&&!a.isClosed){const g=r.encode(d);g&&a.writeStreamChunk({buffer:g,isEnd:!1,timeReceived:Date.now()})}},o.connect(h),h.connect(u.destination),this.privMediaResources={scriptProcessorNode:h,source:o,stream:s}},p=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(u.audioWorklet&&!p){if(!this.privSpeechProcessorScript){const h=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,l=new Blob([h],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(l)}u.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const h=new AudioWorkletNode(u,"speech-processor");h.port.onmessage=l=>{const d=l.data;if(a&&!a.isClosed){const g=r.encode(d);g&&a.writeStreamChunk({buffer:g,isEnd:!1,timeReceived:Date.now()})}},o.connect(h),h.connect(u.destination),this.privMediaResources={scriptProcessorNode:h,source:o,stream:s}}).catch(()=>{c()})}else try{c()}catch(h){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${h}`)}}releaseMediaResources(u){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(u.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(s=>s.stop()),this.privMediaResources.source=null))}setWorkletUrl(u){this.privSpeechProcessorScript=u}}return dt.PcmRecorder=t,dt}var lt={},F={},Go;function ih(){if(Go)return F;Go=1;var e=F&&F.__createBinding||(Object.create?(function(l,d,g,f){f===void 0&&(f=g),Object.defineProperty(l,f,{enumerable:!0,get:function(){return d[g]}})}):(function(l,d,g,f){f===void 0&&(f=g),l[f]=d[g]})),t=F&&F.__setModuleDefault||(Object.create?(function(l,d){Object.defineProperty(l,"default",{enumerable:!0,value:d})}):function(l,d){l.default=d}),i=F&&F.__importStar||function(l){if(l&&l.__esModule)return l;var d={};if(l!=null)for(var g in l)g!=="default"&&Object.prototype.hasOwnProperty.call(l,g)&&e(d,l,g);return t(d,l),d},u=F&&F.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(F,"__esModule",{value:!0}),F.WebsocketMessageAdapter=void 0;const s=i(_e),a=i(_e),n=u(_e),r=u(_e),o=u(_e),c=q(),p=T();let h=class Cs{constructor(d,g,f,S,v,m){if(!d)throw new p.ArgumentNullError("uri");if(!f)throw new p.ArgumentNullError("messageFormatter");this.proxyInfo=S,this.privConnectionEvents=new p.EventSource,this.privConnectionId=g,this.privMessageFormatter=f,this.privConnectionState=p.ConnectionState.None,this.privUri=d,this.privHeaders=v,this.privEnableCompression=m,this.privHeaders[c.HeaderNames.ConnectionId]=this.privConnectionId,this.privHeaders.connectionId=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===p.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new p.Deferred,this.privCertificateValidatedDeferral=new p.Deferred,this.privConnectionState=p.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!Cs.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{let g=new URL(this.privUri).protocol;g?.toLocaleLowerCase()==="wss:"?g="https:":g?.toLocaleLowerCase()==="ws:"&&(g="http:");const f={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression,followRedirects:g.toLocaleLowerCase()==="https:"};this.privCertificateValidatedDeferral.resolve(),f.agent=this.getAgent(),f.agent.protocol=g,this.privWebsocketClient=new o.default(this.privUri,f),this.privWebsocketClient.on("redirect",S=>{const v=new p.ConnectionRedirectEvent(this.privConnectionId,S,this.privUri,`Getting redirect URL from endpoint ${this.privUri} with redirect URL '${S}'`);p.Events.instance.onEvent(v)})}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new p.Queue,this.privDisconnectDeferral=new p.Deferred,this.privSendMessageQueue=new p.Queue,this.processSendQueue().catch(d=>{p.Events.instance.onEvent(new p.BackgroundEvent(d))})}catch(d){return this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(500,d)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new p.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=p.ConnectionState.Connected,this.onEvent(new p.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(200,""))},d=>{this.privConnectionEstablishDeferral.reject(d)})},this.privWebsocketClient.onerror=d=>{this.onEvent(new p.ConnectionErrorEvent(this.privConnectionId,d.message,d.type)),this.privLastErrorReceived=d.message},this.privWebsocketClient.onclose=d=>{this.privConnectionState===p.ConnectionState.Connecting?(this.privConnectionState=p.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(d.code,d.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=p.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new p.ConnectionClosedEvent(this.privConnectionId,d.code,d.reason))),this.onClose(d.code,d.reason).catch(g=>{p.Events.instance.onEvent(new p.BackgroundEvent(g))})},this.privWebsocketClient.onmessage=d=>{const g=new Date().toISOString();if(this.privConnectionState===p.ConnectionState.Connected){const f=new p.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(f.promise),d.data instanceof ArrayBuffer){const S=new p.RawWebsocketMessage(p.MessageType.Binary,d.data);this.privMessageFormatter.toConnectionMessage(S).then(v=>{this.onEvent(new p.ConnectionMessageReceivedEvent(this.privConnectionId,g,v)),f.resolve(v)},v=>{f.reject(`Invalid binary message format. Error: ${v}`)})}else{const S=new p.RawWebsocketMessage(p.MessageType.Text,d.data);this.privMessageFormatter.toConnectionMessage(S).then(v=>{this.onEvent(new p.ConnectionMessageReceivedEvent(this.privConnectionId,g,v)),f.resolve(v)},v=>{f.reject(`Invalid text message format. Error: ${v}`)})}}},this.privConnectionEstablishDeferral.promise}send(d){if(this.privConnectionState!==p.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${p.ConnectionState[this.privConnectionState]} state`);const g=new p.Deferred,f=new p.Deferred;return this.privSendMessageQueue.enqueueFromPromise(f.promise),this.privMessageFormatter.fromConnectionMessage(d).then(S=>{f.resolve({Message:d,RawWebsocketMessage:S,sendStatusDeferral:g})},S=>{f.reject(`Error formatting the message. ${S}`)}),g.promise}read(){return this.privConnectionState!==p.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(d){if(this.privWebsocketClient)this.privConnectionState!==p.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,d||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(d){try{if(!d)return Promise.resolve();if(this.onEvent(new p.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),d.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(d.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+d.Message.id+" "+new Error().stack);return Promise.resolve()}catch(g){return Promise.reject(`websocket send error: ${g}`)}}async onClose(d,g){const f=`Connection closed. ${d}: ${g}`;this.privConnectionState=p.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},f),await this.privSendMessageQueue.drainAndDispose(S=>{S.sendStatusDeferral.reject(f)},f)}async processSendQueue(){for(;;){const g=await this.privSendMessageQueue.dequeue();if(!g)return;try{await this.sendRawMessage(g),g.sendStatusDeferral.resolve()}catch(f){g.sendStatusDeferral.reject(f)}}}onEvent(d){this.privConnectionEvents.onEvent(d),p.Events.instance.onEvent(d)}getAgent(){const d=new n.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(d.proxyInfo=this.proxyInfo),d}static GetProxyAgent(d){const g={host:d.HostName,port:d.Port};return d.UserName?g.headers={"Proxy-Authentication":"Basic "+Buffer.from(`${d.UserName}:${d.Password===void 0?"":d.Password}`).toString("base64")}:g.headers={},g.headers.requestOCSP="true",new r.default(g)}createConnection(d,g){let f;if(g={...g,requestOCSP:!0,servername:g.host},this.proxyInfo){const v=Cs.GetProxyAgent(this.proxyInfo);f=new Promise((m,C)=>{v.callback(d,g,(y,R)=>{y?C(y):m(R)})})}else g.secureEndpoint?f=Promise.resolve(a.connect(g)):f=Promise.resolve(s.connect(g));return f}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}};return F.WebsocketMessageAdapter=h,h.forceNpmWebSocket=!1,F}var Qo;function Jl(){if(Qo)return lt;Qo=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.WebsocketConnection=void 0;const e=T(),t=ih();let i=class{constructor(s,a,n,r,o,c=!1,p){if(this.privIsDisposed=!1,!s)throw new e.ArgumentNullError("uri");if(!r)throw new e.ArgumentNullError("messageFormatter");this.privMessageFormatter=r;let h="",l=0;if(a){for(const d in a)if(d){h+=l===0&&s.indexOf("?")===-1?"?":"&";const g=encodeURIComponent(d);h+=g;let f=a[d];f&&(f=encodeURIComponent(f),h+=`=${f}`),l++}}if(n){for(const d in n)if(d){h+=l===0&&s.indexOf("?")===-1?"?":"&";const g=encodeURIComponent(n[d]);h+=`${d}=${g}`,l++}}this.privUri=s+h,this.privId=p||(0,e.createNoDashGuid)(),this.privConnectionMessageAdapter=new t.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,o,n,c)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(s){return this.privConnectionMessageAdapter.send(s)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}};return lt.WebsocketConnection=i,lt}var vt={},Xo;function Gl(){if(Xo)return vt;Xo=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.ReplayableAudioNode=void 0;let e=class{constructor(u,s){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=u,this.privBytesPerSecond=s}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){const u=this.privReplayOffset-this.privBufferStartOffset;let s=Math.round(u*this.privBytesPerSecond*1e-7);s%2!==0&&s++;let a=0;for(;a<this.privBuffers.length&&s>=this.privBuffers[a].chunk.buffer.byteLength;)s-=this.privBuffers[a++].chunk.buffer.byteLength;if(a<this.privBuffers.length){const n=this.privBuffers[a].chunk.buffer.slice(s);return this.privReplayOffset+=n.byteLength/this.privBytesPerSecond*1e7,a===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:n,isEnd:!1,timeReceived:this.privBuffers[a].chunk.timeReceived})}}return this.privAudioNode.read().then(u=>(u&&u.buffer&&this.privBuffers&&(this.privBuffers.push(new t(u,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=u.buffer.byteLength),u))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(u){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=u;const s=u-this.privBufferStartOffset;let a=Math.round(s*this.privBytesPerSecond*1e-7),n=0;for(;n<this.privBuffers.length&&a>=this.privBuffers[n].chunk.buffer.byteLength;)a-=this.privBuffers[n++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(u-a/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(n)}findTimeAtOffset(u){if(u<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(const s of this.privBuffers){const a=s.byteOffset/this.privBytesPerSecond*1e7,n=a+s.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(u>=a&&u<=n)return s.chunk.timeReceived}return 0}};vt.ReplayableAudioNode=e;class t{constructor(u,s,a){this.chunk=u,this.serial=s,this.byteOffset=a}}return vt}var ft={},Pn={},X={},K={},Zo;function nh(){if(Zo)return K;Zo=1;var e=K&&K.__createBinding||(Object.create?(function(n,r,o,c){c===void 0&&(c=o),Object.defineProperty(n,c,{enumerable:!0,get:function(){return r[o]}})}):(function(n,r,o,c){c===void 0&&(c=o),n[c]=r[o]})),t=K&&K.__setModuleDefault||(Object.create?(function(n,r){Object.defineProperty(n,"default",{enumerable:!0,value:r})}):function(n,r){n.default=r}),i=K&&K.__importStar||function(n){if(n&&n.__esModule)return n;var r={};if(n!=null)for(var o in n)o!=="default"&&Object.prototype.hasOwnProperty.call(n,o)&&e(r,n,o);return t(r,n),r};Object.defineProperty(K,"__esModule",{value:!0}),K.AudioFileWriter=void 0;const u=i(_e),s=_();let a=class{constructor(r){s.Contracts.throwIfNullOrUndefined(u.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=u.openSync(r,"w")}set format(r){s.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=r;let o=0;this.privAudioFormat.hasHeader&&(o=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=u.createWriteStream("",{fd:this.privFd,start:o,autoClose:!1}))}write(r){s.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(r.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),u.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),u.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}};return K.AudioFileWriter=a,K}var x={},Yo;function sh(){if(Yo)return x;Yo=1,Object.defineProperty(x,"__esModule",{value:!0}),x.PullAudioInputStreamImpl=x.PullAudioInputStream=x.PushAudioInputStreamImpl=x.PushAudioInputStream=x.AudioInputStream=void 0;const e=A(),t=T(),i=be(),u=P(),s=Me();let a=class{constructor(){}static createPushStream(h){return n.create(h)}static createPullStream(h,l){return o.create(h,l)}};x.AudioInputStream=a;class n extends a{static create(h){return new r(h)}}x.PushAudioInputStream=n;class r extends n{constructor(h){super(),h===void 0?this.privFormat=s.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=h,this.privEvents=new t.EventSource,this.privId=(0,i.createNoDashGuid)(),this.privStream=new t.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(h){this.privStream.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}async attach(h){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn();const l=this.privStream;return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:async()=>(this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>l.read()}}detach(h){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(h){this.privEvents.onEvent(h),t.Events.instance.onEvent(h)}toBuffer(h){const l=Buffer.alloc(h.byteLength),d=new Uint8Array(h);for(let g=0;g<l.length;++g)l[g]=d[g];return l}}x.PushAudioInputStreamImpl=r;class o extends a{constructor(){super()}static create(h,l){return new c(h,l)}}x.PullAudioInputStream=o;class c extends o{constructor(h,l){super(),l===void 0?this.privFormat=u.AudioStreamFormat.getDefaultInputFormat():this.privFormat=l,this.privEvents=new t.EventSource,this.privId=(0,i.createNoDashGuid)(),this.privCallback=h,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}async attach(h){return this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn(),this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:()=>(this.privCallback.close(),this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>{let l=0,d;for(;l<this.privBufferSize;){const g=new ArrayBuffer(this.privBufferSize-l),f=this.privCallback.read(g);if(d===void 0?d=g:new Int8Array(d).set(new Int8Array(g),l),f===0)break;l+=f}return Promise.resolve({buffer:d.slice(0,l),isEnd:this.privIsClosed||l===0,timeReceived:Date.now()})}}}detach(h){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(h){this.privEvents.onEvent(h),t.Events.instance.onEvent(h)}}return x.PullAudioInputStreamImpl=c,x}var U={},gt={},En={},ea;function oh(){return ea||(ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechSynthesisOutputFormat=void 0,(function(t){t[t.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",t[t.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",t[t.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",t[t.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",t[t.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",t[t.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",t[t.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",t[t.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",t[t.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",t[t.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",t[t.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",t[t.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",t[t.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",t[t.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",t[t.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",t[t.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",t[t.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",t[t.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",t[t.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",t[t.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",t[t.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",t[t.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",t[t.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",t[t.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",t[t.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",t[t.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",t[t.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",t[t.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",t[t.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",t[t.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",t[t.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",t[t.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",t[t.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",t[t.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",t[t.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",t[t.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",t[t.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm",t[t.AmrWb16000Hz=37]="AmrWb16000Hz",t[t.G72216Khz64Kbps=38]="G72216Khz64Kbps"})(e.SpeechSynthesisOutputFormat||(e.SpeechSynthesisOutputFormat={}))})(En)),En}var ta;function Vi(){if(ta)return gt;ta=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.AudioOutputFormatImpl=void 0;const e=oh(),t=Me();class i extends t.AudioStreamFormatImpl{constructor(s,a,n,r,o,c,p,h,l){super(n,c,a,s),this.formatTag=s,this.avgBytesPerSec=r,this.blockAlign=o,this.priAudioFormatString=p,this.priRequestAudioFormatString=h,this.priHasHeader=l}static fromSpeechSynthesisOutputFormat(s){return s===void 0?i.getDefaultOutputFormat():i.fromSpeechSynthesisOutputFormatString(i.SpeechSynthesisOutputFormatToString[s])}static fromSpeechSynthesisOutputFormatString(s){switch(s){case"raw-8khz-8bit-mono-mulaw":return new i(t.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,s,s,!1);case"riff-16khz-16kbps-mono-siren":return new i(t.AudioFormatTag.Siren,1,16e3,2e3,40,0,s,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new i(t.AudioFormatTag.Siren,1,16e3,2e3,40,0,s,s,!1);case"audio-16khz-32kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,4096,2,16,s,s,!1);case"audio-16khz-128kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,16384,2,16,s,s,!1);case"audio-16khz-64kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,8192,2,16,s,s,!1);case"audio-24khz-48kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,6144,2,16,s,s,!1);case"audio-24khz-96kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,12288,2,16,s,s,!1);case"audio-24khz-160kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,20480,2,16,s,s,!1);case"raw-16khz-16bit-mono-truesilk":return new i(t.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,s,s,!1);case"riff-8khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,8e3,16e3,2,16,s,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,24e3,48e3,2,16,s,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new i(t.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,s,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,16e3,32e3,2,16,s,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,24e3,48e3,2,16,s,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,8e3,16e3,2,16,s,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,s,s,!1);case"ogg-24khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,s,s,!1);case"raw-48khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,48e3,96e3,2,16,s,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,48e3,96e3,2,16,s,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,48e3,12288,2,16,s,s,!1);case"audio-48khz-192kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,48e3,24576,2,16,s,s,!1);case"ogg-48khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,s,s,!1);case"webm-16khz-16bit-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,s,s,!1);case"webm-24khz-16bit-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,s,s,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,s,s,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,16e3,4e3,2,16,s,s,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,24e3,6e3,2,16,s,s,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,24e3,3e3,2,16,s,s,!1);case"audio-24khz-16bit-mono-flac":return new i(t.AudioFormatTag.FLAC,1,24e3,24e3,2,16,s,s,!1);case"audio-48khz-16bit-mono-flac":return new i(t.AudioFormatTag.FLAC,1,48e3,3e4,2,16,s,s,!1);case"raw-24khz-16bit-mono-truesilk":return new i(t.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,s,s,!1);case"raw-8khz-8bit-mono-alaw":return new i(t.AudioFormatTag.ALaw,1,8e3,8e3,1,8,s,s,!1);case"riff-8khz-8bit-mono-alaw":return new i(t.AudioFormatTag.ALaw,1,8e3,8e3,1,8,s,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,22050,44100,2,16,s,s,!1);case"riff-22050hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,22050,44100,2,16,s,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,44100,88200,2,16,s,s,!1);case"riff-44100hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,44100,88200,2,16,s,"raw-44100hz-16bit-mono-pcm",!0);case"amr-wb-16000h":return new i(t.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,s,s,!1);case"g722-16khz-64kbps":return new i(t.AudioFormatTag.G722,1,16e3,8e3,2,16,s,s,!1);case"riff-16khz-16bit-mono-pcm":default:return new i(t.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return i.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(s){if(this.priHasHeader){const a=new DataView(this.privHeader);a.setUint32(4,s+this.privHeader.byteLength-8,!0),a.setUint32(40,s,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(s){if(!this.hasHeader)return s;this.updateHeader(s.byteLength);const a=new Uint8Array(s.byteLength+this.header.byteLength);return a.set(new Uint8Array(this.header),0),a.set(new Uint8Array(s),this.header.byteLength),a.buffer}}return gt.AudioOutputFormatImpl=i,i.SpeechSynthesisOutputFormatToString={[e.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[e.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[e.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[e.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[e.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[e.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[e.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[e.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[e.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.AmrWb16000Hz]:"amr-wb-16000hz",[e.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:"g722-16khz-64kbps"},gt}var ra;function ke(){if(ra)return U;ra=1,Object.defineProperty(U,"__esModule",{value:!0}),U.PushAudioOutputStreamImpl=U.PushAudioOutputStream=U.PullAudioOutputStreamImpl=U.PullAudioOutputStream=U.AudioOutputStream=void 0;const e=T(),t=_(),i=Vi();let u=class{constructor(){}static createPullStream(){return s.create()}};U.AudioOutputStream=u;class s extends u{static create(){return new a}}U.PullAudioOutputStream=s;class a extends s{constructor(){super(),this.privId=(0,e.createNoDashGuid)(),this.privStream=new e.Stream}set format(c){c==null&&(this.privFormat=i.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=c}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(c){const p=new Int8Array(c);let h=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>c.byteLength)return p.set(this.privLastChunkView.slice(0,c.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(c.byteLength),Promise.resolve(c.byteLength);p.set(this.privLastChunkView),h=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;h<c.byteLength&&!this.privStream.isReadEnded;){const l=await this.privStream.read();if(l!==void 0&&!l.isEnd){let d;l.buffer.byteLength>c.byteLength-h?(d=l.buffer.slice(0,c.byteLength-h),this.privLastChunkView=new Int8Array(l.buffer.slice(c.byteLength-h))):d=l.buffer,p.set(new Int8Array(d),h),h+=d.byteLength}else this.privStream.readEnded()}return h}write(c){t.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:c,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}U.PullAudioOutputStreamImpl=a;class n extends u{constructor(){super()}static create(c){return new r(c)}}U.PushAudioOutputStream=n;class r extends n{constructor(c){super(),this.privId=(0,e.createNoDashGuid)(),this.privCallback=c}set format(c){}write(c){this.privCallback.write&&this.privCallback.write(c)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}return U.PushAudioOutputStreamImpl=r,U}var ia;function ch(){if(ia)return X;ia=1,Object.defineProperty(X,"__esModule",{value:!0}),X.AudioOutputConfigImpl=X.AudioConfigImpl=X.AudioConfig=void 0;const e=N(),t=_(),i=P(),u=nh(),s=sh(),a=ke();let n=class ah{static fromDefaultMicrophoneInput(){const p=new e.PcmRecorder(!0);return new r(new e.MicAudioSource(p))}static fromMicrophoneInput(p){const h=new e.PcmRecorder(!0);return new r(new e.MicAudioSource(h,p))}static fromWavFileInput(p,h="unnamedBuffer.wav"){return new r(new e.FileAudioSource(p,h))}static fromStreamInput(p){if(p instanceof i.PullAudioInputStreamCallback)return new r(new s.PullAudioInputStreamImpl(p));if(p instanceof i.AudioInputStream)return new r(p);if(typeof MediaStream<"u"&&p instanceof MediaStream){const h=new e.PcmRecorder(!1);return new r(new e.MicAudioSource(h,null,null,p))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new o(new i.SpeakerAudioDestination)}static fromSpeakerOutput(p){if(p===void 0)return ah.fromDefaultSpeakerOutput();if(p instanceof i.SpeakerAudioDestination)return new o(p);throw new Error("Not Supported Type")}static fromAudioFileOutput(p){return new o(new u.AudioFileWriter(p))}static fromStreamOutput(p){if(p instanceof i.PushAudioOutputStreamCallback)return new o(new a.PushAudioOutputStreamImpl(p));if(p instanceof i.PushAudioOutputStream)return new o(p);if(p instanceof i.PullAudioOutputStream)return new o(p);throw new Error("Not Supported Type")}};X.AudioConfig=n;class r extends n{constructor(p){super(),this.privSource=p}get format(){return this.privSource.format}close(p,h){this.privSource.turnOff().then(()=>{p&&p()},l=>{h&&h(l)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(p){return this.privSource.attach(p)}detach(p){return this.privSource.detach(p)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(p,h){if(t.Contracts.throwIfNull(h,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(p,h);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(p,h){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(p,h);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}X.AudioConfigImpl=r;class o extends n{constructor(p){super(),this.privDestination=p}set format(p){this.privDestination.format=p}write(p){this.privDestination.write(p)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}return X.AudioOutputConfigImpl=o,X}var In={},na;function Ql(){return na||(na=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CancellationReason=void 0,(function(t){t[t.Error=0]="Error",t[t.EndOfStream=1]="EndOfStream"})(e.CancellationReason||(e.CancellationReason={}))})(In)),In}var St={},sa;function Xl(){if(sa)return St;sa=1,Object.defineProperty(St,"__esModule",{value:!0}),St.PullAudioInputStreamCallback=void 0;let e=class{};return St.PullAudioInputStreamCallback=e,St}var mt={},oa;function Zl(){if(oa)return mt;oa=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.PushAudioOutputStreamCallback=void 0;let e=class{};return mt.PushAudioOutputStreamCallback=e,mt}var Ct={},aa;function Yl(){if(aa)return Ct;aa=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.KeywordRecognitionModel=void 0;const e=_();let t=class{constructor(){this.privDisposed=!1}static fromFile(u){throw e.Contracts.throwIfFileDoesNotExist(u,"fileName"),new Error("Not yet implemented.")}static fromStream(u){throw e.Contracts.throwIfNull(u,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}};return Ct.KeywordRecognitionModel=t,Ct}var yt={},ca;function ev(){if(ca)return yt;ca=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.SessionEventArgs=void 0;let e=class{constructor(i){this.privSessionId=i}get sessionId(){return this.privSessionId}};return yt.SessionEventArgs=e,yt}var Rt={},ua;function tv(){if(ua)return Rt;ua=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.RecognitionEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,s){super(s),this.privOffset=u}get offset(){return this.privOffset}};return Rt.RecognitionEventArgs=t,Rt}var An={},pa;function rv(){return pa||(pa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OutputFormat=void 0,(function(t){t[t.Simple=0]="Simple",t[t.Detailed=1]="Detailed"})(e.OutputFormat||(e.OutputFormat={}))})(An)),An}var Pt={},ha;function iv(){if(ha)return Pt;ha=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.IntentRecognitionEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,s,a){super(s,a),this.privResult=u}get result(){return this.privResult}};return Pt.IntentRecognitionEventArgs=t,Pt}var Et={},da;function nv(){if(da)return Et;da=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.RecognitionResult=void 0;let e=class{constructor(i,u,s,a,n,r,o,c,p,h){this.privResultId=i,this.privReason=u,this.privText=s,this.privDuration=a,this.privOffset=n,this.privLanguage=r,this.privLanguageDetectionConfidence=o,this.privErrorDetails=c,this.privJson=p,this.privProperties=h}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}};return Et.RecognitionResult=e,Et}var It={},la;function sv(){if(la)return It;la=1,Object.defineProperty(It,"__esModule",{value:!0}),It.SpeechRecognitionResult=void 0;const e=P();let t=class extends e.RecognitionResult{constructor(u,s,a,n,r,o,c,p,h,l,d){super(u,s,a,n,r,o,c,h,l,d),this.privSpeakerId=p}get speakerId(){return this.privSpeakerId}};return It.SpeechRecognitionResult=t,It}var At={},va;function ov(){if(va)return At;va=1,Object.defineProperty(At,"__esModule",{value:!0}),At.IntentRecognitionResult=void 0;const e=P();let t=class extends e.SpeechRecognitionResult{constructor(u,s,a,n,r,o,c,p,h,l,d){super(s,a,n,r,o,c,p,void 0,h,l,d),this.privIntentId=u}get intentId(){return this.privIntentId}};return At.IntentRecognitionResult=t,At}var he={},fa;function av(){if(fa)return he;fa=1,Object.defineProperty(he,"__esModule",{value:!0}),he.LanguageUnderstandingModelImpl=he.LanguageUnderstandingModel=void 0;const e=_();let t=class{constructor(){}static fromEndpoint(s){e.Contracts.throwIfNull(s,"uri"),e.Contracts.throwIfNullOrWhitespace(s.hostname,"uri");const a=new i,n=s.host.indexOf(".");if(n===-1)throw new Error("Could not determine region from endpoint");a.region=s.host.substr(0,n);const r=s.pathname.lastIndexOf("/")+1;if(r===-1)throw new Error("Could not determine appId from endpoint");if(a.appId=s.pathname.substr(r),a.subscriptionKey=s.searchParams.get("subscription-key"),a.subscriptionKey===void 0)throw new Error("Could not determine subscription key from endpoint");return a}static fromAppId(s){e.Contracts.throwIfNullOrWhitespace(s,"appId");const a=new i;return a.appId=s,a}static fromSubscription(s,a,n){e.Contracts.throwIfNullOrWhitespace(s,"subscriptionKey"),e.Contracts.throwIfNullOrWhitespace(a,"appId"),e.Contracts.throwIfNullOrWhitespace(n,"region");const r=new i;return r.appId=a,r.region=n,r.subscriptionKey=s,r}};he.LanguageUnderstandingModel=t;class i extends t{}return he.LanguageUnderstandingModelImpl=i,he}var Z={},ga;function cv(){if(ga)return Z;ga=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.MeetingTranscriptionEventArgs=Z.ConversationTranscriptionEventArgs=Z.SpeechRecognitionEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(a,n,r){super(n,r),this.privResult=a}get result(){return this.privResult}};Z.SpeechRecognitionEventArgs=t;class i extends e.RecognitionEventArgs{constructor(a,n,r){super(n,r),this.privResult=a}get result(){return this.privResult}}Z.ConversationTranscriptionEventArgs=i;class u extends t{}return Z.MeetingTranscriptionEventArgs=u,Z}var Tt={},wt={},Sa;function Hi(){if(Sa)return wt;Sa=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.CancellationEventArgsBase=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,s,a,n,r){super(n,r),this.privReason=u,this.privErrorDetails=s,this.privErrorCode=a}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return wt.CancellationEventArgsBase=t,wt}var ma;function uv(){if(ma)return Tt;ma=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.SpeechRecognitionCanceledEventArgs=void 0;const e=Hi();let t=class extends e.CancellationEventArgsBase{};return Tt.SpeechRecognitionCanceledEventArgs=t,Tt}var _t={},Ca;function pv(){if(Ca)return _t;Ca=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.TranslationRecognitionEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,s,a){super(s,a),this.privResult=u}get result(){return this.privResult}};return _t.TranslationRecognitionEventArgs=t,_t}var bt={},ya;function hv(){if(ya)return bt;ya=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.TranslationSynthesisEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,s){super(s),this.privResult=u}get result(){return this.privResult}};return bt.TranslationSynthesisEventArgs=t,bt}var Mt={},Ra;function ph(){if(Ra)return Mt;Ra=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.TranslationRecognitionResult=void 0;const e=P();let t=class uh extends e.SpeechRecognitionResult{constructor(u,s,a,n,r,o,c,p,h,l,d){super(s,a,n,r,o,c,p,void 0,h,l,d),this.privTranslations=u}static fromSpeechRecognitionResult(u){return new uh(void 0,u.resultId,u.reason,u.text,u.duration,u.offset,u.language,u.languageDetectionConfidence,u.errorDetails,u.json,u.properties)}get translations(){return this.privTranslations}};return Mt.TranslationRecognitionResult=t,Mt}var Ot={},Pa;function dv(){if(Pa)return Ot;Pa=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.TranslationSynthesisResult=void 0;let e=class{constructor(i,u){this.privReason=i,this.privAudio=u}get audio(){return this.privAudio}get reason(){return this.privReason}};return Ot.TranslationSynthesisResult=e,Ot}var Tn={},Ea;function lv(){return Ea||(Ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ResultReason=void 0,(function(t){t[t.NoMatch=0]="NoMatch",t[t.Canceled=1]="Canceled",t[t.RecognizingSpeech=2]="RecognizingSpeech",t[t.RecognizedSpeech=3]="RecognizedSpeech",t[t.RecognizedKeyword=4]="RecognizedKeyword",t[t.RecognizingIntent=5]="RecognizingIntent",t[t.RecognizedIntent=6]="RecognizedIntent",t[t.TranslatingSpeech=7]="TranslatingSpeech",t[t.TranslatedSpeech=8]="TranslatedSpeech",t[t.SynthesizingAudio=9]="SynthesizingAudio",t[t.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",t[t.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",t[t.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",t[t.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",t[t.RecognizedSpeakers=14]="RecognizedSpeakers",t[t.RecognizedSpeaker=15]="RecognizedSpeaker",t[t.ResetVoiceProfile=16]="ResetVoiceProfile",t[t.DeletedVoiceProfile=17]="DeletedVoiceProfile",t[t.VoicesListRetrieved=18]="VoicesListRetrieved",t[t.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",t[t.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",t[t.TranslatedInstantMessage=21]="TranslatedInstantMessage",t[t.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"})(e.ResultReason||(e.ResultReason={}))})(Tn)),Tn}var de={},Ia;function vv(){if(Ia)return de;Ia=1,Object.defineProperty(de,"__esModule",{value:!0}),de.SpeechConfigImpl=de.SpeechConfig=void 0;const e=A(),t=_(),i=P();let u=class{constructor(){}static fromSubscription(n,r){t.Contracts.throwIfNullOrWhitespace(n,"subscriptionKey"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new s;return o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o.setProperty(i.PropertyId.SpeechServiceConnection_IntentRegion,r),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,n),o}static fromEndpoint(n,r){t.Contracts.throwIfNull(n,"endpoint");const o=typeof r=="string"&&r.trim().length>0,c=typeof r=="object"&&r!==null&&typeof r.getToken=="function",p=typeof r=="object"&&r!==null&&typeof r.key=="string";if(r!==void 0&&!o&&!c&&!p)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let h;return typeof r=="string"?(h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r)):typeof r=="object"&&typeof r.getToken=="function"?h=new s(r):typeof r=="object"&&typeof r.key=="string"?(h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r.key)):h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,n.href),h}static fromHost(n,r){t.Contracts.throwIfNull(n,"hostName");const o=new s;return o.setProperty(i.PropertyId.SpeechServiceConnection_Host,n.protocol+"//"+n.hostname+(n.port===""?"":":"+n.port)),o.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),r!==void 0&&o.setProperty(i.PropertyId.SpeechServiceConnection_Key,r),o}static fromAuthorizationToken(n,r){t.Contracts.throwIfNull(n,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new s;return o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o.setProperty(i.PropertyId.SpeechServiceConnection_IntentRegion,r),o.authorizationToken=n,o}close(){}};de.SpeechConfig=u;class s extends u{constructor(n){super(),this.privProperties=new i.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=i.OutputFormat.Simple,this.privTokenCredential=n}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,n)}get speechRecognitionLanguage(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,n)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,n)}get outputFormat(){return i.OutputFormat[this.privProperties.getProperty(e.OutputFormatPropertyName,void 0)]}set outputFormat(n){this.privProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[n])}get endpointId(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_EndpointId,n)}get tokenCredential(){return this.privTokenCredential}setProperty(n,r){t.Contracts.throwIfNull(r,"value"),this.privProperties.setProperty(n,r)}getProperty(n,r){return this.privProperties.getProperty(n,r)}setProxy(n,r,o,c){this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyHostName],n),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPort],r),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyUserName],o),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPassword],c)}setServiceProperty(n,r){const o=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));o[n]=r,this.privProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(o))}setProfanity(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceResponse_ProfanityOption,i.ProfanityOption[n])}enableAudioLogging(){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true"),this.privProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Detailed])}enableDictation(){this.privProperties.setProperty(e.ForceDictationPropertyName,"true")}clone(){const n=new s(this.tokenCredential);return n.privProperties=this.privProperties.clone(),n}get speechSynthesisLanguage(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,n)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,n)}get speechSynthesisOutputFormat(){return i.SpeechSynthesisOutputFormat[this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(n){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,i.SpeechSynthesisOutputFormat[n])}}return de.SpeechConfigImpl=s,de}var le={},Aa;function fv(){if(Aa)return le;Aa=1,Object.defineProperty(le,"__esModule",{value:!0}),le.SpeechTranslationConfigImpl=le.SpeechTranslationConfig=void 0;const e=A(),t=_(),i=P();let u=class extends i.SpeechConfig{constructor(){super()}static fromSubscription(n,r){t.Contracts.throwIfNullOrWhitespace(n,"subscriptionKey"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new s;return o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Key,n),o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromAuthorizationToken(n,r){t.Contracts.throwIfNullOrWhitespace(n,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new s;return o.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,n),o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromHost(n,r){t.Contracts.throwIfNull(n,"hostName");const o=new s;return o.setProperty(i.PropertyId.SpeechServiceConnection_Host,n.protocol+"//"+n.hostname+(n.port===""?"":":"+n.port)),r!==void 0&&o.setProperty(i.PropertyId.SpeechServiceConnection_Key,r),o}static fromEndpoint(n,r){t.Contracts.throwIfNull(n,"endpoint");const o=typeof r=="string"&&r.trim().length>0,c=typeof r=="object"&&r!==null&&typeof r.getToken=="function",p=typeof r=="object"&&r!==null&&typeof r.key=="string";if(r!==void 0&&!o&&!c&&!p)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let h;return typeof r=="string"?(h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r)):typeof r=="object"&&typeof r.getToken=="function"?h=new s(r):typeof r=="object"&&typeof r.key=="string"?(h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r.key)):h=new s,h.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,n.href),h}};le.SpeechTranslationConfig=u;class s extends u{constructor(n){super(),this.privSpeechProperties=new i.PropertyCollection,this.outputFormat=i.OutputFormat.Simple,this.privTokenCredential=n}set authorizationToken(n){t.Contracts.throwIfNullOrWhitespace(n,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,n)}set speechRecognitionLanguage(n){t.Contracts.throwIfNullOrWhitespace(n,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,n)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return i.OutputFormat[this.privSpeechProperties.getProperty(e.OutputFormatPropertyName,void 0)]}set outputFormat(n){this.privSpeechProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[n])}get endpointId(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(n){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_EndpointId,n)}addTargetLanguage(n){t.Contracts.throwIfNullOrWhitespace(n,"value");const r=this.targetLanguages;r.includes(n)||(r.push(n),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,r.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(n){t.Contracts.throwIfNullOrWhitespace(n,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,n)}get region(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_Region)}get tokenCredential(){return this.privTokenCredential}setProxy(n,r,o,c){this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyHostName],n),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPort],r),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyUserName],o),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPassword],c)}getProperty(n,r){return this.privSpeechProperties.getProperty(n,r)}setProperty(n,r){this.privSpeechProperties.setProperty(n,r)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(n,r){const o=JSON.parse(this.privSpeechProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));o[n]=r,this.privSpeechProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(o))}setProfanity(n){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceResponse_ProfanityOption,i.ProfanityOption[n])}enableAudioLogging(){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(e.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(n){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,n)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(n){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,n)}get speechSynthesisOutputFormat(){return i.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(n){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,i.SpeechSynthesisOutputFormat[n])}}return le.SpeechTranslationConfigImpl=s,le}var Dt={},Ta;function dh(){if(Ta)return Dt;Ta=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.PropertyCollection=void 0;const e=P();let t=class hh{constructor(){this.privKeys=[],this.privValues=[]}getProperty(u,s){let a;typeof u=="string"?a=u:a=e.PropertyId[u];for(let n=0;n<this.privKeys.length;n++)if(this.privKeys[n]===a)return this.privValues[n];if(s!==void 0)return String(s)}setProperty(u,s){let a;typeof u=="string"?a=u:a=e.PropertyId[u];for(let n=0;n<this.privKeys.length;n++)if(this.privKeys[n]===a){this.privValues[n]=s;return}this.privKeys.push(a),this.privValues.push(s)}clone(){const u=new hh;for(let s=0;s<this.privKeys.length;s++)u.privKeys.push(this.privKeys[s]),u.privValues.push(this.privValues[s]);return u}mergeTo(u){this.privKeys.forEach(s=>{if(u.getProperty(s,void 0)===void 0){const a=this.getProperty(s);u.setProperty(s,a)}})}get keys(){return this.privKeys}};return Dt.PropertyCollection=t,Dt}var wn={},wa;function _s(){return wa||(wa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PropertyId=void 0,(function(t){t[t.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",t[t.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",t[t.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",t[t.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",t[t.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",t[t.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",t[t.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",t[t.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",t[t.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",t[t.SpeechServiceConnection_TranslationCategoryId=9]="SpeechServiceConnection_TranslationCategoryId",t[t.SpeechServiceConnection_IntentRegion=10]="SpeechServiceConnection_IntentRegion",t[t.SpeechServiceConnection_ProxyHostName=11]="SpeechServiceConnection_ProxyHostName",t[t.SpeechServiceConnection_ProxyPort=12]="SpeechServiceConnection_ProxyPort",t[t.SpeechServiceConnection_ProxyUserName=13]="SpeechServiceConnection_ProxyUserName",t[t.SpeechServiceConnection_ProxyPassword=14]="SpeechServiceConnection_ProxyPassword",t[t.SpeechServiceConnection_RecoMode=15]="SpeechServiceConnection_RecoMode",t[t.SpeechServiceConnection_RecoLanguage=16]="SpeechServiceConnection_RecoLanguage",t[t.Speech_SessionId=17]="Speech_SessionId",t[t.SpeechServiceConnection_SynthLanguage=18]="SpeechServiceConnection_SynthLanguage",t[t.SpeechServiceConnection_SynthVoice=19]="SpeechServiceConnection_SynthVoice",t[t.SpeechServiceConnection_SynthOutputFormat=20]="SpeechServiceConnection_SynthOutputFormat",t[t.SpeechServiceConnection_AutoDetectSourceLanguages=21]="SpeechServiceConnection_AutoDetectSourceLanguages",t[t.SpeechServiceResponse_RequestDetailedResultTrueFalse=22]="SpeechServiceResponse_RequestDetailedResultTrueFalse",t[t.SpeechServiceResponse_RequestProfanityFilterTrueFalse=23]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",t[t.SpeechServiceResponse_JsonResult=24]="SpeechServiceResponse_JsonResult",t[t.SpeechServiceResponse_JsonErrorDetails=25]="SpeechServiceResponse_JsonErrorDetails",t[t.CancellationDetails_Reason=26]="CancellationDetails_Reason",t[t.CancellationDetails_ReasonText=27]="CancellationDetails_ReasonText",t[t.CancellationDetails_ReasonDetailedText=28]="CancellationDetails_ReasonDetailedText",t[t.LanguageUnderstandingServiceResponse_JsonResult=29]="LanguageUnderstandingServiceResponse_JsonResult",t[t.SpeechServiceConnection_Url=30]="SpeechServiceConnection_Url",t[t.SpeechServiceConnection_InitialSilenceTimeoutMs=31]="SpeechServiceConnection_InitialSilenceTimeoutMs",t[t.SpeechServiceConnection_EndSilenceTimeoutMs=32]="SpeechServiceConnection_EndSilenceTimeoutMs",t[t.Speech_SegmentationSilenceTimeoutMs=33]="Speech_SegmentationSilenceTimeoutMs",t[t.Speech_SegmentationMaximumTimeMs=34]="Speech_SegmentationMaximumTimeMs",t[t.Speech_SegmentationStrategy=35]="Speech_SegmentationStrategy",t[t.Speech_StartEventSensitivity=36]="Speech_StartEventSensitivity",t[t.SpeechServiceConnection_EnableAudioLogging=37]="SpeechServiceConnection_EnableAudioLogging",t[t.SpeechServiceConnection_LanguageIdMode=38]="SpeechServiceConnection_LanguageIdMode",t[t.SpeechServiceConnection_RecognitionEndpointVersion=39]="SpeechServiceConnection_RecognitionEndpointVersion",t[t.SpeechServiceConnection_SpeakerIdMode=40]="SpeechServiceConnection_SpeakerIdMode",t[t.SpeechServiceResponse_ProfanityOption=41]="SpeechServiceResponse_ProfanityOption",t[t.SpeechServiceResponse_PostProcessingOption=42]="SpeechServiceResponse_PostProcessingOption",t[t.SpeechServiceResponse_RequestWordLevelTimestamps=43]="SpeechServiceResponse_RequestWordLevelTimestamps",t[t.SpeechServiceResponse_StablePartialResultThreshold=44]="SpeechServiceResponse_StablePartialResultThreshold",t[t.SpeechServiceResponse_OutputFormatOption=45]="SpeechServiceResponse_OutputFormatOption",t[t.SpeechServiceResponse_TranslationRequestStablePartialResult=46]="SpeechServiceResponse_TranslationRequestStablePartialResult",t[t.SpeechServiceResponse_RequestWordBoundary=47]="SpeechServiceResponse_RequestWordBoundary",t[t.SpeechServiceResponse_RequestPunctuationBoundary=48]="SpeechServiceResponse_RequestPunctuationBoundary",t[t.SpeechServiceResponse_RequestSentenceBoundary=49]="SpeechServiceResponse_RequestSentenceBoundary",t[t.SpeechServiceResponse_DiarizeIntermediateResults=50]="SpeechServiceResponse_DiarizeIntermediateResults",t[t.Conversation_ApplicationId=51]="Conversation_ApplicationId",t[t.Conversation_DialogType=52]="Conversation_DialogType",t[t.Conversation_Initial_Silence_Timeout=53]="Conversation_Initial_Silence_Timeout",t[t.Conversation_From_Id=54]="Conversation_From_Id",t[t.Conversation_Conversation_Id=55]="Conversation_Conversation_Id",t[t.Conversation_Custom_Voice_Deployment_Ids=56]="Conversation_Custom_Voice_Deployment_Ids",t[t.Conversation_Speech_Activity_Template=57]="Conversation_Speech_Activity_Template",t[t.Conversation_Request_Bot_Status_Messages=58]="Conversation_Request_Bot_Status_Messages",t[t.Conversation_Agent_Connection_Id=59]="Conversation_Agent_Connection_Id",t[t.SpeechServiceConnection_Host=60]="SpeechServiceConnection_Host",t[t.ConversationTranslator_Host=61]="ConversationTranslator_Host",t[t.ConversationTranslator_Name=62]="ConversationTranslator_Name",t[t.ConversationTranslator_CorrelationId=63]="ConversationTranslator_CorrelationId",t[t.ConversationTranslator_Token=64]="ConversationTranslator_Token",t[t.PronunciationAssessment_ReferenceText=65]="PronunciationAssessment_ReferenceText",t[t.PronunciationAssessment_GradingSystem=66]="PronunciationAssessment_GradingSystem",t[t.PronunciationAssessment_Granularity=67]="PronunciationAssessment_Granularity",t[t.PronunciationAssessment_EnableMiscue=68]="PronunciationAssessment_EnableMiscue",t[t.PronunciationAssessment_Json=69]="PronunciationAssessment_Json",t[t.PronunciationAssessment_Params=70]="PronunciationAssessment_Params",t[t.SpeakerRecognition_Api_Version=71]="SpeakerRecognition_Api_Version",t[t.WebWorkerLoadType=72]="WebWorkerLoadType",t[t.TalkingAvatarService_WebRTC_SDP=73]="TalkingAvatarService_WebRTC_SDP"})(e.PropertyId||(e.PropertyId={}))})(wn)),wn}var kt={},_a;function gv(){if(_a)return kt;_a=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Recognizer=void 0;const e=A(),t=T(),i=_(),u=P();let s=class lh{constructor(n,r,o,c){this.audioConfig=n!==void 0?n:u.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=r.clone(),this.privConnectionFactory=o,this.tokenCredential=c,this.implCommonRecognizerSetup()}close(n,r){i.Contracts.throwIfDisposed(this.privDisposed),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),n,r)}get internalData(){return this.privReco}async dispose(n){this.privDisposed||(this.privDisposed=!0,n&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return e.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(n){e.ServiceRecognizerBase.telemetryDataEnabled=n}implCommonRecognizerSetup(){let n=typeof window<"u"?"Browser":"Node",r="unknown",o="unknown";typeof navigator<"u"&&(n=n+"/"+navigator.platform,r=navigator.userAgent,o=navigator.appVersion);const c=this.createRecognizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(n,r,o))));this.privReco=this.createServiceRecognizer(lh.getAuth(this.privProperties,this.tokenCredential),this.privConnectionFactory,this.audioConfig,c)}async recognizeOnceAsyncImpl(n){i.Contracts.throwIfDisposed(this.privDisposed);const r=new t.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(n,r.resolve,r.reject);const o=await r.promise;return await this.implRecognizerStop(),o}async startContinuousRecognitionAsyncImpl(n){i.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(n,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){i.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuth(n,r){const o=n.getProperty(u.PropertyId.SpeechServiceConnection_Key,void 0);return o&&o!==""?new e.CognitiveSubscriptionKeyAuthentication(o):r?new e.CognitiveTokenAuthentication(async()=>{try{return(await r.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(c){throw c}},async()=>{try{return(await r.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(c){throw c}}):new e.CognitiveTokenAuthentication(()=>{const c=n.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)},()=>{const c=n.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)})}};return kt.Recognizer=s,kt}var zt={},_n={},ba;function V(){return ba||(ba=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechStartEventSensitivity=e.RecognitionMode=void 0,(function(t){t.Interactive="Interactive",t.Dictation="Dictation",t.Conversation="Conversation",t.None="None"})(e.RecognitionMode||(e.RecognitionMode={})),(function(t){t.Low="low",t.Medium="medium",t.High="high"})(e.SpeechStartEventSensitivity||(e.SpeechStartEventSensitivity={}))})(_n)),_n}var Ma;function Sv(){if(Ma)return zt;Ma=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.SpeechRecognizer=void 0;const e=A(),t=V(),i=T(),u=_(),s=P();let a=class vh extends s.Recognizer{constructor(r,o){const c=r;u.Contracts.throwIfNull(c,"speechConfig"),u.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage),s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new e.SpeechConnectionFactory,r.tokenCredential),this.privDisposedRecognizer=!1}static FromConfig(r,o,c){const p=r;return o.properties.mergeTo(p.properties),new vh(r,c)}get endpointId(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){u.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,r)}get speechRecognitionLanguage(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,s.OutputFormat[s.OutputFormat.Simple])===s.OutputFormat[s.OutputFormat.Simple]?s.OutputFormat.Simple:s.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),r,o)}startContinuousRecognitionAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(this.properties.getProperty(e.ForceDictationPropertyName,void 0)===void 0?t.RecognitionMode.Conversation:t.RecognitionMode.Dictation),r,o)}stopContinuousRecognitionAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}startKeywordRecognitionAsync(r,o,c){u.Contracts.throwIfNull(r,"model"),c&&c("Not yet implemented.")}stopKeywordRecognitionAsync(r){r&&r()}close(r,o){u.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new e.RecognizerConfig(r,this.privProperties)}createServiceRecognizer(r,o,c,p){const h=c;return new e.SpeechServiceRecognizer(r,o,h,p,this)}};return zt.SpeechRecognizer=a,zt}var Nt={},Oa;function mv(){if(Oa)return Nt;Oa=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.IntentRecognizer=void 0;const e=A(),t=V(),i=T(),u=_(),s=P();let a=class extends s.Recognizer{constructor(r,o){u.Contracts.throwIfNullOrUndefined(r,"speechConfig");const c=r;u.Contracts.throwIfNullOrUndefined(c,"speechConfig"),super(o,c.properties,new e.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=c.properties,u.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage),s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return u.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,r)}get properties(){return this.privProperties}recognizeOnceAsync(r,o){if(u.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const c=this.buildSpeechContext();this.privReco.speechContext.getContext().intent=c.Intent,this.privReco.dynamicGrammar.addReferenceGrammar(c.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,i.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),r,o)}startContinuousRecognitionAsync(r,o){if(Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){const c=this.buildSpeechContext();this.privReco.speechContext.getContext().intent=c.Intent,this.privReco.dynamicGrammar.addReferenceGrammar(c.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),r,o)}stopContinuousRecognitionAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}startKeywordRecognitionAsync(r,o,c){u.Contracts.throwIfNull(r,"model"),c&&c("Not yet implemented.")}stopKeywordRecognitionAsync(r,o){if(r)try{r()}catch(c){o&&o(c)}}addIntent(r,o){u.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),u.Contracts.throwIfNullOrWhitespace(o,"intentId"),u.Contracts.throwIfNullOrWhitespace(r,"simplePhrase"),this.privAddedIntents.push([o,r])}addIntentWithLanguageModel(r,o,c){u.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),u.Contracts.throwIfNullOrWhitespace(r,"intentId"),u.Contracts.throwIfNull(o,"model");const p=o;u.Contracts.throwIfNullOrWhitespace(p.appId,"model.appId"),this.privAddedLmIntents[r]=new e.AddedLmIntent(p,c)}addAllIntents(r,o){u.Contracts.throwIfNull(r,"model");const c=r;u.Contracts.throwIfNullOrWhitespace(c.appId,"model.appId"),this.privUmbrellaIntent=new e.AddedLmIntent(c,o)}close(r,o){u.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}createRecognizerConfig(r){return new e.RecognizerConfig(r,this.privProperties)}createServiceRecognizer(r,o,c,p){const h=c;return new e.IntentServiceRecognizer(r,o,h,p,this)}async dispose(r){this.privDisposedIntentRecognizer||r&&(this.privDisposedIntentRecognizer=!0,await super.dispose(r))}buildSpeechContext(){let r,o,c;const p=[];this.privUmbrellaIntent!==void 0&&(r=this.privUmbrellaIntent.modelImpl.appId,o=this.privUmbrellaIntent.modelImpl.region,c=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(const h of Object.keys(this.privAddedLmIntents)){const l=this.privAddedLmIntents[h];if(r===void 0)r=l.modelImpl.appId;else if(r!==l.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(o===void 0)o=l.modelImpl.region;else if(o!==l.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(c===void 0)c=l.modelImpl.subscriptionKey;else if(c!==l.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");const d="luis/"+r+"-PRODUCTION#"+h;p.push(d)}return{Intent:{id:r,key:c===void 0?this.privProperties.getProperty(s.PropertyId[s.PropertyId.SpeechServiceConnection_Key]):c,provider:"LUIS"},ReferenceGrammars:this.privUmbrellaIntent===void 0?p:["luis/"+r+"-PRODUCTION"]}}};return Nt.IntentRecognizer=a,Nt}var bn={},Da;function Cv(){return Da||(Da=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VoiceProfileType=void 0,(function(t){t[t.TextIndependentIdentification=0]="TextIndependentIdentification",t[t.TextDependentVerification=1]="TextDependentVerification",t[t.TextIndependentVerification=2]="TextIndependentVerification"})(e.VoiceProfileType||(e.VoiceProfileType={}))})(bn)),bn}var jt={},Lt={},ve={},ka;function fh(){if(ka)return ve;ka=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.ConnectionMessageImpl=ve.ConnectionMessage=void 0;const e=q(),t=T(),i=dh(),u=_s();let s=class{};ve.ConnectionMessage=s;class a{constructor(r){this.privConnectionMessage=r,this.privProperties=new i.PropertyCollection,this.privConnectionMessage.headers[e.HeaderNames.ConnectionId]&&this.privProperties.setProperty(u.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[e.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(o=>{this.privProperties.setProperty(o,this.privConnectionMessage.headers[o])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(r=>r.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===t.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===t.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}return ve.ConnectionMessageImpl=a,ve}var za;function gh(){if(za)return Lt;za=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Connection=void 0;const e=A(),t=T(),i=fh(),u=_(),s=P();let a=class ys{static fromRecognizer(r){const o=r.internalData,c=new ys;return c.privInternalData=o,c.setupEvents(),c}static fromSynthesizer(r){const o=r.internalData,c=new ys;return c.privInternalData=o,c.setupEvents(),c}openConnection(r,o){(0,t.marshalPromiseToCallbacks)(this.privInternalData.connect(),r,o)}closeConnection(r,o){if(this.privInternalData instanceof e.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");(0,t.marshalPromiseToCallbacks)(this.privInternalData.disconnect(),r,o)}setMessageProperty(r,o,c){if(u.Contracts.throwIfNullOrWhitespace(o,"propertyName"),this.privInternalData instanceof e.ServiceRecognizerBase){if(r.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");{const p=this.privInternalData.speechContext.getContext();p[o]=c}}else if(this.privInternalData instanceof e.SynthesisAdapterBase){if(r.toLowerCase()!=="speech.config"&&r.toLowerCase()!=="synthesis.context")throw new Error("Only speech.config and synthesis.context message paths are currently supported for synthesizer");if(r.toLowerCase()==="speech.config"){if(o.toLowerCase()!=="context")throw new Error("Only context property is currently supported for speech.config message path for synthesizer");this.privInternalData.synthesizerConfig.setContextFromJson(c)}else this.privInternalData.synthesisContext.setSection(o,c)}}sendMessageAsync(r,o,c,p){(0,t.marshalPromiseToCallbacks)(this.privInternalData.sendNetworkMessage(r,o),c,p)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(r=>{r.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new s.ConnectionEventArgs(r.connectionId)):r.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new s.ConnectionEventArgs(r.connectionId)):r.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new s.ConnectionMessageEventArgs(new i.ConnectionMessageImpl(r.message))):r.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new s.ConnectionMessageEventArgs(new i.ConnectionMessageImpl(r.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(r=>{this.receivedServiceMessage&&this.receivedServiceMessage(new s.ServiceEventArgs(r.jsonString,r.name))})}};return Lt.Connection=a,Lt}var Na;function yv(){if(Na)return jt;Na=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.TranslationRecognizer=void 0;const e=A(),t=V(),i=T(),u=gh(),s=_(),a=P();let n=class Sh extends a.Recognizer{constructor(o,c,p){const h=o;s.Contracts.throwIfNull(h,"speechConfig"),super(c,h.properties,p||new e.TranslationConnectionFactory,o.tokenCredential),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&s.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationVoice]),s.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationToLanguages]),s.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(o,c,p){const h=o;return c.properties.mergeTo(h.properties),c.properties.getProperty(a.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)===e.AutoDetectSourceLanguagesOpenRangeOptionName&&h.properties.setProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),new Sh(o,p)}get speechRecognitionLanguage(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,o)}recognizeOnceAsync(o,c){s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,i.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,c)}startContinuousRecognitionAsync(o,c){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,c)}stopContinuousRecognitionAsync(o,c){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),o,c)}removeTargetLanguage(o){if(s.Contracts.throwIfNullOrUndefined(o,"language to be removed"),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){const c=this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),p=c.indexOf(o);p>-1&&(c.splice(p,1),this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")),this.updateLanguages(c))}}addTargetLanguage(o){s.Contracts.throwIfNullOrUndefined(o,"language to be added");let c=[];this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(c=this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),c.includes(o)||(c.push(o),this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")))):(this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,o),c=[o]),this.updateLanguages(c)}close(o,c){s.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),o,c)}onConnection(){}async dispose(o){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,o&&(await this.implRecognizerStop(),await super.dispose(o)))}createRecognizerConfig(o){return new e.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,c,p,h){const l=p;return new e.TranslationServiceRecognizer(o,c,l,h,this)}updateLanguages(o){const c=u.Connection.fromRecognizer(this);c&&(c.setMessageProperty("speech.context","translationcontext",{to:o}),c.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:o})))}};return jt.TranslationRecognizer=n,jt}var qt={},ja;function Rv(){if(ja)return qt;ja=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.Translations=void 0;const e=P();let t=class{constructor(){this.privMap=new e.PropertyCollection}get languages(){return this.privMap.keys}get(u,s){return this.privMap.getProperty(u,s)}set(u,s){this.privMap.setProperty(u,s)}};return qt.Translations=t,qt}var Mn={},La;function Pv(){return La||(La=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NoMatchReason=void 0,(function(t){t[t.NotRecognized=0]="NotRecognized",t[t.InitialSilenceTimeout=1]="InitialSilenceTimeout",t[t.InitialBabbleTimeout=2]="InitialBabbleTimeout"})(e.NoMatchReason||(e.NoMatchReason={}))})(Mn)),Mn}var Bt={},qa;function Ev(){if(qa)return Bt;qa=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.NoMatchDetails=void 0;const e=A(),t=P();let i=class mh{constructor(s){this.privReason=s}static fromResult(s){const a=e.SimpleSpeechPhrase.fromJSON(s.json,0);let n=t.NoMatchReason.NotRecognized;switch(a.RecognitionStatus){case e.RecognitionStatus.BabbleTimeout:n=t.NoMatchReason.InitialBabbleTimeout;break;case e.RecognitionStatus.InitialSilenceTimeout:n=t.NoMatchReason.InitialSilenceTimeout;break;default:n=t.NoMatchReason.NotRecognized;break}return new mh(n)}get reason(){return this.privReason}};return Bt.NoMatchDetails=i,Bt}var Ft={},Ba;function Iv(){if(Ba)return Ft;Ba=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.TranslationRecognitionCanceledEventArgs=void 0;let e=class{constructor(i,u,s,a,n){this.privCancelReason=u,this.privErrorDetails=s,this.privResult=n,this.privSessionId=i,this.privErrorCode=a}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return Ft.TranslationRecognitionCanceledEventArgs=e,Ft}var xt={},Fa;function Av(){if(Fa)return xt;Fa=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.IntentRecognitionCanceledEventArgs=void 0;const e=P();let t=class extends e.IntentRecognitionEventArgs{constructor(u,s,a,n,r,o){super(n,r,o),this.privReason=u,this.privErrorDetails=s,this.privErrorCode=a}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return xt.IntentRecognitionCanceledEventArgs=t,xt}var Ut={},xa;function Ch(){if(xa)return Ut;xa=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.CancellationDetailsBase=void 0;let e=class{constructor(i,u,s){this.privReason=i,this.privErrorDetails=u,this.privErrorCode=s}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}};return Ut.CancellationDetailsBase=e,Ut}var Wt={},Ua;function Tv(){if(Ua)return Wt;Ua=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.CancellationDetails=void 0;const e=A(),t=Ch(),i=P();let u=class yh extends t.CancellationDetailsBase{constructor(a,n,r){super(a,n,r)}static fromResult(a){let n=i.CancellationReason.Error,r=i.CancellationErrorCode.NoError;if(a instanceof i.RecognitionResult&&a.json){const o=e.SimpleSpeechPhrase.fromJSON(a.json,0);n=e.EnumTranslation.implTranslateCancelResult(o.RecognitionStatus)}return a.properties&&(r=i.CancellationErrorCode[a.properties.getProperty(e.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.NoError])]),new yh(n,a.errorDetails||e.EnumTranslation.implTranslateErrorDetails(r),r)}};return Wt.CancellationDetails=u,Wt}var On={},Wa;function wv(){return Wa||(Wa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CancellationErrorCode=void 0,(function(t){t[t.NoError=0]="NoError",t[t.AuthenticationFailure=1]="AuthenticationFailure",t[t.BadRequestParameters=2]="BadRequestParameters",t[t.TooManyRequests=3]="TooManyRequests",t[t.ConnectionFailure=4]="ConnectionFailure",t[t.ServiceTimeout=5]="ServiceTimeout",t[t.ServiceError=6]="ServiceError",t[t.RuntimeError=7]="RuntimeError",t[t.Forbidden=8]="Forbidden"})(e.CancellationErrorCode||(e.CancellationErrorCode={}))})(On)),On}var Vt={},Va;function _v(){if(Va)return Vt;Va=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.ConnectionEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{};return Vt.ConnectionEventArgs=t,Vt}var Ht={},Ha;function bv(){if(Ha)return Ht;Ha=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ServiceEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,s,a){super(a),this.privJsonResult=u,this.privEventName=s}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};return Ht.ServiceEventArgs=t,Ht}var Kt={},Ka;function Mv(){if(Ka)return Kt;Ka=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PhraseListGrammar=void 0;const e=_();let t=class Rh{constructor(u){this.privGrammerBuilder=u.dynamicGrammar}static fromRecognizer(u){const s=u.internalData;return new Rh(s)}addPhrase(u){this.privGrammerBuilder.addPhrase(u)}addPhrases(u){this.privGrammerBuilder.addPhrase(u)}clear(){this.privGrammerBuilder.clearPhrases()}setWeight(u){e.Contracts.throwIfNumberOutOfRange(u,"weight",0,2),this.privGrammerBuilder.setWeight(u)}};return Kt.PhraseListGrammar=t,Kt}var fe={},$a;function bs(){if($a)return fe;$a=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.DialogServiceConfigImpl=fe.DialogServiceConfig=void 0;const e=_(),t=P();let i=class{constructor(){}set applicationId(a){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};fe.DialogServiceConfig=i;class u extends i{constructor(){super(),this.privSpeechConfig=new t.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(a){e.Contracts.throwIfNullOrWhitespace(a,"value"),this.privSpeechConfig.speechRecognitionLanguage=a}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(a){this.privSpeechConfig.outputFormat=a}setProperty(a,n){this.privSpeechConfig.setProperty(a,n)}getProperty(a,n){return this.privSpeechConfig.getProperty(a)}setProxy(a,n,r,o){this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyHostName,a),this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyPort,`${n}`),r&&this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyUserName,r),o&&this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyPassword,o)}setServiceProperty(a,n,r){this.privSpeechConfig.setServiceProperty(a,n)}close(){}}return fe.DialogServiceConfigImpl=u,fe}var $t={},Ja;function Ov(){if(Ja)return $t;Ja=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.BotFrameworkConfig=void 0;const e=_(),t=bs(),i=P();let u=class extends t.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(a,n,r){e.Contracts.throwIfNullOrWhitespace(a,"subscription"),e.Contracts.throwIfNullOrWhitespace(n,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,n),r&&o.setProperty(i.PropertyId.Conversation_ApplicationId,r),o}static fromAuthorizationToken(a,n,r){e.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(n,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,n),r&&o.setProperty(i.PropertyId.Conversation_ApplicationId,r),o}static fromHost(a,n,r){e.Contracts.throwIfNullOrUndefined(a,"host");const o=a instanceof URL?a:new URL(`wss://${a}.convai.speech.azure.us`);e.Contracts.throwIfNullOrUndefined(o,"resolvedHost");const c=new t.DialogServiceConfigImpl;return c.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),c.setProperty(i.PropertyId.SpeechServiceConnection_Host,o.toString()),n!==void 0&&c.setProperty(i.PropertyId.SpeechServiceConnection_Key,n),c}static fromEndpoint(a,n){e.Contracts.throwIfNull(a,"endpoint");const r=new t.DialogServiceConfigImpl;return r.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),r.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,a.toString()),n!==void 0&&r.setProperty(i.PropertyId.SpeechServiceConnection_Key,n),r}};return $t.BotFrameworkConfig=u,$t}var Jt={},Ga;function Dv(){if(Ga)return Jt;Ga=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.CustomCommandsConfig=void 0;const e=_(),t=bs(),i=P();let u=class extends t.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(a,n,r){e.Contracts.throwIfNullOrWhitespace(a,"applicationId"),e.Contracts.throwIfNullOrWhitespace(n,"subscription"),e.Contracts.throwIfNullOrWhitespace(r,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(i.PropertyId.Conversation_ApplicationId,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,n),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromAuthorizationToken(a,n,r){e.Contracts.throwIfNullOrWhitespace(a,"applicationId"),e.Contracts.throwIfNullOrWhitespace(n,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(r,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(i.PropertyId.Conversation_ApplicationId,a),o.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,n),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}set applicationId(a){e.Contracts.throwIfNullOrWhitespace(a,"value"),this.setProperty(i.PropertyId.Conversation_ApplicationId,a)}get applicationId(){return this.getProperty(i.PropertyId.Conversation_ApplicationId)}};return Jt.CustomCommandsConfig=u,Jt}var Gt={},Qt={},Xt={},Zt={},Qa;function ne(){if(Qa)return Zt;Qa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.QueryParameterNames=void 0;let e=class{};return Zt.QueryParameterNames=e,e.BotId="botid",e.CustomSpeechDeploymentId="cid",e.CustomVoiceDeploymentId="deploymentId",e.EnableAudioLogging="storeAudio",e.EnableLanguageId="lidEnabled",e.EnableWordLevelTimestamps="wordLevelTimestamps",e.EndSilenceTimeoutMs="endSilenceTimeoutMs",e.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs",e.SegmentationMaximumTimeMs="segmentationMaximumTimeMs",e.SegmentationStrategy="segmentationStrategy",e.Format="format",e.InitialSilenceTimeoutMs="initialSilenceTimeoutMs",e.Language="language",e.Profanity="profanity",e.RequestBotStatusMessages="enableBotMessageStatus",e.StableIntermediateThreshold="stableIntermediateThreshold",e.StableTranslation="stableTranslation",e.TestHooks="testhooks",e.Postprocessing="postprocessing",e.CtsMeetingId="meetingId",e.CtsDeviceId="deviceId",e.CtsIsParticipant="isParticipant",e.EnableAvatar="enableTalkingAvatar",Zt}var Xa;function J(){if(Xa)return Xt;Xa=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.ConnectionFactoryBase=void 0;const e=A(),t=T(),i=P(),u=ne();let s=class{static getHostSuffix(n){if(n){if(n.toLowerCase().startsWith("china"))return".azure.cn";if(n.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(n,r,o){new Map([[i.PropertyId.Speech_SegmentationSilenceTimeoutMs,u.QueryParameterNames.SegmentationSilenceTimeoutMs],[i.PropertyId.SpeechServiceConnection_EnableAudioLogging,u.QueryParameterNames.EnableAudioLogging],[i.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,u.QueryParameterNames.EndSilenceTimeoutMs],[i.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,u.QueryParameterNames.InitialSilenceTimeoutMs],[i.PropertyId.SpeechServiceResponse_PostProcessingOption,u.QueryParameterNames.Postprocessing],[i.PropertyId.SpeechServiceResponse_ProfanityOption,u.QueryParameterNames.Profanity],[i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,u.QueryParameterNames.EnableWordLevelTimestamps],[i.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,u.QueryParameterNames.StableIntermediateThreshold]]).forEach((h,l)=>{this.setUrlParameter(l,h,n,r,o)});const p=JSON.parse(n.parameters.getProperty(e.ServicePropertiesPropertyName,"{}"));Object.keys(p).forEach(h=>{r[h]=p[h]})}setUrlParameter(n,r,o,c,p){const h=o.parameters.getProperty(n,void 0);h&&(!p||p.search(r)===-1)&&(c[r]=h.toLocaleLowerCase())}static async getRedirectUrlFromEndpoint(n){const r=new URL(n);r.protocol="https:",r.port="443",r.searchParams.append("GenerateRedirectResponse","true");const c=r.toString();t.Events.instance.onEvent(new t.ConnectionRedirectEvent("",c,void 0,"ConnectionFactoryBase: redirectUrl request"));const p=await fetch(c);if(p.status!==200)return n;const h=await p.text();t.Events.instance.onEvent(new t.ConnectionRedirectEvent("",h,n,"ConnectionFactoryBase: redirectUrlString"));try{return new URL(h.trim()).toString()}catch{return n}}};return Xt.ConnectionFactoryBase=s,Xt}var Za;function kv(){if(Za)return Qt;Za=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.DialogConnectionFactory=void 0;const e=N(),t=A(),i=P(),u=J(),s=A(),a=q(),n=ne();class r extends u.ConnectionFactoryBase{create(c,p,h){const l=c.parameters.getProperty(i.PropertyId.Conversation_ApplicationId,""),d=c.parameters.getProperty(i.PropertyId.Conversation_DialogType),g=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region),f=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),S=c.parameters.getProperty(i.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),v={};v[a.HeaderNames.ConnectionId]=h,v[n.QueryParameterNames.Format]=c.parameters.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase(),v[n.QueryParameterNames.Language]=f,v[n.QueryParameterNames.RequestBotStatusMessages]=S,l&&(v[n.QueryParameterNames.BotId]=l,d===i.DialogServiceConfig.DialogTypes.CustomCommands&&(v[a.HeaderNames.CustomCommandsAppId]=l));const m=d===i.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",C=d===i.DialogServiceConfig.DialogTypes.CustomCommands?"v1":d===i.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",y={};p.token!=null&&p.token!==""&&(y[p.headerName]=p.token);let R=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,"");if(!R){const w=u.ConnectionFactoryBase.getHostSuffix(g),E=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,`wss://${g}.${r.BaseUrl}${w}`);R=`${E.endsWith("/")?E:E+"/"}${m}${r.ApiKey}/${C}`}this.setCommonUrlParams(c,v,R);const I=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(R,v,y,new s.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),I,h))}}return Qt.DialogConnectionFactory=r,r.ApiKey="api",r.BaseUrl="convai.speech",Qt}var Ya;function zv(){if(Ya)return Gt;Ya=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.DialogServiceConnector=void 0;const e=kv(),t=A(),i=V(),u=T(),s=_(),a=P(),n=_s();let r=class extends a.Recognizer{constructor(c,p){const h=c;s.Contracts.throwIfNull(c,"dialogConfig"),super(p,h.properties,new e.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=h.properties.clone();const l=this.buildAgentConfig();this.privReco.agentConfig.set(l)}connect(c,p){(0,u.marshalPromiseToCallbacks)(this.privReco.connect(),c,p)}disconnect(c,p){(0,u.marshalPromiseToCallbacks)(this.privReco.disconnect(),c,p)}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(c){s.Contracts.throwIfNullOrWhitespace(c,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,c)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(n.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(c){this.properties.setProperty(n.PropertyId.Conversation_Speech_Activity_Template,c)}listenOnceAsync(c,p){if(this.isTurnComplete){s.Contracts.throwIfDisposed(this.privIsDisposed);const l=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;const d=new u.Deferred;await this.privReco.recognize(i.RecognitionMode.Conversation,d.resolve,d.reject);const g=await d.promise;return await this.implRecognizerStop(),g})();l.catch(()=>{this.dispose(!0).catch(()=>{})}),(0,u.marshalPromiseToCallbacks)(l.finally(()=>{this.isTurnComplete=!0}),c,p)}}sendActivityAsync(c,p,h){(0,u.marshalPromiseToCallbacks)(this.privReco.sendMessage(c),p,h)}close(c,p){s.Contracts.throwIfDisposed(this.privIsDisposed),(0,u.marshalPromiseToCallbacks)(this.dispose(!0),c,p)}async dispose(c){this.privIsDisposed||c&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(c))}createRecognizerConfig(c){return new t.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,p,h,l){const d=h;return new t.DialogServiceAdapter(c,p,d,l,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(n.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(n.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(n.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};return Gt.DialogServiceConnector=r,Gt}var Yt={},ec;function Nv(){if(ec)return Yt;ec=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.ActivityReceivedEventArgs=void 0;let e=class{constructor(i,u){this.privActivity=i,this.privAudioStream=u}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}};return Yt.ActivityReceivedEventArgs=e,Yt}var er={},tr={},tc;function jv(){if(tc)return tr;tc=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.TurnStatusResponsePayload=void 0;class e{constructor(i){this.privMessageStatusResponse=JSON.parse(i)}static fromJSON(i){return new e(i)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}return tr.TurnStatusResponsePayload=e,tr}var rc;function Lv(){if(rc)return er;rc=1,Object.defineProperty(er,"__esModule",{value:!0}),er.TurnStatusReceivedEventArgs=void 0;const e=jv();let t=class{constructor(u){this.privTurnStatus=e.TurnStatusResponsePayload.fromJSON(u)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}};return er.TurnStatusReceivedEventArgs=t,er}var Dn={},ic;function qv(){return ic||(ic=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServicePropertyChannel=void 0,(function(t){t[t.UriQueryParameter=0]="UriQueryParameter"})(e.ServicePropertyChannel||(e.ServicePropertyChannel={}))})(Dn)),Dn}var kn={},nc;function Bv(){return nc||(nc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProfanityOption=void 0,(function(t){t[t.Masked=0]="Masked",t[t.Removed=1]="Removed",t[t.Raw=2]="Raw"})(e.ProfanityOption||(e.ProfanityOption={}))})(kn)),kn}var rr={},sc;function Fv(){if(sc)return rr;sc=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.BaseAudioPlayer=void 0;const e=G(),t=P(),i=Me();let u=class{constructor(a){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,a===void 0&&(a=t.AudioStreamFormat.getDefaultInputFormat()),this.init(a)}playAudioSample(a,n,r){try{this.ensureInitializedContext();const o=this.formatAudioData(a),c=new Float32Array(this.samples.length+o.length);c.set(this.samples,0),c.set(o,this.samples.length),this.samples=c,n&&n()}catch(o){r&&r(o)}}stopAudio(a,n){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{a&&a()},r=>{n&&n(r)}),this.audioContext=null)}init(a){this.audioFormat=a,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();const a=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},a)}}createAudioContext(){this.audioContext=i.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(a){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(a),128);case 16:return this.formatArrayBuffer(new Int16Array(a),32768);case 32:return this.formatArrayBuffer(new Int32Array(a),2147483648);default:throw new e.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(a,n){const r=new Float32Array(a.length);for(let o=0;o<a.length;o++)r[o]=a[o]/n;return r}updateAudioBuffer(){if(this.samples.length===0)return;const a=this.audioFormat.channels,n=this.audioContext.createBufferSource(),r=this.samples.length/a,o=this.audioContext.createBuffer(a,r,this.audioFormat.samplesPerSec);for(let c=0;c<a;c++){let p=c;const h=o.getChannelData(c);for(let l=0;l<this.samples.length;l++,p+=a)h[l]=this.samples[p]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),n.buffer=o,n.connect(this.gainNode),n.start(this.startTime),this.startTime+=o.duration,this.samples=new Float32Array}async playAudio(a){this.audioContext===null&&this.createAudioContext();const n=this.audioContext.createBufferSource(),r=this.audioContext.destination;await this.audioContext.decodeAudioData(a,o=>{n.buffer=o,n.connect(r),n.start(0)})}};return rr.BaseAudioPlayer=u,rr}var ir={},oc;function xv(){if(oc)return ir;oc=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.ConnectionMessageEventArgs=void 0;let e=class{constructor(i){this.privConnectionMessage=i}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}};return ir.ConnectionMessageEventArgs=e,ir}var nr={},ac;function Uv(){if(ac)return nr;ac=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.VoiceProfile=void 0;let e=class{constructor(i,u){this.privId=i,this.privProfileType=u}get profileId(){return this.privId}get profileType(){return this.privProfileType}};return nr.VoiceProfile=e,nr}var ge={},cc;function Wv(){if(cc)return ge;cc=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.VoiceProfileEnrollmentCancellationDetails=ge.VoiceProfileEnrollmentResult=void 0;const e=A(),t=P();let i=class Rs{constructor(a,n,r){this.privReason=a,this.privProperties=new t.PropertyCollection,this.privReason!==t.ResultReason.Canceled?n&&(this.privDetails=JSON.parse(n),this.privDetails.enrollmentStatus.toLowerCase()==="enrolling"&&(this.privReason=t.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=r,this.privProperties.setProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(a){const n=[];for(const r of a.value){const o=r.enrollmentStatus.toLowerCase()==="enrolling"?t.ResultReason.EnrollingVoiceProfile:r.enrollmentStatus.toLowerCase()==="enrolled"?t.ResultReason.EnrolledVoiceProfile:t.ResultReason.Canceled,c=new Rs(o,null,null);c.privDetails=this.getIdentificationDetails(r),n.push(c)}return n}static FromVerificationProfileList(a){const n=[];for(const r of a.value){const o=r.enrollmentStatus.toLowerCase()==="enrolling"?t.ResultReason.EnrollingVoiceProfile:r.enrollmentStatus.toLowerCase()==="enrolled"?t.ResultReason.EnrolledVoiceProfile:t.ResultReason.Canceled,c=new Rs(o,null,null);c.privDetails=this.getVerificationDetails(r),n.push(c)}return n}static getIdentificationDetails(a){return{audioLength:a.audioLength?parseFloat(a.audioLength):0,audioSpeechLength:a.audioSpeechLength?parseFloat(a.audioSpeechLength):0,enrollmentStatus:a.enrollmentStatus,enrollmentsCount:a.enrollmentsCount||0,enrollmentsLength:a.enrollmentsLength?parseFloat(a.enrollmentsLength):0,enrollmentsSpeechLength:a.enrollmentsSpeechLength?parseFloat(a.enrollmentsSpeechLength):0,profileId:a.profileId||a.identificationProfileId,remainingEnrollmentsSpeechLength:a.remainingEnrollmentsSpeechLength?parseFloat(a.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(a){return{audioLength:a.audioLength?parseFloat(a.audioLength):0,audioSpeechLength:a.audioSpeechLength?parseFloat(a.audioSpeechLength):0,enrollmentStatus:a.enrollmentStatus,enrollmentsCount:a.enrollmentsCount,enrollmentsLength:a.enrollmentsLength?parseFloat(a.enrollmentsLength):0,enrollmentsSpeechLength:a.enrollmentsSpeechLength?parseFloat(a.enrollmentsSpeechLength):0,profileId:a.profileId||a.verificationProfileId,remainingEnrollmentsCount:a.remainingEnrollments||a.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:a.remainingEnrollmentsSpeechLength?parseFloat(a.remainingEnrollmentsSpeechLength):0}}};ge.VoiceProfileEnrollmentResult=i;class u extends t.CancellationDetailsBase{constructor(a,n,r){super(a,n,r)}static fromResult(a){const n=t.CancellationReason.Error;let r=t.CancellationErrorCode.NoError;return a.properties&&(r=t.CancellationErrorCode[a.properties.getProperty(e.CancellationErrorCodePropertyName,t.CancellationErrorCode[t.CancellationErrorCode.NoError])]),new u(n,a.errorDetails,r)}}return ge.VoiceProfileEnrollmentCancellationDetails=u,ge}var Se={},uc;function Vv(){if(uc)return Se;uc=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.VoiceProfileCancellationDetails=Se.VoiceProfileResult=void 0;const e=A(),t=_(),i=P();let u=class{constructor(n,r){this.privReason=n,this.privProperties=new i.PropertyCollection,n===i.ResultReason.Canceled&&(t.Contracts.throwIfNullOrUndefined(r,"statusText"),this.privErrorDetails=r,this.privProperties.setProperty(e.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}};Se.VoiceProfileResult=u;class s extends i.CancellationDetailsBase{constructor(n,r,o){super(n,r,o)}static fromResult(n){const r=i.CancellationReason.Error;let o=i.CancellationErrorCode.NoError;return n.properties&&(o=i.CancellationErrorCode[n.properties.getProperty(e.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.NoError])]),new s(r,n.errorDetails,o)}}return Se.VoiceProfileCancellationDetails=s,Se}var sr={},pc;function Hv(){if(pc)return sr;pc=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.VoiceProfilePhraseResult=void 0;const e=_(),t=P();let i=class extends t.VoiceProfileResult{constructor(s,a,n,r){super(s,a),this.privPhrases=[],e.Contracts.throwIfNullOrUndefined(r,"phrase array"),this.privType=n,r&&r[0]&&(this.privPhrases=r)}get phrases(){return this.privPhrases}get type(){return this.privType}};return sr.VoiceProfilePhraseResult=i,sr}var or={},hc;function Kv(){if(hc)return or;hc=1,Object.defineProperty(or,"__esModule",{value:!0}),or.VoiceProfileClient=void 0;const e=A(),t=ch(),i=_(),u=P();let s=class extends u.Recognizer{constructor(n){i.Contracts.throwIfNullOrUndefined(n,"speechConfig");const r=n;i.Contracts.throwIfNull(r,"speechConfig"),super(t.AudioConfig.fromStreamInput(u.AudioInputStream.createPushStream()),r.properties,new e.VoiceProfileConnectionFactory),this.privProperties=r.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(n){i.Contracts.throwIfNullOrWhitespace(n,"token"),this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,n)}async createProfileAsync(n,r){const o=await this.privVoiceAdapter.createProfile(n,r);return new u.VoiceProfile(o[0],n)}async retrieveEnrollmentResultAsync(n){return this.privVoiceAdapter.retrieveEnrollmentResult(n)}async getAllProfilesAsync(n){return this.privVoiceAdapter.getAllProfiles(n)}async getActivationPhrasesAsync(n,r){return this.privVoiceAdapter.getActivationPhrases(n,r)}async enrollProfileAsync(n,r){const o=r;return i.Contracts.throwIfNullOrUndefined(o,"audioConfig"),this.audioConfig=r,this.privVoiceAdapter.SpeakerAudioSource=o,this.privVoiceAdapter.enrollProfile(n)}async deleteProfileAsync(n){return this.privVoiceAdapter.deleteProfile(n)}async resetProfileAsync(n){return this.privVoiceAdapter.resetProfile(n)}async close(){await this.dispose(!0)}createServiceRecognizer(n,r,o,c){const p=o;return new e.VoiceServiceRecognizer(n,r,p,c,this)}async dispose(n){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,n&&await super.dispose(n))}createRecognizerConfig(n){return new e.RecognizerConfig(n,this.properties)}getResult(n,r){return new u.VoiceProfileResult(n.ok?r:u.ResultReason.Canceled,n.statusText)}};return or.VoiceProfileClient=s,or}var ar={},dc;function $v(){if(dc)return ar;dc=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.SpeakerRecognizer=void 0;const e=A(),t=_(),i=P();let u=class extends i.Recognizer{constructor(a,n){t.Contracts.throwIfNullOrUndefined(a,"speechConfig");const r=a;t.Contracts.throwIfNullOrUndefined(r,"speechConfig"),super(n,r.properties,new e.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=n,t.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=r.properties}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(a){t.Contracts.throwIfNullOrWhitespace(a,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a)}get properties(){return this.privProperties}async recognizeOnceAsync(a){return t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(a)}async close(){t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.dispose(!0)}async recognizeSpeakerOnceAsyncImpl(a){t.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.implRecognizerStop();const n=await this.privReco.recognizeSpeaker(a);return await this.implRecognizerStop(),n}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}createRecognizerConfig(a){return new e.RecognizerConfig(a,this.privProperties)}createServiceRecognizer(a,n,r,o){const c=r;return new e.SpeakerServiceRecognizer(a,n,c,o,this)}async dispose(a){this.privDisposedSpeakerRecognizer||a&&(this.privDisposedSpeakerRecognizer=!0,await super.dispose(a))}};return ar.SpeakerRecognizer=u,ar}var cr={},lc;function Jv(){if(lc)return cr;lc=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.SpeakerIdentificationModel=void 0;const e=_(),t=P();let i=class Ph{constructor(s){if(this.privVoiceProfiles=[],this.privProfileIds=[],e.Contracts.throwIfNullOrUndefined(s,"VoiceProfiles"),s.length===0)throw new Error("Empty Voice Profiles array");for(const a of s){if(a.profileType!==t.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+a.profileId);this.privVoiceProfiles.push(a),this.privProfileIds.push(a.profileId)}}static fromProfiles(s){return new Ph(s)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}};return cr.SpeakerIdentificationModel=i,cr}var ur={},vc;function Gv(){if(vc)return ur;vc=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.SpeakerVerificationModel=void 0;const e=_(),t=P();let i=class Eh{constructor(s){if(e.Contracts.throwIfNullOrUndefined(s,"VoiceProfile"),s.profileType===t.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=s}static fromProfile(s){return new Eh(s)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===t.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}};return ur.SpeakerVerificationModel=i,ur}var pr={},zn={},fc;function Ih(){return fc||(fc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LanguageIdMode=void 0,(function(t){t[t.AtStart=0]="AtStart",t[t.Continuous=1]="Continuous"})(e.LanguageIdMode||(e.LanguageIdMode={}))})(zn)),zn}var gc;function Qv(){if(gc)return pr;gc=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.AutoDetectSourceLanguageConfig=void 0;const e=A(),t=_(),i=P(),u=Ih();let s=class $i{constructor(){this.privProperties=new i.PropertyCollection,this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=u.LanguageIdMode.AtStart}static fromOpenRange(){const n=new $i;return n.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e.AutoDetectSourceLanguagesOpenRangeOptionName),n.properties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),n}static fromLanguages(n){t.Contracts.throwIfArrayEmptyOrWhitespace(n,"languages");const r=new $i;return r.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,n.join()),r}static fromSourceLanguageConfigs(n){if(n.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const r=new $i,o=[];return n.forEach(c=>{if(o.push(c.language),c.endpointId!==void 0&&c.endpointId!==""){const p=c.language+i.PropertyId.SpeechServiceConnection_EndpointId.toString();r.properties.setProperty(p,c.endpointId)}}),r.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o.join()),r}get properties(){return this.privProperties}set mode(n){n===u.LanguageIdMode.Continuous?(this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=n}};return pr.AutoDetectSourceLanguageConfig=s,pr}var hr={},Sc;function Xv(){if(Sc)return hr;Sc=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.AutoDetectSourceLanguageResult=void 0;const e=_();let t=class Ps{constructor(u,s){e.Contracts.throwIfNullOrUndefined(u,"language"),e.Contracts.throwIfNullOrUndefined(s,"languageDetectionConfidence"),this.privLanguage=u,this.privLanguageDetectionConfidence=s}static fromResult(u){return new Ps(u.language,u.languageDetectionConfidence)}static fromConversationTranscriptionResult(u){return new Ps(u.language,u.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}};return hr.AutoDetectSourceLanguageResult=t,hr}var dr={},mc;function Zv(){if(mc)return dr;mc=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.SourceLanguageConfig=void 0;const e=_();let t=class Ah{constructor(u,s){e.Contracts.throwIfNullOrUndefined(u,"language"),this.privLanguage=u,this.privEndpointId=s}static fromLanguage(u,s){return new Ah(u,s)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}};return dr.SourceLanguageConfig=t,dr}var Nn={},Cc;function Yv(){return Cc||(Cc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeakerRecognitionCancellationDetails=e.SpeakerRecognitionResult=e.SpeakerRecognitionResultType=void 0;const t=A(),i=P();var u;(function(n){n[n.Verify=0]="Verify",n[n.Identify=1]="Identify"})(u=e.SpeakerRecognitionResultType||(e.SpeakerRecognitionResultType={}));class s{constructor(r,o=i.ResultReason.RecognizedSpeaker,c=i.CancellationErrorCode.NoError,p=""){this.privProperties=new i.PropertyCollection;const h=r.scenario==="TextIndependentIdentification"?u.Identify:u.Verify;this.privReason=o,this.privReason!==i.ResultReason.Canceled?h===u.Identify?(this.privProfileId=r.identificationResult.identifiedProfile.profileId,this.privScore=r.identificationResult.identifiedProfile.score,this.privReason=i.ResultReason.RecognizedSpeakers):(this.privScore=r.verificationResult.score,r.verificationResult.recognitionResult.toLowerCase()!=="accept"&&(this.privReason=i.ResultReason.NoMatch),r.verificationResult.profileId!==void 0&&r.verificationResult.profileId!==""&&(this.privProfileId=r.verificationResult.profileId)):(this.privErrorDetails=p,this.privProperties.setProperty(t.CancellationErrorCodePropertyName,i.CancellationErrorCode[c])),this.privProperties.setProperty(i.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(r))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}}e.SpeakerRecognitionResult=s;class a extends i.CancellationDetailsBase{constructor(r,o,c){super(r,o,c)}static fromResult(r){const o=i.CancellationReason.Error;let c=i.CancellationErrorCode.NoError;return r.properties&&(c=i.CancellationErrorCode[r.properties.getProperty(t.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.NoError])]),new a(o,r.errorDetails,c)}}e.SpeakerRecognitionCancellationDetails=a})(Nn)),Nn}var jn={},me={},yc;function Th(){if(yc)return me;yc=1,Object.defineProperty(me,"__esModule",{value:!0}),me.ConversationImpl=me.Conversation=void 0;const e=A(),t=T(),i=_(),u=P();let s=class{constructor(){}static createConversationAsync(r,o,c,p){i.Contracts.throwIfNullOrUndefined(r,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),i.Contracts.throwIfNullOrUndefined(r.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!r.subscriptionKey&&!r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceAuthorization_Token])&&i.Contracts.throwIfNullOrUndefined(r.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let h,l,d;return typeof o=="string"?(h=new a(r,o),(0,t.marshalPromiseToCallbacks)((async()=>{})(),c,p)):(h=new a(r),l=o,d=c,h.createConversationAsync((()=>{l&&l()}),g=>{d&&d(g)})),h}};me.Conversation=s;class a extends s{constructor(r,o){if(super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=h=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,l)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,l)}catch{}},this.onParticipantUpdateCommandReceived=(h,l)=>{try{const d=this.privParticipants.getParticipant(l.id);if(d!==void 0){switch(l.key){case e.ConversationTranslatorCommandTypes.changeNickname:d.displayName=l.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:d.isUsingTts=l.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:d.profanity=l.value;break;case e.ConversationTranslatorCommandTypes.setMute:d.isMuted=l.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:d.translateToLanguages=l.value;break}this.privParticipants.addOrUpdateParticipant(d),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,[this.toParticipant(d)],l.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,l)=>{try{this.privParticipants.participants.forEach(d=>d.isMuted=d.isHost?!1:l.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,this.toParticipants(!1),l.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,l)=>{try{const d=this.privParticipants.addOrUpdateParticipant(l.participant);d!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,[this.toParticipant(d)],l.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,l)=>{try{const d=this.privParticipants.getParticipant(l.participant.id);d!==void 0&&(this.privParticipants.deleteParticipant(l.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.LeftConversation,[this.toParticipant(d)],l.sessionId)))}catch{}},this.onTranslationReceived=(h,l)=>{try{switch(l.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,l)=>{try{if(l.sessionToken!==void 0&&l.sessionToken!==null&&(this.privRoom.token=l.sessionToken),this.privParticipants.participants=[...l.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),l.sessionId)),this.me.isHost){const d=this.privConversationTranslator?.properties.getProperty(u.PropertyId.ConversationTranslator_Name);d!==void 0&&d.length>0&&d!==this.me.displayName&&this.changeNicknameAsync(d)}}catch{}},this.onConversationExpiration=(h,l)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,l)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new u.PropertyCollection,this.privManager=new e.ConversationManager,r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage])||r.setProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage]),o)this.privConversationId=o;else{r.targetLanguages.length===0&&r.addTargetLanguage(this.privLanguage),r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceResponse_ProfanityOption])||r.setProfanity(u.ProfanityOption.Masked);let l=r.getProperty(u.PropertyId[u.PropertyId.ConversationTranslator_Name]);l==null&&(l="Host"),i.Contracts.throwIfNullOrTooLong(l,"nickname",50),i.Contracts.throwIfNullOrTooShort(l,"nickname",2),r.setProperty(u.PropertyId[u.PropertyId.ConversationTranslator_Name],l)}this.privConfig=r;const p=r;i.Contracts.throwIfNull(p,"speechConfig"),this.privProperties=p.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const r=this.conversationId,o=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of e.ConversationConnectionConfig.transcriptionEventKeys){const l=this.properties.getProperty(h,"");l!==""&&(c[h]=l)}return{id:r,participants:o,conversationProperties:c}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"authorizationToken"),this.privToken=r}set conversationTranslator(r){this.privConversationTranslator=r}onToken(r){this.privConversationTranslator.onToken(r)}createConversationAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,(c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=c,this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}startConversationAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=e.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}addParticipantAsync(r,o,c){i.Contracts.throwIfNullOrUndefined(r,"Participant"),(0,t.marshalPromiseToCallbacks)(this.addParticipantImplAsync(r),o,c)}joinConversationAsync(r,o,c,p,h){try{i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","conversationId")),i.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,r,(l=>{i.Contracts.throwIfNullOrUndefined(l,this.privErrors.permissionDeniedConnect),this.privRoom=l,this.privConfig.authorizationToken=l.cognitiveSpeechAuthToken,p&&p(l.cognitiveSpeechAuthToken)}),(l=>{this.handleError(l,h)}))}catch(l){this.handleError(l,h)}}deleteConversationAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.deleteConversationImplAsync(),r,o)}async deleteConversationImplAsync(){i.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),i.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.endConversationImplAsync(),r,o)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!0),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}removeParticipantAsync(r,o,c){try{if(i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&r.hasOwnProperty("id"))(0,t.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(r),o,c);else{i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let p="";typeof r=="string"?p=r:r.hasOwnProperty("id")?p=r.id:r.hasOwnProperty("userId")&&(p=r.userId),i.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(l=>l.id===p)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(p),(()=>{this.handleCallback(o,c)}),(l=>{this.handleError(l,c)}))}}catch(p){this.handleError(p,c)}}unlockConversationAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!1),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}sendTextMessageAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","message")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),r.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}setTranslatedLanguagesAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfArrayEmptyOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","languages")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}changeNicknameAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(r){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await r.enforceAudioGating(),this.privTranscriberRecognizer=r,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){const r=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:r,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(r){if(this.privParticipants.addOrUpdateParticipant(r)!==void 0&&this.privTranscriberRecognizer){const c=this.conversationInfo;return c.participants=[r],this.privTranscriberRecognizer.pushConversationEvent(c,"join")}}removeParticipantImplAsync(r){this.privParticipants.deleteParticipant(r.id);const o=this.conversationInfo;return o.participants=[r],this.privTranscriberRecognizer.pushConversationEvent(o,"leave")}async close(r){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(o){throw o}r&&this.dispose()}handleCallback(r,o){if(r){try{r()}catch(c){o&&o(c)}r=void 0}}handleError(r,o){if(o)if(r instanceof Error){const c=r;o(c.name+": "+c.message)}else o(r)}toParticipants(r){const o=this.privParticipants.participants.map(c=>this.toParticipant(c));return r?o:o.filter(c=>c.isHost===!1)}toParticipant(r){return new u.Participant(r.id,r.avatar,r.displayName,r.isHost,r.isMuted,r.isUsingTts,r.preferredLanguage,r.voice)}getMuteAllCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMuteCommand(r,o){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getEjectCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getChangeNicknameCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"nickname"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:r,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMessageCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),i.Contracts.throwIfNullOrWhitespace(r,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:r,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return me.ConversationImpl=a,me}var lr={},Rc;function ef(){if(Rc)return lr;Rc=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.ConversationCommon=void 0;let e=class{constructor(i){this.privAudioConfig=i}handleCallback(i,u){if(i){try{i()}catch(s){u&&u(s)}i=void 0}}handleError(i,u){if(u)if(i instanceof Error){const s=i;u(s.name+": "+s.message)}else u(i)}};return lr.ConversationCommon=e,lr}var vr={},Pc;function tf(){if(Pc)return vr;Pc=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.ConversationExpirationEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,s){super(s),this.privExpirationTime=u}get expirationTime(){return this.privExpirationTime}};return vr.ConversationExpirationEventArgs=t,vr}var fr={},Ec;function rf(){if(Ec)return fr;Ec=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.ConversationParticipantsChangedEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,s,a){super(a),this.privReason=u,this.privParticipant=s}get reason(){return this.privReason}get participants(){return this.privParticipant}};return fr.ConversationParticipantsChangedEventArgs=t,fr}var gr={},Ic;function nf(){if(Ic)return gr;Ic=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.ConversationTranslationCanceledEventArgs=void 0;const e=Hi();let t=class extends e.CancellationEventArgsBase{};return gr.ConversationTranslationCanceledEventArgs=t,gr}var Sr={},Ac;function sf(){if(Ac)return Sr;Ac=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.ConversationTranslationEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,s,a){super(s,a),this.privResult=u}get result(){return this.privResult}};return Sr.ConversationTranslationEventArgs=t,Sr}var mr={},Tc;function of(){if(Tc)return mr;Tc=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.ConversationTranslationResult=void 0;const e=ph();let t=class extends e.TranslationRecognitionResult{constructor(u,s,a,n,r,o,c,p,h,l,d){super(s,n,r,o,c,p,void 0,void 0,h,l,d),this.privId=u,this.privOrigLang=a}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};return mr.ConversationTranslationResult=t,mr}var Ln={},Cr={},yr={},wc;function wh(){if(wc)return yr;wc=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.StringUtils=void 0;let e=class{static formatString(i,u){if(!i)return"";if(!u)return i;let s="",a="";const n=c=>{s+=c},r=c=>{a+=c};let o=n;for(let c=0;c<i.length;c++){const p=i[c],h=c+1<i.length?i[c+1]:"";switch(p){case"{":h==="{"?(o("{"),c++):o=r;break;case"}":h==="}"?(o("}"),c++):(u.hasOwnProperty(a)&&(s+=u[a]),o=n,a="");break;default:o(p);break}}return s}};return yr.StringUtils=e,yr}var _c;function af(){if(_c)return Cr;_c=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.ConversationTranslatorConnectionFactory=void 0;const e=N(),t=wh(),i=_(),u=P(),s=q(),a=ne(),n=J(),r=A();let o=class _h extends n.ConnectionFactoryBase{constructor(p){super(),i.Contracts.throwIfNullOrUndefined(p,"convGetter"),this.privConvGetter=p}create(p,h,l){const d=p.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",g=this.privConvGetter().room,f=g.cognitiveSpeechRegion||p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Region,""),S={hostSuffix:n.ConnectionFactoryBase.getHostSuffix(f),path:_h.CTS_VIRT_MIC_PATH,region:encodeURIComponent(f)};S[a.QueryParameterNames.Language]=encodeURIComponent(p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage,"")),S[a.QueryParameterNames.CtsMeetingId]=encodeURIComponent(g.roomId),S[a.QueryParameterNames.CtsDeviceId]=encodeURIComponent(g.participantId),S[a.QueryParameterNames.CtsIsParticipant]=g.isHost?"":"&"+a.QueryParameterNames.CtsIsParticipant;let v="";const m={},C={};if(d){v=p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Endpoint),v||(v="wss://"+p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),v=t.StringUtils.formatString(v,S);const R=new URL(v);R.searchParams.forEach((w,E)=>{m[E]=w}),new r.TranscriberConnectionFactory().setQueryParams(m,p,v),m[a.QueryParameterNames.CtsMeetingId]=S[a.QueryParameterNames.CtsMeetingId],m[a.QueryParameterNames.CtsDeviceId]=S[a.QueryParameterNames.CtsDeviceId],g.isHost||(m[a.QueryParameterNames.CtsIsParticipant]=""),a.QueryParameterNames.Format in m||(m[a.QueryParameterNames.Format]="simple"),R.searchParams.forEach((w,E)=>{R.searchParams.set(E,m[E]),delete m[E]}),v=R.toString()}else{const R=new r.TranslationConnectionFactory;v=R.getEndpointUrl(p,!0),v=t.StringUtils.formatString(v,S),R.setQueryParams(m,p,v)}C[s.HeaderNames.ConnectionId]=l,C[e.RestConfigBase.configParams.token]=g.token,h.token&&(C[h.headerName]=h.token);const y=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return Promise.resolve(new e.WebsocketConnection(v,m,C,new r.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),y,l))}};return Cr.ConversationTranslatorConnectionFactory=o,o.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio",Cr}var bc;function cf(){return bc||(bc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationTranslator=e.SpeechState=void 0;const t=A(),i=af(),u=T(),s=_(),a=P(),n=Th(),r=Ms();var o;(function(h){h[h.Inactive=0]="Inactive",h[h.Connecting=1]="Connecting",h[h.Connected=2]="Connected"})(o=e.SpeechState||(e.SpeechState={}));class c extends a.TranslationRecognizer{constructor(l,d,g,f){super(l,d,new i.ConversationTranslatorConnectionFactory(f)),this.privSpeechState=o.Inactive,g&&(this.privTranslator=g,this.sessionStarted=()=>{this.privSpeechState=o.Connected},this.sessionStopped=()=>{this.privSpeechState=o.Inactive},this.recognizing=(S,v)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,v)},this.recognized=async(S,v)=>{v.result?.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(v.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,v)},this.canceled=async()=>{if(this.privSpeechState!==o.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=o.Inactive}})}get state(){return this.privSpeechState}set state(l){this.privSpeechState=l}set authentication(l){this.privReco.authentication=l}onConnection(){this.privSpeechState=o.Connected}async onCancelSpeech(){this.privSpeechState=o.Inactive,await this.cancelSpeech()}fireCancelEvent(l){try{if(this.privTranslator.canceled){const d=new r.ConversationTranslationCanceledEventArgs(a.CancellationReason.Error,l,a.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,d)}}catch{}}async cancelSpeech(){try{this.stopContinuousRecognitionAsync(),await this.privReco?.disconnect(),this.privSpeechState=o.Inactive}catch{}}}class p extends r.ConversationCommon{constructor(l){super(l),this.privErrors=t.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new a.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){return this.privConversation?.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===o.Connected||this.privCTRecognizer.state===o.Connecting||this.privConversation.isMutedByHost)}onToken(l){this.privCTRecognizer.authentication=l}setServiceProperty(l,d){const g=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));g[l]=d,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(g))}joinConversationAsync(l,d,g,f,S){try{if(typeof l=="string"){s.Contracts.throwIfNullOrUndefined(l,this.privErrors.invalidArgs.replace("{arg}","conversation id")),s.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),S);let v=g;(v==null||v==="")&&(v=t.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=a.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(a.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(v),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage],v),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.ConversationTranslator_Name],d);const m=[a.PropertyId.SpeechServiceConnection_Host,a.PropertyId.ConversationTranslator_Host,a.PropertyId.SpeechServiceConnection_Endpoint,a.PropertyId.SpeechServiceConnection_ProxyHostName,a.PropertyId.SpeechServiceConnection_ProxyPassword,a.PropertyId.SpeechServiceConnection_ProxyPort,a.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const y of m){const R=this.privProperties.getProperty(y);if(R){const I=typeof y=="string"?y:a.PropertyId[y];this.privSpeechTranslationConfig.setProperty(I,R)}}const C=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));for(const y of Object.keys(C))this.privSpeechTranslationConfig.setServiceProperty(y,C[y],a.ServicePropertyChannel.UriQueryParameter);this.privConversation=new n.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(l,d,v,(y=>{y||this.handleError(new Error(this.privErrors.permissionDeniedConnect),S),this.privSpeechTranslationConfig.authorizationToken=y,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync((()=>{this.handleCallback(f,S)}),(R=>{this.handleError(R,S)}))}),(y=>{this.handleError(y,S)}))}else typeof l=="object"?(s.Contracts.throwIfNullOrUndefined(l,this.privErrors.invalidArgs.replace("{arg}","conversation id")),s.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(a.PropertyId.ConversationTranslator_Name,d),this.privConversation=l,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,s.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),s.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=l.config,this.handleCallback(g,f)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),f)}catch(v){this.handleError(v,typeof g=="string"?S:f)}}leaveConversationAsync(l,d){(0,u.marshalPromiseToCallbacks)((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),l,d)}sendTextMessageAsync(l,d,g){try{s.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),s.Contracts.throwIfNullOrWhitespace(l,this.privErrors.invalidArgs.replace("{arg}",l)),this.privConversation.sendTextMessageAsync(l,d,g)}catch(f){this.handleError(f,g)}}startTranscribingAsync(l,d){(0,u.marshalPromiseToCallbacks)((async()=>{try{s.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),s.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),s.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),d),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(g){throw this.privIsSpeaking=!1,await this.cancelSpeech(),g}})(),l,d)}stopTranscribingAsync(l,d){(0,u.marshalPromiseToCallbacks)((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((g,f)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(g,f)})}catch{await this.cancelSpeech()}})(),l,d)}isDisposed(){return this.privIsDisposed}dispose(l,d,g){(0,u.marshalPromiseToCallbacks)((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),d,g)}async cancelSpeech(){try{this.privIsSpeaking=!1,await this.privCTRecognizer?.onCancelSpeech(),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=a.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key],"");const l=()=>this.privConversation;this.privCTRecognizer=new c(this.privSpeechTranslationConfig,this.privAudioConfig,this,l)}catch(l){throw await this.cancelSpeech(),l}}startContinuousRecognition(){return new Promise((l,d)=>{this.privCTRecognizer.startContinuousRecognitionAsync(l,d)})}}e.ConversationTranslator=p})(Ln)),Ln}var Rr={},Mc;function uf(){if(Mc)return Rr;Mc=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.ConversationTranscriber=void 0;const e=A(),t=V(),i=T(),u=_(),s=P();let a=class bh extends s.Recognizer{constructor(r,o){const c=r;u.Contracts.throwIfNull(c,"speechConfig"),u.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage),s.PropertyId[s.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new e.ConversationTranscriberConnectionFactory,r.tokenCredential),this.privProperties.setProperty(s.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(r,o,c){const p=r;return o.properties.mergeTo(p.properties),new bh(r,c)}get endpointId(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(s.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){u.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,r)}get speechRecognitionLanguage(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,s.OutputFormat[s.OutputFormat.Simple])===s.OutputFormat[s.OutputFormat.Simple]?s.OutputFormat.Simple:s.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),r,o)}stopTranscribingAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}close(r,o){u.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new e.RecognizerConfig(r,this.privProperties)}createServiceRecognizer(r,o,c,p){const h=c;return p.isSpeakerDiarizationEnabled=!0,new e.ConversationTranscriptionServiceRecognizer(r,o,h,p,this)}};return Rr.ConversationTranscriber=a,Rr}var Ce={},Oc;function pf(){if(Oc)return Ce;Oc=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Participant=Ce.User=void 0;const e=P();class t{constructor(s){this.privUserId=s}get userId(){return this.privUserId}}Ce.User=t;class i{constructor(s,a,n,r,o,c,p,h){this.privId=s,this.privAvatar=a,this.privDisplayName=n,this.privIsHost=r,this.privIsMuted=o,this.privIsUsingTts=c,this.privPreferredLanguage=p,this.privVoice=h,this.privProperties=new e.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(s,a,n){return new i(s,"",s,!1,!1,!1,a,n)}}return Ce.Participant=i,Ce}var qn={},Dc;function hf(){return Dc||(Dc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ParticipantChangedReason=void 0,(function(t){t[t.JoinedConversation=0]="JoinedConversation",t[t.LeftConversation=1]="LeftConversation",t[t.Updated=2]="Updated"})(e.ParticipantChangedReason||(e.ParticipantChangedReason={}))})(qn)),qn}var ye={},kc;function df(){if(kc)return ye;kc=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.MeetingImpl=ye.Meeting=void 0;const e=A(),t=T(),i=_(),u=P();let s=class{constructor(){}static createMeetingAsync(r,o,c,p){if(i.Contracts.throwIfNullOrUndefined(r,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),i.Contracts.throwIfNullOrUndefined(r.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),i.Contracts.throwIfNull(o,"meetingId"),o.length===0)throw new Error("meetingId cannot be empty");!r.subscriptionKey&&!r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceAuthorization_Token])&&i.Contracts.throwIfNullOrUndefined(r.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const h=new a(r,o);return(0,t.marshalPromiseToCallbacks)((async()=>{})(),c,p),h}};ye.Meeting=s;class a extends s{constructor(r,o){super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=h=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,l)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,l)}catch{}},this.onParticipantUpdateCommandReceived=(h,l)=>{try{const d=this.privParticipants.getParticipant(l.id);if(d!==void 0){switch(l.key){case e.ConversationTranslatorCommandTypes.changeNickname:d.displayName=l.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:d.isUsingTts=l.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:d.profanity=l.value;break;case e.ConversationTranslatorCommandTypes.setMute:d.isMuted=l.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:d.translateToLanguages=l.value;break}this.privParticipants.addOrUpdateParticipant(d),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,[this.toParticipant(d)],l.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,l)=>{try{this.privParticipants.participants.forEach(d=>d.isMuted=d.isHost?!1:l.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,this.toParticipants(!1),l.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,l)=>{try{const d=this.privParticipants.addOrUpdateParticipant(l.participant);d!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,[this.toParticipant(d)],l.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,l)=>{try{const d=this.privParticipants.getParticipant(l.participant.id);d!==void 0&&(this.privParticipants.deleteParticipant(l.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.LeftConversation,[this.toParticipant(d)],l.sessionId)))}catch{}},this.onTranslationReceived=(h,l)=>{try{switch(l.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new u.ConversationTranslationEventArgs(l.payload,void 0,l.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,l)=>{try{if(l.sessionToken!==void 0&&l.sessionToken!==null&&(this.privRoom.token=l.sessionToken),this.privParticipants.participants=[...l.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),l.sessionId)),this.me.isHost){const d=this.privConversationTranslator?.properties.getProperty(u.PropertyId.ConversationTranslator_Name);d!==void 0&&d.length>0&&d!==this.me.displayName&&this.changeNicknameAsync(d)}}catch{}},this.onConversationExpiration=(h,l)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,l)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new u.PropertyCollection,this.privManager=new e.ConversationManager,r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage])||r.setProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=o,this.privConfig=r;const p=r;i.Contracts.throwIfNull(p,"speechConfig"),this.privProperties=p.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const r=this.meetingId,o=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of e.ConversationConnectionConfig.transcriptionEventKeys){const l=this.properties.getProperty(h,"");l!==""&&(c[h]=l)}return{id:r,participants:o,meetingProperties:c}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"authorizationToken"),this.privToken=r}createMeetingAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,(c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=c,this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}startMeetingAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}addParticipantAsync(r,o,c){i.Contracts.throwIfNullOrUndefined(r,"Participant"),(0,t.marshalPromiseToCallbacks)(this.addParticipantImplAsync(r),o,c)}joinMeetingAsync(r,o,c,p,h){try{i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","conversationId")),i.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,r,(l=>{i.Contracts.throwIfNullOrUndefined(l,this.privErrors.permissionDeniedConnect),this.privRoom=l,this.privConfig.authorizationToken=l.cognitiveSpeechAuthToken,p&&p(l.cognitiveSpeechAuthToken)}),(l=>{this.handleError(l,h)}))}catch(l){this.handleError(l,h)}}deleteMeetingAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.deleteMeetingImplAsync(),r,o)}async deleteMeetingImplAsync(){i.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),i.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.endMeetingImplAsync(),r,o)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!0),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}removeParticipantAsync(r,o,c){try{if(i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&r.hasOwnProperty("id"))(0,t.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(r),o,c);else{i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let p="";typeof r=="string"?p=r:r.hasOwnProperty("id")?p=r.id:r.hasOwnProperty("userId")&&(p=r.userId),i.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(l=>l.id===p)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(p),(()=>{this.handleCallback(o,c)}),(l=>{this.handleError(l,c)}))}}catch(p){this.handleError(p,c)}}unlockMeetingAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!1),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}sendTextMessageAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","message")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),r.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}setTranslatedLanguagesAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfArrayEmptyOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","languages")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}changeNicknameAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(r){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await r.enforceAudioGating(),this.privTranscriberRecognizer=r,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){const r=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:r,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(r){if(this.privParticipants.addOrUpdateParticipant(r)!==void 0&&this.privTranscriberRecognizer){const c=this.meetingInfo;return c.participants=[r],this.privTranscriberRecognizer.pushMeetingEvent(c,"join")}}removeParticipantImplAsync(r){this.privParticipants.deleteParticipant(r.id);const o=this.meetingInfo;return o.participants=[r],this.privTranscriberRecognizer.pushMeetingEvent(o,"leave")}async close(r){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(o){throw o}r&&this.dispose()}handleCallback(r,o){if(r){try{r()}catch(c){o&&o(c)}r=void 0}}handleError(r,o){if(o)if(r instanceof Error){const c=r;o(c.name+": "+c.message)}else o(r)}toParticipants(r){const o=this.privParticipants.participants.map(c=>this.toParticipant(c));return r?o:o.filter(c=>c.isHost===!1)}toParticipant(r){return new u.Participant(r.id,r.avatar,r.displayName,r.isHost,r.isMuted,r.isUsingTts,r.preferredLanguage,r.voice)}getMuteAllCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMuteCommand(r,o){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getEjectCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getChangeNicknameCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(r,"nickname"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:r,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMessageCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),i.Contracts.throwIfNullOrWhitespace(r,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:r,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return ye.MeetingImpl=a,ye}var Pr={},zc;function lf(){if(zc)return Pr;zc=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.MeetingTranscriptionCanceledEventArgs=void 0;const e=Hi();class t extends e.CancellationEventArgsBase{}return Pr.MeetingTranscriptionCanceledEventArgs=t,Pr}var Er={},Nc;function vf(){if(Nc)return Er;Nc=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.MeetingTranscriber=void 0;const e=A(),t=T(),i=_(),u=P(),s=Ms();let a=class{constructor(r){this.privAudioConfig=r,this.privProperties=new u.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return u.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,r)}joinMeetingAsync(r,o,c){const p=r;i.Contracts.throwIfNullOrUndefined(s.MeetingImpl,"Meeting"),this.privRecognizer=new e.TranscriberRecognizer(r.config,this.privAudioConfig),i.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),(0,t.marshalPromiseToCallbacks)(p.connectTranscriberRecognizer(this.privRecognizer),o,c)}startTranscribingAsync(r,o){this.privRecognizer.startContinuousRecognitionAsync(r,o)}stopTranscribingAsync(r,o){this.privRecognizer.stopContinuousRecognitionAsync(r,o)}leaveMeetingAsync(r,o){this.privRecognizer.disconnectCallbacks(),(0,t.marshalPromiseToCallbacks)((async()=>{})(),r,o)}close(r,o){i.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(this.privRecognizer&&(await this.privRecognizer.close(),this.privRecognizer=void 0),r&&(this.privDisposedRecognizer=!0))}};return Er.MeetingTranscriber=a,Er}var Ir={},jc;function ff(){if(jc)return Ir;jc=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.ConversationTranscriptionResult=void 0;const e=P();let t=class extends e.RecognitionResult{constructor(u,s,a,n,r,o,c,p,h,l,d){super(u,s,a,n,r,o,c,h,l,d),this.privSpeakerId=p}get speakerId(){return this.privSpeakerId}};return Ir.ConversationTranscriptionResult=t,Ir}var Lc;function Ms(){return Lc||(Lc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationTranscriptionResult=e.MeetingTranscriber=e.MeetingTranscriptionCanceledEventArgs=e.MeetingImpl=e.Meeting=e.ParticipantChangedReason=e.User=e.Participant=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.ConversationCommon=e.ConversationImpl=e.Conversation=void 0;var t=Th();Object.defineProperty(e,"Conversation",{enumerable:!0,get:function(){return t.Conversation}}),Object.defineProperty(e,"ConversationImpl",{enumerable:!0,get:function(){return t.ConversationImpl}});var i=ef();Object.defineProperty(e,"ConversationCommon",{enumerable:!0,get:function(){return i.ConversationCommon}});var u=tf();Object.defineProperty(e,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return u.ConversationExpirationEventArgs}});var s=rf();Object.defineProperty(e,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return s.ConversationParticipantsChangedEventArgs}});var a=nf();Object.defineProperty(e,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return a.ConversationTranslationCanceledEventArgs}});var n=sf();Object.defineProperty(e,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return n.ConversationTranslationEventArgs}});var r=of();Object.defineProperty(e,"ConversationTranslationResult",{enumerable:!0,get:function(){return r.ConversationTranslationResult}});var o=cf();Object.defineProperty(e,"ConversationTranslator",{enumerable:!0,get:function(){return o.ConversationTranslator}});var c=uf();Object.defineProperty(e,"ConversationTranscriber",{enumerable:!0,get:function(){return c.ConversationTranscriber}});var p=pf();Object.defineProperty(e,"Participant",{enumerable:!0,get:function(){return p.Participant}}),Object.defineProperty(e,"User",{enumerable:!0,get:function(){return p.User}});var h=hf();Object.defineProperty(e,"ParticipantChangedReason",{enumerable:!0,get:function(){return h.ParticipantChangedReason}});var l=df();Object.defineProperty(e,"Meeting",{enumerable:!0,get:function(){return l.Meeting}}),Object.defineProperty(e,"MeetingImpl",{enumerable:!0,get:function(){return l.MeetingImpl}});var d=lf();Object.defineProperty(e,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return d.MeetingTranscriptionCanceledEventArgs}});var g=vf();Object.defineProperty(e,"MeetingTranscriber",{enumerable:!0,get:function(){return g.MeetingTranscriber}});var f=ff();Object.defineProperty(e,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return f.ConversationTranscriptionResult}})})(jn)),jn}var Re={},qc;function Os(){if(qc)return Re;qc=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.SynthesisRequest=Re.Synthesizer=void 0;const e=A(),t=T(),i=_(),u=P();let s=class Mh{constructor(r){const o=r;i.Contracts.throwIfNull(o,"speechConfig"),this.privProperties=o.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new t.Queue,this.tokenCredential=r.tokenCredential}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,r)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(u.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===e.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(r){const o={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-AvaMultilingualNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let c=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),p=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_SynthVoice,""),h=Mh.XMLEncode(r);return this.autoDetectSourceLanguage?c="en-US":p=p||o[c],p&&(h=`<voice name='${p}'>${h}</voice>`),h=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${c}'>${h}</speak>`,h}async dispose(r){this.privDisposed||(r&&this.privAdapter&&await this.privAdapter.dispose(),this.privDisposed=!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const r=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(r.text,r.isSSML,r.requestId,r.cb,r.err,r.dataStream)}}createSynthesizerConfig(r){return new e.SynthesizerConfig(r,this.privProperties)}implCommonSynthesizeSetup(){let r=typeof window<"u"?"Browser":"Node",o="unknown",c="unknown";typeof navigator<"u"&&(r=r+"/"+navigator.platform,o=navigator.userAgent,c=navigator.appVersion);const p=this.createSynthesizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(r,o,c)))),h=this.privProperties.getProperty(u.PropertyId.SpeechServiceConnection_Key,void 0),l=h&&h!==""?new e.CognitiveSubscriptionKeyAuthentication(h):this.tokenCredential?new e.CognitiveTokenAuthentication(async()=>{try{return(await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(d){throw d}},async()=>{try{return(await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(d){throw d}}):new e.CognitiveTokenAuthentication(()=>{const d=this.privProperties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(d)},()=>{const d=this.privProperties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(d)});this.privAdapter=this.createSynthesisAdapter(l,this.privConnectionFactory,p),this.privRestAdapter=this.createRestSynthesisAdapter(l,p)}static XMLEncode(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};Re.Synthesizer=s;class a{constructor(r,o,c,p,h,l){this.requestId=r,this.text=o,this.isSSML=c,this.cb=p,this.err=h,this.dataStream=l}}return Re.SynthesisRequest=a,Re}var Ar={},Bc;function gf(){if(Bc)return Ar;Bc=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.SpeechSynthesizer=void 0;const e=A(),t=T(),i=nh(),u=Vi(),s=ke(),a=_(),n=P(),r=Os();let o=class Oh extends n.Synthesizer{constructor(p,h){super(p),h!==null&&(h===void 0?this.audioConfig=typeof window>"u"?void 0:n.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=h),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(p,h,l){const d=p;return h.properties.mergeTo(d.properties),new Oh(p,l)}speakTextAsync(p,h,l,d){this.speakImpl(p,!1,h,l,d)}speakSsmlAsync(p,h,l,d){this.speakImpl(p,!0,h,l,d)}async getVoicesAsync(p=""){return this.getVoices(p)}close(p,h){a.Contracts.throwIfDisposed(this.privDisposed),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),p,h)}get internalData(){return this.privAdapter}createSynthesisAdapter(p,h,l){return new e.SpeechSynthesisAdapter(p,h,l,this,this.audioConfig)}createRestSynthesisAdapter(p,h){return new e.SynthesisRestAdapter(h,p)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(n.SpeechSynthesisOutputFormat[this.properties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(p,h,l,d,g){try{a.Contracts.throwIfDisposed(this.privDisposed);const f=(0,t.createNoDashGuid)();let S;g instanceof n.PushAudioOutputStreamCallback?S=new s.PushAudioOutputStreamImpl(g):g instanceof n.PullAudioOutputStream?S=g:g!==void 0?S=new i.AudioFileWriter(g):S=void 0,this.synthesisRequestQueue.enqueue(new r.SynthesisRequest(f,p,h,v=>{if(this.privSynthesizing=!1,l)try{l(v)}catch(m){d&&d(m)}l=void 0,this.adapterSpeak().catch(()=>{})},v=>{d&&d(v)},S)),this.adapterSpeak().catch(()=>{})}catch(f){if(d)if(f instanceof Error){const S=f;d(S.name+": "+S.message)}else d(f);this.dispose(!0).catch(()=>{})}}async getVoices(p){const h=(0,t.createNoDashGuid)(),l=await this.privRestAdapter.getVoicesList(h);if(l.ok&&Array.isArray(l.json)){let d=l.json;return p&&p.length>0&&(d=d.filter(g=>!!g.Locale&&g.Locale.toLowerCase()===p.toLowerCase())),new n.SynthesisVoicesResult(h,d,void 0)}else return new n.SynthesisVoicesResult(h,void 0,`Error: ${l.status}: ${l.statusText}`)}};return Ar.SpeechSynthesizer=o,Ar}var Tr={},Fc;function Sf(){if(Fc)return Tr;Fc=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.SynthesisResult=void 0;let e=class{constructor(i,u,s,a){this.privResultId=i,this.privReason=u,this.privErrorDetails=s,this.privProperties=a}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}};return Tr.SynthesisResult=e,Tr}var wr={},xc;function mf(){if(xc)return wr;xc=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.SpeechSynthesisResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,s,a,n,r,o){super(u,s,n,r),this.privAudioData=a,this.privAudioDuration=o}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};return wr.SpeechSynthesisResult=t,wr}var _r={},Uc;function Cf(){if(Uc)return _r;Uc=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.SpeechSynthesisEventArgs=void 0;let e=class{constructor(i){this.privResult=i}get result(){return this.privResult}};return _r.SpeechSynthesisEventArgs=e,_r}var br={},Wc;function yf(){if(Wc)return br;Wc=1,Object.defineProperty(br,"__esModule",{value:!0}),br.SpeechSynthesisWordBoundaryEventArgs=void 0;let e=class{constructor(i,u,s,a,n,r){this.privAudioOffset=i,this.privDuration=u,this.privText=s,this.privWordLength=a,this.privTextOffset=n,this.privBoundaryType=r}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}};return br.SpeechSynthesisWordBoundaryEventArgs=e,br}var Mr={},Vc;function Rf(){if(Vc)return Mr;Vc=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.SpeechSynthesisBookmarkEventArgs=void 0;let e=class{constructor(i,u){this.privAudioOffset=i,this.privText=u}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}};return Mr.SpeechSynthesisBookmarkEventArgs=e,Mr}var Or={},Hc;function Pf(){if(Hc)return Or;Hc=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.SpeechSynthesisVisemeEventArgs=void 0;let e=class{constructor(i,u,s){this.privAudioOffset=i,this.privVisemeId=u,this.privAnimation=s}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}};return Or.SpeechSynthesisVisemeEventArgs=e,Or}var Bn={},Kc;function Ef(){return Kc||(Kc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechSynthesisBoundaryType=void 0,(function(t){t.Word="WordBoundary",t.Punctuation="PunctuationBoundary",t.Sentence="SentenceBoundary"})(e.SpeechSynthesisBoundaryType||(e.SpeechSynthesisBoundaryType={}))})(Bn)),Bn}var Dr={},$c;function If(){if($c)return Dr;$c=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.SynthesisVoicesResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,s,a){if(Array.isArray(s)){super(u,e.ResultReason.VoicesListRetrieved,void 0,new e.PropertyCollection),this.privVoices=[];for(const n of s)this.privVoices.push(new e.VoiceInfo(n))}else super(u,e.ResultReason.Canceled,a||"Error information unavailable",new e.PropertyCollection)}get voices(){return this.privVoices}};return Dr.SynthesisVoicesResult=t,Dr}var Fn={},Jc;function Af(){return Jc||(Jc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=void 0;var t;(function(n){n[n.Unknown=0]="Unknown",n[n.Female=1]="Female",n[n.Male=2]="Male",n[n.Neutral=3]="Neutral"})(t=e.SynthesisVoiceGender||(e.SynthesisVoiceGender={}));var i;(function(n){n[n.Unknown=0]="Unknown",n[n.OnlineNeural=1]="OnlineNeural",n[n.OnlineStandard=2]="OnlineStandard",n[n.OfflineNeural=3]="OfflineNeural",n[n.OfflineStandard=4]="OfflineStandard",n[n.OnlineNeuralHD=5]="OnlineNeuralHD"})(i=e.SynthesisVoiceType||(e.SynthesisVoiceType={}));const u={[t[t.Neutral]]:t.Neutral,[t[t.Male]]:t.Male,[t[t.Female]]:t.Female},s={Neural:i.OnlineNeural,NeuralHD:i.OnlineNeuralHD};class a{constructor(r){if(this.privStyleList=[],r){if(this.privName=r.Name,this.privLocale=r.Locale,this.privShortName=r.ShortName,this.privLocaleName=r.LocaleName,this.privDisplayName=r.DisplayName,this.privLocalName=r.LocalName,this.privVoiceType=s[r.VoiceType]||i.Unknown,this.privGender=u[r.Gender]||t.Unknown,r.StyleList&&Array.isArray(r.StyleList))for(const o of r.StyleList)this.privStyleList.push(o);this.privSampleRateHertz=r.SampleRateHertz,this.privStatus=r.Status,r.ExtendedPropertyMap&&(this.privExtendedPropertyMap=r.ExtendedPropertyMap),this.privWordsPerMinute=r.WordsPerMinute,Array.isArray(r.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...r.SecondaryLocaleList]),Array.isArray(r.RolePlayList)&&(this.privRolePlayList=[...r.RolePlayList]),r.VoiceTag&&(this.privVoiceTag=r.VoiceTag)}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}get voiceTag(){return this.privVoiceTag}}e.VoiceInfo=a})(Fn)),Fn}var kr={},Gc;function Tf(){if(Gc)return kr;Gc=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.SpeakerAudioDestination=void 0;const e=T(),t=ke(),i=Me(),u=1800,s={[i.AudioFormatTag.PCM]:"audio/wav",[i.AudioFormatTag.MuLaw]:"audio/x-wav",[i.AudioFormatTag.MP3]:"audio/mpeg",[i.AudioFormatTag.OGG_OPUS]:"audio/ogg",[i.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[i.AudioFormatTag.ALaw]:"audio/x-wav",[i.AudioFormatTag.FLAC]:"audio/flac",[i.AudioFormatTag.AMR_WB]:"audio/amr-wb",[i.AudioFormatTag.G722]:"audio/G722"};let a=class{constructor(r){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=r||(0,e.createNoDashGuid)(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(r,o,c){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(r),this.updateSourceBuffer().then(()=>{o&&o()},p=>{c&&c(p)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(r),this.privBytesReceived+=r.byteLength)}close(r,o){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{r&&r()},c=>{o&&o(c)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===i.AudioFormatTag.PCM||this.privFormat.formatTag===i.AudioFormatTag.MuLaw||this.privFormat.formatTag===i.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let c=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(c).then(()=>{c=this.privFormat.addHeader(c);const p=new Blob([c],{type:s[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(p),this.notifyPlayback().then(()=>{r&&r()},h=>{o&&o(h)})},p=>{o&&o(p)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(r){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=r;const o=s[this.privFormat.formatTag];o===void 0?console.warn(`Unknown mimeType for format ${i.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(o)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=u,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(o),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})):(console.warn(`Format ${i.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new t.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){return this.privAudio?.volume??-1}set volume(r){this.privAudio&&(this.privAudio.volume=r)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(r,o){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{r&&r()},c=>{o&&o(c)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const r=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(r)}catch{this.privAudioBuffer.unshift(r),console.log("buffer filled, pausing addition of binaries until space is made");return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}};return kr.SpeakerAudioDestination=a,kr}var zr={},Qc;function wf(){if(Qc)return zr;Qc=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.ConversationTranscriptionCanceledEventArgs=void 0;const e=Hi();let t=class extends e.CancellationEventArgsBase{};return zr.ConversationTranscriptionCanceledEventArgs=t,zr}var Nr={},Xc;function _f(){if(Xc)return Nr;Xc=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.MeetingTranscriptionCanceledEventArgs=void 0;const e=Hi();let t=class extends e.CancellationEventArgsBase{};return Nr.MeetingTranscriptionCanceledEventArgs=t,Nr}var xn={},Zc;function bf(){return Zc||(Zc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PronunciationAssessmentGradingSystem=void 0,(function(t){t[t.FivePoint=1]="FivePoint",t[t.HundredMark=2]="HundredMark"})(e.PronunciationAssessmentGradingSystem||(e.PronunciationAssessmentGradingSystem={}))})(xn)),xn}var Un={},Yc;function Mf(){return Yc||(Yc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PronunciationAssessmentGranularity=void 0,(function(t){t[t.Phoneme=1]="Phoneme",t[t.Word=2]="Word",t[t.FullText=3]="FullText"})(e.PronunciationAssessmentGranularity||(e.PronunciationAssessmentGranularity={}))})(Un)),Un}var jr={},eu;function Of(){if(eu)return jr;eu=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.PronunciationAssessmentConfig=void 0;const e=_(),t=P();let i=class Dh{constructor(s,a=t.PronunciationAssessmentGradingSystem.FivePoint,n=t.PronunciationAssessmentGranularity.Phoneme,r=!1){e.Contracts.throwIfNullOrUndefined(s,"referenceText"),this.privProperties=new t.PropertyCollection,this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_ReferenceText,s),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_GradingSystem,t.PronunciationAssessmentGradingSystem[a]),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_Granularity,t.PronunciationAssessmentGranularity[n]),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,String(r))}static fromJSON(s){e.Contracts.throwIfNullOrUndefined(s,"json");const a=new Dh("");return a.privProperties=new t.PropertyCollection,a.properties.setProperty(t.PropertyId.PronunciationAssessment_Json,s),a}toJSON(){return this.updateJson(),this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Params)}applyTo(s){this.updateJson();const a=s.internalData;a.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(t.PropertyId.PronunciationAssessment_Params),a.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(t.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(s){e.Contracts.throwIfNullOrWhitespace(s,"referenceText"),this.properties.setProperty(t.PropertyId.PronunciationAssessment_ReferenceText,s)}set phonemeAlphabet(s){e.Contracts.throwIfNullOrWhitespace(s,"phonemeAlphabet"),this.privPhonemeAlphabet=s}set enableMiscue(s){const a=s?"true":"false";this.properties.setProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,a)}get enableMiscue(){return this.properties.getProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(s){this.privNBestPhonemeCount=s}set enableProsodyAssessment(s){this.privEnableProsodyAssessment=s}get properties(){return this.privProperties}updateJson(){const s=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Json,"{}"),a=JSON.parse(s),n=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_ReferenceText);n&&(a.referenceText=n);const r=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_GradingSystem);r&&(a.gradingSystem=r);const o=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Granularity);o&&(a.granularity=o),this.privPhonemeAlphabet&&(a.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(a.nbestPhonemeCount=this.privNBestPhonemeCount),a.enableProsodyAssessment=this.privEnableProsodyAssessment,a.dimension="Comprehensive",this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_EnableMiscue)&&(a.enableMiscue=this.enableMiscue),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_Params,JSON.stringify(a))}};return jr.PronunciationAssessmentConfig=i,jr}var Lr={},tu;function Df(){if(tu)return Lr;tu=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.PronunciationAssessmentResult=void 0;const e=_(),t=P();let i=class kh{constructor(s){const a=JSON.parse(s);e.Contracts.throwIfNullOrUndefined(a.NBest[0],"NBest"),this.privPronJson=a.NBest[0]}static fromResult(s){e.Contracts.throwIfNullOrUndefined(s,"result");const a=s.properties.getProperty(t.PropertyId.SpeechServiceResponse_JsonResult);return e.Contracts.throwIfNullOrUndefined(a,"json"),new kh(a)}get detailResult(){return this.privPronJson}get accuracyScore(){return this.detailResult.PronunciationAssessment?.AccuracyScore}get pronunciationScore(){return this.detailResult.PronunciationAssessment?.PronScore}get completenessScore(){return this.detailResult.PronunciationAssessment?.CompletenessScore}get fluencyScore(){return this.detailResult.PronunciationAssessment?.FluencyScore}get prosodyScore(){return this.detailResult.PronunciationAssessment?.ProsodyScore}};return Lr.PronunciationAssessmentResult=i,Lr}var qr={},ru;function kf(){if(ru)return qr;ru=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.AvatarConfig=void 0;const e=_(),t=P();let i=class{constructor(s,a,n){this.privCustomized=!1,this.privUseBuiltInVoice=!1,e.Contracts.throwIfNullOrWhitespace(s,"character"),this.character=s,this.style=a,n===void 0&&(n=new t.AvatarVideoFormat),this.videoFormat=n}get customized(){return this.privCustomized}set customized(s){this.privCustomized=s}get useBuiltInVoice(){return this.privUseBuiltInVoice}set useBuiltInVoice(s){this.privUseBuiltInVoice=s}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(s){this.privBackgroundColor=s}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(s){this.privBackgroundImage=s}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(s){this.privRemoteIceServers=s}};return qr.AvatarConfig=i,qr}var Wn={},iu;function zf(){return iu||(iu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AvatarEventArgs=e.AvatarEventTypes=void 0,(function(i){i.SwitchedToSpeaking="SwitchedToSpeaking",i.SwitchedToIdle="SwitchedToIdle",i.SessionClosed="SessionClosed"})(e.AvatarEventTypes||(e.AvatarEventTypes={}));class t{constructor(u,s){this.privOffset=u,this.privDescription=s}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}e.AvatarEventArgs=t})(Wn)),Wn}var Br={},Fr={},nu;function zh(){if(nu)return Fr;nu=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.SpeechSynthesisConnectionFactory=void 0;const e=N(),t=P(),i=J(),u=A(),s=q(),a=ne();let n=class{constructor(){this.synthesisUri="/tts/cognitiveservices/websocket/v1"}async create(o,c,p){let h=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,void 0),d=i.ConnectionFactoryBase.getHostSuffix(l),g=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),f=g===void 0?"tts":"voice",S=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+l+"."+f+".speech"+d),v={},m={};if(c.token!==void 0&&c.token!==""&&(m[c.headerName]=c.token),m[s.HeaderNames.ConnectionId]=p,g!==void 0&&g!==""&&(!h||h.search(a.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(v[a.QueryParameterNames.CustomVoiceDeploymentId]=g),o.avatarEnabled&&(!h||h.search(a.QueryParameterNames.EnableAvatar)===-1)&&(v[a.QueryParameterNames.EnableAvatar]="true"),h){const y=new URL(h),R=y.pathname;(R===""||R==="/")&&(y.pathname=this.synthesisUri,h=await i.ConnectionFactoryBase.getRedirectUrlFromEndpoint(y.toString()))}h||(h=S+this.synthesisUri),o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,h);const C=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new e.WebsocketConnection(h,v,m,new u.WebsocketMessageFormatter,e.ProxyInfo.fromParameters(o.parameters),C,p)}};return Fr.SpeechSynthesisConnectionFactory=n,Fr}var su;function Nf(){if(su)return Br;su=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.AvatarSynthesizer=void 0;const e=zh(),t=A(),i=T(),u=Vi(),s=P(),a=_(),n=Os();let r=class extends s.Synthesizer{constructor(c,p){super(c),a.Contracts.throwIfNullOrUndefined(p,"avatarConfig"),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.privAvatarConfig=p,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(s.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(c){a.Contracts.throwIfNullOrUndefined(c,"peerConnection"),this.privIceServers=c.getConfiguration().iceServers,a.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const p=new i.Deferred;c.onicegatheringstatechange=()=>{i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering state: "+c.iceGatheringState,i.EventType.Debug)),c.iceGatheringState==="complete"&&(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering complete.",i.EventType.Info)),p.resolve())},c.onicecandidate=f=>{f.candidate?i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice candidate: "+f.candidate.candidate,i.EventType.Debug)):(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice candidate: complete",i.EventType.Debug)),p.resolve())},setTimeout(()=>{c.iceGatheringState!=="complete"&&(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering timeout.",i.EventType.Warning)),p.resolve())},2e3);const h=await c.createOffer();await c.setLocalDescription(h),await p.promise,i.Events.instance.onEvent(new i.PlatformEvent("peer connection: got local SDP.",i.EventType.Info)),this.privProperties.setProperty(s.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(c.localDescription));const l=await this.speak("",!1);if(l.reason!==s.ResultReason.SynthesizingAudioCompleted)return new s.SynthesisResult(l.resultId,l.reason,l.errorDetails,l.properties);const d=atob(l.properties.getProperty(s.PropertyId.TalkingAvatarService_WebRTC_SDP)),g=new RTCSessionDescription(JSON.parse(d));return await c.setRemoteDescription(g),new s.SynthesisResult(l.resultId,l.reason,void 0,l.properties)}async speakTextAsync(c){const p=await this.speak(c,!1);return new s.SynthesisResult(p.resultId,p.reason,p.errorDetails,p.properties)}async speakSsmlAsync(c){const p=await this.speak(c,!0);return new s.SynthesisResult(p.resultId,p.reason,p.errorDetails,p.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return a.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(c,p,h){return new t.AvatarSynthesisAdapter(c,p,h,this,this.privAvatarConfig)}createRestSynthesisAdapter(c,p){}createSynthesizerConfig(c){const p=super.createSynthesizerConfig(c);return p.avatarEnabled=!0,p}async speak(c,p){const h=(0,i.createNoDashGuid)(),l=new i.Deferred;return this.synthesisRequestQueue.enqueue(new n.SynthesisRequest(h,c,p,d=>{l.resolve(d),this.privSynthesizing=!1,this.adapterSpeak()},d=>{l.reject(d),this.privSynthesizing=!1})),this.adapterSpeak(),l.promise}};return Br.AvatarSynthesizer=r,Br}var Pe={},ou;function jf(){if(ou)return Pe;ou=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.AvatarVideoFormat=Pe.Coordinate=void 0;class e{constructor(u,s){this.x=u,this.y=s}}Pe.Coordinate=e;let t=class{constructor(u="H264",s=2e6,a=1920,n=1080){this.codec=u,this.bitrate=s,this.width=a,this.height=n}setCropRange(u,s){this.cropRange={bottomRight:s,topLeft:u}}};return Pe.AvatarVideoFormat=t,Pe}var xr={},au;function Lf(){if(au)return xr;au=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.AvatarWebRTCConnectionResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,s,a,n,r){super(s,a,n,r),this.privSDPAnswer=u}get SDPAnswer(){return this.privSDPAnswer}};return xr.AvatarWebRTCConnectionResult=t,xr}var Ur={},cu;function qf(){if(cu)return Ur;cu=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.Diagnostics=void 0;const e=N(),t=T();let i=class{static SetLoggingLevel(s){this.privListener=new e.ConsoleLoggingListener(s),t.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(s){if(typeof window>"u")this.privListener&&(this.privListener.logPath=s);else throw new Error("File system logging not available in browser.")}static set onLogOutput(s){this.privListener&&(this.privListener.logCallback=s)}};return Ur.Diagnostics=i,i.privListener=void 0,Ur}var uu;function P(){return uu||(uu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionEventArgs=e.CancellationErrorCode=e.CancellationDetails=e.CancellationDetailsBase=e.IntentRecognitionCanceledEventArgs=e.TranslationRecognitionCanceledEventArgs=e.NoMatchDetails=e.NoMatchReason=e.Translations=e.TranslationRecognizer=e.VoiceProfileType=e.IntentRecognizer=e.SpeechRecognizer=e.Recognizer=e.PropertyId=e.PropertyCollection=e.SpeechTranslationConfigImpl=e.SpeechTranslationConfig=e.SpeechConfigImpl=e.SpeechConfig=e.ResultReason=e.TranslationSynthesisResult=e.TranslationRecognitionResult=e.TranslationSynthesisEventArgs=e.TranslationRecognitionEventArgs=e.SpeechRecognitionCanceledEventArgs=e.MeetingTranscriptionEventArgs=e.ConversationTranscriptionEventArgs=e.SpeechRecognitionEventArgs=e.LanguageUnderstandingModel=e.IntentRecognitionResult=e.SpeechRecognitionResult=e.RecognitionResult=e.IntentRecognitionEventArgs=e.OutputFormat=e.RecognitionEventArgs=e.SessionEventArgs=e.KeywordRecognitionModel=e.PushAudioOutputStreamCallback=e.PullAudioInputStreamCallback=e.CancellationReason=e.PushAudioOutputStream=e.PullAudioOutputStream=e.AudioOutputStream=e.PushAudioInputStream=e.PullAudioInputStream=e.AudioInputStream=e.AudioFormatTag=e.AudioStreamFormat=e.AudioConfig=void 0,e.SpeechSynthesisEventArgs=e.SpeechSynthesisResult=e.SynthesisResult=e.SpeechSynthesizer=e.SpeechSynthesisOutputFormat=e.Synthesizer=e.User=e.ParticipantChangedReason=e.Participant=e.MeetingTranscriber=e.Meeting=e.ConversationTranscriptionResult=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.Conversation=e.SpeakerRecognitionCancellationDetails=e.SpeakerRecognitionResultType=e.SpeakerRecognitionResult=e.SourceLanguageConfig=e.AutoDetectSourceLanguageResult=e.AutoDetectSourceLanguageConfig=e.SpeakerVerificationModel=e.SpeakerIdentificationModel=e.SpeakerRecognizer=e.VoiceProfileClient=e.VoiceProfilePhraseResult=e.VoiceProfileCancellationDetails=e.VoiceProfileResult=e.VoiceProfileEnrollmentCancellationDetails=e.VoiceProfileEnrollmentResult=e.VoiceProfile=e.ConnectionMessage=e.ConnectionMessageEventArgs=e.BaseAudioPlayer=e.ProfanityOption=e.ServicePropertyChannel=e.TurnStatusReceivedEventArgs=e.ActivityReceivedEventArgs=e.DialogServiceConnector=e.CustomCommandsConfig=e.BotFrameworkConfig=e.DialogServiceConfig=e.PhraseListGrammar=e.Connection=e.ServiceEventArgs=void 0,e.LogLevel=e.Diagnostics=e.AvatarWebRTCConnectionResult=e.Coordinate=e.AvatarVideoFormat=e.AvatarSynthesizer=e.AvatarEventArgs=e.AvatarConfig=e.LanguageIdMode=e.PronunciationAssessmentResult=e.PronunciationAssessmentConfig=e.PronunciationAssessmentGranularity=e.PronunciationAssessmentGradingSystem=e.MeetingTranscriptionCanceledEventArgs=e.ConversationTranscriptionCanceledEventArgs=e.SpeakerAudioDestination=e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=e.SynthesisVoicesResult=e.SpeechSynthesisBoundaryType=e.SpeechSynthesisVisemeEventArgs=e.SpeechSynthesisBookmarkEventArgs=e.SpeechSynthesisWordBoundaryEventArgs=void 0;var t=ch();Object.defineProperty(e,"AudioConfig",{enumerable:!0,get:function(){return t.AudioConfig}});var i=Me();Object.defineProperty(e,"AudioStreamFormat",{enumerable:!0,get:function(){return i.AudioStreamFormat}}),Object.defineProperty(e,"AudioFormatTag",{enumerable:!0,get:function(){return i.AudioFormatTag}});var u=sh();Object.defineProperty(e,"AudioInputStream",{enumerable:!0,get:function(){return u.AudioInputStream}}),Object.defineProperty(e,"PullAudioInputStream",{enumerable:!0,get:function(){return u.PullAudioInputStream}}),Object.defineProperty(e,"PushAudioInputStream",{enumerable:!0,get:function(){return u.PushAudioInputStream}});var s=ke();Object.defineProperty(e,"AudioOutputStream",{enumerable:!0,get:function(){return s.AudioOutputStream}}),Object.defineProperty(e,"PullAudioOutputStream",{enumerable:!0,get:function(){return s.PullAudioOutputStream}}),Object.defineProperty(e,"PushAudioOutputStream",{enumerable:!0,get:function(){return s.PushAudioOutputStream}});var a=Ql();Object.defineProperty(e,"CancellationReason",{enumerable:!0,get:function(){return a.CancellationReason}});var n=Xl();Object.defineProperty(e,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return n.PullAudioInputStreamCallback}});var r=Zl();Object.defineProperty(e,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return r.PushAudioOutputStreamCallback}});var o=Yl();Object.defineProperty(e,"KeywordRecognitionModel",{enumerable:!0,get:function(){return o.KeywordRecognitionModel}});var c=ev();Object.defineProperty(e,"SessionEventArgs",{enumerable:!0,get:function(){return c.SessionEventArgs}});var p=tv();Object.defineProperty(e,"RecognitionEventArgs",{enumerable:!0,get:function(){return p.RecognitionEventArgs}});var h=rv();Object.defineProperty(e,"OutputFormat",{enumerable:!0,get:function(){return h.OutputFormat}});var l=iv();Object.defineProperty(e,"IntentRecognitionEventArgs",{enumerable:!0,get:function(){return l.IntentRecognitionEventArgs}});var d=nv();Object.defineProperty(e,"RecognitionResult",{enumerable:!0,get:function(){return d.RecognitionResult}});var g=sv();Object.defineProperty(e,"SpeechRecognitionResult",{enumerable:!0,get:function(){return g.SpeechRecognitionResult}});var f=ov();Object.defineProperty(e,"IntentRecognitionResult",{enumerable:!0,get:function(){return f.IntentRecognitionResult}});var S=av();Object.defineProperty(e,"LanguageUnderstandingModel",{enumerable:!0,get:function(){return S.LanguageUnderstandingModel}});var v=cv();Object.defineProperty(e,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return v.SpeechRecognitionEventArgs}}),Object.defineProperty(e,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return v.ConversationTranscriptionEventArgs}}),Object.defineProperty(e,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return v.MeetingTranscriptionEventArgs}});var m=uv();Object.defineProperty(e,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return m.SpeechRecognitionCanceledEventArgs}});var C=pv();Object.defineProperty(e,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return C.TranslationRecognitionEventArgs}});var y=hv();Object.defineProperty(e,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return y.TranslationSynthesisEventArgs}});var R=ph();Object.defineProperty(e,"TranslationRecognitionResult",{enumerable:!0,get:function(){return R.TranslationRecognitionResult}});var I=dv();Object.defineProperty(e,"TranslationSynthesisResult",{enumerable:!0,get:function(){return I.TranslationSynthesisResult}});var w=lv();Object.defineProperty(e,"ResultReason",{enumerable:!0,get:function(){return w.ResultReason}});var E=vv();Object.defineProperty(e,"SpeechConfig",{enumerable:!0,get:function(){return E.SpeechConfig}}),Object.defineProperty(e,"SpeechConfigImpl",{enumerable:!0,get:function(){return E.SpeechConfigImpl}});var M=fv();Object.defineProperty(e,"SpeechTranslationConfig",{enumerable:!0,get:function(){return M.SpeechTranslationConfig}}),Object.defineProperty(e,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return M.SpeechTranslationConfigImpl}});var D=dh();Object.defineProperty(e,"PropertyCollection",{enumerable:!0,get:function(){return D.PropertyCollection}});var W=_s();Object.defineProperty(e,"PropertyId",{enumerable:!0,get:function(){return W.PropertyId}});var Oe=gv();Object.defineProperty(e,"Recognizer",{enumerable:!0,get:function(){return Oe.Recognizer}});var j=Sv();Object.defineProperty(e,"SpeechRecognizer",{enumerable:!0,get:function(){return j.SpeechRecognizer}});var zs=mv();Object.defineProperty(e,"IntentRecognizer",{enumerable:!0,get:function(){return zs.IntentRecognizer}});var Qh=Cv();Object.defineProperty(e,"VoiceProfileType",{enumerable:!0,get:function(){return Qh.VoiceProfileType}});var Xh=yv();Object.defineProperty(e,"TranslationRecognizer",{enumerable:!0,get:function(){return Xh.TranslationRecognizer}});var Zh=Rv();Object.defineProperty(e,"Translations",{enumerable:!0,get:function(){return Zh.Translations}});var Yh=Pv();Object.defineProperty(e,"NoMatchReason",{enumerable:!0,get:function(){return Yh.NoMatchReason}});var ed=Ev();Object.defineProperty(e,"NoMatchDetails",{enumerable:!0,get:function(){return ed.NoMatchDetails}});var td=Iv();Object.defineProperty(e,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return td.TranslationRecognitionCanceledEventArgs}});var rd=Av();Object.defineProperty(e,"IntentRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return rd.IntentRecognitionCanceledEventArgs}});var id=Ch();Object.defineProperty(e,"CancellationDetailsBase",{enumerable:!0,get:function(){return id.CancellationDetailsBase}});var nd=Tv();Object.defineProperty(e,"CancellationDetails",{enumerable:!0,get:function(){return nd.CancellationDetails}});var sd=wv();Object.defineProperty(e,"CancellationErrorCode",{enumerable:!0,get:function(){return sd.CancellationErrorCode}});var od=_v();Object.defineProperty(e,"ConnectionEventArgs",{enumerable:!0,get:function(){return od.ConnectionEventArgs}});var ad=bv();Object.defineProperty(e,"ServiceEventArgs",{enumerable:!0,get:function(){return ad.ServiceEventArgs}});var cd=gh();Object.defineProperty(e,"Connection",{enumerable:!0,get:function(){return cd.Connection}});var ud=Mv();Object.defineProperty(e,"PhraseListGrammar",{enumerable:!0,get:function(){return ud.PhraseListGrammar}});var pd=bs();Object.defineProperty(e,"DialogServiceConfig",{enumerable:!0,get:function(){return pd.DialogServiceConfig}});var hd=Ov();Object.defineProperty(e,"BotFrameworkConfig",{enumerable:!0,get:function(){return hd.BotFrameworkConfig}});var dd=Dv();Object.defineProperty(e,"CustomCommandsConfig",{enumerable:!0,get:function(){return dd.CustomCommandsConfig}});var ld=zv();Object.defineProperty(e,"DialogServiceConnector",{enumerable:!0,get:function(){return ld.DialogServiceConnector}});var vd=Nv();Object.defineProperty(e,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return vd.ActivityReceivedEventArgs}});var fd=Lv();Object.defineProperty(e,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return fd.TurnStatusReceivedEventArgs}});var gd=qv();Object.defineProperty(e,"ServicePropertyChannel",{enumerable:!0,get:function(){return gd.ServicePropertyChannel}});var Sd=Bv();Object.defineProperty(e,"ProfanityOption",{enumerable:!0,get:function(){return Sd.ProfanityOption}});var md=Fv();Object.defineProperty(e,"BaseAudioPlayer",{enumerable:!0,get:function(){return md.BaseAudioPlayer}});var Cd=xv();Object.defineProperty(e,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return Cd.ConnectionMessageEventArgs}});var yd=fh();Object.defineProperty(e,"ConnectionMessage",{enumerable:!0,get:function(){return yd.ConnectionMessage}});var Rd=Uv();Object.defineProperty(e,"VoiceProfile",{enumerable:!0,get:function(){return Rd.VoiceProfile}});var Ns=Wv();Object.defineProperty(e,"VoiceProfileEnrollmentResult",{enumerable:!0,get:function(){return Ns.VoiceProfileEnrollmentResult}}),Object.defineProperty(e,"VoiceProfileEnrollmentCancellationDetails",{enumerable:!0,get:function(){return Ns.VoiceProfileEnrollmentCancellationDetails}});var js=Vv();Object.defineProperty(e,"VoiceProfileResult",{enumerable:!0,get:function(){return js.VoiceProfileResult}}),Object.defineProperty(e,"VoiceProfileCancellationDetails",{enumerable:!0,get:function(){return js.VoiceProfileCancellationDetails}});var Pd=Hv();Object.defineProperty(e,"VoiceProfilePhraseResult",{enumerable:!0,get:function(){return Pd.VoiceProfilePhraseResult}});var Ed=Kv();Object.defineProperty(e,"VoiceProfileClient",{enumerable:!0,get:function(){return Ed.VoiceProfileClient}});var Id=$v();Object.defineProperty(e,"SpeakerRecognizer",{enumerable:!0,get:function(){return Id.SpeakerRecognizer}});var Ad=Jv();Object.defineProperty(e,"SpeakerIdentificationModel",{enumerable:!0,get:function(){return Ad.SpeakerIdentificationModel}});var Td=Gv();Object.defineProperty(e,"SpeakerVerificationModel",{enumerable:!0,get:function(){return Td.SpeakerVerificationModel}});var wd=Qv();Object.defineProperty(e,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return wd.AutoDetectSourceLanguageConfig}});var _d=Xv();Object.defineProperty(e,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return _d.AutoDetectSourceLanguageResult}});var bd=Zv();Object.defineProperty(e,"SourceLanguageConfig",{enumerable:!0,get:function(){return bd.SourceLanguageConfig}});var Xi=Yv();Object.defineProperty(e,"SpeakerRecognitionResult",{enumerable:!0,get:function(){return Xi.SpeakerRecognitionResult}}),Object.defineProperty(e,"SpeakerRecognitionResultType",{enumerable:!0,get:function(){return Xi.SpeakerRecognitionResultType}}),Object.defineProperty(e,"SpeakerRecognitionCancellationDetails",{enumerable:!0,get:function(){return Xi.SpeakerRecognitionCancellationDetails}});var B=Ms();Object.defineProperty(e,"Conversation",{enumerable:!0,get:function(){return B.Conversation}}),Object.defineProperty(e,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return B.ConversationExpirationEventArgs}}),Object.defineProperty(e,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return B.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(e,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return B.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(e,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return B.ConversationTranslationEventArgs}}),Object.defineProperty(e,"ConversationTranslationResult",{enumerable:!0,get:function(){return B.ConversationTranslationResult}}),Object.defineProperty(e,"ConversationTranslator",{enumerable:!0,get:function(){return B.ConversationTranslator}}),Object.defineProperty(e,"ConversationTranscriber",{enumerable:!0,get:function(){return B.ConversationTranscriber}}),Object.defineProperty(e,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return B.ConversationTranscriptionResult}}),Object.defineProperty(e,"Meeting",{enumerable:!0,get:function(){return B.Meeting}}),Object.defineProperty(e,"MeetingTranscriber",{enumerable:!0,get:function(){return B.MeetingTranscriber}}),Object.defineProperty(e,"Participant",{enumerable:!0,get:function(){return B.Participant}}),Object.defineProperty(e,"ParticipantChangedReason",{enumerable:!0,get:function(){return B.ParticipantChangedReason}}),Object.defineProperty(e,"User",{enumerable:!0,get:function(){return B.User}});var Md=Os();Object.defineProperty(e,"Synthesizer",{enumerable:!0,get:function(){return Md.Synthesizer}});var Od=oh();Object.defineProperty(e,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return Od.SpeechSynthesisOutputFormat}});var Dd=gf();Object.defineProperty(e,"SpeechSynthesizer",{enumerable:!0,get:function(){return Dd.SpeechSynthesizer}});var kd=Sf();Object.defineProperty(e,"SynthesisResult",{enumerable:!0,get:function(){return kd.SynthesisResult}});var zd=mf();Object.defineProperty(e,"SpeechSynthesisResult",{enumerable:!0,get:function(){return zd.SpeechSynthesisResult}});var Nd=Cf();Object.defineProperty(e,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return Nd.SpeechSynthesisEventArgs}});var jd=yf();Object.defineProperty(e,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return jd.SpeechSynthesisWordBoundaryEventArgs}});var Ld=Rf();Object.defineProperty(e,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return Ld.SpeechSynthesisBookmarkEventArgs}});var qd=Pf();Object.defineProperty(e,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return qd.SpeechSynthesisVisemeEventArgs}});var Bd=Ef();Object.defineProperty(e,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return Bd.SpeechSynthesisBoundaryType}});var Fd=If();Object.defineProperty(e,"SynthesisVoicesResult",{enumerable:!0,get:function(){return Fd.SynthesisVoicesResult}});var Zi=Af();Object.defineProperty(e,"SynthesisVoiceGender",{enumerable:!0,get:function(){return Zi.SynthesisVoiceGender}}),Object.defineProperty(e,"SynthesisVoiceType",{enumerable:!0,get:function(){return Zi.SynthesisVoiceType}}),Object.defineProperty(e,"VoiceInfo",{enumerable:!0,get:function(){return Zi.VoiceInfo}});var xd=Tf();Object.defineProperty(e,"SpeakerAudioDestination",{enumerable:!0,get:function(){return xd.SpeakerAudioDestination}});var Ud=wf();Object.defineProperty(e,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Ud.ConversationTranscriptionCanceledEventArgs}});var Wd=_f();Object.defineProperty(e,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Wd.MeetingTranscriptionCanceledEventArgs}});var Vd=bf();Object.defineProperty(e,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return Vd.PronunciationAssessmentGradingSystem}});var Hd=Mf();Object.defineProperty(e,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return Hd.PronunciationAssessmentGranularity}});var Kd=Of();Object.defineProperty(e,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return Kd.PronunciationAssessmentConfig}});var $d=Df();Object.defineProperty(e,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return $d.PronunciationAssessmentResult}});var Jd=Ih();Object.defineProperty(e,"LanguageIdMode",{enumerable:!0,get:function(){return Jd.LanguageIdMode}});var Gd=kf();Object.defineProperty(e,"AvatarConfig",{enumerable:!0,get:function(){return Gd.AvatarConfig}});var Qd=zf();Object.defineProperty(e,"AvatarEventArgs",{enumerable:!0,get:function(){return Qd.AvatarEventArgs}});var Xd=Nf();Object.defineProperty(e,"AvatarSynthesizer",{enumerable:!0,get:function(){return Xd.AvatarSynthesizer}});var Ls=jf();Object.defineProperty(e,"AvatarVideoFormat",{enumerable:!0,get:function(){return Ls.AvatarVideoFormat}}),Object.defineProperty(e,"Coordinate",{enumerable:!0,get:function(){return Ls.Coordinate}});var Zd=Lf();Object.defineProperty(e,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return Zd.AvatarWebRTCConnectionResult}});var Yd=qf();Object.defineProperty(e,"Diagnostics",{enumerable:!0,get:function(){return Yd.Diagnostics}});var el=rh();Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return el.LogLevel}})})(Pn)),Pn}var pu;function Bf(){if(pu)return ft;pu=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.ProxyInfo=void 0;const e=P();let t=class Nh{constructor(u,s,a,n){this.privProxyHostName=u,this.privProxyPort=s,this.privProxyUserName=a,this.privProxyPassword=n}static fromParameters(u){return new Nh(u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyPort),10),u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyUserName),u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(u){return this.fromParameters(u.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};return ft.ProxyInfo=t,ft}var Wr={},Vn,hu;function Ff(){if(hu)return Vn;hu=1;const e=new Set(["json","buffer","string"]);return Vn=t=>(...i)=>{const u=new Set;let s,a,n,r="";return i.forEach(o=>{if(typeof o=="string")if(o.toUpperCase()===o)if(s){const c=`Can't set method to ${o}, already set to ${s}.`;throw new Error(c)}else s=o;else if(o.startsWith("http:")||o.startsWith("https:"))r=o;else if(e.has(o))a=o;else throw new Error(`Unknown encoding, ${o}`);else if(typeof o=="number")u.add(o);else if(typeof o=="object")if(Array.isArray(o)||o instanceof Set)o.forEach(c=>u.add(c));else{if(n)throw new Error("Cannot set headers twice.");n=o}else throw new Error(`Unknown type: ${typeof o}`)}),s||(s="GET"),u.size===0&&u.add(200),t(u,s,a,n,r)},Vn}var Hn,du;function xf(){if(du)return Hn;du=1;const e=Ff();class t extends Error{constructor(s,...a){super(...a),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="StatusError",this.message=s.statusMessage,this.statusCode=s.status,this.res=s,this.json=s.json.bind(s),this.text=s.text.bind(s),this.arrayBuffer=s.arrayBuffer.bind(s);let n;Object.defineProperty(this,"responseBody",{get:()=>(n||(n=this.arrayBuffer()),n)}),this.headers={};for(const[o,c]of s.headers.entries())this.headers[o.toLowerCase()]=c}}return Hn=e((u,s,a,n,r)=>async(o,c,p={})=>{o=r+(o||"");let h=new URL(o);if(n||(n={}),h.username&&(n.Authorization="Basic "+btoa(h.username+":"+h.password),h=new URL(h.protocol+"//"+h.host+h.pathname+h.search)),h.protocol!=="https:"&&h.protocol!=="http:")throw new Error(`Unknown protocol, ${h.protocol}`);if(c&&!(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="string"))if(typeof c=="object")c=JSON.stringify(c),n["Content-Type"]="application/json";else throw new Error("Unknown body type.");p=new Headers({...n||{},...p});const l=await fetch(h,{method:s,headers:p,body:c});if(l.statusCode=l.status,!u.has(l.status))throw new t(l);return a==="json"?l.json():a==="buffer"?l.arrayBuffer():a==="string"?l.text():l}),Hn}var lu;function Uf(){return lu||(lu=1,(function(e){var t=Wr&&Wr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(e,"__esModule",{value:!0}),e.RestMessageAdapter=e.RestRequestType=void 0;const i=t(xf()),u=T();var s;(function(n){n.Get="GET",n.Post="POST",n.Delete="DELETE",n.File="file"})(s=e.RestRequestType||(e.RestRequestType={}));let a=class{constructor(r){if(!r)throw new u.ArgumentNullError("configParams");this.privHeaders=r.headers,this.privIgnoreCache=r.ignoreCache}static extractHeaderValue(r,o){let c="";try{const p=o.trim().split(/[\r\n]+/),h={};p.forEach(l=>{const d=l.split(": "),g=d.shift().toLowerCase(),f=d.join(": ");h[g]=f}),c=h[r.toLowerCase()]}catch{}return c}set options(r){this.privHeaders=r.headers,this.privIgnoreCache=r.ignoreCache}setHeaders(r,o){this.privHeaders[r]=o}request(r,o,c={},p=null){const h=new u.Deferred,l=r===s.File?"POST":r,d=(f,S={})=>{const v=f;return{data:JSON.stringify(S),headers:JSON.stringify(f.headers),json:S,ok:f.statusCode>=200&&f.statusCode<300,status:f.statusCode,statusText:S.error?S.error.message:v.statusText?v.statusText:v.statusMessage}},g=f=>{const S=(0,i.default)(o,l,this.privHeaders,200,201,202,204,400,401,402,403,404),v=this.queryParams(c)===""?"":`?${this.queryParams(c)}`;S(v,f).then(async m=>{if(r===s.Delete||m.statusCode===204)h.resolve(d(m));else try{const C=await m.json();h.resolve(d(m,C))}catch{h.resolve(d(m))}}).catch(m=>{h.reject(m)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),r===s.Post&&p&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),g(p),h.promise}queryParams(r={}){return Object.keys(r).map(o=>encodeURIComponent(o)+"="+encodeURIComponent(r[o])).join("&")}};e.RestMessageAdapter=a})(Wr)),Wr}var Vr={},vu;function jh(){if(vu)return Vr;vu=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.RestConfigBase=void 0;let e=class Ji{static get requestOptions(){return Ji.privDefaultRequestOptions}static get configParams(){return Ji.privDefaultParams}static get restErrors(){return Ji.privRestErrors}};return Vr.RestConfigBase=e,e.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4},e.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},e.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"},Vr}var fu;function N(){return fu||(fu=1,(function(e){var t=pe&&pe.__createBinding||(Object.create?(function(u,s,a,n){n===void 0&&(n=a),Object.defineProperty(u,n,{enumerable:!0,get:function(){return s[a]}})}):(function(u,s,a,n){n===void 0&&(n=a),u[n]=s[a]})),i=pe&&pe.__exportStar||function(u,s){for(var a in u)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&t(s,u,a)};Object.defineProperty(e,"__esModule",{value:!0}),i(Wl(),e),i(Vl(),e),i(Hl(),e),i(Kl(),e),i($l(),e),i(Jl(),e),i(ih(),e),i(Gl(),e),i(Bf(),e),i(Uf(),e),i(jh(),e)})(pe)),pe}var gu;function Wf(){if(gu)return ut;gu=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.IntentConnectionFactory=void 0;const e=N(),t=P(),i=J(),u=A(),s=q();let a=class extends i.ConnectionFactoryBase{create(r,o,c){let p=r.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint);if(!p){const g=r.parameters.getProperty(t.PropertyId.SpeechServiceConnection_IntentRegion),f=i.ConnectionFactoryBase.getHostSuffix(g);p=r.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+g+".sr.speech"+f)+"/speech/recognition/interactive/cognitiveservices/v1"}const h={format:"simple",language:r.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(r,h,p);const l={};o.token!==void 0&&o.token!==""&&(l[o.headerName]=o.token),l[s.HeaderNames.ConnectionId]=c,r.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,p);const d=r.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(p,h,l,new u.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(r),d,c))}getSpeechRegionFromIntentRegion(r){switch(r){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return r}}};return ut.IntentConnectionFactory=a,ut}var Ee={},Su;function Vf(){if(Su)return Ee;Su=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.VoiceProfileConnectionFactory=Ee.SpeakerRecognitionConnectionFactory=void 0;const e=N(),t=P(),i=J(),u=A(),s=q();class a extends i.ConnectionFactoryBase{create(c,p,h,l){let d=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint);if(!d){const v=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region),m=i.ConnectionFactoryBase.getHostSuffix(v),C=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,`wss://${v}.spr-frontend.speech${m}`),y=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");d=`${C}/speaker/ws/${this.scenarioToPath(y)}/${h}`}const g={format:"simple",language:c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(c,g,d);const f={};p.token!==void 0&&p.token!==""&&(f[p.headerName]=p.token),f[s.HeaderNames.ConnectionId]=l,f[s.HeaderNames.SpIDAuthKey]=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Key),c.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,d);const S=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(d,g,f,new u.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),S,l))}scenarioToPath(c){switch(c){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}}let n=class extends a{create(c,p,h){return super.create(c,p,"recognition",h)}};Ee.SpeakerRecognitionConnectionFactory=n;class r extends a{create(c,p,h){return super.create(c,p,"profile",h)}}return Ee.VoiceProfileConnectionFactory=r,Ee}var Kn={},mu;function Ds(){return mu||(mu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognitionEndedEvent=e.RecognitionCompletionStatus=e.RecognitionStartedEvent=e.ConnectingToServiceEvent=e.ListeningStartedEvent=e.RecognitionTriggeredEvent=e.SpeechRecognitionEvent=void 0;const t=T();class i extends t.PlatformEvent{constructor(p,h,l,d=t.EventType.Info){super(p,d),this.privRequestId=h,this.privSessionId=l}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}e.SpeechRecognitionEvent=i;class u extends i{constructor(p,h,l,d){super("RecognitionTriggeredEvent",p,h),this.privAudioSourceId=l,this.privAudioNodeId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}e.RecognitionTriggeredEvent=u;class s extends i{constructor(p,h,l,d){super("ListeningStartedEvent",p,h),this.privAudioSourceId=l,this.privAudioNodeId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}e.ListeningStartedEvent=s;class a extends i{constructor(p,h,l){super("ConnectingToServiceEvent",p,l),this.privAuthFetchEventid=h}get authFetchEventid(){return this.privAuthFetchEventid}}e.ConnectingToServiceEvent=a;class n extends i{constructor(p,h,l,d,g){super("RecognitionStartedEvent",p,g),this.privAudioSourceId=h,this.privAudioNodeId=l,this.privAuthFetchEventId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}e.RecognitionStartedEvent=n;var r;(function(c){c[c.Success=0]="Success",c[c.AudioSourceError=1]="AudioSourceError",c[c.AudioSourceTimeout=2]="AudioSourceTimeout",c[c.AuthTokenFetchError=3]="AuthTokenFetchError",c[c.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",c[c.UnAuthorized=5]="UnAuthorized",c[c.ConnectTimeout=6]="ConnectTimeout",c[c.ConnectError=7]="ConnectError",c[c.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",c[c.UnknownError=9]="UnknownError"})(r=e.RecognitionCompletionStatus||(e.RecognitionCompletionStatus={}));class o extends i{constructor(p,h,l,d,g,f,S,v){super("RecognitionEndedEvent",p,g,S===r.Success?t.EventType.Info:t.EventType.Error),this.privAudioSourceId=h,this.privAudioNodeId=l,this.privAuthFetchEventId=d,this.privStatus=S,this.privError=v,this.privServiceTag=f}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}e.RecognitionEndedEvent=o})(Kn)),Kn}var Hr={},Kr={},Cu;function ze(){if(Cu)return Kr;Cu=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.SpeechConnectionMessage=void 0;const e=T(),t=q();class i extends e.ConnectionMessage{constructor(s,a,n,r,o,c,p,h){if(!a)throw new e.ArgumentNullError("path");if(!n)throw new e.ArgumentNullError("requestId");const l={};if(l[t.HeaderNames.Path]=a,l[t.HeaderNames.RequestId]=n,l[t.HeaderNames.RequestTimestamp]=new Date().toISOString(),r&&(l[t.HeaderNames.ContentType]=r),c&&(l[t.HeaderNames.RequestStreamId]=c),p)for(const d in p)d&&(l[d]=p[d]);h?super(s,o,l,h):super(s,o,l),this.privPath=a,this.privRequestId=n,this.privContentType=r,this.privStreamId=c,this.privAdditionalHeaders=p}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(s){let a=null,n=null,r=null,o=null;const c={};if(s.headers)for(const p in s.headers)p&&(p.toLowerCase()===t.HeaderNames.Path.toLowerCase()?a=s.headers[p]:p.toLowerCase()===t.HeaderNames.RequestId.toLowerCase()?n=s.headers[p]:p.toLowerCase()===t.HeaderNames.ContentType.toLowerCase()?r=s.headers[p]:p.toLowerCase()===t.HeaderNames.RequestStreamId.toLowerCase()?o=s.headers[p]:c[p]=s.headers[p]);return new i(s.messageType,a,n,r,s.body,o,c,s.id)}}return Kr.SpeechConnectionMessage=i,Kr}var $n={},yu;function Hf(){return yu||(yu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SegmentationMode=void 0,(function(t){t.Normal="Normal",t.Disabled="Disabled",t.Custom="Custom",t.Semantic="Semantic"})(e.SegmentationMode||(e.SegmentationMode={}))})($n)),$n}var Jn={},Ru;function Kf(){return Ru||(Ru=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.None="None",t.Synthesize="Synthesize"})(e.NextAction||(e.NextAction={}))})(Jn)),Jn}var Gn={},Pu;function $f(){return Pu||(Pu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Mode=void 0,(function(t){t.None="None",t.Always="Always"})(e.Mode||(e.Mode={}))})(Gn)),Gn}var Qn={},Eu;function Jf(){return Eu||(Eu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LanguageIdDetectionPriority=e.LanguageIdDetectionMode=void 0,(function(t){t.DetectAtAudioStart="DetectAtAudioStart",t.DetectContinuous="DetectContinuous",t.DetectSegments="DetectSegments"})(e.LanguageIdDetectionMode||(e.LanguageIdDetectionMode={})),(function(t){t.Auto="Auto",t.PrioritizeLatency="PrioritizeLatency",t.PrioritizeAccuracy="PrioritizeAccuracy"})(e.LanguageIdDetectionPriority||(e.LanguageIdDetectionPriority={}))})(Qn)),Qn}var Xn={},Iu;function Gf(){return Iu||(Iu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.Recognize="Recognize",t.None="None"})(e.NextAction||(e.NextAction={}))})(Xn)),Xn}var Zn={},Au;function Qf(){return Au||(Au=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OnUnknownAction=void 0,(function(t){t.RecognizeWithDefaultLanguage="RecognizeWithDefaultLanguage",t.None="None"})(e.OnUnknownAction||(e.OnUnknownAction={}))})(Zn)),Zn}var Yn={},Tu;function Xf(){return Tu||(Tu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ResultType=void 0,(function(t){t.Auto="Auto",t.StableFragment="StableFragment",t.Hypothesis="Hypothesis",t.None="None"})(e.ResultType||(e.ResultType={}))})(Yn)),Yn}var es={},wu;function Zf(){return wu||(wu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PhraseResultOutputType=void 0,(function(t){t.Always="Always",t.None="None"})(e.PhraseResultOutputType||(e.PhraseResultOutputType={}))})(es)),es}var ts={},_u;function Yf(){return _u||(_u=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.None="None",t.Translate="Translate"})(e.NextAction||(e.NextAction={}))})(ts)),ts}var bu;function eg(){if(bu)return Hr;bu=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.ServiceRecognizerBase=void 0;const e=N(),t=T(),i=P(),u=A(),s=ze(),a=Hf(),n=V(),r=Kf(),o=$f(),c=Jf(),p=Gf(),h=Qf(),l=Xf(),d=Zf(),g=Yf();let f=class xi{constructor(v,m,C,y,R){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!v)throw new t.ArgumentNullError("authentication");if(!m)throw new t.ArgumentNullError("connectionFactory");if(!C)throw new t.ArgumentNullError("audioSource");if(!y)throw new t.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=y.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=v,this.privConnectionFactory=m,this.privAudioSource=C,this.privRecognizerConfig=y,this.privIsDisposed=!1,this.privRecognizer=R,this.privRequestSession=new u.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privDynamicGrammar=new u.DynamicGrammarBuilder,this.privSpeechContext=new u.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new u.AgentConfig,this.privRecognizerConfig.parameters.getProperty(i.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=t.Timeout.setTimeout:(typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<"u"&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(w=>{if(w.name==="ConnectionClosedEvent"){const E=w;(E.statusCode===1003||E.statusCode===1007||E.statusCode===1002||E.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(i.CancellationReason.Error,E.statusCode===1007?i.CancellationErrorCode.BadRequestParameters:i.CancellationErrorCode.ConnectionFailure,`${E.reason} websocket error code: ${E.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=(0,t.createNoDashGuid)())}setTranslationJson(){const v=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(v!==void 0){const m=v.split(","),C=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),y=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationCategoryId,void 0),R=C!==void 0?r.NextAction.Synthesize:r.NextAction.None;if(this.privSpeechContext.getContext().translation={onPassthrough:{action:R},onSuccess:{action:R},output:{includePassThroughResults:!0,interimResults:{mode:o.Mode.Always}},targetLanguages:m},y!==void 0&&(this.privSpeechContext.getContext().translation.category=y),C!==void 0){const w={};for(const E of m)w[E]=C;this.privSpeechContext.getContext().synthesis={defaultVoices:w}}const I=this.privSpeechContext.getContext().phraseDetection||{};I.onSuccess={action:g.NextAction.Translate},I.onInterim={action:g.NextAction.Translate},this.privSpeechContext.getContext().phraseDetection=I}}setSpeechSegmentationTimeoutJson(){const v=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0),m=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationMaximumTimeMs,void 0),C=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationStrategy,void 0),y={mode:a.SegmentationMode.Normal};let R=!1;if(C!==void 0){R=!0;let I=a.SegmentationMode.Normal;switch(C.toLowerCase()){case"default":break;case"time":I=a.SegmentationMode.Custom;break;case"semantic":I=a.SegmentationMode.Semantic;break}y.mode=I}if(v!==void 0){R=!0;const I=parseInt(v,10);y.mode=a.SegmentationMode.Custom,y.segmentationSilenceTimeoutMs=I}if(m!==void 0){R=!0;const I=parseInt(m,10);y.mode=a.SegmentationMode.Custom,y.segmentationForcedTimeoutMs=I}if(R){const I=this.privSpeechContext.getContext().phraseDetection||{};switch(I.mode=this.recognitionMode,this.recognitionMode){case n.RecognitionMode.Conversation:I.conversation=I.conversation??{segmentation:{}},I.conversation.segmentation=y;break;case n.RecognitionMode.Interactive:I.interactive=I.interactive??{segmentation:{}},I.interactive.segmentation=y;break;case n.RecognitionMode.Dictation:I.dictation=I.dictation??{},I.dictation.segmentation=y;break}this.privSpeechContext.getContext().phraseDetection=I}}setLanguageIdJson(){const v=this.privSpeechContext.getContext().phraseDetection||{};if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){const m=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");m.length===1&&m[0]===u.AutoDetectSourceLanguagesOpenRangeOptionName&&(m[0]="UND");let C;this.privRecognizerConfig.languageIdMode==="Continuous"?C=c.LanguageIdDetectionMode.DetectContinuous:C=c.LanguageIdDetectionMode.DetectAtAudioStart,this.privSpeechContext.getContext().languageId={languages:m,mode:C,onSuccess:{action:p.NextAction.Recognize},onUnknown:{action:h.OnUnknownAction.None},priority:c.LanguageIdDetectionPriority.PrioritizeLatency},this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:l.ResultType.Auto},phraseResults:{resultType:d.PhraseResultOutputType.Always}};const y=this.privRecognizerConfig.sourceLanguageModels;y!==void 0&&(v.customModels=y,v.onInterim={action:g.NextAction.None},v.onSuccess={action:g.NextAction.None})}this.privSpeechContext.getContext().phraseDetection=v}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(u.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase()===i.OutputFormat[i.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}setSpeechStartEventSensitivityJson(){const v=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_StartEventSensitivity,void 0);if(v!==void 0){let m=!1;switch(v.toLowerCase()){case n.SpeechStartEventSensitivity.Low:case n.SpeechStartEventSensitivity.Medium:case n.SpeechStartEventSensitivity.High:m=!0;break}if(m){const C=this.privSpeechContext.getContext().phraseDetection||{};C.voiceOnsetSensitivity=v.toLowerCase(),this.privSpeechContext.getContext().phraseDetection=C}}}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(v){this.privRecognizerConfig.parameters.setProperty(i.PropertyId.ConversationTranslator_Token,v)}set voiceProfileType(v){this.privRecognizerConfig.parameters.setProperty(i.PropertyId.SpeechServiceConnection_SpeakerIdMode,v)}set authentication(v){this.privAuthentication=v}isDisposed(){return this.privIsDisposed}async dispose(v){if(this.privIsDisposed=!0,this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose(v)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(v,m,C){if(this.recognizeOverride!==void 0){await this.recognizeOverride(v,m,C);return}if(this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=v,this.privRecognizerConfig.recognitionEndpointVersion==="2"){const E=this.privSpeechContext.getContext().phraseDetection||{};E.mode=v,this.privSpeechContext.getContext().phraseDetection=E}this.setLanguageIdJson(),this.setTranslationJson(),this.privRecognizerConfig.autoDetectSourceLanguages!==void 0&&this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&this.setupTranslationWithLanguageId(),this.setSpeechSegmentationTimeoutJson(),this.setOutputDetailLevelJson(),this.setSpeechStartEventSensitivityJson(),this.privSuccessCallback=m,this.privErrorCallback=C,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const y=this.connectImpl();let R;try{const E=await this.audioSource.attach(this.privRequestSession.audioNodeId),M=await this.audioSource.format,D=await this.audioSource.deviceInfo;this.privIsLiveAudio=D.type&&D.type===u.type.Microphones,R=new e.ReplayableAudioNode(E,M.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(R,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:D}}catch(E){throw await this.privRequestSession.onStopRecognizing(),E}try{await y}catch(E){await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.ConnectionFailure,E);return}const I=new i.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,I),this.receiveMessage(),this.sendAudio(R).catch(async E=>{await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.RuntimeError,E)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(v,m){this.connectImpl().then(()=>{try{v&&v()}catch(C){m&&m(C)}},C=>{try{m&&m(C)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(v){}async sendNetworkMessage(v,m){const C=typeof m=="string"?t.MessageType.Text:t.MessageType.Binary,y=typeof m=="string"?"application/json":"";return(await this.fetchConnection()).send(new s.SpeechConnectionMessage(C,v,this.privRequestSession.requestId,y,m))}set activityTemplate(v){this.privActivityTemplate=v}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(v){this.privExpectContentAssessmentResponse=v}async sendTelemetryData(){const v=this.privRequestSession.getTelemetry();if(xi.telemetryDataEnabled!==!0||this.privIsDisposed||v===null)return;if(xi.telemetryData)try{xi.telemetryData(v)}catch{}await(await this.fetchConnection()).send(new s.SpeechConnectionMessage(t.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",v))}async cancelRecognitionLocal(v,m,C){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,v,m,C))}async receiveMessage(){try{if(this.privIsDisposed)return;let v=await this.fetchConnection();const m=await v.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!m)return this.receiveMessage();this.privServiceHasSentMessage=!0;const C=s.SpeechConnectionMessage.fromConnectionMessage(m);if(C.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(C.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const y=u.SpeechDetected.fromJSON(C.textBody,this.privRequestSession.currentTurnAudioOffset),R=new i.RecognitionEventArgs(y.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,R);break;case"speech.enddetected":let I;C.textBody.length>0?I=C.textBody:I="{ Offset: 0 }";const w=u.SpeechDetected.fromJSON(I,this.privRequestSession.currentTurnAudioOffset),E=new i.RecognitionEventArgs(w.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,E);break;case"turn.end":await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(i.CancellationReason.EndOfStream,i.CancellationErrorCode.NoError,void 0));const M=new i.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,M);return}else v=await this.fetchConnection(),await this.sendPrePayloadJSON(v);break;default:await this.processTypeSpecificMessages(C)||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(C.path.toLowerCase(),C.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){const v=this.privRequestSession.recognitionBytesSent,m=this.privAverageBytesPerMs!==0?v/this.privAverageBytesPerMs:0;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(m)}sendSpeechContext(v,m){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const C=this.speechContext.toJSON();if(m&&this.privRequestSession.onSpeechContext(),C)return v.send(new s.SpeechConnectionMessage(t.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",C))}setupTranslationWithLanguageId(){const v=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0),m=this.privRecognizerConfig.autoDetectSourceLanguages!==void 0;if(v!==void 0&&m){this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:l.ResultType.None},phraseResults:{resultType:d.PhraseResultOutputType.None}};const C=this.privSpeechContext.getContext().translation;if(C){const y=this.privRecognizerConfig.sourceLanguageModels;if(y!==void 0&&y.length>0){const I=this.privSpeechContext.getContext().phraseDetection||{};I.customModels=y,this.privSpeechContext.getContext().phraseDetection=I}this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&(C.onSuccess={action:r.NextAction.Synthesize},C.onPassthrough={action:r.NextAction.Synthesize})}}}noOp(){}async sendPrePayloadJSON(v,m=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(v);await this.sendSpeechContext(v,m),await this.sendWaveHeader(v)}async sendWaveHeader(v){const m=await this.audioSource.format;return v.send(new s.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",m.header))}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(v=>v.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(v,m,C){if(m.onSpeechContext(),xi.telemetryDataEnabled!==!0){const R={context:{system:JSON.parse(C).context.system}};C=JSON.stringify(R)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){const y=JSON.parse(C);y.context.DisableReferenceChannel="True",y.context.MicSpec="1_0_0",C=JSON.stringify(y)}if(C)return v.send(new s.SpeechConnectionMessage(t.MessageType.Text,"speech.config",m.requestId,"application/json",C))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(v=>v.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async sendAudio(v){const m=await this.audioSource.format;this.privAverageBytesPerMs=m.avgBytesPerSec/1e3;let C=Date.now();const y=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),R=m.avgBytesPerSec/1e3*parseInt(y,10),I=this.privRequestSession.recogNumber,w=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===I){const E=await this.fetchConnection(),M=await v.read();if(this.privRequestSession.isSpeechEnded)return;let D,W;if(!M||M.isEnd?(D=null,W=0):(D=M.buffer,this.privRequestSession.onAudioSent(D.byteLength),R>=this.privRequestSession.bytesSent?W=0:W=Math.max(0,C-Date.now())),W!==0&&await this.delay(W),D!==null&&(C=Date.now()+D.byteLength*1e3/(m.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===I)if(E.send(new s.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,D)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),M?.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return w()}};return w()}async retryableConnect(){let v=!1;this.privAuthFetchEventId=(0,t.createNoDashGuid)();const m=this.privRequestSession.sessionId;this.privConnectionId=m!==void 0?m:(0,t.createNoDashGuid)(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let C=0,y="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){this.privRequestSession.onRetryConnection();const I=await(v?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);const w=await this.privConnectionFactory.create(this.privRecognizerConfig,I,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(w.events),w.events.attach(M=>{this.connectionEvents.onEvent(M)});const E=await w.open();if(E.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(E.statusCode),Promise.resolve(w);E.statusCode===1006&&(v=!0),C=E.statusCode,y=E.reason}return await this.privRequestSession.onConnectionEstablishCompleted(C,y),Promise.reject(`Unable to contact server. StatusCode: ${C}, ${this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${y}`)}delay(v){return new Promise(m=>this.privSetTimeout(m,v))}writeBufferToConsole(v){let m="Buffer Size: ";if(v===null)m+="null";else{const C=new Uint8Array(v);m+=`${v.byteLength}\r
`;for(let y=0;y<v.byteLength;y++)m+=C[y].toString(16).padStart(2,"0")+" ",(y+1)%16===0&&(console.info(m),m="")}console.info(m)}async sendFinalAudio(){await(await this.fetchConnection()).send(new s.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}async configureConnection(){const v=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(v):(await this.sendSpeechServiceConfig(v,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(v,!1),v)}};return Hr.ServiceRecognizerBase=f,f.telemetryDataEnabled=!0,Hr}var $r={},Mu;function tg(){if(Mu)return $r;Mu=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.ConversationServiceRecognizer=void 0;const e=P(),t=A();let i=class extends t.ServiceRecognizerBase{constructor(s,a,n,r,o){super(s,a,n,r,o),this.handleSpeechPhraseMessage=async c=>this.handleSpeechPhrase(c),this.handleSpeechHypothesisMessage=c=>this.handleSpeechHypothesis(c)}processTypeSpecificMessages(s){}handleRecognizedCallback(s,a,n){}handleRecognizingCallback(s,a,n){}async processSpeechMessages(s){let a=!1;switch(s.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(s.textBody),a=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(s.textBody),a=!0;break}return a}cancelRecognition(s,a,n,r,o){}async handleSpeechPhrase(s){const a=t.SimpleSpeechPhrase.fromJSON(s,this.privRequestSession.currentTurnAudioOffset),n=t.EnumTranslation.implTranslateRecognitionResult(a.RecognitionStatus);let r;const o=new e.PropertyCollection;if(o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s),this.privRequestSession.onPhraseRecognized(a.Offset+a.Duration),e.ResultReason.Canceled===n){const c=t.EnumTranslation.implTranslateCancelResult(a.RecognitionStatus),p=t.EnumTranslation.implTranslateCancelErrorCode(a.RecognitionStatus);await this.cancelRecognitionLocal(c,p,t.EnumTranslation.implTranslateErrorDetails(p))}else if(a.RecognitionStatus!==t.RecognitionStatus.EndOfDictation){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,n,a.DisplayText,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,a.SpeakerId,void 0,a.asJson(),o);else{const c=t.DetailedSpeechPhrase.fromJSON(s,this.privRequestSession.currentTurnAudioOffset);r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,n,c.Text,c.Duration,c.Offset,c.Language,c.LanguageDetectionConfidence,c.SpeakerId,void 0,c.asJson(),o)}this.handleRecognizedCallback(r,r.offset,this.privRequestSession.sessionId)}}handleSpeechHypothesis(s){const a=t.SpeechHypothesis.fromJSON(s,this.privRequestSession.currentTurnAudioOffset),n=new e.PropertyCollection;n.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s);const r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,a.Text,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,a.SpeakerId,void 0,a.asJson(),n);this.privRequestSession.onHypothesis(a.Offset),this.handleRecognizingCallback(r,a.Duration,this.privRequestSession.sessionId)}};return $r.ConversationServiceRecognizer=i,$r}var rs={},Ou;function rg(){return Ou||(Ou=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognizerConfig=e.SpeechResultFormat=void 0;const t=P(),i=A(),u=V();(function(a){a[a.Simple=0]="Simple",a[a.Detailed=1]="Detailed"})(e.SpeechResultFormat||(e.SpeechResultFormat={}));class s{constructor(n,r){this.privSpeechServiceConfig=n||new i.SpeechServiceConfig(new i.Context(null)),this.privParameters=r,this.privMaxRetryCount=parseInt(r.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=r.getProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(n){this.privRecognitionMode=n,this.privRecognitionActivityTimeout=n===u.RecognitionMode.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=u.RecognitionMode[n]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==u.RecognitionMode.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2")}set recognitionEndpointVersion(n){this.parameters.setProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,n)}get sourceLanguageModels(){const n=[];let r=!1;if(this.autoDetectSourceLanguages!==void 0)for(const o of this.autoDetectSourceLanguages.split(",")){const c=o+t.PropertyId.SpeechServiceConnection_EndpointId.toString(),p=this.parameters.getProperty(c,void 0);p!==void 0?(n.push({language:o,endpoint:p}),r=!0):n.push({language:o,endpoint:""})}return r?n:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(n){this.privEnableSpeakerId=n}}e.RecognizerConfig=s})(rs)),rs}var is={},Du;function ig(){return Du||(Du=1,Object.defineProperty(is,"__esModule",{value:!0})),is}var Jr={},ku;function ng(){if(ku)return Jr;ku=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.WebsocketMessageFormatter=void 0;const e=T(),t=`\r
`;let i=class{toConnectionMessage(s){const a=new e.Deferred;try{if(s.messageType===e.MessageType.Text){const n=s.textContent;let r={},o=null;if(n){const c=n.split(`\r
\r
`);c&&c.length>0&&(r=this.parseHeaders(c[0]),c.length>1&&(o=c[1]))}a.resolve(new e.ConnectionMessage(s.messageType,o,r,s.id))}else if(s.messageType===e.MessageType.Binary){const n=s.binaryContent;let r={},o=null;if(!n||n.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const c=new DataView(n),p=c.getInt16(0);if(n.byteLength<p+2)throw new Error("Invalid binary message format. Header content missing.");let h="";for(let l=0;l<p;l++)h+=String.fromCharCode(c.getInt8(l+2));r=this.parseHeaders(h),n.byteLength>p+2&&(o=n.slice(2+p)),a.resolve(new e.ConnectionMessage(s.messageType,o,r,s.id))}}catch(n){a.reject(`Error formatting the message. Error: ${n}`)}return a.promise}fromConnectionMessage(s){const a=new e.Deferred;try{if(s.messageType===e.MessageType.Text){const n=`${this.makeHeaders(s)}${t}${s.textBody?s.textBody:""}`;a.resolve(new e.RawWebsocketMessage(e.MessageType.Text,n,s.id))}else if(s.messageType===e.MessageType.Binary){const n=this.makeHeaders(s),r=s.binaryBody,o=this.stringToArrayBuffer(n),c=new Int8Array(o),p=c.byteLength,h=new Int8Array(2+p+(r?r.byteLength:0));if(h[0]=p>>8&255,h[1]=p&255,h.set(c,2),r){const d=new Int8Array(r);h.set(d,2+p)}const l=h.buffer;a.resolve(new e.RawWebsocketMessage(e.MessageType.Binary,l,s.id))}}catch(n){a.reject(`Error formatting the message. ${n}`)}return a.promise}makeHeaders(s){let a="";if(s.headers)for(const n in s.headers)n&&(a+=`${n}: ${s.headers[n]}${t}`);return a}parseHeaders(s){const a={};if(s){const n=s.match(/[^\r\n]+/g);if(a){for(const r of n)if(r){const o=r.indexOf(":"),c=o>0?r.substr(0,o).trim().toLowerCase():r,p=o>0&&r.length>o+1?r.substr(o+1).trim():"";a[c]=p}}}return a}stringToArrayBuffer(s){const a=new ArrayBuffer(s.length),n=new DataView(a);for(let r=0;r<s.length;r++)n.setUint8(r,s.charCodeAt(r));return a}};return Jr.WebsocketMessageFormatter=i,Jr}var Gr={},zu;function sg(){if(zu)return Gr;zu=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.SpeechConnectionFactory=void 0;const e=N(),t=A(),i=P(),u=J(),s=A(),a=q(),n=ne(),r=V();let o=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/stt/speech/universal/v"}async create(p,h,l){let d=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,void 0);const g=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region,void 0),f=u.ConnectionFactoryBase.getHostSuffix(g),S=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://"+g+".stt.speech"+f),v={},m=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,void 0),C=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(m?(!d||d.search(n.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(v[n.QueryParameterNames.CustomSpeechDeploymentId]=m):C&&(!d||d.search(n.QueryParameterNames.Language)===-1)&&(v[n.QueryParameterNames.Language]=C),(!d||d.search(n.QueryParameterNames.Format)===-1)&&(v[n.QueryParameterNames.Format]=p.parameters.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase()),p.autoDetectSourceLanguages!==void 0&&(v[n.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(p,v,d),d){const E=new URL(d),M=E.pathname;(M===""||M==="/")&&(E.pathname=this.universalUri+p.recognitionEndpointVersion,d=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(E.toString()))}if(!d)switch(p.recognitionMode){case r.RecognitionMode.Conversation:p.parameters.getProperty(t.ForceDictationPropertyName,"false")==="true"?d=S+this.dictationRelativeUri:p.recognitionEndpointVersion!==void 0&&parseInt(p.recognitionEndpointVersion,10)>1?d=`${S}${this.universalUri}${p.recognitionEndpointVersion}`:d=S+this.conversationRelativeUri;break;case r.RecognitionMode.Dictation:d=S+this.dictationRelativeUri;break;default:p.recognitionEndpointVersion!==void 0&&parseInt(p.recognitionEndpointVersion,10)>1?d=`${S}${this.universalUri}${p.recognitionEndpointVersion}`:d=S+this.interactiveRelativeUri;break}const y={};h.token!==void 0&&h.token!==""&&(y[h.headerName]=h.token),y[a.HeaderNames.ConnectionId]=l,y.connectionId=l;const R=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",I=new e.WebsocketConnection(d,v,y,new s.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),R,l),w=I.uri;return p.parameters.setProperty(i.PropertyId.SpeechServiceConnection_Url,w),I}};return Gr.SpeechConnectionFactory=o,Gr}var Qr={},Nu;function og(){if(Nu)return Qr;Nu=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.ConversationTranscriberConnectionFactory=void 0;const e=N(),t=P(),i=A(),u=J(),s=A(),a=q(),n=ne();let r=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2",this.conversationRelativeUriV1="/speech/recognition/conversation/cognitiveservices/v1"}async create(c,p,h){let l=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,void 0),g=u.ConnectionFactoryBase.getHostSuffix(d),f=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+d+".stt.speech"+g),S={},v=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),m=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(v?(!l||l.search(n.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(S[n.QueryParameterNames.CustomSpeechDeploymentId]=v):m&&(!l||l.search(n.QueryParameterNames.Language)===-1)&&(S[n.QueryParameterNames.Language]=m),c.autoDetectSourceLanguages!==void 0&&(S[n.QueryParameterNames.EnableLanguageId]="true"),c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)==="1")l=`${f}${this.universalUri}`;else{if(this.setV2UrlParams(c,S,l),l){const E=new URL(l),M=E.pathname;(M===""||M==="/")&&(E.pathname=this.universalUri,l=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(E.toString()))}l||(l=`${f}${this.conversationRelativeUriV1}`)}const y={};p.token!==void 0&&p.token!==""&&(y[p.headerName]=p.token),y[a.HeaderNames.ConnectionId]=h;const R=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",I=new e.WebsocketConnection(l,S,y,new s.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),R,h),w=I.uri;return c.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,w),I}setV2UrlParams(c,p,h){new Map([[t.PropertyId.Speech_SegmentationSilenceTimeoutMs,n.QueryParameterNames.SegmentationSilenceTimeoutMs],[t.PropertyId.SpeechServiceConnection_EnableAudioLogging,n.QueryParameterNames.EnableAudioLogging],[t.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,n.QueryParameterNames.EndSilenceTimeoutMs],[t.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,n.QueryParameterNames.InitialSilenceTimeoutMs],[t.PropertyId.SpeechServiceResponse_PostProcessingOption,n.QueryParameterNames.Postprocessing],[t.PropertyId.SpeechServiceResponse_ProfanityOption,n.QueryParameterNames.Profanity],[t.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,n.QueryParameterNames.StableIntermediateThreshold]]).forEach((g,f)=>{this.setUrlParameter(f,g,c,p,h)});const d=JSON.parse(c.parameters.getProperty(i.ServicePropertiesPropertyName,"{}"));Object.keys(d).forEach(g=>{p[g]=d[g]})}};return Qr.ConversationTranscriberConnectionFactory=r,Qr}var Xr={},ju;function ag(){if(ju)return Xr;ju=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.TranscriberConnectionFactory=void 0;const e=N(),t=P(),i=J(),u=A(),s=q(),a=ne();let n=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(o,c,p){let h=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const l=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,"centralus"),d=i.ConnectionFactoryBase.getHostSuffix(l),g="wss://transcribe."+l+".cts.speech"+d+this.multiaudioRelativeUri,f=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,g),S={};this.setQueryParams(S,o,h),h||(h=f);const v={};c.token!==void 0&&c.token!==""&&(v[c.headerName]=c.token),v[s.HeaderNames.ConnectionId]=p,o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,h);const m=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(h,S,v,new u.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(o),m,p))}setQueryParams(o,c,p){const h=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),l=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);h&&!(a.QueryParameterNames.CustomSpeechDeploymentId in o)&&(o[a.QueryParameterNames.CustomSpeechDeploymentId]=h),l&&!(a.QueryParameterNames.Language in o)&&(o[a.QueryParameterNames.Language]=l);const d=c.parameters.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",g=c.parameters.getProperty(u.OutputFormatPropertyName,t.OutputFormat[t.OutputFormat.Simple])!==t.OutputFormat[t.OutputFormat.Simple];(d||g)&&(o[a.QueryParameterNames.Format]=t.OutputFormat[t.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(c,o,p)}};return Xr.TranscriberConnectionFactory=n,Xr}var Zr={},Lu;function cg(){if(Lu)return Zr;Lu=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.TranslationConnectionFactory=void 0;const e=N(),t=wh(),i=P(),u=J(),s=A(),a=q(),n=ne(),r=V();let o=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2",this.translationV1Uri="/speech/translation/cognitiveservices/v1"}async create(p,h,l){let d=this.getEndpointUrl(p);const g={};if(this.setQueryParams(g,p,d),d){const m=new URL(d),C=m.pathname;(C===""||C==="/")&&(m.pathname=this.universalUri,d=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(m.toString()))}const f={};h.token!==void 0&&h.token!==""&&(f[h.headerName]=h.token),f[a.HeaderNames.ConnectionId]=l,p.parameters.setProperty(i.PropertyId.SpeechServiceConnection_Url,d);const S=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new e.WebsocketConnection(d,g,f,new s.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),S,l)}getEndpointUrl(p,h){const l=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region),d=u.ConnectionFactoryBase.getHostSuffix(l);let g=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,void 0);return g?h===!0?g:t.StringUtils.formatString(g,{region:l}):(p.parameters.getProperty("SPEECH-ForceV1Endpoint","false")==="true"?g=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+d)+this.translationV1Uri:g=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+d)+this.universalUri,h===!0?g:t.StringUtils.formatString(g,{region:l}))}setQueryParams(p,h,l){p.from=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),p.to=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages),p.scenario=h.recognitionMode===r.RecognitionMode.Interactive?"interactive":h.recognitionMode===r.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(h,p,l),this.setUrlParameter(i.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,n.QueryParameterNames.StableTranslation,h,p,l);const d=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);d!==void 0&&(p.voice=d,p.features="requireVoice")}};return Zr.TranslationConnectionFactory=o,Zr}var Yr={},qu;function ug(){if(qu)return Yr;qu=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.EnumTranslation=void 0;const e=P(),t=A();let i=class{static implTranslateRecognitionResult(s,a=!1){let n=e.ResultReason.Canceled;switch(s){case t.RecognitionStatus.Success:n=e.ResultReason.RecognizedSpeech;break;case t.RecognitionStatus.EndOfDictation:n=a?e.ResultReason.RecognizedSpeech:e.ResultReason.NoMatch;break;case t.RecognitionStatus.NoMatch:case t.RecognitionStatus.InitialSilenceTimeout:case t.RecognitionStatus.BabbleTimeout:n=e.ResultReason.NoMatch;break;case t.RecognitionStatus.Error:case t.RecognitionStatus.BadRequest:case t.RecognitionStatus.Forbidden:default:n=e.ResultReason.Canceled;break}return n}static implTranslateCancelResult(s){let a=e.CancellationReason.EndOfStream;switch(s){case t.RecognitionStatus.Success:case t.RecognitionStatus.EndOfDictation:case t.RecognitionStatus.NoMatch:a=e.CancellationReason.EndOfStream;break;case t.RecognitionStatus.InitialSilenceTimeout:case t.RecognitionStatus.BabbleTimeout:case t.RecognitionStatus.Error:case t.RecognitionStatus.BadRequest:case t.RecognitionStatus.Forbidden:default:a=e.CancellationReason.Error;break}return a}static implTranslateCancelErrorCode(s){let a=e.CancellationErrorCode.NoError;switch(s){case t.RecognitionStatus.Error:a=e.CancellationErrorCode.ServiceError;break;case t.RecognitionStatus.TooManyRequests:a=e.CancellationErrorCode.TooManyRequests;break;case t.RecognitionStatus.BadRequest:a=e.CancellationErrorCode.BadRequestParameters;break;case t.RecognitionStatus.Forbidden:a=e.CancellationErrorCode.Forbidden;break;default:a=e.CancellationErrorCode.NoError;break}return a}static implTranslateErrorDetails(s){let a="The speech service encountered an internal error and could not continue.";switch(s){case e.CancellationErrorCode.Forbidden:a="The recognizer is using a free subscription that ran out of quota.";break;case e.CancellationErrorCode.BadRequestParameters:a="Invalid parameter or unsupported audio format in the request.";break;case e.CancellationErrorCode.TooManyRequests:a="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break}return a}};return Yr.EnumTranslation=i,Yr}var ns={},Bu;function pg(){return Bu||(Bu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognitionStatus=e.SynthesisStatus=void 0,(function(t){t[t.Success=0]="Success",t[t.SynthesisEnd=1]="SynthesisEnd",t[t.Error=2]="Error"})(e.SynthesisStatus||(e.SynthesisStatus={})),(function(t){t[t.Success=0]="Success",t[t.NoMatch=1]="NoMatch",t[t.InitialSilenceTimeout=2]="InitialSilenceTimeout",t[t.BabbleTimeout=3]="BabbleTimeout",t[t.Error=4]="Error",t[t.EndOfDictation=5]="EndOfDictation",t[t.TooManyRequests=6]="TooManyRequests",t[t.BadRequest=7]="BadRequest",t[t.Forbidden=8]="Forbidden"})(e.RecognitionStatus||(e.RecognitionStatus={}))})(ns)),ns}var ei={},Fu;function hg(){if(Fu)return ei;Fu=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.TranslationSynthesisEnd=void 0;const e=A();let t=class Lh{constructor(u){this.privSynthesisEnd=JSON.parse(u),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=e.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=e.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(u){return new Lh(u)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};return ei.TranslationSynthesisEnd=t,ei}var ti={},xu;function dg(){if(xu)return ti;xu=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.TranslationHypothesis=void 0;const e=_(),t=Ts();let i=class Es{constructor(s,a){this.privTranslationHypothesis=s,this.privTranslationHypothesis.Offset+=a,this.privTranslationHypothesis.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationHypothesis.Translation.TranslationStatus)}static fromJSON(s,a){return new Es(JSON.parse(s),a)}static fromTranslationResponse(s,a){e.Contracts.throwIfNullOrUndefined(s,"translationHypothesis");const n=s.SpeechHypothesis;return s.SpeechHypothesis=void 0,n.Translation=s,new Es(n,a)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){return this.privTranslationHypothesis.PrimaryLanguage?.Language}asJson(){const s={...this.privTranslationHypothesis};return s.Translation!==void 0?JSON.stringify({...s,TranslationStatus:t.TranslationStatus[s.Translation.TranslationStatus]}):JSON.stringify(s)}mapTranslationStatus(s){if(typeof s=="string")return t.TranslationStatus[s];if(typeof s=="number")return s}};return ti.TranslationHypothesis=i,ti}var ri={},Uu;function lg(){if(Uu)return ri;Uu=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.TranslationPhrase=void 0;const e=_(),t=A(),i=Ts();let u=class Is{constructor(a,n){this.privTranslationPhrase=a,this.privTranslationPhrase.Offset+=n,this.privTranslationPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privTranslationPhrase.RecognitionStatus),this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationPhrase.Translation.TranslationStatus))}static fromJSON(a,n){return new Is(JSON.parse(a),n)}static fromTranslationResponse(a,n){e.Contracts.throwIfNullOrUndefined(a,"translationResponse");const r=a.SpeechPhrase;return a.SpeechPhrase=void 0,r.Translation=a,r.Text=r.DisplayText,new Is(r,n)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){return this.privTranslationPhrase.PrimaryLanguage?.Language}get Confidence(){return this.privTranslationPhrase.PrimaryLanguage?.Confidence}get Translation(){return this.privTranslationPhrase.Translation}asJson(){const a={...this.privTranslationPhrase},n={...a,RecognitionStatus:t.RecognitionStatus[a.RecognitionStatus]};return a.Translation&&(n.Translation={...a.Translation,TranslationStatus:i.TranslationStatus[a.Translation.TranslationStatus]}),JSON.stringify(n)}mapRecognitionStatus(a){if(typeof a=="string")return t.RecognitionStatus[a];if(typeof a=="number")return a}mapTranslationStatus(a){if(typeof a=="string")return i.TranslationStatus[a];if(typeof a=="number")return a}};return ri.TranslationPhrase=u,ri}var ii={},Wu;function vg(){if(Wu)return ii;Wu=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.TranslationServiceRecognizer=void 0;const e=T(),t=P(),i=A();let u=class extends i.ConversationServiceRecognizer{constructor(a,n,r,o,c){super(a,n,r,o,c),this.privTranslationRecognizer=c,this.connectionEvents.attach(p=>{p.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(a){const n=new t.PropertyCollection;let r=await this.processSpeechMessages(a);if(r)return!0;const o=async p=>{if(n.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,p.asJson()),this.privRequestSession.onPhraseRecognized(p.Offset+p.Duration),p.RecognitionStatus===i.RecognitionStatus.Success){const h=this.fireEventForResult(p,n);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,h)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(h.result)}catch(l){this.privErrorCallback&&this.privErrorCallback(l)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const h=i.EnumTranslation.implTranslateRecognitionResult(p.RecognitionStatus),l=new t.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,h,p.Text,p.Duration,p.Offset,p.Language,p.Confidence,void 0,p.asJson(),n);if(h===t.ResultReason.Canceled){const d=i.EnumTranslation.implTranslateCancelResult(p.RecognitionStatus),g=i.EnumTranslation.implTranslateCancelErrorCode(p.RecognitionStatus);await this.cancelRecognitionLocal(d,g,i.EnumTranslation.implTranslateErrorDetails(g))}else if(p.RecognitionStatus!==i.RecognitionStatus.EndOfDictation){const d=new t.TranslationRecognitionEventArgs(l,l.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,d)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(l)}catch(g){this.privErrorCallback&&this.privErrorCallback(g)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0}},c=p=>{n.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,p.asJson());const h=this.fireEventForResult(p,n);if(this.privRequestSession.onHypothesis(h.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,h)}catch{}r=!0};switch(a.messageType===e.MessageType.Text&&n.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"translation.hypothesis":c(i.TranslationHypothesis.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.response":const p=JSON.parse(a.textBody);if(p.SpeechPhrase)await o(i.TranslationPhrase.fromTranslationResponse(p,this.privRequestSession.currentTurnAudioOffset));else{const l=JSON.parse(a.textBody);l.SpeechHypothesis&&c(i.TranslationHypothesis.fromTranslationResponse(l,this.privRequestSession.currentTurnAudioOffset))}break;case"translation.phrase":await o(i.TranslationPhrase.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.synthesis":case"audio":this.sendSynthesisAudio(a.binaryBody,this.privRequestSession.sessionId),r=!0;break;case"audio.end":case"translation.synthesis.end":const h=i.TranslationSynthesisEnd.fromJSON(a.textBody);switch(h.SynthesisStatus){case i.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const l=new t.TranslationSynthesisResult(t.ResultReason.Canceled,void 0),d=new t.TranslationSynthesisEventArgs(l,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,d)}catch{}}if(this.privTranslationRecognizer.canceled){const l=new t.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,t.CancellationReason.Error,h.FailureReason,t.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,l)}catch{}}break;case i.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break}r=!0;break}return r}cancelRecognition(a,n,r,o,c){const p=new t.PropertyCollection;if(p.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]),this.privTranslationRecognizer.canceled){const h=new t.TranslationRecognitionCanceledEventArgs(a,r,c,o,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new t.TranslationRecognitionResult(void 0,n,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,c,void 0,p);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(a,n,r){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(a),n,r);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,o)}catch{}}handleRecognizedCallback(a,n,r){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(a),n,r);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,o)}catch{}}fireEventForResult(a,n){let r;if(a.Translation.Translations!==void 0){r=new t.Translations;for(const d of a.Translation.Translations)r.set(d.Language,d.Text||d.DisplayText)}let o,c;a instanceof i.TranslationPhrase?(a.Translation&&a.Translation.TranslationStatus===e.TranslationStatus.Success?o=t.ResultReason.TranslatedSpeech:o=t.ResultReason.RecognizedSpeech,c=a.Confidence):o=t.ResultReason.TranslatingSpeech;const p=a.Language,h=new t.TranslationRecognitionResult(r,this.privRequestSession.requestId,o,a.Text,a.Duration,a.Offset,p,c,a.Translation.FailureReason,a.asJson(),n);return new t.TranslationRecognitionEventArgs(h,a.Offset,this.privRequestSession.sessionId)}sendSynthesisAudio(a,n){const r=a===void 0?t.ResultReason.SynthesizingAudioCompleted:t.ResultReason.SynthesizingAudio,o=new t.TranslationSynthesisResult(r,a),c=new t.TranslationSynthesisEventArgs(o,n);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,c)}catch{}}};return ii.TranslationServiceRecognizer=u,ii}var ni={},Vu;function fg(){if(Vu)return ni;Vu=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.SpeechDetected=void 0;let e=class qh{constructor(i,u){this.privSpeechStartDetected=JSON.parse(i),this.privSpeechStartDetected.Offset+=u}static fromJSON(i,u){return new qh(i,u)}get Offset(){return this.privSpeechStartDetected.Offset}};return ni.SpeechDetected=e,ni}var si={},Hu;function gg(){if(Hu)return si;Hu=1,Object.defineProperty(si,"__esModule",{value:!0}),si.SpeechHypothesis=void 0;let e=class Bh{constructor(i,u){this.privSpeechHypothesis=JSON.parse(i),this.updateOffset(u)}static fromJSON(i,u){return new Bh(i,u)}updateOffset(i){this.privSpeechHypothesis.Offset+=i}asJson(){return JSON.stringify(this.privSpeechHypothesis)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}};return si.SpeechHypothesis=e,si}var oi={},Ku;function Sg(){if(Ku)return oi;Ku=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.SpeechKeyword=void 0;let e=class Fh{constructor(i,u){this.privSpeechKeyword=JSON.parse(i),this.privSpeechKeyword.Offset+=u}static fromJSON(i,u){return new Fh(i,u)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}asJson(){return JSON.stringify(this.privSpeechKeyword)}};return oi.SpeechKeyword=e,oi}var ai={},$u;function mg(){if($u)return ai;$u=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.SpeechServiceRecognizer=void 0;const e=P(),t=A();let i=class extends t.ServiceRecognizerBase{constructor(s,a,n,r,o){super(s,a,n,r,o),this.privSpeechRecognizer=o}async processTypeSpecificMessages(s){let a;const n=new e.PropertyCollection;let r=!1;switch(s.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const o=t.SpeechHypothesis.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset);n.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,o.asJson()),a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,void 0,void 0,o.asJson(),n),this.privRequestSession.onHypothesis(o.Offset);const c=new e.SpeechRecognitionEventArgs(a,o.Offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,c)}catch{}r=!0;break;case"speech.phrase":const p=t.SimpleSpeechPhrase.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset);n.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,p.asJson());const h=t.EnumTranslation.implTranslateRecognitionResult(p.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(p.Offset+p.Duration),e.ResultReason.Canceled===h){const l=t.EnumTranslation.implTranslateCancelResult(p.RecognitionStatus),d=t.EnumTranslation.implTranslateCancelErrorCode(p.RecognitionStatus);await this.cancelRecognitionLocal(l,d,t.EnumTranslation.implTranslateErrorDetails(d))}else{if(p.RecognitionStatus===t.RecognitionStatus.EndOfDictation)break;if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,h,p.DisplayText,p.Duration,p.Offset,p.Language,p.LanguageDetectionConfidence,void 0,void 0,p.asJson(),n);else{const d=t.DetailedSpeechPhrase.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset);n.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,d.asJson()),a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,h,d.RecognitionStatus===t.RecognitionStatus.Success?d.NBest[0].Display:"",d.Duration,d.Offset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,d.asJson(),n)}const l=new e.SpeechRecognitionEventArgs(a,a.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,l)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(a)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0;break}return r}cancelRecognition(s,a,n,r,o){const c=new e.PropertyCollection;if(c.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[r]),this.privSpeechRecognizer.canceled){const p=new e.SpeechRecognitionCanceledEventArgs(n,o,r,void 0,s);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,p)}catch{}}if(this.privSuccessCallback){const p=new e.SpeechRecognitionResult(a,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,o,void 0,c);try{this.privSuccessCallback(p),this.privSuccessCallback=void 0}catch{}}}};return ai.SpeechServiceRecognizer=i,ai}var ci={},ss={},Ju;function Cg(){return Ju||(Ju=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IdentityProvider=e.SpeakerDiarizationMode=void 0,(function(t){t.None="None",t.Identity="Identity",t.Anonymous="Anonymous"})(e.SpeakerDiarizationMode||(e.SpeakerDiarizationMode={})),(function(t){t.CallCenter="CallCenter"})(e.IdentityProvider||(e.IdentityProvider={}))})(ss)),ss}var Gu;function yg(){if(Gu)return ci;Gu=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.ConversationTranscriptionServiceRecognizer=void 0;const e=P(),t=A(),i=Cg(),u=V();let s=class extends t.ServiceRecognizerBase{constructor(n,r,o,c,p){super(n,r,o,c,p),this.privConversationTranscriber=p,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const n=this.privSpeechContext.getContext().phraseDetection||{};n.mode=u.RecognitionMode.Conversation;const r={};r.mode=i.SpeakerDiarizationMode.Anonymous,r.audioSessionId=this.privDiarizationSessionId,r.audioOffsetMs=0,r.diarizeIntermediates=this.privRecognizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceResponse_DiarizeIntermediateResults,"false")==="true",n.speakerDiarization=r,this.privSpeechContext.getContext().phraseDetection=n}}async processTypeSpecificMessages(n){let r;const o=new e.PropertyCollection;o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,n.textBody);let c=!1;switch(n.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const p=t.SpeechHypothesis.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset);r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,p.Text,p.Duration,p.Offset,p.Language,p.LanguageDetectionConfidence,p.SpeakerId,void 0,p.asJson(),o),this.privRequestSession.onHypothesis(p.Offset);const h=new e.ConversationTranscriptionEventArgs(r,p.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,h)}catch{}c=!0;break;case"speech.phrase":const l=t.SimpleSpeechPhrase.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset),d=t.EnumTranslation.implTranslateRecognitionResult(l.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(l.Offset+l.Duration),e.ResultReason.Canceled===d){const g=t.EnumTranslation.implTranslateCancelResult(l.RecognitionStatus),f=t.EnumTranslation.implTranslateCancelErrorCode(l.RecognitionStatus);await this.cancelRecognitionLocal(g,f,t.EnumTranslation.implTranslateErrorDetails(f))}else if(!(this.privRequestSession.isSpeechEnded&&d===e.ResultReason.NoMatch&&l.RecognitionStatus!==t.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,d,l.DisplayText,l.Duration,l.Offset,l.Language,l.LanguageDetectionConfidence,l.SpeakerId,void 0,l.asJson(),o);else{const f=t.DetailedSpeechPhrase.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset);r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,d,f.RecognitionStatus===t.RecognitionStatus.Success?f.NBest[0].Display:void 0,f.Duration,f.Offset,f.Language,f.LanguageDetectionConfidence,l.SpeakerId,void 0,f.asJson(),o)}const g=new e.ConversationTranscriptionEventArgs(r,r.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,g)}catch{}}c=!0;break}return c}cancelRecognition(n,r,o,c,p){if(new e.PropertyCollection().setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]),this.privConversationTranscriber.canceled){const l=new e.ConversationTranscriptionCanceledEventArgs(o,p,c,void 0,n);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,l)}catch{}}}};return ci.ConversationTranscriptionServiceRecognizer=s,ci}var ui={},Qu;function Rg(){if(Qu)return ui;Qu=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.TranscriptionServiceRecognizer=void 0;const e=T(),t=P(),i=A(),u=ze();let s=class extends i.ConversationServiceRecognizer{constructor(n,r,o,c,p){super(n,r,o,c,p),this.privTranscriberRecognizer=p,this.sendPrePayloadJSONOverride=h=>this.sendTranscriptionStartJSON(h),this.privRecognizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(n,r){if(this.privRequestSession.isRecognizing){const o=await this.fetchConnection();await this.sendSpeechEvent(o,this.createSpeechEventPayload(n,r))}}async sendMeetingSpeechEventAsync(n,r){if(this.privRequestSession.isRecognizing){const o=await this.fetchConnection();await this.sendSpeechEvent(o,this.createMeetingSpeechEventPayload(n,r))}}processTypeSpecificMessages(n){return this.processSpeechMessages(n)}handleRecognizedCallback(n,r,o){try{const c=new t.SpeechRecognitionEventArgs(n,r,o);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,c),this.privSuccessCallback){try{this.privSuccessCallback(n)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(n,r,o){try{const c=new t.SpeechRecognitionEventArgs(n,r,o);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,c)}catch{}}cancelRecognition(n,r,o,c,p){const h=new t.PropertyCollection;if(h.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[c]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const l=new t.MeetingTranscriptionCanceledEventArgs(o,p,c,void 0,n);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,l)}catch{}}}else if(this.privTranscriberRecognizer.canceled){const l=new t.ConversationTranscriptionCanceledEventArgs(o,p,c,void 0,n);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,l)}catch{}}if(this.privSuccessCallback){const l=new t.SpeechRecognitionResult(r,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,p,void 0,h);try{this.privSuccessCallback(l),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(n){if(await this.sendSpeechContext(n,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const r=this.privTranscriberRecognizer.getMeetingInfo(),o=this.createMeetingSpeechEventPayload(r,"start");await this.sendSpeechEvent(n,o)}else{const r=this.privTranscriberRecognizer.getConversationInfo(),o=this.createSpeechEventPayload(r,"start");await this.sendSpeechEvent(n,o)}await this.sendWaveHeader(n)}sendSpeechEvent(n,r){const o=JSON.stringify(r);if(o)return n.send(new u.SpeechConnectionMessage(e.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",o))}createSpeechEventPayload(n,r){const o={id:"meeting",name:r,meeting:n.conversationProperties};return o.meeting.id=n.id,o.meeting.attendees=n.participants,o}createMeetingSpeechEventPayload(n,r){const o={id:"meeting",name:r,meeting:n.meetingProperties};return o.meeting.id=n.id,o.meeting.attendees=n.participants,o}};return ui.TranscriptionServiceRecognizer=s,ui}var pi={},Xu;function Pg(){if(Xu)return pi;Xu=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.DetailedSpeechPhrase=void 0;const e=A();let t=class xh{constructor(u,s){this.privDetailedSpeechPhrase=JSON.parse(u),this.privDetailedSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privDetailedSpeechPhrase.RecognitionStatus),this.updateOffsets(s)}static fromJSON(u,s){return new xh(u,s)}updateOffsets(u){if(this.privDetailedSpeechPhrase.Offset+=u,this.privDetailedSpeechPhrase.NBest)for(const s of this.privDetailedSpeechPhrase.NBest){if(s.Words)for(const a of s.Words)a.Offset+=u;if(s.DisplayWords)for(const a of s.DisplayWords)a.Offset+=u}}asJson(){const u={...this.privDetailedSpeechPhrase};return JSON.stringify({...u,RecognitionStatus:e.RecognitionStatus[u.RecognitionStatus]})}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}mapRecognitionStatus(u){if(typeof u=="string")return e.RecognitionStatus[u];if(typeof u=="number")return u}};return pi.DetailedSpeechPhrase=t,pi}var hi={},Zu;function Eg(){if(Zu)return hi;Zu=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.SimpleSpeechPhrase=void 0;const e=A();let t=class Uh{constructor(u,s=0){this.privSimpleSpeechPhrase=JSON.parse(u),this.privSimpleSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privSimpleSpeechPhrase.RecognitionStatus),this.updateOffset(s)}static fromJSON(u,s){return new Uh(u,s)}updateOffset(u){this.privSimpleSpeechPhrase.Offset+=u}asJson(){const u={...this.privSimpleSpeechPhrase};return JSON.stringify({...u,RecognitionStatus:e.RecognitionStatus[u.RecognitionStatus]})}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}mapRecognitionStatus(u){if(typeof u=="string")return e.RecognitionStatus[u];if(typeof u=="number")return u}};return hi.SimpleSpeechPhrase=t,hi}var di={},Yu;function Ig(){if(Yu)return di;Yu=1,Object.defineProperty(di,"__esModule",{value:!0}),di.AddedLmIntent=void 0;let e=class{constructor(i,u){this.modelImpl=i,this.intentName=u}};return di.AddedLmIntent=e,di}var li={},ep;function Ag(){if(ep)return li;ep=1,Object.defineProperty(li,"__esModule",{value:!0}),li.IntentServiceRecognizer=void 0;const e=T(),t=P(),i=A();let u=class extends i.ServiceRecognizerBase{constructor(a,n,r,o,c){super(a,n,r,o,c),this.privIntentRecognizer=c,this.privIntentDataSent=!1,o.recognitionEndpointVersion="1"}setIntents(a,n){this.privAddedLmIntents=a,this.privUmbrellaIntent=n,this.privIntentDataSent=!0}processTypeSpecificMessages(a){let n,r,o=!1;const c=new t.PropertyCollection;switch(a.messageType===e.MessageType.Text&&c.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"speech.hypothesis":const h=i.SpeechHypothesis.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset);if(n=new t.IntentRecognitionResult(void 0,this.privRequestSession.requestId,t.ResultReason.RecognizingIntent,h.Text,h.Duration,h.Offset,h.Language,h.LanguageDetectionConfidence,void 0,h.asJson(),c),this.privRequestSession.onHypothesis(n.offset),r=new t.IntentRecognitionEventArgs(n,h.Offset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,r)}catch{}o=!0;break;case"speech.phrase":const l=i.SimpleSpeechPhrase.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset);n=new t.IntentRecognitionResult(void 0,this.privRequestSession.requestId,i.EnumTranslation.implTranslateRecognitionResult(l.RecognitionStatus),l.DisplayText,l.Duration,l.Offset,l.Language,l.LanguageDetectionConfidence,void 0,l.asJson(),c),r=new t.IntentRecognitionEventArgs(n,n.offset,this.privRequestSession.sessionId);const d=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,r)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(n)}catch(f){this.privErrorCallback&&this.privErrorCallback(f)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};this.privIntentDataSent===!1||t.ResultReason.NoMatch===r.result.reason?(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),d()):this.privPendingIntentArgs=r,o=!0;break;case"response":if(r=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,r===void 0){if(a.textBody==="")return;r=new t.IntentRecognitionEventArgs(new t.IntentRecognitionResult,0,this.privRequestSession.sessionId)}const g=i.IntentResponse.fromJSON(a.textBody);if(g!==null&&g.topScoringIntent&&g.topScoringIntent.intent){let f=this.privAddedLmIntents[g.topScoringIntent.intent];if(this.privUmbrellaIntent!==void 0&&(f=this.privUmbrellaIntent),f){const S=f===void 0||f.intentName===void 0?g.topScoringIntent.intent:f.intentName;let v=r.result.reason;S!==void 0&&(v=t.ResultReason.RecognizedIntent);const m=r.result.properties!==void 0?r.result.properties:new t.PropertyCollection;m.setProperty(t.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,a.textBody),r=new t.IntentRecognitionEventArgs(new t.IntentRecognitionResult(S,r.result.resultId,v,r.result.text,r.result.duration,r.result.offset,void 0,void 0,r.result.errorDetails,r.result.json,m),r.offset,r.sessionId)}}if(this.privRequestSession.onPhraseRecognized(r.offset+r.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,r)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(r.result)}catch(f){this.privErrorCallback&&this.privErrorCallback(f)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}o=!0;break}const p=new e.Deferred;return p.resolve(o),p.promise}cancelRecognition(a,n,r,o,c){const p=new t.PropertyCollection;if(p.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]),this.privIntentRecognizer.canceled){const h=new t.IntentRecognitionCanceledEventArgs(r,c,o,void 0,void 0,a);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new t.IntentRecognitionResult(void 0,n,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,c,void 0,p);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}};return li.IntentServiceRecognizer=u,li}var vi={},tp;function Tg(){if(tp)return vi;tp=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.IntentResponse=void 0;let e=class Wh{constructor(i){i===""?this.privIntentResponse={}:this.privIntentResponse=JSON.parse(i)}static fromJSON(i){return new Wh(i)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}};return vi.IntentResponse=e,vi}var os={},rp;function wg(){return rp||(rp=1,Object.defineProperty(os,"__esModule",{value:!0})),os}var fi={},gi={},ip;function _g(){if(ip)return gi;ip=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.ServiceTelemetryListener=void 0;const e=T(),t=Ds();class i{constructor(s,a,n){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=s,this.privAudioSourceId=a,this.privAudioNodeId=n,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(s){s>0&&this.privPhraseLatencies.push(Date.now()-s)}hypothesisReceived(s){s>0&&this.privHypothesisLatencies.push(Date.now()-s)}onEvent(s){this.privIsDisposed||(s instanceof t.RecognitionTriggeredEvent&&s.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:s.eventTime,Name:"ListeningTrigger",Start:s.eventTime}),s instanceof e.AudioStreamNodeAttachingEvent&&s.audioSourceId===this.privAudioSourceId&&s.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=s.eventTime),s instanceof e.AudioStreamNodeAttachedEvent&&s.audioSourceId===this.privAudioSourceId&&s.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=s.eventTime),s instanceof e.AudioSourceErrorEvent&&s.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:s.eventTime,Error:s.error,Name:"Microphone",Start:this.privMicStartTime})),s instanceof e.AudioStreamNodeErrorEvent&&s.audioSourceId===this.privAudioSourceId&&s.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:s.eventTime,Error:s.error,Name:"Microphone",Start:this.privMicStartTime})),s instanceof e.AudioStreamNodeDetachedEvent&&s.audioSourceId===this.privAudioSourceId&&s.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:s.eventTime,Name:"Microphone",Start:this.privMicStartTime})),s instanceof t.ConnectingToServiceEvent&&s.requestId===this.privRequestId&&(this.privConnectionId=s.sessionId),s instanceof e.ConnectionStartEvent&&s.connectionId===this.privConnectionId&&(this.privConnectionStartTime=s.eventTime),s instanceof e.ConnectionEstablishedEvent&&s.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:s.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),s instanceof e.ConnectionEstablishErrorEvent&&s.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:s.eventTime,Error:this.getConnectionError(s.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),s instanceof e.ConnectionMessageReceivedEvent&&s.connectionId===this.privConnectionId&&s.message&&s.message.headers&&s.message.headers.path&&(this.privReceivedMessages[s.message.headers.path]||(this.privReceivedMessages[s.message.headers.path]=new Array),this.privReceivedMessages[s.message.headers.path].length<50&&this.privReceivedMessages[s.message.headers.path].push(s.networkReceivedTime)))}getTelemetry(){const s=new Array;this.privListeningTriggerMetric&&s.push(this.privListeningTriggerMetric),this.privMicMetric&&s.push(this.privMicMetric),this.privConnectionEstablishMetric&&s.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&s.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&s.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const a={Metrics:s,ReceivedMessages:this.privReceivedMessages},n=JSON.stringify(a);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],n}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(s){switch(s){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+s.toString()}}}return gi.ServiceTelemetryListener=i,gi}var np;function bg(){if(np)return fi;np=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.RequestSession=void 0;const e=T(),t=Ds(),i=_g();let u=class{constructor(a){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=a,this.privRequestId=(0,e.createNoDashGuid)(),this.privAudioNodeId=(0,e.createNoDashGuid)(),this.privTurnDeferral=new e.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(a){this.privServiceTelemetryListener&&this.privDetachables.push(a.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new i.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new t.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(a,n){this.privAudioNode=a,this.privIsAudioNodeDetached=!1,n?await this.onComplete():this.onEvent(new t.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(a,n){this.privAuthFetchEventId=a,this.privSessionId=n,this.onEvent(new t.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(a){a&&await this.onComplete()}async onConnectionEstablishCompleted(a,n){if(a===200){this.onEvent(new t.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else a===403&&await this.onComplete()}async onServiceTurnEndResponse(a){this.privTurnDeferral.resolve(),!a||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=(0,e.createNoDashGuid)()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new e.Deferred}onHypothesis(a){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(a)))}onPhraseRecognized(a){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(a)),this.onServiceRecognized(a)}onServiceRecognized(a){this.privLastRecoOffset=a,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(a),this.privConnectionAttempts=0}onAudioSent(a){this.privBytesSent+=a,this.privRecognitionBytesSent+=a}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const a of this.privDetachables)await a.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(a){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(a),e.Events.instance.onEvent(a)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}};return fi.RequestSession=u,fi}var Si={},as={},sp;function Mg(){return sp||(sp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TentativePhraseResultsOption=e.OutputFormat=e.PhraseExtension=e.PhraseOption=void 0,(function(t){t.WordTimings="WordTimings",t.SNR="SNR",t.Pronunciation="Pronunciation",t.WordPronunciation="WordPronunciation",t.WordConfidence="WordConfidence",t.Words="Words",t.Sentiment="Sentiment",t.PronunciationAssessment="PronunciationAssessment",t.ContentAssessment="ContentAssessment",t.PhraseAMScore="PhraseAMScore",t.PhraseLMScore="PhraseLMScore",t.WordAMScore="WordAMScore",t.WordLMScore="WordLMScore",t.RuleTree="RuleTree",t.NBestTimings="NBestTimings",t.DecoderDiagnostics="DecoderDiagnostics",t.DisplayWordTimings="DisplayWordTimings",t.DisplayWords="DisplayWords"})(e.PhraseOption||(e.PhraseOption={})),(function(t){t.Graph="Graph",t.Corrections="Corrections",t.Sentiment="Sentiment"})(e.PhraseExtension||(e.PhraseExtension={})),(function(t){t.Simple="Simple",t.Detailed="Detailed"})(e.OutputFormat||(e.OutputFormat={})),(function(t){t.None="None",t.Always="Always"})(e.TentativePhraseResultsOption||(e.TentativePhraseResultsOption={}))})(as)),as}var op;function Og(){if(op)return Si;op=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.SpeechContext=void 0;const e=V(),t=Mg();let i=class{constructor(s){this.privContext={},this.privDynamicGrammar=s}getContext(){return this.privContext}setPronunciationAssessmentParams(s,a=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(s)||{},a&&(this.privContext.phraseDetection.mode=e.RecognitionMode.Conversation),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.PronunciationAssessment),this.privContext.phraseOutput.detailed.options.indexOf(t.PhraseOption.SNR)===-1&&this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.SNR)}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=t.OutputFormat.Detailed}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=t.OutputFormat.Detailed,this.privContext.phraseOutput.detailed.options.indexOf(t.PhraseOption.WordTimings)===-1&&this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.WordTimings)}setSpeakerDiarizationAudioOffsetMs(s){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=s}toJSON(){const s=this.privDynamicGrammar.generateGrammarObject();return this.privContext.dgi=s,JSON.stringify(this.privContext)}};return Si.SpeechContext=i,Si}var mi={},cs={},ap;function Dg(){return ap||(ap=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SubstringMatchType=e.GroupType=void 0,(function(t){t.IntentText="IntentText",t.IntentEntity="IntentEntity",t.Generic="Generic",t.People="People",t.Place="Place",t.DynamicEntity="DynamicEntity"})(e.GroupType||(e.GroupType={})),(function(t){t.None="None",t.LeftRooted="LeftRooted",t.PartialName="PartialName",t.MiddleOfSentence="MiddleOfSentence"})(e.SubstringMatchType||(e.SubstringMatchType={}))})(cs)),cs}var cp;function kg(){if(cp)return mi;cp=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.DynamicGrammarBuilder=void 0;const e=Dg();let t=class{constructor(){this.privWeight=1}addPhrase(u){this.privPhrases||(this.privPhrases=[]),u instanceof Array?this.privPhrases=this.privPhrases.concat(u):this.privPhrases.push(u)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(u){this.privGrammars||(this.privGrammars=[]),u instanceof Array?this.privGrammars=this.privGrammars.concat(u):this.privGrammars.push(u)}clearGrammars(){this.privGrammars=void 0}setWeight(u){this.privWeight=u}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;const u={};if(u.referenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){const s=[];this.privPhrases.forEach(a=>{s.push({text:a})}),u.groups=[{type:e.GroupType.Generic,items:s}],u.bias=this.privWeight}return u}};return mi.DynamicGrammarBuilder=t,mi}var Ci={},yi={},Ri={},us={},up;function Vh(){return up||(up=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDataStreamType=e.ActivityPayloadResponse=void 0;class t{constructor(u){this.privActivityResponse=JSON.parse(u)}static fromJSON(u){return new t(u)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}e.ActivityPayloadResponse=t,(function(i){i[i.None=0]="None",i[i.TextToSpeechAudio=1]="TextToSpeechAudio"})(e.MessageDataStreamType||(e.MessageDataStreamType={}))})(us)),us}var pp;function zg(){if(pp)return Ri;pp=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.DialogServiceTurnState=void 0;const e=Vi(),t=ke(),i=Vh();let u=class{constructor(a,n){this.privRequestId=n,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=a,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(a,n){return a.messageDataStreamType===i.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=t.AudioOutputStream.createPullStream(),this.privAudioStream.format=n!==void 0?n:e.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}};return Ri.DialogServiceTurnState=u,Ri}var hp;function Ng(){if(hp)return yi;hp=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.DialogServiceTurnStateManager=void 0;const e=G(),t=zg();let i=class{constructor(){this.privTurnMap=new Map}StartTurn(s){if(this.privTurnMap.has(s))throw new e.InvalidOperationError("Service error: There is already a turn with id:"+s);const a=new t.DialogServiceTurnState(this,s);return this.privTurnMap.set(s,a),this.privTurnMap.get(s)}GetTurn(s){return this.privTurnMap.get(s)}CompleteTurn(s){if(!this.privTurnMap.has(s))throw new e.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+s);const a=this.privTurnMap.get(s);return a.complete(),this.privTurnMap.delete(s),a}};return yi.DialogServiceTurnStateManager=i,yi}var ps={},dp;function jg(){return dp||(dp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InvocationSource=void 0,(function(t){t.None="None",t.VoiceActivationWithKeyword="VoiceActivationWithKeyword"})(e.InvocationSource||(e.InvocationSource={}))})(ps)),ps}var hs={},lp;function Lg(){return lp||(lp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OnRejectAction=e.KeywordDetectionType=void 0,(function(t){t.StartTrigger="StartTrigger"})(e.KeywordDetectionType||(e.KeywordDetectionType={})),(function(t){t.EndOfTurn="EndOfTurn",t.Continue="Continue"})(e.OnRejectAction||(e.OnRejectAction={}))})(hs)),hs}var vp;function qg(){if(vp)return Ci;vp=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.DialogServiceAdapter=void 0;const e=N(),t=Xp(),i=T(),u=Vi(),s=P(),a=Ng(),n=A(),r=Vh(),o=jg(),c=Lg(),p=ze();let h=class extends n.ServiceRecognizerBase{constructor(d,g,f,S,v){super(d,g,f,S,v),this.privEvents=new i.EventSource,this.privDialogServiceConnector=v,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new a.DialogServiceTurnStateManager,this.recognizeOverride=(m,C,y)=>this.listenOnce(m,C,y),this.postConnectImplOverride=m=>this.dialogConnectImpl(m),this.configConnectionOverride=m=>this.configConnection(m),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=f,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(m=>{m.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}async sendMessage(d){const g=(0,i.createGuid)(),f=(0,i.createNoDashGuid)(),S={context:{interactionId:g},messagePayload:JSON.parse(d),version:.5},v=JSON.stringify(S);await(await this.fetchConnection()).send(new p.SpeechConnectionMessage(i.MessageType.Text,"agent",f,"application/json",v))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,s.CancellationReason.Error,s.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(d){const g=new s.PropertyCollection;d.messageType===i.MessageType.Text&&g.setProperty(s.PropertyId.SpeechServiceResponse_JsonResult,d.textBody);let f,S;switch(d.path.toLowerCase()){case"speech.phrase":const m=n.SimpleSpeechPhrase.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);if(this.privRequestSession.onPhraseRecognized(m.Offset+m.Duration),m.RecognitionStatus!==n.RecognitionStatus.TooManyRequests&&m.RecognitionStatus!==n.RecognitionStatus.Error){const w=this.fireEventForResult(m,g);if(this.privLastResult=w.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,w)}catch{}}S=!0;break;case"speech.hypothesis":const C=n.SpeechHypothesis.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);f=new s.SpeechRecognitionResult(this.privRequestSession.requestId,s.ResultReason.RecognizingSpeech,C.Text,C.Duration,C.Offset,C.Language,C.LanguageDetectionConfidence,void 0,void 0,C.asJson(),g),this.privRequestSession.onHypothesis(C.Offset);const y=new s.SpeechRecognitionEventArgs(f,C.Offset,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,y)}catch{}S=!0;break;case"speech.keyword":const R=n.SpeechKeyword.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);f=new s.SpeechRecognitionResult(this.privRequestSession.requestId,R.Status==="Accepted"?s.ResultReason.RecognizedKeyword:s.ResultReason.NoMatch,R.Text,R.Duration,R.Offset,void 0,void 0,void 0,void 0,R.asJson(),g),R.Status!=="Accepted"&&(this.privLastResult=f);const I=new s.SpeechRecognitionEventArgs(f,f.duration,f.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,I)}catch{}S=!0;break;case"audio":{const w=d.requestId.toUpperCase(),E=this.privTurnStateManager.GetTurn(w);try{d.binaryBody?E.audioStream.write(d.binaryBody):E.endAudioStream()}catch{}}S=!0;break;case"response":this.handleResponseMessage(d),S=!0;break}const v=new i.Deferred;return v.resolve(S),v.promise}async cancelRecognition(d,g,f,S,v){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){const m=new s.PropertyCollection;m.setProperty(n.CancellationErrorCodePropertyName,s.CancellationErrorCode[S]);const C=new s.SpeechRecognitionCanceledEventArgs(f,v,S,void 0,d);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,C)}catch{}if(this.privSuccessCallback){const y=new s.SpeechRecognitionResult(void 0,s.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,v,void 0,m);try{this.privSuccessCallback(y),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(d,g,f){this.privRecognizerConfig.recognitionMode=d,this.privSuccessCallback=g,this.privErrorCallback=f,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(s.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const S=this.connectImpl(),v=this.sendPreAudioMessages(),m=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),C=await this.privDialogAudioSource.format,y=await this.privDialogAudioSource.deviceInfo,R=new e.ReplayableAudioNode(m,C.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(R,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:y};try{await S,await v}catch(E){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,s.CancellationReason.Error,s.CancellationErrorCode.ConnectionFailure,E),Promise.resolve()}const I=new s.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,I),this.sendAudio(R).then(()=>{},async E=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,s.CancellationReason.Error,s.CancellationErrorCode.RuntimeError,E)})}dialogConnectImpl(d){return this.privConnectionLoop=this.startMessageLoop(),d}receiveDialogMessageOverride(){const d=new i.Deferred,g=async()=>{try{const f=this.isDisposed(),S=!this.isDisposed()&&this.terminateMessageLoop;if(f||S){d.resolve(void 0);return}const m=await(await this.fetchConnection()).read();if(!m)return g();const C=p.SpeechConnectionMessage.fromConnectionMessage(m);switch(C.path.toLowerCase()){case"turn.start":{const D=C.requestId.toUpperCase(),W=this.privRequestSession.requestId.toUpperCase();D!==W?this.privTurnStateManager.StartTurn(D):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const R=n.SpeechDetected.fromJSON(C.textBody,this.privRequestSession.currentTurnAudioOffset),I=new s.RecognitionEventArgs(R.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,I);break;case"speech.enddetected":let w;C.textBody.length>0?w=C.textBody:w="{ Offset: 0 }";const E=n.SpeechDetected.fromJSON(w,this.privRequestSession.currentTurnAudioOffset);this.privRequestSession.onServiceRecognized(E.Offset);const M=new s.RecognitionEventArgs(E.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,M);break;case"turn.end":{const D=C.requestId.toUpperCase(),W=this.privRequestSession.requestId.toUpperCase();if(D!==W)this.privTurnStateManager.CompleteTurn(D);else{const Oe=new s.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,Oe),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(j){this.privErrorCallback&&this.privErrorCallback(j)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(C)||this.serviceEvents&&this.serviceEvents.onEvent(new i.ServiceEvent(C.path.toLowerCase(),C.textBody))}catch{}}return g()}catch{this.terminateMessageLoop=!0,d.resolve()}};return g().catch(f=>{i.Events.instance.onEvent(new i.BackgroundEvent(f))}),d.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(d){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,s.CancellationReason.Error,s.CancellationErrorCode.RuntimeError,d)}return Promise.resolve()}async configConnection(d){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(await this.sendSpeechServiceConfig(d,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(d),d)}async sendPreAudioMessages(){const d=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(d,!0),await this.sendAgentContext(d),await this.sendWaveHeader(d)}sendAgentConfig(d){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(s.PropertyId.Conversation_DialogType)===s.DialogServiceConfig.DialogTypes.CustomCommands){const f=this.agentConfig.get();f.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(s.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(f)}this.onEvent(new t.SendingAgentContextMessageEvent(this.agentConfig));const g=this.agentConfig.toJsonString();return this.agentConfigSent=!0,d.send(new p.SpeechConnectionMessage(i.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",g))}}sendAgentContext(d){const g=(0,i.createGuid)(),f=this.privDialogServiceConnector.properties.getProperty(s.PropertyId.Conversation_Speech_Activity_Template),v=JSON.stringify({channelData:"",context:{interactionId:g},messagePayload:typeof f===void 0?void 0:f,version:.5});return d.send(new p.SpeechConnectionMessage(i.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",v))}fireEventForResult(d,g){const f=n.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),S=new s.SpeechRecognitionResult(this.privRequestSession.requestId,f,d.DisplayText,d.Duration,d.Offset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,d.asJson(),g);return new s.SpeechRecognitionEventArgs(S,d.Offset,this.privRequestSession.sessionId)}handleResponseMessage(d){const g=JSON.parse(d.textBody);switch(g.messageType.toLowerCase()){case"message":const f=d.requestId.toUpperCase(),S=r.ActivityPayloadResponse.fromJSON(d.textBody),v=this.privTurnStateManager.GetTurn(f);if(S.conversationId){const y=this.agentConfig.get();y.botInfo.conversationId=S.conversationId,this.agentConfig.set(y)}const m=v.processActivityPayload(S,u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),C=new s.ActivityReceivedEventArgs(S.messagePayload,m);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,C)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new s.TurnStatusReceivedEventArgs(d.textBody))}catch{}break;default:i.Events.instance.onEvent(new i.BackgroundEvent(`Unexpected response of type ${g.messageType}. Ignoring.`));break}}onEvent(d){this.privEvents.onEvent(d),i.Events.instance.onEvent(d)}addKeywordContextData(){const d=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(d===void 0)return;const g=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),f=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),S=d.split(";"),v=g===void 0?[]:g.split(";"),m=f===void 0?[]:f.split(";"),C=[];for(let y=0;y<S.length;y++){const R={text:S[y]};y<v.length&&(R.startOffset=Number(v[y])),y<m.length&&(R.duration=Number(m[y])),C.push(R)}this.speechContext.getContext().invocationSource=o.InvocationSource.VoiceActivationWithKeyword,this.speechContext.getContext().keywordDetection=[{clientDetectedKeywords:C,onReject:{action:c.OnRejectAction.EndOfTurn},type:c.KeywordDetectionType.StartTrigger}]}};return Ci.DialogServiceAdapter=h,Ci}var Pi={},fp;function Bg(){if(fp)return Pi;fp=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.AgentConfig=void 0;let e=class{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(i){this.iPrivConfig=i}};return Pi.AgentConfig=e,Pi}var ds={},Ei={},Ii={},gp;function ks(){if(gp)return Ii;gp=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.ConversationConnectionConfig=void 0;const e=jh();let t=class ie extends e.RestConfigBase{static get host(){return ie.privHost}static get apiVersion(){return ie.privApiVersion}static get clientAppId(){return ie.privClientAppId}static get defaultLanguageCode(){return ie.privDefaultLanguageCode}static get restPath(){return ie.privRestPath}static get webSocketPath(){return ie.privWebSocketPath}static get transcriptionEventKeys(){return ie.privTranscriptionEventKeys}};return Ii.ConversationConnectionConfig=t,t.privHost="dev.microsofttranslator.com",t.privRestPath="/capito/room",t.privApiVersion="2.0",t.privDefaultLanguageCode="en-US",t.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15",t.privWebSocketPath="/capito/translate",t.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"],Ii}var Sp;function Fg(){if(Sp)return Ei;Sp=1,Object.defineProperty(Ei,"__esModule",{value:!0}),Ei.ConversationManager=void 0;const e=N(),t=_(),i=P(),u=ks();let s=class{constructor(){this.privRequestParams=u.ConversationConnectionConfig.configParams,this.privErrors=u.ConversationConnectionConfig.restErrors,this.privHost=u.ConversationConnectionConfig.host,this.privApiVersion=u.ConversationConnectionConfig.apiVersion,this.privRestPath=u.ConversationConnectionConfig.restPath,this.privRestAdapter=new e.RestMessageAdapter({})}createOrJoin(n,r,o,c){try{t.Contracts.throwIfNullOrUndefined(n,"args");const p=n.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,u.ConversationConnectionConfig.defaultLanguageCode),h=n.getProperty(i.PropertyId.ConversationTranslator_Name,"conversation_host"),l=n.getProperty(i.PropertyId.ConversationTranslator_Host,this.privHost),d=n.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),g=n.getProperty(i.PropertyId.SpeechServiceConnection_Key),f=n.getProperty(i.PropertyId.SpeechServiceConnection_Region),S=n.getProperty(i.PropertyId.SpeechServiceAuthorization_Token);t.Contracts.throwIfNullOrWhitespace(p,"languageCode"),t.Contracts.throwIfNullOrWhitespace(h,"nickname"),t.Contracts.throwIfNullOrWhitespace(l,"endpointHost");const v={};v[this.privRequestParams.apiVersion]=this.privApiVersion,v[this.privRequestParams.languageCode]=p,v[this.privRequestParams.nickname]=h;const m={};d&&(m[this.privRequestParams.correlationId]=d),m[this.privRequestParams.clientAppId]=u.ConversationConnectionConfig.clientAppId,r!==void 0?v[this.privRequestParams.roomId]=r:(t.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionRegion),m[this.privRequestParams.subscriptionRegion]=f,g?m[this.privRequestParams.subscriptionKey]=g:S?m[this.privRequestParams.authorization]=`Bearer ${S}`:t.Contracts.throwIfNullOrUndefined(g,this.privErrors.authInvalidSubscriptionKey));const C={};C.headers=m,this.privRestAdapter.options=C;const y=`https://${l}${this.privRestPath}`;this.privRestAdapter.request(e.RestRequestType.Post,y,v,null).then(R=>{const I=e.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,R.headers);if(!R.ok){if(c){let E=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",R.status.toString()),M;try{M=JSON.parse(R.data),E+=` [${M.error.code}: ${M.error.message}]`}catch{E+=` [${R.data}]`}I&&(E+=` ${I}`),c(E)}return}const w=JSON.parse(R.data);if(w&&(w.requestId=I),o){try{o(w)}catch(E){c&&c(E)}o=void 0}}).catch(()=>{})}catch(p){if(c)if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}}leave(n,r){return new Promise((o,c)=>{try{t.Contracts.throwIfNullOrUndefined(n,this.privErrors.invalidArgs.replace("{arg}","config")),t.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","token"));const p=n.getProperty(i.PropertyId.ConversationTranslator_Host,this.privHost),h=n.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),l={};l[this.privRequestParams.apiVersion]=this.privApiVersion,l[this.privRequestParams.sessionToken]=r;const d={};h&&(d[this.privRequestParams.correlationId]=h);const g={};g.headers=d,this.privRestAdapter.options=g;const f=`https://${p}${this.privRestPath}`;this.privRestAdapter.request(e.RestRequestType.Delete,f,l,null).then(S=>{S.ok,o()}).catch(()=>{})}catch(p){if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}})}};return Ei.ConversationManager=s,Ei}var Ie={},Ai={},Ti={},wi={},mp;function Hh(){if(mp)return wi;mp=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.ConversationConnectionMessage=void 0;const e=T();let t=class extends e.ConnectionMessage{constructor(u,s,a,n){super(u,s,a,n);const r=JSON.parse(this.textBody);r.type!==void 0&&(this.privConversationMessageType=r.type)}get conversationMessageType(){return this.privConversationMessageType}};return wi.ConversationConnectionMessage=t,wi}var Cp;function xg(){if(Cp)return Ti;Cp=1,Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.ConversationWebsocketMessageFormatter=void 0;const e=T(),t=Hh();let i=class{toConnectionMessage(s){const a=new e.Deferred;try{if(s.messageType===e.MessageType.Text){const n=new t.ConversationConnectionMessage(s.messageType,s.textContent,{},s.id);a.resolve(n)}else s.messageType===e.MessageType.Binary&&a.resolve(new t.ConversationConnectionMessage(s.messageType,s.binaryContent,void 0,s.id))}catch(n){a.reject(`Error formatting the message. Error: ${n}`)}return a.promise}fromConnectionMessage(s){const a=new e.Deferred;try{if(s.messageType===e.MessageType.Text){const n=`${s.textBody?s.textBody:""}`;a.resolve(new e.RawWebsocketMessage(e.MessageType.Text,n,s.id))}}catch(n){a.reject(`Error formatting the message. ${n}`)}return a.promise}};return Ti.ConversationWebsocketMessageFormatter=i,Ti}var yp;function Ug(){if(yp)return Ai;yp=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.ConversationConnectionFactory=void 0;const e=N(),t=T(),i=_(),u=P(),s=J(),a=ks(),n=xg();let r=class extends s.ConnectionFactoryBase{create(c,p,h){const l=c.parameters.getProperty(u.PropertyId.ConversationTranslator_Host,a.ConversationConnectionConfig.host),d=c.parameters.getProperty(u.PropertyId.ConversationTranslator_CorrelationId,(0,t.createGuid)()),g=`wss://${l}${a.ConversationConnectionConfig.webSocketPath}`,f=c.parameters.getProperty(u.PropertyId.ConversationTranslator_Token,void 0);i.Contracts.throwIfNullOrUndefined(f,"token");const S={};S[a.ConversationConnectionConfig.configParams.apiVersion]=a.ConversationConnectionConfig.apiVersion,S[a.ConversationConnectionConfig.configParams.token]=f,S[a.ConversationConnectionConfig.configParams.correlationId]=d;const v=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(g,S,{},new n.ConversationWebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),v,h))}};return Ai.ConversationConnectionFactory=r,Ai}var _i={},bi={},Rp;function Wg(){if(Rp)return bi;Rp=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.ConversationRequestSession=void 0;const e=T();let t=class{constructor(u){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=u,this.privRequestId=(0,e.createNoDashGuid)(),this.privRequestCompletionDeferral=new e.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(u,s){this.privSessionId=s}onAuthCompleted(u){u&&this.onComplete()}onConnectionEstablishCompleted(u){u!==200&&u===403&&this.onComplete()}onServiceTurnEndResponse(u){u?this.privRequestId=(0,e.createNoDashGuid)():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const u of this.privDetachables)await u.detach()}}onComplete(){}};return bi.ConversationRequestSession=t,bi}var L={},Pp;function Kh(){if(Pp)return L;Pp=1,Object.defineProperty(L,"__esModule",{value:!0}),L.ConversationReceivedTranslationEventArgs=L.ParticipantsListEventArgs=L.ParticipantAttributeEventArgs=L.ParticipantEventArgs=L.LockRoomEventArgs=L.MuteAllEventArgs=void 0;const e=P();class t extends e.SessionEventArgs{constructor(o,c){super(c),this.privIsMuted=o}get isMuted(){return this.privIsMuted}}L.MuteAllEventArgs=t;class i extends e.SessionEventArgs{constructor(o,c){super(c),this.privIsLocked=o}get isMuted(){return this.privIsLocked}}L.LockRoomEventArgs=i;class u extends e.SessionEventArgs{constructor(o,c){super(c),this.privParticipant=o}get participant(){return this.privParticipant}}L.ParticipantEventArgs=u;class s extends e.SessionEventArgs{constructor(o,c,p,h){super(h),this.privKey=c,this.privValue=p,this.privParticipantId=o}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}L.ParticipantAttributeEventArgs=s;class a extends e.SessionEventArgs{constructor(o,c,p,h,l,d,g,f,S){super(S),this.privRoomId=o,this.privSessionToken=c,this.privTranslateTo=p,this.privProfanityFilter=h,this.privRoomProfanityFilter=l,this.privIsRoomLocked=d,this.privIsRoomLocked=g,this.privParticipants=f}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}L.ParticipantsListEventArgs=a;class n{constructor(o,c,p){this.privPayload=c,this.privCommand=o,this.privSessionId=p}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}return L.ConversationReceivedTranslationEventArgs=n,L}var Y={},Ep;function $h(){if(Ep)return Y;Ep=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.ConversationTranslatorCommandTypes=Y.ConversationTranslatorMessageTypes=Y.InternalParticipants=void 0;class e{constructor(i=[],u){this.participants=i,this.meId=u}addOrUpdateParticipant(i){if(i===void 0)return;const u=this.getParticipantIndex(i.id);return u>-1?this.participants.splice(u,1,i):this.participants.push(i),this.getParticipant(i.id)}getParticipantIndex(i){return this.participants.findIndex(u=>u.id===i)}getParticipant(i){return this.participants.find(u=>u.id===i)}deleteParticipant(i){this.participants=this.participants.filter(u=>u.id!==i)}get host(){return this.participants.find(i=>i.isHost===!0)}get me(){return this.getParticipant(this.meId)}}return Y.InternalParticipants=e,Y.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"},Y.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"},Y}var ls={},Mi={},Ip;function Vg(){if(Ip)return Mi;Ip=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.CommandResponsePayload=void 0;const e=i=>JSON.parse(i);let t=class Jh{constructor(u){this.privCommandResponse=e(u)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(u){return new Jh(u)}};return Mi.CommandResponsePayload=t,Mi}var Ae={},Ap;function Hg(){if(Ap)return Ae;Ap=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ParticipantPayloadResponse=Ae.ParticipantsListPayloadResponse=void 0;const e=s=>JSON.parse(s),t=s=>JSON.parse(s);class i{constructor(a){this.privParticipantsPayloadResponse=e(a)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(a){return new i(a)}}Ae.ParticipantsListPayloadResponse=i;class u{constructor(a){this.privParticipantPayloadResponse=t(a)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(a){return new u(a)}}return Ae.ParticipantPayloadResponse=u,Ae}var Te={},Tp;function Kg(){if(Tp)return Te;Tp=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.TextResponsePayload=Te.SpeechResponsePayload=void 0;const e=s=>JSON.parse(s),t=s=>JSON.parse(s);class i{constructor(a){this.privSpeechResponse=e(a)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(a){return new i(a)}}Te.SpeechResponsePayload=i;class u{constructor(a){this.privTextResponse=t(a)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(a){return new u(a)}}return Te.TextResponsePayload=u,Te}var wp;function $g(){return wp||(wp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TextResponsePayload=e.SpeechResponsePayload=e.ParticipantPayloadResponse=e.ParticipantsListPayloadResponse=e.CommandResponsePayload=void 0;var t=Vg();Object.defineProperty(e,"CommandResponsePayload",{enumerable:!0,get:function(){return t.CommandResponsePayload}});var i=Hg();Object.defineProperty(e,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return i.ParticipantsListPayloadResponse}}),Object.defineProperty(e,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return i.ParticipantPayloadResponse}});var u=Kg();Object.defineProperty(e,"SpeechResponsePayload",{enumerable:!0,get:function(){return u.SpeechResponsePayload}}),Object.defineProperty(e,"TextResponsePayload",{enumerable:!0,get:function(){return u.TextResponsePayload}})})(ls)),ls}var _p;function Jg(){if(_p)return _i;_p=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.ConversationServiceAdapter=void 0;const e=T(),t=P(),i=A(),u=Hh(),s=Wg(),a=Kh(),n=$h(),r=$g();let o=class extends i.ServiceRecognizerBase{constructor(p,h,l,d,g){super(p,h,l,d,g),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=g,this.privConversationAuthentication=p,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=f=>this.conversationConnectImpl(f),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new s.ConversationRequestSession((0,e.createNoDashGuid)()),this.privConversationConnectionFactory=h,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(p){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(p),await super.dispose(p)}async sendMessage(p){return(await this.fetchConnection()).send(new u.ConversationConnectionMessage(e.MessageType.Text,p))}async sendMessageAsync(p){await(await this.fetchConnection()).send(new u.ConversationConnectionMessage(e.MessageType.Text,p))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,t.CancellationReason.Error,t.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(p,h,l,d,g){this.terminateMessageLoop=!0;const f=new t.ConversationTranslationCanceledEventArgs(l,g,d,void 0,p);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,f)}catch{}}async conversationConnectImpl(p){return this.privConnectionLoop=this.startMessageLoop(),p}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const p=new e.Deferred;try{const l=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return p.resolve(),Promise.resolve();if(!l)return this.receiveConversationMessageOverride();const d=this.privConversationRequestSession.sessionId,g=l.conversationMessageType.toLowerCase();let f=!1;try{switch(g){case"info":case"participant_command":case"command":const S=r.CommandResponsePayload.fromJSON(l.textBody);switch(S.command.toLowerCase()){case"participantlist":const I=r.ParticipantsListPayloadResponse.fromJSON(l.textBody),w=I.participants.map(j=>({avatar:j.avatar,displayName:j.nickname,id:j.participantId,isHost:j.ishost,isMuted:j.ismuted,isUsingTts:j.usetts,preferredLanguage:j.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new a.ParticipantsListEventArgs(I.roomid,I.token,I.translateTo,I.profanityFilter,I.roomProfanityFilter,I.roomLocked,I.muteAll,w,d));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(S.participantId,n.ConversationTranslatorCommandTypes.setTranslateToLanguages,S.value,d));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(S.participantId,n.ConversationTranslatorCommandTypes.setProfanityFiltering,S.value,d));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(S.participantId,n.ConversationTranslatorCommandTypes.setMute,S.value,d));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new a.MuteAllEventArgs(S.value,d));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new t.ConversationExpirationEventArgs(S.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(S.participantId,n.ConversationTranslatorCommandTypes.setUseTTS,S.value,d));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new a.LockRoomEventArgs(S.value,d));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(S.participantId,n.ConversationTranslatorCommandTypes.changeNickname,S.value,d));break;case"joinsession":const E=r.ParticipantPayloadResponse.fromJSON(l.textBody),M={avatar:E.avatar,displayName:E.nickname,id:E.participantId,isHost:E.ishost,isMuted:E.ismuted,isUsingTts:E.usetts,preferredLanguage:E.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new a.ParticipantEventArgs(M,d));break;case"leavesession":const D={id:S.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new a.ParticipantEventArgs(D,d));break;case"disconnectsession":const W={id:S.participantId};break;case"token":const Oe=new i.CognitiveTokenAuthentication(()=>{const j=S.token;return Promise.resolve(j)},()=>{const j=S.token;return Promise.resolve(j)});this.authentication=Oe,this.privConversationServiceConnector.onToken(Oe);break;default:break}break;case"partial":case"final":const v=r.SpeechResponsePayload.fromJSON(l.textBody),m=g==="final"?t.ResultReason.TranslatedParticipantSpeech:t.ResultReason.TranslatingParticipantSpeech,C=new t.ConversationTranslationResult(v.participantId,this.getTranslations(v.translations),v.language,v.id,m,v.recognition,void 0,void 0,l.textBody,void 0);v.isFinal?((C.text!==void 0&&C.text.length>0||v.id===this.privLastPartialUtteranceId)&&(f=!0),f&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(n.ConversationTranslatorMessageTypes.final,C,d))):C.text!==void 0&&(this.privLastPartialUtteranceId=v.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(n.ConversationTranslatorMessageTypes.partial,C,d)));break;case"translated_message":const y=r.TextResponsePayload.fromJSON(l.textBody),R=new t.ConversationTranslationResult(y.participantId,this.getTranslations(y.translations),y.language,void 0,void 0,y.originalText,void 0,void 0,void 0,l.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(n.ConversationTranslatorMessageTypes.instantMessage,R,d));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return p.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const p=this.receiveConversationMessageOverride();try{return await p}catch(h){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",t.CancellationReason.Error,t.CancellationErrorCode.RuntimeError,h),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(p=>p.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(p=>p),this.privConnectionConfigPromise)}getTranslations(p){let h;if(p!==void 0){h=new t.Translations;for(const l of p)h.set(l.lang,l.translation)}return h}};return _i.ConversationServiceAdapter=o,_i}var bp;function Gg(){if(bp)return Ie;bp=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.ConversationTranslatorRecognizer=Ie.ConversationRecognizerFactory=void 0;const e=A(),t=T(),i=_(),u=P(),s=Ug(),a=Jg();class n{static fromConfig(c,p,h){return new r(c,p,h)}}Ie.ConversationRecognizerFactory=n;let r=class extends u.Recognizer{constructor(c,p,h){const l=p;i.Contracts.throwIfNull(l,"speechConfig");const d=c;i.Contracts.throwIfNull(d,"conversationImpl"),super(h,l.properties,new s.ConversationConnectionFactory),this.privConversation=d,this.privIsDisposed=!1,this.privProperties=l.properties.clone(),this.privConnection=u.Connection.fromRecognizer(this),this.privProperties.getProperty(u.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=t.Timeout.setTimeout,this.privClearTimeout=t.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(c){this.privConnection.connected=c}set disconnected(c){this.privConnection.disconnected=c}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(c,p,h){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfNullOrWhitespace(c,"token"),this.privReco.conversationTranslatorToken=c,this.resetConversationTimeout(),this.privReco.connectAsync(p,h)}catch(l){if(h)if(l instanceof Error){const d=l;h(d.name+": "+d.message)}else h(l)}}disconnect(c,p){try{i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{c&&c()},h=>{p&&p(h)})}catch(h){if(p)if(h instanceof Error){const l=h;p(l.name+": "+l.message)}else p(h);this.dispose(!0).catch(l=>{t.Events.instance.onEvent(new t.BackgroundEvent(l))})}}sendRequest(c,p,h){try{i.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(c,p,h)}catch(l){if(h)if(l instanceof Error){const d=l;h(d.name+": "+d.message)}else h(l);this.dispose(!0).catch(d=>{t.Events.instance.onEvent(new t.BackgroundEvent(d))})}}onToken(c){this.privConversation.onToken(c)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(c){this.privIsDisposed||c&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),await super.dispose(c))}createRecognizerConfig(c){return new e.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,p,h,l){const d=h;return new a.ConversationServiceAdapter(c,p,d,l,this)}sendMessage(c,p,h){const l=this.privReco;((g,f,S)=>{g!==void 0?g.then(()=>{try{f&&f()}catch(v){S&&S(`'Unhandled error on promise callback: ${v}'`)}},v=>{try{S&&S(v)}catch{}}):S&&S("Null promise")})(l.sendMessageAsync(c),p,h),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};return Ie.ConversationTranslatorRecognizer=r,Ie}var Oi={},Mp;function Qg(){if(Mp)return Oi;Mp=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.TranscriberRecognizer=void 0;const e=T(),t=_(),i=P(),u=A(),s=V();let a=class extends i.Recognizer{constructor(r,o){const c=r;t.Contracts.throwIfNull(c,"speechTranslationConfig");const p=o;t.Contracts.throwIfNull(p,"audioConfigImpl"),t.Contracts.throwIfNullOrWhitespace(c.speechRecognitionLanguage,i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new u.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return t.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){t.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,r)}set conversation(r){t.Contracts.throwIfNullOrUndefined(r,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=r}getConversationInfo(){return t.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(r){t.Contracts.throwIfNullOrUndefined(r,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=r}getMeetingInfo(){return t.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(r,o){(0,e.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(s.RecognitionMode.Conversation),r,o)}stopContinuousRecognitionAsync(r,o){(0,e.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(r,o){const c=this.privReco;t.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendSpeechEventAsync(r,o)}async pushMeetingEvent(r,o){const c=this.privReco;t.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendMeetingSpeechEventAsync(r,o)}async enforceAudioGating(){const c=(await this.audioConfig.format).channels;if(c===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(c!==8)throw new Error(`Unsupported audio configuration: Detected ${c}-channel audio`)}connectMeetingCallbacks(r){this.isMeetingRecognizer=!0,this.canceled=(o,c)=>{r.canceled&&r.canceled(r,c)},this.recognizing=(o,c)=>{r.transcribing&&r.transcribing(r,c)},this.recognized=(o,c)=>{r.transcribed&&r.transcribed(r,c)},this.sessionStarted=(o,c)=>{r.sessionStarted&&r.sessionStarted(r,c)},this.sessionStopped=(o,c)=>{r.sessionStopped&&r.sessionStopped(r,c)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new u.RecognizerConfig(r,this.properties)}createServiceRecognizer(r,o,c,p){const h=c;return new u.TranscriptionServiceRecognizer(r,o,h,p,this)}};return Oi.TranscriberRecognizer=a,Oi}var Op;function Xg(){return Op||(Op=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InternalParticipants=e.ConversationTranslatorMessageTypes=e.ConversationTranslatorCommandTypes=e.ParticipantsListEventArgs=e.ParticipantEventArgs=e.ParticipantAttributeEventArgs=e.MuteAllEventArgs=e.LockRoomEventArgs=e.ConversationReceivedTranslationEventArgs=e.TranscriberRecognizer=e.ConversationRecognizerFactory=e.ConversationConnectionConfig=e.ConversationManager=void 0;var t=Fg();Object.defineProperty(e,"ConversationManager",{enumerable:!0,get:function(){return t.ConversationManager}});var i=ks();Object.defineProperty(e,"ConversationConnectionConfig",{enumerable:!0,get:function(){return i.ConversationConnectionConfig}});var u=Gg();Object.defineProperty(e,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return u.ConversationRecognizerFactory}});var s=Qg();Object.defineProperty(e,"TranscriberRecognizer",{enumerable:!0,get:function(){return s.TranscriberRecognizer}});var a=Kh();Object.defineProperty(e,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return a.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(e,"LockRoomEventArgs",{enumerable:!0,get:function(){return a.LockRoomEventArgs}}),Object.defineProperty(e,"MuteAllEventArgs",{enumerable:!0,get:function(){return a.MuteAllEventArgs}}),Object.defineProperty(e,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return a.ParticipantAttributeEventArgs}}),Object.defineProperty(e,"ParticipantEventArgs",{enumerable:!0,get:function(){return a.ParticipantEventArgs}}),Object.defineProperty(e,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return a.ParticipantsListEventArgs}});var n=$h();Object.defineProperty(e,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return n.ConversationTranslatorCommandTypes}}),Object.defineProperty(e,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return n.ConversationTranslatorMessageTypes}}),Object.defineProperty(e,"InternalParticipants",{enumerable:!0,get:function(){return n.InternalParticipants}})})(ds)),ds}var vs={},Dp;function Gh(){return Dp||(Dp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SynthesisAudioMetadata=e.MetadataType=void 0,(function(i){i.WordBoundary="WordBoundary",i.Bookmark="Bookmark",i.Viseme="Viseme",i.SentenceBoundary="SentenceBoundary",i.SessionEnd="SessionEnd",i.AvatarSignal="TalkingAvatarSignal"})(e.MetadataType||(e.MetadataType={}));class t{constructor(u){this.privSynthesisAudioMetadata=JSON.parse(u)}static fromJSON(u){return new t(u)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}e.SynthesisAudioMetadata=t})(vs)),vs}var Di={},$={},kp;function Zg(){if(kp)return $;kp=1,Object.defineProperty($,"__esModule",{value:!0}),$.SynthesisStartedEvent=$.ConnectingToSynthesisServiceEvent=$.SynthesisTriggeredEvent=$.SpeechSynthesisEvent=void 0;const e=T();class t extends e.PlatformEvent{constructor(n,r,o=e.EventType.Info){super(n,o),this.privRequestId=r}get requestId(){return this.privRequestId}}$.SpeechSynthesisEvent=t;class i extends t{constructor(n,r,o){super("SynthesisTriggeredEvent",n),this.privSessionAudioDestinationId=r,this.privTurnAudioDestinationId=o}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}$.SynthesisTriggeredEvent=i;class u extends t{constructor(n,r){super("ConnectingToSynthesisServiceEvent",n),this.privAuthFetchEventId=r}get authFetchEventId(){return this.privAuthFetchEventId}}$.ConnectingToSynthesisServiceEvent=u;class s extends t{constructor(n,r){super("SynthesisStartedEvent",n),this.privAuthFetchEventId=r}get authFetchEventId(){return this.privAuthFetchEventId}}return $.SynthesisStartedEvent=s,$}var zp;function Yg(){if(zp)return Di;zp=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.SynthesisTurn=void 0;const e=T(),t=ke(),i=P(),u=Gh(),s=Zg();let a=class As{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=(0,e.createNoDashGuid)(),this.privTurnDeferral=new e.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(r){this.privStreamId=r}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(r){this.privAudioOutputFormat=r}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const r=new i.PropertyCollection;return r.setProperty(i.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),r}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const r=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(r),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(r,o,c,p){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=r,this.privRawText=o,this.privIsSSML=c,this.privAudioOutputStream=new t.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",p!==void 0&&(this.privTurnAudioDestination=p,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new s.SynthesisTriggeredEvent(this.requestId,void 0,p===void 0?void 0:p.id()))}onPreConnectionStart(r){this.privAuthFetchEventId=r,this.onEvent(new s.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(r){r&&this.onComplete()}onConnectionEstablishCompleted(r){if(r===200){this.onEvent(new s.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else r===403&&this.onComplete()}onServiceResponseMessage(r){const o=JSON.parse(r);this.streamId=o.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(r){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new e.Deferred;const o=JSON.parse(r);o.webrtc&&(this.privWebRTCSDP=o.webrtc.connectionString)}onAudioChunkReceived(r){this.isSynthesizing&&(this.privAudioOutputStream.write(r),this.privBytesReceived+=r.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(r))}onTextBoundaryEvent(r){this.updateTextOffset(r.Data.text.Text,r.Type)}onVisemeMetadataReceived(r){r.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=r.Data.AnimationChunk)}onSessionEnd(r){this.privAudioDuration=r.Data.Offset}async constructSynthesisResult(){const r=await this.getAllReceivedAudioWithHeader();return new i.SpeechSynthesisResult(this.requestId,i.ResultReason.SynthesizingAudioCompleted,r,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const r=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",r}onEvent(r){e.Events.instance.onEvent(r)}static isXmlTag(r){return r.length>=2&&r[0]==="<"&&r[r.length-1]===">"}updateTextOffset(r,o){o===u.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(r,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+r.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!As.isXmlTag(r)&&this.updateTextOffset(r,o))):(this.privSentenceOffset=this.privRawText.indexOf(r,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+r.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!As.isXmlTag(r)&&this.updateTextOffset(r,o)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(r){return this.privRawText.indexOf("<",r+1)>this.privRawText.indexOf(">",r+1)}};return Di.SynthesisTurn=a,Di}var ki={},Np;function eS(){if(Np)return ki;Np=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.SynthesisAdapterBase=void 0;const e=T(),t=P(),i=A(),u=ze();let s=class{constructor(n,r,o,c){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!n)throw new e.ArgumentNullError("authentication");if(!r)throw new e.ArgumentNullError("connectionFactory");if(!o)throw new e.ArgumentNullError("synthesizerConfig");this.privAuthentication=n,this.privConnectionFactory=r,this.privSynthesizerConfig=o,this.privIsDisposed=!1,this.privSessionAudioDestination=c,this.privSynthesisTurn=new i.SynthesisTurn,this.privConnectionEvents=new e.EventSource,this.privServiceEvents=new e.EventSource,this.privSynthesisContext=new i.SynthesisContext,this.privAgentConfig=new i.AgentConfig,this.connectionEvents.attach(p=>{if(p.name==="ConnectionClosedEvent"){const h=p;h.statusCode!==1e3&&this.cancelSynthesisLocal(t.CancellationReason.Error,h.statusCode===1007?t.CancellationErrorCode.BadRequestParameters:t.CancellationErrorCode.ConnectionFailure,`${h.reason} websocket error code: ${h.statusCode}`)}})}get synthesizerConfig(){return this.privSynthesizerConfig}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(n){this.privActivityTemplate=n}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(n){this.privAudioOutputFormat=n,this.privSynthesisTurn.audioOutputFormat=n,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=n),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=n)}isDisposed(){return this.privIsDisposed}async dispose(n){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(n)}async connect(){await this.connectImpl()}async sendNetworkMessage(n,r){const o=typeof r=="string"?e.MessageType.Text:e.MessageType.Binary,c=typeof r=="string"?"application/json":"";return(await this.fetchConnection()).send(new u.SpeechConnectionMessage(o,n,this.privSynthesisTurn.requestId,c,r))}async Speak(n,r,o,c,p,h){let l;if(r?l=n:l=this.privSynthesizer.buildSsml(n),this.speakOverride!==void 0)return this.speakOverride(l,o,c,p);this.privSuccessCallback=c,this.privErrorCallback=p,this.privSynthesisTurn.startNewSynthesis(o,n,r,h);try{await this.connectImpl();const d=await this.fetchConnection();await this.sendSynthesisContext(d),await this.sendSsmlMessage(d,l,o),this.onSynthesisStarted(o),this.receiveMessage()}catch(d){return this.cancelSynthesisLocal(t.CancellationReason.Error,t.CancellationErrorCode.ConnectionFailure,d),Promise.reject(d)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new u.SpeechConnectionMessage(e.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}cancelSynthesis(n,r,o,c){const p=new t.PropertyCollection;p.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]);const h=new t.SpeechSynthesisResult(n,t.ResultReason.Canceled,void 0,c,p);if(this.onSynthesisCancelled(h),this.privSuccessCallback)try{this.privSuccessCallback(h)}catch{}}cancelSynthesisLocal(n,r,o){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,n,r,o))}processTypeSpecificMessages(n){return!0}async receiveMessage(){try{const r=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!r)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const o=u.SpeechConnectionMessage.fromConnectionMessage(r);if(o.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(o.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(o.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(o.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===o.streamId.toLowerCase()&&o.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(o.binaryBody),this.onSynthesizing(o.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(o.binaryBody));break;case"audio.metadata":const c=i.SynthesisAudioMetadata.fromJSON(o.textBody).Metadata;for(const h of c)switch(h.Type){case i.MetadataType.WordBoundary:case i.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(h);const l=new t.SpeechSynthesisWordBoundaryEventArgs(h.Data.Offset,h.Data.Duration,h.Data.text.Text,h.Data.text.Length,h.Type===i.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,h.Data.text.BoundaryType);this.onWordBoundary(l);break;case i.MetadataType.Bookmark:const d=new t.SpeechSynthesisBookmarkEventArgs(h.Data.Offset,h.Data.Bookmark);this.onBookmarkReached(d);break;case i.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(h),h.Data.IsLastAnimation){const g=new t.SpeechSynthesisVisemeEventArgs(h.Data.Offset,h.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(g)}break;case i.MetadataType.AvatarSignal:this.onAvatarEvent(h);break;case i.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(h);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let p;try{p=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(p)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.onSynthesisCompleted(p);break;default:this.processTypeSpecificMessages(o)||this.privServiceEvents&&this.serviceEvents.onEvent(new e.ServiceEvent(o.path.toLowerCase(),o.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(n){this.setSynthesisContextSynthesisSection();const r=this.synthesisContext.toJSON();if(r)return n.send(new u.SpeechConnectionMessage(e.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",r))}setSpeechConfigSynthesisSection(){}connectImpl(n=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(o=>o.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=(0,e.createNoDashGuid)(),this.privConnectionId=(0,e.createNoDashGuid)(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const r=n?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=r.then(async o=>{this.privSynthesisTurn.onAuthCompleted(!1);const c=await this.privConnectionFactory.create(this.privSynthesizerConfig,o,this.privConnectionId);c.events.attach(h=>{this.connectionEvents.onEvent(h)});const p=await c.open();return p.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(p.statusCode),Promise.resolve(c)):p.statusCode===403&&!n?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(p.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${p.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Url)} Reason: ${p.reason}`))},o=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(o)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(n,r){if(r)return n.send(new u.SpeechConnectionMessage(e.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",r))}sendSsmlMessage(n,r,o){return n.send(new u.SpeechConnectionMessage(e.MessageType.Text,"ssml",o,"application/ssml+xml",r))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(n=>n.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async configureConnection(){const n=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(n):(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(n,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),n)}onAvatarEvent(n){}onSynthesisStarted(n){}onSynthesizing(n){}onSynthesisCancelled(n){}onSynthesisCompleted(n){}onWordBoundary(n){}onVisemeReceived(n){}onBookmarkReached(n){}};return ki.SynthesisAdapterBase=s,s.telemetryDataEnabled=!0,ki}var zi={},jp;function tS(){if(jp)return zi;jp=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.AvatarSynthesisAdapter=void 0;const e=P(),t=A();let i=class extends t.SynthesisAdapterBase{constructor(s,a,n,r,o){super(s,a,n,void 0),this.privAvatarSynthesizer=r,this.privSynthesizer=r,this.privAvatarConfig=o}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:this.privAvatarConfig.videoFormat?.bitrate,codec:this.privAvatarConfig.videoFormat?.codec,crop:{bottomRight:{x:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.y},topLeft:{x:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.y}},resolution:{height:this.privAvatarConfig.videoFormat?.height,width:this.privAvatarConfig.videoFormat?.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(e.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:this.privAvatarConfig.backgroundImage?.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style,useBuiltInVoice:this.privAvatarConfig.useBuiltInVoice}}}onAvatarEvent(s){if(this.privAvatarSynthesizer.avatarEventReceived){const a=new e.AvatarEventArgs(s.Data.Offset,s.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,a)}catch{}}}};return zi.AvatarSynthesisAdapter=i,zi}var Ni={},Lp;function rS(){if(Lp)return Ni;Lp=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.SpeechSynthesisAdapter=void 0;const e=P(),t=A();let i=class extends t.SynthesisAdapterBase{constructor(s,a,n,r,o){super(s,a,n,o),this.privSpeechSynthesizer=r,this.privSynthesizer=r}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(s){const a=new e.SpeechSynthesisEventArgs(new e.SpeechSynthesisResult(s,e.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,a)}onSynthesizing(s){if(this.privSpeechSynthesizer.synthesizing)try{const a=this.privSynthesisTurn.audioOutputFormat.addHeader(s),n=new e.SpeechSynthesisEventArgs(new e.SpeechSynthesisResult(this.privSynthesisTurn.requestId,e.ResultReason.SynthesizingAudio,a));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,n)}catch{}}onSynthesisCancelled(s){if(this.privSpeechSynthesizer.SynthesisCanceled){const a=new e.SpeechSynthesisEventArgs(s);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,a)}catch{}}}onSynthesisCompleted(s){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new e.SpeechSynthesisEventArgs(s))}catch{}}onWordBoundary(s){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,s)}catch{}}onVisemeReceived(s){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,s)}catch{}}onBookmarkReached(s){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,s)}catch{}}};return Ni.SpeechSynthesisAdapter=i,Ni}var ji={},qp;function iS(){if(qp)return ji;qp=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.SynthesisRestAdapter=void 0;const e=N(),t=P(),i=J(),u=q();let s=class{constructor(n,r){let o=n.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!o){const p=n.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,"westus"),h=i.ConnectionFactoryBase.getHostSuffix(p);o=n.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,`https://${p}.tts.speech${h}`)}this.privUri=`${o}/cognitiveservices/voices/list`;const c=e.RestConfigBase.requestOptions;this.privRestAdapter=new e.RestMessageAdapter(c),this.privAuthentication=r}getVoicesList(n){return this.privRestAdapter.setHeaders(u.HeaderNames.ConnectionId,n),this.privAuthentication.fetch(n).then(r=>(this.privRestAdapter.setHeaders(r.headerName,r.token),this.privRestAdapter.request(e.RestRequestType.Get,this.privUri)))}};return ji.SynthesisRestAdapter=s,ji}var fs={},Bp;function nS(){return Bp||(Bp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SynthesizerConfig=e.SynthesisServiceType=void 0;const t=A();var i;(function(s){s[s.Standard=0]="Standard",s[s.Custom=1]="Custom"})(i=e.SynthesisServiceType||(e.SynthesisServiceType={}));class u{constructor(a,n){this.privSynthesisServiceType=i.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=a||new t.SpeechServiceConfig(new t.Context(null)),this.privParameters=n}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(a){this.privSynthesisServiceType=a}set synthesisVideoSection(a){this.privSpeechServiceConfig.Context.synthesis={video:a}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}setContextFromJson(a){const n=JSON.parse(a);n.system&&(this.privSpeechServiceConfig.Context.system=n.system),n.os&&(this.privSpeechServiceConfig.Context.os=n.os),n.audio&&(this.privSpeechServiceConfig.Context.audio=n.audio),n.synthesis&&(this.privSpeechServiceConfig.Context.synthesis=n.synthesis)}}e.SynthesizerConfig=u})(fs)),fs}var Li={},Fp;function sS(){if(Fp)return Li;Fp=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.SynthesisContext=void 0;const e=P();let t=class{constructor(){this.privContext={}}setSection(u,s){this.privContext[u]=s}set audioOutputFormat(u){this.privAudioOutputFormat=u}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(u){const s=this.buildSynthesisContext(u);this.setSection("synthesis",s)}buildSynthesisContext(u){return{audio:{metadataOptions:{bookmarkEnabled:!!u?.bookmarkReached,punctuationBoundaryEnabled:u?.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!u?.wordBoundary),sentenceBoundaryEnabled:u?.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!u?.visemeReceived,wordBoundaryEnabled:u?.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!u?.wordBoundary)},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:u?.autoDetectSourceLanguage}}}};return Li.SynthesisContext=t,Li}var qi={},xp;function oS(){if(xp)return qi;xp=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.SpeakerRecognitionConfig=void 0;const e=A();let t=class{constructor(u,s){this.privContext=u||new e.Context(null),this.privParameters=s}get parameters(){return this.privParameters}get Context(){return this.privContext}};return qi.SpeakerRecognitionConfig=t,qi}var Bi={},Up;function aS(){if(Up)return Bi;Up=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.SpeakerServiceRecognizer=void 0;const e=N(),t=T(),i=P(),u=A(),s=ze();let a=class extends u.ServiceRecognizerBase{constructor(r,o,c,p,h){super(r,o,c,p,h),this.privSpeakerRecognizer=h,this.privSpeakerAudioSource=c,this.recognizeSpeaker=l=>this.recognizeSpeakerOnce(l),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(r){let o=!1;const c=new i.PropertyCollection;switch(r.messageType===t.MessageType.Text&&c.setProperty(i.PropertyId.SpeechServiceResponse_JsonResult,r.textBody),r.path.toLowerCase()){case"speaker.response":const h=JSON.parse(r.textBody);let l;h.status.statusCode.toLowerCase()!=="success"?l=new i.SpeakerRecognitionResult(h,i.ResultReason.Canceled,i.CancellationErrorCode.ServiceError,h.status.reason):l=new i.SpeakerRecognitionResult(h,i.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(l),o=!0;break}const p=new t.Deferred;return p.resolve(o),p.promise}cancelRecognition(r,o,c,p,h){if(new i.PropertyCollection().setProperty(u.CancellationErrorCodePropertyName,i.CancellationErrorCode[p]),this.privResultDeferral){const d=new i.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:h,reason:h}},i.ResultReason.Canceled,p,h);try{this.privResultDeferral.resolve(d)}catch(g){this.privResultDeferral.reject(g)}}}async recognizeSpeakerOnce(r){this.privSpeakerModel=r,this.voiceProfileType=r.scenario,this.privResultDeferral||(this.privResultDeferral=new t.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(i.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const o=this.connectImpl(),c=this.sendPreAudioMessages(this.extractSpeakerContext(r)),p=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),h=await this.privSpeakerAudioSource.format,l=await this.privSpeakerAudioSource.deviceInfo,d=new e.ReplayableAudioNode(p,h.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(d,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:l};try{await o,await c}catch(S){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,i.CancellationReason.Error,i.CancellationErrorCode.ConnectionFailure,S)}const g=new i.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,g),this.receiveMessage(),this.sendAudio(d).then(()=>{},S=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,i.CancellationReason.Error,i.CancellationErrorCode.RuntimeError,S)}),this.privResultDeferral.promise}async sendPreAudioMessages(r){const o=await this.fetchConnection();await this.sendSpeakerRecognition(o,r)}async sendSpeakerRecognition(r,o){const c=JSON.stringify(o);return r.send(new s.SpeechConnectionMessage(t.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",c))}extractSpeakerContext(r){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:r.profileIds,scenario:r.scenario}}};return Bi.SpeakerServiceRecognizer=a,Bi}var Fi={},Wp;function cS(){if(Wp)return Fi;Wp=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.VoiceServiceRecognizer=void 0;const e=N(),t=T(),i=P(),u=A(),s=ze();let a=class extends u.ServiceRecognizerBase{constructor(r,o,c,p,h){super(r,o,c,p,h),this.privDeferralMap=new t.DeferralMap,this.privSpeakerAudioSource=c,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(r){this.privSpeakerAudioSource=r}processTypeSpecificMessages(r){let o=!1;const c=new i.PropertyCollection;switch(r.messageType===t.MessageType.Text&&c.setProperty(i.PropertyId.SpeechServiceResponse_JsonResult,r.textBody),r.path.toLowerCase()){case"speaker.profiles":const h=JSON.parse(r.textBody);switch(h.operation.toLowerCase()){case"create":this.handleCreateResponse(h,r.requestId);break;case"delete":case"reset":this.handleResultResponse(h,r.requestId);break;case"fetch":const f=JSON.parse(r.textBody);this.handleFetchResponse(f,r.requestId);break}o=!0;break;case"speaker.phrases":const l=JSON.parse(r.textBody);this.handlePhrasesResponse(l,r.requestId),o=!0;break;case"speaker.profile.enrollment":const d=JSON.parse(r.textBody),g=new i.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(d.enrollment?d.enrollment.enrollmentStatus:d.status.statusCode),d.enrollment?JSON.stringify(d.enrollment):void 0,d.status.reason);this.privDeferralMap.getId(r.requestId)&&this.privDeferralMap.complete(r.requestId,g),this.privRequestSession.onSpeechEnded(),o=!0;break}const p=new t.Deferred;return p.resolve(o),p.promise}cancelRecognition(r,o,c,p,h){new i.PropertyCollection().setProperty(u.CancellationErrorCodePropertyName,i.CancellationErrorCode[p]);const d=new i.VoiceProfileEnrollmentResult(i.ResultReason.Canceled,h,h);this.privDeferralMap.getId(o)&&this.privDeferralMap.complete(o,d)}async createProfile(r,o){this.voiceProfileType=r.toString();const c=this.connectImpl();try{const p=new t.Deferred;return await c,await this.sendCreateProfile(p,r,o),this.receiveMessage(),p.promise}catch(p){throw p}}async resetProfile(r){return this.voiceProfileType=r.profileType.toString(),this.sendCommonRequest("reset",r.profileType,r)}async deleteProfile(r){return this.voiceProfileType=r.profileType.toString(),this.sendCommonRequest("delete",r.profileType,r)}async retrieveEnrollmentResult(r){return this.voiceProfileType=r.profileType.toString(),this.privExpectedProfileId=r.profileId,this.sendCommonRequest("fetch",r.profileType,r)}async getAllProfiles(r){return this.voiceProfileType=r.toString(),this.sendCommonRequest("fetch",r)}async getActivationPhrases(r,o){this.voiceProfileType=r.toString();const c=this.connectImpl();try{const p=new t.Deferred;return await c,await this.sendPhrasesRequest(p,r,o),this.receiveMessage(),p.promise}catch(p){throw p}}async enrollProfile(r){this.voiceProfileType=r.profileType.toString();const o=new t.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(i.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const c=this.connectImpl(),p=this.sendPreAudioMessages(r,o),h=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),l=await this.privSpeakerAudioSource.format,d=await this.privSpeakerAudioSource.deviceInfo,g=new e.ReplayableAudioNode(h,l.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(g,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:d};try{await c,await p}catch(v){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,i.CancellationReason.Error,i.CancellationErrorCode.ConnectionFailure,v)}const f=new i.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,f),this.receiveMessage(),this.sendAudio(g).then(()=>{},v=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,i.CancellationReason.Error,i.CancellationErrorCode.RuntimeError,v)}),o.promise}async sendPreAudioMessages(r,o){const c=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,o),await this.sendBaseRequest(c,"enroll",this.scenarioFrom(r.profileType),r)}async sendPhrasesRequest(r,o,c){const p=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,r);const h=this.scenarioFrom(o),l={locale:c,scenario:h};return p.send(new s.SpeechConnectionMessage(t.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(l)))}async sendCreateProfile(r,o,c){const p=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,r);const h=o===i.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":o===i.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",l={locale:c,number:"1",scenario:h};return p.send(new s.SpeechConnectionMessage(t.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(l)))}async sendCommonRequest(r,o,c=void 0){const p=this.connectImpl();try{const h=new t.Deferred;this.privRequestSession.onSpeechContext(),await p;const l=await this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,h),await this.sendBaseRequest(l,r,this.scenarioFrom(o),c),this.receiveMessage(),h.promise}catch(h){throw h}}async sendBaseRequest(r,o,c,p){const h={scenario:c};return p?h.profileIds=[p.profileId]:h.maxPageSize=-1,r.send(new s.SpeechConnectionMessage(t.MessageType.Text,`speaker.profile.${o}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(h)))}extractSpeakerContext(r){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:r.profileIds,scenario:r.scenario}}handlePhrasesResponse(r,o){if(this.privDeferralMap.getId(o))if(r.status.statusCode.toLowerCase()!=="success"){const c=i.ResultReason.Canceled,p=new i.VoiceProfilePhraseResult(c,r.status.statusCode,r.passPhraseType,[]);this.privDeferralMap.complete(o,p)}else if(r.phrases&&r.phrases.length>0){const c=i.ResultReason.EnrollingVoiceProfile,p=new i.VoiceProfilePhraseResult(c,r.status.statusCode,r.passPhraseType,r.phrases);this.privDeferralMap.complete(o,p)}else throw new Error("Voice Profile get activation phrases failed, no phrases received");else throw new Error(`Voice Profile get activation phrases request for requestID ${o} not found`)}handleCreateResponse(r,o){if(r.profiles&&r.profiles.length>0)if(this.privDeferralMap.getId(o)){const c=r.profiles.map(p=>p.profileId);this.privDeferralMap.complete(o,c)}else throw new Error(`Voice Profile create request for requestID ${o} not found`);else throw new Error("Voice Profile create failed, no profile id received")}handleResultResponse(r,o){if(this.privDeferralMap.getId(o)){const c=r.operation.toLowerCase()==="delete"?i.ResultReason.DeletedVoiceProfile:i.ResultReason.ResetVoiceProfile,p=r.status.statusCode.toLowerCase()==="success"?c:i.ResultReason.Canceled,h=new i.VoiceProfileResult(p,`statusCode: ${r.status.statusCode}, errorDetails: ${r.status.reason}`);this.privDeferralMap.complete(o,h)}else throw new Error(`Voice Profile create request for requestID ${o} not found`)}handleFetchResponse(r,o){if(this.privDeferralMap.getId(o)&&r.profiles[0]){if(this.privExpectedProfileId&&r.profiles.length===1&&r.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;const c=r.profiles[0],p=new i.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(c.enrollmentStatus),JSON.stringify(c),r.status.reason);this.privDeferralMap.complete(o,p)}else if(r.profiles.length>0){const c=r.profiles,p=[];for(const h of c)p.push(new i.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(h.enrollmentStatus),JSON.stringify(h),r.status.reason));this.privDeferralMap.complete(o,p)}}else throw new Error(`Voice Profile fetch request for requestID ${o} not found`)}enrollmentReasonFrom(r){switch(r.toLowerCase()){case"enrolled":return i.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return i.ResultReason.Canceled;default:return i.ResultReason.EnrollingVoiceProfile}}scenarioFrom(r){return r===i.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":r===i.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}};return Fi.VoiceServiceRecognizer=a,Fi}var gs={},Vp;function uS(){return Vp||(Vp=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.type=e.connectivity=e.Device=e.OS=e.System=e.Context=e.SpeechServiceConfig=void 0;class t{constructor(r){this.context=r}serialize(){return JSON.stringify(this,(r,o)=>{if(o&&typeof o=="object"&&!Array.isArray(o)){const c={};for(const p in o)Object.hasOwnProperty.call(o,p)&&(c[p&&p.charAt(0).toLowerCase()+p.substring(1)]=o[p]);return c}return o})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(r){this.recognition=r.toLowerCase()}}e.SpeechServiceConfig=t;class i{constructor(r){this.system=new u,this.os=r}}e.Context=i;class u{constructor(){const r="1.46.0";this.name="SpeechSDK",this.version=r,this.build="JavaScript",this.lang="JavaScript"}}e.System=u;class s{constructor(r,o,c){this.platform=r,this.name=o,this.version=c}}e.OS=s;class a{constructor(r,o,c){this.manufacturer=r,this.model=o,this.version=c}}e.Device=a,(function(n){n.Bluetooth="Bluetooth",n.Wired="Wired",n.WiFi="WiFi",n.Cellular="Cellular",n.InBuilt="InBuilt",n.Unknown="Unknown"})(e.connectivity||(e.connectivity={})),(function(n){n.Phone="Phone",n.Speaker="Speaker",n.Car="Car",n.Headset="Headset",n.Thermostat="Thermostat",n.Microphones="Microphones",n.Deskphone="Deskphone",n.RemoteControl="RemoteControl",n.Unknown="Unknown",n.File="File",n.Stream="Stream"})(e.type||(e.type={}))})(gs)),gs}var Hp;function A(){return Hp||(Hp=1,(function(e){var t=oe&&oe.__createBinding||(Object.create?(function(a,n,r,o){o===void 0&&(o=r),Object.defineProperty(a,o,{enumerable:!0,get:function(){return n[r]}})}):(function(a,n,r,o){o===void 0&&(o=r),a[o]=n[r]})),i=oe&&oe.__exportStar||function(a,n){for(var r in a)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&t(n,a,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.AutoDetectSourceLanguagesOpenRangeOptionName=e.ForceDictationPropertyName=e.ServicePropertiesPropertyName=e.CancellationErrorCodePropertyName=e.OutputFormatPropertyName=e.SpeechSynthesisAdapter=e.AvatarSynthesisAdapter=void 0,i(Ll(),e),i(ql(),e),i(ws(),e),i(Bl(),e),i(Fl(),e),i(Wf(),e),i(Vf(),e),i(Ds(),e),i(eg(),e),i(tg(),e),i(rg(),e),i(ig(),e),i(ng(),e),i(sg(),e),i(og(),e),i(ag(),e),i(cg(),e),i(zh(),e),i(ug(),e),i(pg(),e),i(hg(),e),i(dg(),e),i(lg(),e),i(vg(),e),i(fg(),e),i(gg(),e),i(Sg(),e),i(mg(),e),i(yg(),e),i(Rg(),e),i(Pg(),e),i(Eg(),e),i(Ig(),e),i(Ag(),e),i(Tg(),e),i(wg(),e),i(bg(),e),i(Og(),e),i(kg(),e),i(qg(),e),i(Bg(),e),i(Xg(),e),i(Gh(),e),i(Yg(),e),i(eS(),e);var u=tS();Object.defineProperty(e,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return u.AvatarSynthesisAdapter}});var s=rS();Object.defineProperty(e,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return s.SpeechSynthesisAdapter}}),i(iS(),e),i(nS(),e),i(sS(),e),i(oS(),e),i(aS(),e),i(cS(),e),i(uS(),e),e.OutputFormatPropertyName="OutputFormat",e.CancellationErrorCodePropertyName="CancellationErrorCode",e.ServicePropertiesPropertyName="ServiceProperties",e.ForceDictationPropertyName="ForceDictation",e.AutoDetectSourceLanguagesOpenRangeOptionName="UND"})(oe)),oe}var Kp;function pS(){return Kp||(Kp=1,(function(e){var t=se&&se.__createBinding||(Object.create?(function(s,a,n,r){r===void 0&&(r=n),Object.defineProperty(s,r,{enumerable:!0,get:function(){return a[n]}})}):(function(s,a,n,r){r===void 0&&(r=n),s[r]=a[n]})),i=se&&se.__exportStar||function(s,a){for(var n in s)n!=="default"&&!Object.prototype.hasOwnProperty.call(a,n)&&t(a,s,n)};Object.defineProperty(e,"__esModule",{value:!0});const u=A();new u.AgentConfig,i(P(),e)})(se)),se}var O=pS();class Ui{static instance;audio=null;isPlaying=!1;currentAudioBlob=null;currentMessageId=null;configLoaded=!1;configLoading=!1;siliconFlowApiKey="";useSiliconFlowStream=!1;openaiApiKey="";useOpenAI=!1;openaiModel="tts-1";openaiVoice="alloy";openaiResponseFormat="mp3";openaiSpeed=1;useOpenAIStream=!1;azureApiKey="";azureRegion="eastus";useAzure=!1;azureVoiceName="zh-CN-XiaoxiaoNeural";azureLanguage="zh-CN";azureOutputFormat="audio-24khz-160kbitrate-mono-mp3";azureRate="medium";azurePitch="medium";azureVolume="medium";azureStyle="general";azureStyleDegree=1;azureRole="default";azureUseSSML=!0;defaultModel="FunAudioLLM/CosyVoice2-0.5B";defaultVoice="FunAudioLLM/CosyVoice2-0.5B:alex";audioContext=null;sourceNode=null;isStreamPlaying=!1;constructor(){console.log("初始化TTSService"),"speechSynthesis"in window&&window.speechSynthesis.getVoices(),this.audio=new Audio,this.audio.onended=()=>{this.isPlaying=!1,this.currentMessageId=null},this.audio.onerror=()=>{console.error("音频播放错误"),this.isPlaying=!1,this.currentMessageId=null};try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.warn("AudioContext初始化失败，流式播放可能不可用",t)}}static getInstance(){return Ui.instance||(Ui.instance=new Ui),Ui.instance}setApiKey(t){this.siliconFlowApiKey=t}setUseSiliconFlowStream(t){this.useSiliconFlowStream=t}setOpenAIApiKey(t){this.openaiApiKey=t}setUseOpenAI(t){this.useOpenAI=t}setAzureApiKey(t){this.azureApiKey=t}setAzureRegion(t){this.azureRegion=t}setUseAzure(t){this.useAzure=t}setAzureVoiceName(t){this.azureVoiceName=t}setAzureLanguage(t){this.azureLanguage=t}setAzureOutputFormat(t){this.azureOutputFormat=t}setAzureRate(t){this.azureRate=t}setAzurePitch(t){this.azurePitch=t}setAzureVolume(t){this.azureVolume=t}setAzureStyle(t){this.azureStyle=t}setAzureStyleDegree(t){this.azureStyleDegree=Math.max(.01,Math.min(2,t))}setAzureRole(t){this.azureRole=t}setAzureUseSSML(t){this.azureUseSSML=t}setOpenAIModel(t){this.openaiModel=t}setOpenAIVoice(t){this.openaiVoice=t}setOpenAIResponseFormat(t){this.openaiResponseFormat=t}setOpenAISpeed(t){t<.25&&(t=.25),t>4&&(t=4),this.openaiSpeed=t}setUseOpenAIStream(t){this.useOpenAIStream=t}setDefaultVoice(t,i){t&&(this.defaultModel=t),i&&(this.defaultVoice=i)}async initializeConfig(){if(this.configLoaded)return!0;if(this.configLoading)return new Promise(t=>{const i=()=>{this.configLoaded?t(!0):this.configLoading?setTimeout(i,50):t(!1)};i()});this.configLoading=!0;try{const{getStorageItem:t}=await rl(async()=>{const{getStorageItem:n}=await import("./index-BFQp9Otg.js").then(r=>r.hA);return{getStorageItem:n}},__vite__mapDeps([0,1])),[i,u,s,a]=await Promise.all([t("siliconflow_api_key"),t("tts_model"),t("tts_voice"),t("enable_tts")]);return i&&this.setApiKey(i),u&&(this.defaultModel=u),s&&(this.defaultVoice=s.includes(":")?s:`${u||this.defaultModel}:${s}`),this.configLoaded=!0,this.configLoading=!1,!0}catch(t){return console.error("TTSService配置初始化失败:",t),this.configLoading=!1,!1}}isConfigLoaded(){return this.configLoaded}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0),"speechSynthesis"in window&&window.speechSynthesis.cancel(),this.stopStream(),this.isPlaying=!1,this.currentMessageId=null,this.releaseBlobUrl()}releaseBlobUrl(){this.currentAudioBlob&&(URL.revokeObjectURL(this.currentAudioBlob),this.currentAudioBlob=null)}dispose(){this.stop(),this.audio&&(this.audio.src="",this.audio=null),this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.close(),this.audioContext=null)}stopStream(){if(this.sourceNode){try{this.sourceNode.stop(),this.sourceNode.disconnect()}catch(t){console.error("停止音频源时出错",t)}this.sourceNode=null}this.isStreamPlaying=!1}getIsPlaying(){return this.isPlaying||this.isStreamPlaying}getCurrentMessageId(){return this.currentMessageId}async togglePlayback(t,i,u=this.defaultVoice){if((this.isPlaying||this.isStreamPlaying)&&this.currentMessageId===t)return this.stop(),!1;(this.isPlaying||this.isStreamPlaying)&&this.stop();const s=await this.speak(i,u);return s&&(this.currentMessageId=t),s}async speak(t,i=this.defaultVoice){try{if((this.isPlaying||this.isStreamPlaying)&&this.stop(),!t||t.trim()==="")return console.error("文本为空，无法播放"),!1;if(console.log(`开始播放文本，语音: ${i}`),this.isPlaying=!0,this.useAzure&&await this.speakWithAzure(t))return!0;if(this.useOpenAI){if(this.useOpenAIStream&&this.audioContext){if(await this.speakWithOpenAIStream(t))return!0}else if(await this.speakWithOpenAI(t))return!0}return await this.speakWithSiliconFlow(t,i)||this.speakWithWebSpeechAPI(t,i)?!0:(console.warn("所有TTS方法播放失败"),this.isPlaying=!1,!1)}catch(u){return console.error("播放文本失败:",u),this.isPlaying=!1,this.currentMessageId=null,!1}}async speakWithOpenAI(t){try{if(!this.openaiApiKey)return console.warn("OpenAI API密钥未设置，尝试其他方法"),!1;const i="https://api.openai.com/v1/audio/speech",u={model:this.openaiModel,input:t,voice:this.openaiVoice,response_format:this.openaiResponseFormat,speed:this.openaiSpeed};console.log("OpenAI TTS请求参数:",{model:this.openaiModel,voice:this.openaiVoice,response_format:this.openaiResponseFormat,speed:this.openaiSpeed});const s=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${this.openaiApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!s.ok){const n=await s.json().catch(()=>({}));return console.error("OpenAI TTS API请求失败:",s.status,n),!1}const a=await s.blob();if(this.releaseBlobUrl(),this.currentAudioBlob=URL.createObjectURL(a),this.audio){this.audio.src=this.currentAudioBlob;try{await this.audio.play()}catch(n){return console.error("OpenAI TTS API播放失败:",n),this.isPlaying=!1,!1}return!0}return!1}catch(i){return console.error("OpenAI TTS API播放失败:",i),!1}}async speakWithOpenAIStream(t){try{if(!this.openaiApiKey)return console.warn("OpenAI API密钥未设置，尝试其他方法"),!1;if(!this.audioContext)return console.warn("AudioContext不可用，无法使用流式播放"),!1;const i="https://api.openai.com/v1/audio/speech",u={model:this.openaiModel,input:t,voice:this.openaiVoice,response_format:this.openaiResponseFormat,speed:this.openaiSpeed,stream:!0};console.log("OpenAI TTS流式请求参数:",{model:this.openaiModel,voice:this.openaiVoice,response_format:this.openaiResponseFormat,speed:this.openaiSpeed});const s=await fetch(i,{method:"POST",headers:{Authorization:`Bearer ${this.openaiApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!s.ok){const h=await s.json().catch(()=>({}));return console.error("OpenAI TTS API流式请求失败:",s.status,h),!1}this.stopStream(),this.isStreamPlaying=!0;const a=s.body?.getReader();if(!a)return console.error("无法获取响应流"),!1;let n="audio/mp3";switch(this.openaiResponseFormat){case"mp3":n="audio/mp3";break;case"opus":n="audio/opus";break;case"aac":n="audio/aac";break;case"flac":n="audio/flac";break}const r=new MediaSource,o=new Audio;o.src=URL.createObjectURL(r);const c=[];return(async()=>{let h=!1;for(;!h;){const{value:l,done:d}=await a.read();if(h=d,l&&c.push(l),h){const g=c.reduce((C,y)=>C+y.length,0),f=new Uint8Array(g);let S=0;for(const C of c)f.set(C,S),S+=C.length;const v=new Blob([f],{type:n}),m=URL.createObjectURL(v);if(this.audio){this.audio.src=m;try{return await this.audio.play(),this.audio.onended=()=>{URL.revokeObjectURL(m),this.isStreamPlaying=!1,this.currentMessageId=null},!0}catch(C){return console.error("OpenAI TTS API流式播放失败:",C),URL.revokeObjectURL(m),this.isStreamPlaying=!1,!1}}}}return!1})().catch(h=>{console.error("处理音频流时出错:",h),this.isStreamPlaying=!1}),!0}catch(i){return console.error("OpenAI TTS API流式播放失败:",i),this.isStreamPlaying=!1,!1}}async speakWithSiliconFlow(t,i){try{if(!this.siliconFlowApiKey)return console.warn("硅基流动API密钥未设置，尝试其他方法"),!1;const u="https://api.siliconflow.cn/v1/audio/speech",s=this.defaultModel;let a=i||this.defaultVoice;a&&!a.includes(":")&&(a=`${s}:${a}`),console.log("硅基流动TTS请求参数:",{model:s,voice:a,textLength:t.length,useStream:this.useSiliconFlowStream}),console.log("硅基流动TTS文本内容:",t.substring(0,100)+(t.length>100?"...":""));const n={model:s,input:t,voice:a,response_format:"mp3",stream:this.useSiliconFlowStream};return console.log("硅基流动TTS完整请求体:",JSON.stringify(n,null,2)),this.useSiliconFlowStream?await this.speakWithSiliconFlowStream(u,n):await this.speakWithSiliconFlowNormal(u,n)}catch(u){return console.error("硅基流动API播放失败:",u),!1}}async speakWithSiliconFlowNormal(t,i){try{const u=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${this.siliconFlowApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){const a=await u.json().catch(()=>({}));return console.error("硅基流动API请求失败:",u.status,a),!1}const s=await u.blob();if(this.releaseBlobUrl(),this.currentAudioBlob=URL.createObjectURL(s),this.audio){this.audio.src=this.currentAudioBlob;try{await this.audio.play()}catch(a){return console.error("硅基流动API播放失败:",a),this.isPlaying=!1,!1}return!0}return!1}catch(u){return console.error("硅基流动API标准模式播放失败:",u),!1}}async speakWithSiliconFlowStream(t,i){try{if(console.log("硅基流动TTS开始流式播放..."),!this.audioContext)return console.warn("AudioContext不可用，回退到标准模式"),await this.speakWithSiliconFlowNormal(t,{...i,stream:!1});const u=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${this.siliconFlowApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){const s=await u.json().catch(()=>({}));return console.error("硅基流动API流式请求失败:",u.status,s),!1}if(u.body){this.isStreamPlaying=!0;const s=u.body.getReader(),a=[];try{for(;;){const{done:p,value:h}=await s.read();if(p)break;h&&a.push(h)}const n=a.reduce((p,h)=>p+h.length,0),r=new Uint8Array(n);let o=0;for(const p of a)r.set(p,o),o+=p.length;const c=new Blob([r],{type:"audio/mpeg"});if(this.releaseBlobUrl(),this.currentAudioBlob=URL.createObjectURL(c),this.audio){this.audio.src=this.currentAudioBlob;try{return await this.audio.play(),console.log("硅基流动TTS流式播放成功"),!0}catch(p){return console.error("硅基流动API流式播放失败:",p),this.isStreamPlaying=!1,!1}}return!1}finally{s.releaseLock(),this.isStreamPlaying=!1}}else return console.error("响应体为空"),!1}catch(u){return console.error("硅基流动API流式模式播放失败:",u),this.isStreamPlaying=!1,!1}}speakWithWebSpeechAPI(t,i){try{if(!("speechSynthesis"in window))return console.error("浏览器不支持Web Speech API"),!1;window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);let s=window.speechSynthesis.getVoices();return console.log("可用的语音合成声音:",s),s.length===0?(setTimeout(()=>{s=window.speechSynthesis.getVoices(),this.setVoiceAndPlay(u,s,i)},100),!0):this.setVoiceAndPlay(u,s,i)}catch(u){return console.error("Web Speech API播放失败:",u),this.isPlaying=!1,!1}}setVoiceAndPlay(t,i,u){try{let s=i.find(a=>a.name===u);if(s)console.log("使用指定语音:",s.name);else if(console.warn("未找到指定的语音:",u),s=i.find(a=>a.lang==="zh-CN"),s)console.log("使用替代中文语音:",s.name);else if(i.length>0)s=i[0],console.log("使用第一个可用的语音:",s.name);else return console.warn("没有可用的语音"),this.isPlaying=!1,!1;return t.voice=s,t.rate=1,t.pitch=1,t.volume=1,t.onend=()=>{console.log("语音播放结束"),this.isPlaying=!1,this.currentMessageId=null},t.onerror=a=>{console.error("语音播放错误:",a),this.isPlaying=!1,this.currentMessageId=null},window.speechSynthesis.speak(t),!0}catch(s){return console.error("设置语音失败:",s),this.isPlaying=!1,!1}}async speakWithAzure(t){try{if(!this.azureApiKey||!this.azureRegion)return console.warn("Azure API密钥或区域未设置，尝试其他方法"),!1;console.log("Azure TTS请求参数:",{region:this.azureRegion,voiceName:this.azureVoiceName,language:this.azureLanguage,outputFormat:this.azureOutputFormat,rate:this.azureRate,pitch:this.azurePitch,volume:this.azureVolume,style:this.azureStyle,styleDegree:this.azureStyleDegree,role:this.azureRole,useSSML:this.azureUseSSML});const i=O.SpeechConfig.fromSubscription(this.azureApiKey,this.azureRegion);i.speechSynthesisOutputFormat=this.getAzureOutputFormat(),i.speechSynthesisVoiceName=this.azureVoiceName;const u=O.AudioConfig.fromDefaultSpeakerOutput(),s=new O.SpeechSynthesizer(i,u);let a=t;return this.azureUseSSML&&(a=this.buildSSMLText(t)),console.log("Azure TTS开始合成，文本长度:",a.length),new Promise(n=>{const r=Date.now();this.azureUseSSML?s.speakSsmlAsync(a,o=>{const c=Date.now()-r;console.log(`Azure TTS合成完成，耗时: ${c}ms`),o.reason===O.ResultReason.SynthesizingAudioCompleted?(console.log("Azure TTS语音合成成功"),this.isPlaying=!1,this.currentMessageId=null,n(!0)):(console.error("Azure TTS语音合成失败:",o.errorDetails),this.isPlaying=!1,n(!1)),s.close()},o=>{console.error("Azure TTS合成错误:",o),this.isPlaying=!1,s.close(),n(!1)}):s.speakTextAsync(a,o=>{const c=Date.now()-r;console.log(`Azure TTS合成完成，耗时: ${c}ms`),o.reason===O.ResultReason.SynthesizingAudioCompleted?(console.log("Azure TTS语音合成成功"),this.isPlaying=!1,this.currentMessageId=null,n(!0)):(console.error("Azure TTS语音合成失败:",o.errorDetails),this.isPlaying=!1,n(!1)),s.close()},o=>{console.error("Azure TTS合成错误:",o),this.isPlaying=!1,s.close(),n(!1)})})}catch(i){return console.error("Azure TTS播放失败:",i),this.isPlaying=!1,!1}}buildSSMLText(t){let i=`<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${this.azureLanguage}">`;i+=`<voice name="${this.azureVoiceName}">`;const u=[];if(this.azureRate!=="medium"&&u.push(`rate="${this.azureRate}"`),this.azurePitch!=="medium"&&u.push(`pitch="${this.azurePitch}"`),this.azureVolume!=="medium"&&u.push(`volume="${this.azureVolume}"`),u.length>0&&(i+=`<prosody ${u.join(" ")}>`),this.azureStyle!=="general"&&this.azureVoiceName.includes("Neural")){const a=[`style="${this.azureStyle}"`];this.azureStyleDegree!==1&&a.push(`styledegree="${this.azureStyleDegree}"`),this.azureRole!=="default"&&a.push(`role="${this.azureRole}"`),i+=`<mstts:express-as ${a.join(" ")}>`}const s=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");return i+=s,this.azureStyle!=="general"&&this.azureVoiceName.includes("Neural")&&(i+="</mstts:express-as>"),u.length>0&&(i+="</prosody>"),i+="</voice>",i+="</speak>",console.log("构建的SSML:",i),i}getAzureOutputFormat(){return{"audio-16khz-32kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3,"audio-16khz-64kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3,"audio-16khz-128kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3,"audio-24khz-48kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3,"audio-24khz-96kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3,"audio-24khz-160kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3,"audio-48khz-96kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3,"audio-48khz-192kbitrate-mono-mp3":O.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3,"webm-16khz-16bit-mono-opus":O.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus,"webm-24khz-16bit-mono-opus":O.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus,"ogg-16khz-16bit-mono-opus":O.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus,"ogg-24khz-16bit-mono-opus":O.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus,"raw-16khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm,"raw-24khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm,"raw-48khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm,"riff-16khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm,"riff-24khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm,"riff-48khz-16bit-mono-pcm":O.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm}[this.azureOutputFormat]||O.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3}}export{Ui as TTSService};
