import{u as $,U as X,V as Z,r as k,j as e,B as n,a as w,A as ee,T as ae,I as le,b as se,d as r,ah as re,P as m,ai as A,af as o,aj as h,ak as x,ag as d,e as te,H as g,J as j,S as v,K as t,al as p,G as f,g as u,am as ne,f as y,an as ie,i as oe,N as I,ao as de,ap as ce,aq as he,ar as xe,as as ue,at as be,au as me,av as ge,aw as je,ax as ve,ay as pe,az as fe,aA as ye,aB as Ce,aC as Se,aD as Ie,aE as Pe,aF as ke,aG as we,aH as Ae,aI as Re,aJ as Be,aK as Te,aL as We,aM as Fe}from"./index-BFQp9Otg.js";import{C as Ee}from"./Card-IUdLwBcS.js";import{C as ze}from"./CardContent-DXovnOt-.js";import{C as Me}from"./CardActions-ByhgIrLR.js";import{P as De}from"./plus-kwQ_QrJb.js";const Ne=()=>{const R=$(),s=X(),a=Z(l=>l.webSearch)||{enabled:!1,provider:"firecrawl",apiKey:"",includeInContext:!0,maxResults:5,showTimestamp:!0,filterSafeSearch:!0,searchMode:"auto",searchWithTime:!1,excludeDomains:[],providers:[],customProviders:[]},[i,b]=k.useState(null),[B,C]=k.useState(!1);k.useEffect(()=>{},[a]);const T=()=>{R("/settings")},W=()=>{s(ge())},F=l=>{s(je(l.target.value))},E=l=>{s(pe(l.target.value))},z=(l,c)=>{s(Se(c))},M=()=>{s(Ie())},D=()=>{s(Pe())},K=()=>{s(ke())},L=l=>{s(Ce(l.target.value))},G=()=>{const l={id:ye(),name:"新搜索服务",apiKey:"",baseUrl:"",enabled:!0};b(l),C(!0)},_=l=>{b({...l}),C(!0)},U=l=>{s(fe(l))},N=()=>{i&&(i.id&&a.customProviders?.some(l=>l.id===i.id)?s(We(i)):s(Fe(i)),b(null),C(!1))},H=()=>{b(null),C(!1)},S=(l,c)=>{i&&b(P=>({...P,[l]:c}))},O=l=>{s(we(l.target.value))},V=(l,c)=>{s(Ae(c))},q=(l,c)=>{s(Re(c/100))},J=l=>{s(Be(l.target.value))},Q=(l,c)=>{s(Te(c))},Y=l=>{s(ve(l.target.value))};return e.jsxs(n,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:l=>l.palette.mode==="light"?w(l.palette.primary.main,.02):w(l.palette.background.default,.9)},children:[e.jsx(ee,{position:"fixed",elevation:0,sx:{zIndex:l=>l.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(ae,{children:[e.jsx(le,{edge:"start",onClick:T,"aria-label":"back",sx:{color:l=>l.palette.primary.main},children:e.jsx(se,{size:24})}),e.jsxs(r,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,display:"flex",alignItems:"center",gap:1,color:l=>l.palette.text.primary},children:[e.jsx(re,{size:24,color:"#3b82f6",style:{marginRight:8}})," 网络搜索设置"]})]})}),e.jsxs(n,{sx:{flexGrow:1,overflow:"auto",px:2,py:2,mt:8,mb:2,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:[e.jsxs(m,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,color:l=>l.palette.text.primary,mb:2},children:"基本设置"}),e.jsx(A,{children:e.jsx(o,{control:e.jsx(d,{checked:a.enabled,onChange:W}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"启用网络搜索"}),e.jsx(h,{title:"开启后，AI可以通过网络搜索获取最新信息",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]})})}),e.jsx(te,{sx:{my:2}}),e.jsxs(g,{fullWidth:!0,margin:"normal",children:[e.jsx(j,{id:"search-provider-label",children:"搜索服务商"}),e.jsxs(v,{labelId:"search-provider-label",value:a.provider,onChange:F,input:e.jsx(p,{label:"搜索服务商"}),disabled:!a.enabled,MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(t,{value:"bing-free",children:"🆓 Bing 免费搜索 (推荐)"}),e.jsx(t,{value:"tavily",children:"💎 Tavily (付费)"}),e.jsx(t,{value:"exa",children:"🧠 Exa (神经搜索)"}),e.jsx(t,{value:"bocha",children:"🤖 Bocha (AI搜索)"}),e.jsx(t,{value:"firecrawl",children:" Firecrawl (网页抓取)"}),e.jsx(t,{value:"custom",children:"⚙️ 自定义服务"})]})]}),a.provider!=="custom"&&e.jsxs(e.Fragment,{children:[a.provider==="bing-free"&&e.jsxs(g,{fullWidth:!0,margin:"normal",children:[e.jsx(j,{id:"search-engine-label",children:"搜索引擎"}),e.jsxs(v,{labelId:"search-engine-label",value:a.selectedSearchEngine||"bing",onChange:Y,input:e.jsx(p,{label:"搜索引擎"}),disabled:!a.enabled,MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(t,{value:"bing",children:"🔍 Bing"}),e.jsx(t,{value:"google",children:"🌐 Google"}),e.jsx(t,{value:"baidu",children:"🔍 百度"}),e.jsx(t,{value:"sogou",children:"🔍 搜狗"}),e.jsx(t,{value:"yandex",children:"🔍 Yandex"})]})]}),e.jsx(f,{fullWidth:!0,margin:"normal",label:"API 密钥",type:"password",value:a.apiKeys&&a.apiKeys[a.provider]||a.apiKey||"",onChange:E,disabled:!a.enabled,variant:"outlined",placeholder:`请输入 ${a.provider} API 密钥`}),!1,a.provider==="tavily"&&e.jsxs(u,{severity:"info",sx:{mt:2},children:["Tavily 是专为AI设计的搜索API，提供高质量的搜索结果。现在使用移动端兼容的 SDK，完全避免了 CORS 限制问题。访问",e.jsx("a",{href:"https://app.tavily.com",target:"_blank",rel:"noopener noreferrer",style:{marginLeft:5},children:"app.tavily.com"}),"获取 API 密钥。"]}),a.provider==="exa"&&e.jsxs(u,{severity:"info",sx:{mt:2},children:["Exa 是基于神经网络的搜索引擎，提供语义搜索功能。访问",e.jsx("a",{href:"https://exa.ai",target:"_blank",rel:"noopener noreferrer",style:{marginLeft:5},children:"exa.ai"}),"获取 API 密钥。"]}),a.provider==="bocha"&&e.jsxs(u,{severity:"info",sx:{mt:2},children:["Bocha 是AI驱动的搜索引擎，提供智能搜索结果。访问",e.jsx("a",{href:"https://bochaai.com",target:"_blank",rel:"noopener noreferrer",style:{marginLeft:5},children:"bochaai.com"}),"获取 API 密钥。"]}),a.provider==="bing-free"&&e.jsx(u,{severity:"success",sx:{mt:2},children:"免费搜索服务，无需API密钥。您可以选择不同的搜索引擎来获取搜索结果，包括Bing、Google、百度、搜狗等。 使用 capacitor-cors-bypass-enhanced 插件解决移动端CORS问题。"}),a.provider==="firecrawl"&&e.jsxs(u,{severity:"info",sx:{mt:2},children:["Firecrawl 提供强大的网络爬取和搜索功能。访问",e.jsx("a",{href:"https://firecrawl.dev",target:"_blank",rel:"noopener noreferrer",style:{marginLeft:5},children:"firecrawl.dev"}),"获取 API 密钥。"]})]}),a.provider==="custom"&&a.customProviders&&a.customProviders.length>0&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"自定义搜索服务列表"}),a.customProviders.map(l=>e.jsxs(Ee,{variant:"outlined",sx:{mb:2,borderColor:l.enabled?w("#3b82f6",.5):"divider"},children:[e.jsxs(ze,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"h6",children:l.name}),e.jsx(o,{control:e.jsx(d,{checked:l.enabled,onChange:()=>s(ne(l.id))}),label:"启用"})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["API URL: ",l.baseUrl]})]}),e.jsxs(Me,{children:[e.jsx(y,{size:"small",startIcon:e.jsx(ie,{size:16}),onClick:()=>_(l),children:"编辑"}),e.jsx(y,{size:"small",startIcon:e.jsx(oe,{size:16}),color:"error",onClick:()=>U(l.id),children:"删除"})]})]},l.id))]}),a.provider==="custom"&&e.jsx(y,{startIcon:e.jsx(De,{size:16}),variant:"outlined",sx:{mt:2},onClick:G,disabled:!a.enabled,children:"添加自定义搜索服务"})]}),e.jsxs(m,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,color:l=>l.palette.text.primary,mb:2},children:"搜索选项"}),e.jsxs(g,{fullWidth:!0,sx:{mb:3},children:[e.jsx(j,{id:"search-mode-label",children:"搜索模式"}),e.jsxs(v,{labelId:"search-mode-label",value:a.searchMode,onChange:L,input:e.jsx(p,{label:"搜索模式"}),disabled:!a.enabled,MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(t,{value:"auto",children:"自动搜索 (AI 自动判断何时搜索)"}),e.jsx(t,{value:"manual",children:"手动搜索 (点击搜索按钮启动)"})]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(r,{id:"max-results-slider",gutterBottom:!0,children:["最大结果数量: ",a.maxResults]}),e.jsx(I,{"aria-labelledby":"max-results-slider",value:a.maxResults,onChange:z,min:1,max:20,step:1,marks:[{value:1,label:"1"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"}],disabled:!a.enabled})]}),e.jsxs(A,{children:[e.jsx(o,{control:e.jsx(d,{checked:a.includeInContext,onChange:M,disabled:!a.enabled}),label:"将搜索结果包含在上下文中"}),e.jsx(o,{control:e.jsx(d,{checked:a.showTimestamp,onChange:D,disabled:!a.enabled}),label:"显示搜索结果时间戳"}),e.jsx(o,{control:e.jsx(d,{checked:a.filterSafeSearch,onChange:K,disabled:!a.enabled}),label:"启用安全搜索过滤"}),e.jsx(o,{control:e.jsx(d,{checked:a.searchWithTime,onChange:()=>s(de()),disabled:!a.enabled}),label:"在搜索查询中添加当前日期"})]})]}),a.provider==="tavily"&&e.jsxs(m,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,color:l=>l.palette.text.primary,mb:2},children:"🚀 Tavily 最佳实践设置"}),e.jsx(u,{severity:"info",sx:{mb:3},children:"这些设置基于 Tavily 官方最佳实践，可以显著提升搜索质量和相关性。"}),e.jsx(o,{control:e.jsx(d,{checked:a.enableSmartSearch||!1,onChange:()=>s(ce()),disabled:!a.enabled}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"启用智能搜索"}),e.jsx(h,{title:"自动应用最佳实践设置，包括高级搜索深度、内容块优化等",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]}),sx:{mb:3}}),e.jsxs(g,{fullWidth:!0,sx:{mb:3},children:[e.jsx(j,{id:"search-depth-label",children:"搜索深度"}),e.jsxs(v,{labelId:"search-depth-label",value:a.searchDepth||"basic",onChange:O,input:e.jsx(p,{label:"搜索深度"}),disabled:!a.enabled||a.enableSmartSearch,MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(t,{value:"basic",children:"基础搜索 (更快)"}),e.jsx(t,{value:"advanced",children:"高级搜索 (更准确，推荐)"})]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(r,{id:"chunks-per-source-slider",gutterBottom:!0,children:["每个来源的内容块数量: ",a.chunksPerSource||3]}),e.jsx(I,{"aria-labelledby":"chunks-per-source-slider",value:a.chunksPerSource||3,onChange:V,min:1,max:5,step:1,marks:[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"}],disabled:!a.enabled||a.enableSmartSearch})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(r,{id:"min-score-slider",gutterBottom:!0,children:["最小相关性分数: ",Math.round((a.minScore||.3)*100),"%"]}),e.jsx(I,{"aria-labelledby":"min-score-slider",value:Math.round((a.minScore||.3)*100),onChange:q,min:0,max:100,step:5,marks:[{value:0,label:"0%"},{value:30,label:"30%"},{value:70,label:"70%"},{value:100,label:"100%"}],disabled:!a.enabled||a.enableSmartSearch}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"过滤掉相关性分数低于此阈值的搜索结果"})]}),e.jsxs(g,{fullWidth:!0,sx:{mb:3},children:[e.jsx(j,{id:"time-range-label",children:"时间范围过滤"}),e.jsxs(v,{labelId:"time-range-label",value:a.timeRange||"week",onChange:J,input:e.jsx(p,{label:"时间范围过滤"}),disabled:!a.enabled,MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0},children:[e.jsx(t,{value:"day",children:"最近一天"}),e.jsx(t,{value:"week",children:"最近一周"}),e.jsx(t,{value:"month",children:"最近一个月"}),e.jsx(t,{value:"year",children:"最近一年"})]})]}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(r,{id:"news-search-days-slider",gutterBottom:!0,children:["新闻搜索天数范围: ",a.newsSearchDays||7," 天"]}),e.jsx(I,{"aria-labelledby":"news-search-days-slider",value:a.newsSearchDays||7,onChange:Q,min:1,max:30,step:1,marks:[{value:1,label:"1天"},{value:7,label:"1周"},{value:14,label:"2周"},{value:30,label:"1月"}],disabled:!a.enabled}),e.jsx(r,{variant:"body2",color:"text.secondary",children:'当搜索主题设置为"新闻"时使用'})]}),e.jsxs(A,{children:[e.jsx(o,{control:e.jsx(d,{checked:a.includeRawContent||!1,onChange:()=>s(he()),disabled:!a.enabled||a.enableSmartSearch}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"包含原始内容"}),e.jsx(h,{title:"获取完整的网页内容，用于深度分析",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]})}),e.jsx(o,{control:e.jsx(d,{checked:a.includeAnswer||!1,onChange:()=>s(xe()),disabled:!a.enabled}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"包含AI答案摘要"}),e.jsx(h,{title:"Tavily生成的基于搜索结果的答案摘要",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]})}),e.jsx(o,{control:e.jsx(d,{checked:a.enableQueryValidation!==!1,onChange:()=>s(ue()),disabled:!a.enabled}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"启用查询验证"}),e.jsx(h,{title:"验证查询长度和格式，提供优化建议",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]})}),e.jsx(o,{control:e.jsx(d,{checked:a.enablePostProcessing!==!1,onChange:()=>s(be()),disabled:!a.enabled}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{mr:1},children:"启用结果后处理"}),e.jsx(h,{title:"基于相关性分数过滤和排序搜索结果",children:e.jsx(x,{size:16,color:"var(--mui-palette-text-secondary)"})})]})})]})]}),e.jsxs(m,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,color:l=>l.palette.text.primary,mb:2},children:"高级设置"}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"排除域名 (每行一个)"}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:3,value:a.excludeDomains?.join(`
`)||"",onChange:l=>{const c=l.target.value.split(`
`).filter(P=>P.trim());s(me(c))},placeholder:`example.com
spam-site.com`,disabled:!a.enabled,variant:"outlined",sx:{mb:2}}),e.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"这些域名将从搜索结果中排除"})]})]}),B&&i&&e.jsx(n,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:1300,display:"flex",alignItems:"center",justifyContent:"center",p:2},children:e.jsxs(m,{sx:{p:3,width:"100%",maxWidth:500,maxHeight:"90vh",overflow:"auto",borderRadius:2},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:i.id?"编辑搜索服务":"添加搜索服务"}),e.jsx(f,{fullWidth:!0,margin:"normal",label:"服务名称",value:i.name,onChange:l=>S("name",l.target.value),variant:"outlined"}),e.jsx(f,{fullWidth:!0,margin:"normal",label:"基础 URL",value:i.baseUrl,onChange:l=>S("baseUrl",l.target.value),variant:"outlined",placeholder:"https://api.example.com"}),e.jsx(f,{fullWidth:!0,margin:"normal",label:"API 密钥",type:"password",value:i.apiKey,onChange:l=>S("apiKey",l.target.value),variant:"outlined"}),e.jsx(o,{control:e.jsx(d,{checked:i.enabled,onChange:l=>S("enabled",l.target.checked)}),label:"启用此服务"}),e.jsxs(n,{sx:{mt:3,display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(y,{onClick:H,children:"取消"}),e.jsx(y,{variant:"contained",onClick:N,sx:{bgcolor:"#3b82f6","&:hover":{bgcolor:"#2563eb"}},children:"保存"})]})]})})]})};export{Ne as default};
