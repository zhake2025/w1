import{a0 as T,U as F,u as Q,V as R,r,j as e,B as i,d as a,a as v,A as E,T as G,I as p,b as O,P as y,af as $,_ as q,bt as Y,f as b,X as N,a2 as U,Y as V,Z as X,ac as Z,bu as _,an as H,i as J,e as K,bv as M,k as ee,m as te,n as se,G as k,g as ae,o as re}from"./index-BFQp9Otg.js";import{C as ie}from"./CustomIcon-lyslYg9h.js";import{Q as c}from"./QuickPhraseService-c5svCMlT.js";import{P as w}from"./plus-kwQ_QrJb.js";const de=()=>{const g=T(),C=F(),P=Q(),D=()=>{P("/settings")},S=R(t=>t.settings.showQuickPhraseButton??!0),[d,B]=r.useState([]),[z,j]=r.useState(!0),[A,x]=r.useState(!1),[o,h]=r.useState(null),[s,n]=r.useState({title:"",content:""}),l=r.useCallback(async()=>{try{j(!0);const t=await c.getAll();B(t)}catch(t){console.error("加载快捷短语失败:",t)}finally{j(!1)}},[]);r.useEffect(()=>{l()},[l]);const f=()=>{h(null),n({title:"",content:""}),x(!0)},I=t=>{h(t),n({title:t.title,content:t.content}),x(!0)},W=async t=>{if(confirm("确定要删除这个快捷短语吗？"))try{await c.delete(t),await l()}catch(m){console.error("删除快捷短语失败:",m)}},u=()=>{x(!1),h(null),n({title:"",content:""})},L=async()=>{if(!(!s.title.trim()||!s.content.trim()))try{o?await c.update(o.id,{title:s.title,content:s.content}):await c.add({title:s.title,content:s.content}),u(),await l()}catch(t){console.error("保存快捷短语失败:",t)}};return z?e.jsx(i,{sx:{p:3,textAlign:"center"},children:e.jsx(a,{children:"加载中..."})}):e.jsxs(i,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:t=>t.palette.mode==="light"?v(t.palette.primary.main,.02):v(t.palette.background.default,.9)},children:[e.jsx(E,{position:"fixed",elevation:0,sx:{zIndex:t=>t.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(G,{children:[e.jsx(p,{edge:"start",color:"inherit",onClick:D,"aria-label":"back",sx:{color:t=>t.palette.primary.main},children:e.jsx(O,{size:24})}),e.jsx(a,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600},children:"快捷短语管理"})]})}),e.jsxs(i,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:3,px:1},children:"管理您的快捷短语，在聊天时快速插入常用内容。"}),e.jsxs(y,{sx:{p:2,mb:3,border:`1px solid ${g.palette.divider}`,borderRadius:2},children:[e.jsx(a,{variant:"subtitle1",sx:{mb:1,fontWeight:600},children:"显示设置"}),e.jsx($,{control:e.jsx(q,{checked:S,onChange:t=>C(Y(t.target.checked))}),label:"在输入框显示快捷短语按钮"}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"控制是否在聊天输入框中显示快捷短语按钮"})]}),d.length===0?e.jsxs(y,{sx:{p:4,textAlign:"center",borderRadius:2},children:[e.jsx(i,{sx:{opacity:.3,mb:2},children:e.jsx(ie,{name:"quickPhrase",size:48,color:"currentColor"})}),e.jsx(a,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"还没有快捷短语"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"创建您的第一个快捷短语，让聊天更高效"}),e.jsx(b,{variant:"contained",startIcon:e.jsx(w,{}),onClick:f,children:"添加快捷短语"})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{children:d.map((t,m)=>e.jsxs(U.Fragment,{children:[e.jsxs(V,{sx:{bgcolor:"background.paper",borderRadius:1,mb:1,border:`1px solid ${g.palette.divider}`},children:[e.jsx(X,{primary:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{variant:"subtitle1",fontWeight:"medium",children:t.title}),e.jsx(Z,{size:"small",label:`${t.content.length} 字符`,variant:"outlined"})]}),secondary:e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:1,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.content})}),e.jsxs(_,{children:[e.jsx(p,{edge:"end",onClick:()=>I(t),size:"small",sx:{mr:1},children:e.jsx(H,{size:18})}),e.jsx(p,{edge:"end",onClick:()=>W(t.id),size:"small",color:"error",children:e.jsx(J,{size:18})})]})]}),m<d.length-1&&e.jsx(K,{})]},t.id))}),e.jsx(M,{color:"primary","aria-label":"添加快捷短语",onClick:f,sx:{position:"fixed",bottom:24,right:24},children:e.jsx(w,{})})]}),e.jsxs(ee,{open:A,onClose:u,maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:o?"编辑快捷短语":"添加快捷短语"}),e.jsx(se,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[e.jsx(k,{label:"标题",value:s.title,onChange:t=>n({...s,title:t.target.value}),fullWidth:!0,size:"small",placeholder:"为您的快捷短语起个名字"}),e.jsx(k,{label:"内容",value:s.content,onChange:t=>n({...s,content:t.target.value}),multiline:!0,rows:6,fullWidth:!0,size:"small",placeholder:"输入快捷短语的内容..."}),s.content&&e.jsxs(ae,{severity:"info",sx:{mt:1},children:["内容长度：",s.content.length," 字符"]})]})}),e.jsxs(re,{children:[e.jsx(b,{onClick:u,children:"取消"}),e.jsx(b,{onClick:L,variant:"contained",disabled:!s.title.trim()||!s.content.trim(),children:o?"更新":"添加"})]})]})]})]})};export{de as default};
