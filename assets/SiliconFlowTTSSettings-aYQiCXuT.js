import{r as l,j as e,d as y,H as w,G as U,I as E,br as $,J as I,S as M,K,L as j,af as F,ag as V,u as H,ae as x,B as v,A as G,T as N,b as J,f as Y,a as _,g as q,P as Q,e as X,ad as p}from"./index-5OteHtpV.js";import{TTSService as Z}from"./TTSService-Dt-r3wSN.js";import{S as ee}from"./Stack-6qTbuoMo.js";import{E as se}from"./eye-off-C7c48bdq.js";import{T as te}from"./TTSTestSection-CuWdXfnt.js";import"./useThemeProps-CP38LDNq.js";import"./volume-2-CZ9kkBnD.js";const ae=[{value:"FunAudioLLM/CosyVoice2-0.5B",label:"CosyVoice2-0.5B - 多语言语音合成"}],P={"FunAudioLLM/CosyVoice2-0.5B":[{value:"alex",label:"Alex - 沉稳男声"},{value:"benjamin",label:"Benjamin - 低沉男声"},{value:"charles",label:"Charles - 磁性男声"},{value:"david",label:"David - 欢快男声"},{value:"anna",label:"Anna - 沉稳女声"},{value:"bella",label:"Bella - 激情女声"},{value:"claire",label:"Claire - 温柔女声"},{value:"diana",label:"Diana - 欢快女声"}]},le=({settings:o,onSettingsChange:t})=>{const h=l.useCallback(s=>{t(u=>({...u,apiKey:s}))},[t]),i=l.useCallback(()=>{t(s=>({...s,showApiKey:!s.showApiKey}))},[t]),T=l.useCallback(s=>{const u=P[s]?.[0]?.value||"";t(b=>({...b,selectedModel:s,selectedVoice:u}))},[t]),a=l.useCallback(s=>{t(u=>({...u,selectedVoice:s}))},[t]),S=l.useCallback(s=>{t(u=>({...u,useStream:s}))},[t]),c=l.useCallback(s=>{s.preventDefault()},[]),d=P[o.selectedModel]||[];return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"subtitle1",sx:{mb:{xs:2,sm:3},fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem",md:"1.25rem"},color:"text.primary"},children:"硅基流动 TTS API 设置"}),e.jsx("form",{onSubmit:c,children:e.jsxs(ee,{spacing:{xs:2,sm:3},children:[e.jsx(w,{fullWidth:!0,variant:"outlined",children:e.jsx(U,{label:"API密钥",variant:"outlined",value:o.apiKey,onChange:s=>h(s.target.value),type:o.showApiKey?"text":"password",placeholder:"请输入硅基流动API密钥",helperText:"获取API密钥请访问：https://siliconflow.cn/",slotProps:{input:{endAdornment:e.jsx(E,{onClick:i,edge:"end",size:window.innerWidth<600?"small":"medium",sx:{"&:hover":{bgcolor:"action.hover",transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"},children:o.showApiKey?e.jsx(se,{}):e.jsx($,{})})}},sx:{mb:{xs:1.5,sm:2},"& .MuiInputBase-root":{fontSize:{xs:"0.9rem",sm:"1rem"}},"& .MuiInputLabel-root":{fontSize:{xs:"0.9rem",sm:"1rem"}},"& .MuiFormHelperText-root":{fontSize:{xs:"0.75rem",sm:"0.875rem"},mt:{xs:.5,sm:1}},"& .MuiOutlinedInput-notchedOutline":{borderRadius:{xs:1.5,sm:2}}}})}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(I,{children:"TTS模型"}),e.jsx(M,{value:o.selectedModel,onChange:s=>T(s.target.value),label:"TTS模型",children:ae.map(s=>e.jsx(K,{value:s.value,children:s.label},s.value))}),e.jsx(j,{children:"选择适合的TTS模型，不同模型有不同的语音特色"})]}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(I,{children:"语音选择"}),e.jsx(M,{value:o.selectedVoice,onChange:s=>a(s.target.value),label:"语音选择",disabled:!o.selectedModel,children:d.map(s=>e.jsx(K,{value:s.value,children:s.label},s.value))}),e.jsx(j,{children:o.selectedModel?"选择您喜欢的语音风格":"请先选择TTS模型"})]}),e.jsx(F,{control:e.jsx(V,{checked:o.useStream,onChange:s=>S(s.target.checked)}),label:"启用流式输出",sx:{"& .MuiFormControlLabel-label":{fontSize:{xs:"0.9rem",sm:"1rem"},fontWeight:500}}}),e.jsx(j,{sx:{mt:-1,ml:0},children:"流式输出可以实现更快的语音响应，音频将边生成边播放"})]})})]})},me=()=>{const o=H(),t=l.useMemo(()=>Z.getInstance(),[]),h=l.useRef(null),i=l.useRef(null),T=l.useRef(null),[a,S]=l.useState({apiKey:"",showApiKey:!1,selectedModel:"FunAudioLLM/CosyVoice2-0.5B",selectedVoice:"alex",useStream:!1}),[c,d]=l.useState({saveError:"",isTestPlaying:!1}),[s,u]=l.useState("你好，我是硅基流动语音合成服务，感谢你的使用！"),[b,L]=l.useState(!0),[f,k]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const m=await p("siliconflow_api_key")||"",n=await p("tts_model")||"FunAudioLLM/CosyVoice2-0.5B",g=await p("tts_voice")||"alex",C=await p("siliconflow_tts_stream")==="true",O=await p("enable_tts")!=="false",D=await p("selected_tts_service")||"siliconflow";S({apiKey:m,showApiKey:!1,selectedModel:n,selectedVoice:g,useStream:C}),L(O),k(D==="siliconflow"),t.setApiKey(m),t.setUseSiliconFlowStream(C),n&&g&&t.setDefaultVoice(n,`${n}:${g}`)}catch(m){console.error("加载硅基流动TTS设置失败:",m)}})()},[t]);const A=l.useCallback(()=>{try{return f&&!a.apiKey.trim()?(d(r=>({...r,saveError:"启用服务时API密钥不能为空"})),!1):(x("siliconflow_api_key",a.apiKey),x("tts_model",a.selectedModel),x("tts_voice",a.selectedVoice),x("siliconflow_tts_stream",a.useStream.toString()),x("enable_tts",b.toString()),f&&(x("selected_tts_service","siliconflow"),x("use_openai_tts","false"),x("use_azure_tts","false")),t.setApiKey(a.apiKey),t.setUseSiliconFlowStream(a.useStream),t.setDefaultVoice(a.selectedModel,`${a.selectedModel}:${a.selectedVoice}`),f&&(t.setUseOpenAI(!1),t.setUseAzure(!1)),d(r=>({...r,saveError:""})),!0)}catch(r){return console.error("保存硅基流动TTS设置失败:",r),d(m=>({...m,saveError:"保存设置失败，请重试"})),!1}},[a,b,f,t]),B=l.useCallback(()=>{A()&&setTimeout(()=>{o("/settings/voice")},0)},[A,o]),z=l.useCallback(r=>{k(r)},[]),R=l.useCallback(async()=>{if(c.isTestPlaying){t.stop(),i.current&&clearInterval(i.current),d(n=>({...n,isTestPlaying:!1}));return}d(n=>({...n,isTestPlaying:!0})),t.setUseOpenAI(!1),t.setUseAzure(!1),t.setApiKey(a.apiKey),t.setUseSiliconFlowStream(a.useStream),t.setDefaultVoice(a.selectedModel,`${a.selectedModel}:${a.selectedVoice}`),await t.speak(s)||d(n=>({...n,isTestPlaying:!1})),i.current&&clearInterval(i.current);const m=()=>{t.getIsPlaying()?i.current=setTimeout(m,1e3):(d(n=>({...n,isTestPlaying:!1})),i.current&&(clearInterval(i.current),i.current=null))};setTimeout(m,1e3)},[c.isTestPlaying,a,s,t]),W=()=>{o("/settings/voice")};return l.useEffect(()=>()=>{h.current&&clearTimeout(h.current),i.current&&clearInterval(i.current),T.current&&clearTimeout(T.current),c.isTestPlaying&&t.stop()},[c.isTestPlaying,t]),e.jsxs(v,{sx:{display:"flex",flexDirection:"column",height:"100vh",width:"100vw",overflow:"hidden",bgcolor:"background.default"},children:[e.jsx(G,{position:"fixed",elevation:0,sx:{zIndex:r=>r.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",background:"rgba(255, 255, 255, 0.8)","@media (prefers-color-scheme: dark)":{background:"rgba(18, 18, 18, 0.8)"}},children:e.jsxs(N,{sx:{minHeight:{xs:56,sm:64},px:{xs:1,sm:2,md:3}},children:[e.jsx(E,{edge:"start",onClick:W,"aria-label":"返回",size:"large",sx:{color:"primary.main",mr:{xs:1,sm:2},"&:hover":{bgcolor:"primary.main",color:"primary.contrastText",transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"},children:e.jsx(J,{size:20})}),e.jsx(y,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:"硅基流动 TTS 设置"}),e.jsx(Y,{onClick:B,variant:"contained",sx:{bgcolor:"primary.main",color:"primary.contrastText","&:hover":{bgcolor:"primary.dark"},borderRadius:2,px:3},children:"保存"})]})}),e.jsx(v,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,bgcolor:r=>r.palette.mode==="light"?_(r.palette.primary.main,.02):_(r.palette.background.default,.9),"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:e.jsxs(v,{sx:{width:"100%"},children:[c.saveError&&e.jsx(q,{severity:"error",sx:{mb:{xs:1.5,sm:2},borderRadius:{xs:1,sm:2}},children:c.saveError}),e.jsxs(Q,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",background:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsx(y,{variant:"h6",sx:{mb:3,fontWeight:600},children:"API配置"}),e.jsxs(v,{sx:{mb:3},children:[e.jsx(F,{control:e.jsx(V,{checked:f,onChange:r=>z(r.target.checked)}),label:"启用硅基流动 TTS 服务"}),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:1,ml:4},children:"启用后，此服务将成为默认的文本转语音服务。启用其他TTS服务会自动禁用此服务。"})]}),e.jsx(X,{sx:{mb:3}}),e.jsx(le,{settings:a,onSettingsChange:S})]}),e.jsx(te,{testText:s,setTestText:u,handleTestTTS:R,isTestPlaying:c.isTestPlaying,enableTTS:b,selectedTTSService:"siliconflow",openaiApiKey:"",azureApiKey:"",siliconFlowApiKey:a.apiKey})]})})]})};export{me as default};
