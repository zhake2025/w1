import{en as Ie,j as e,bc as L,bg as Ee,bi as Re,eo as de,dj as Ae,da as Te,r as o,b8 as Le,ep as We,bd as Ne,be as $e,d as h,c as Q,a$ as He,u as Ve,B as g,g as ue,A as qe,T as Ye,I as R,b as pe,G as q,P as _e,bG as Ke,bw as Oe,X as Ue,Y as he,a4 as xe,Z as fe,e as Xe,em as Ze,ac as Ge,eq as Qe,K as me,an as Je,i as es,k as Y,m as _,n as K,o as O,f as C,er as ss,a_ as ts,bA as rs}from"./index-Bp4oiTTd.js";import{w as F}from"./WorkspaceService-C9twLfxo.js";import{F as as,H as os,n as ns,M as ls,A as is}from"./MobileFileViewer-CDIoDpLT.js";import{S as cs}from"./search-ujF0MOD3.js";import{F as ds}from"./folder-open-B975vLfv.js";import{L as ge}from"./ListItemButton-ypcwwCi0.js";import{F as us}from"./folder-C81CAi5A.js";import{F as ps}from"./file-text-DZ4vpcFj.js";import{I as hs}from"./image-BjcbBBct.js";import{F as xs}from"./file-CpslafFf.js";const fs=Ie(e.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),ms=L(Ee)(Re(({theme:t})=>({display:"flex",marginLeft:`calc(${t.spacing(1)} * 0.5)`,marginRight:`calc(${t.spacing(1)} * 0.5)`,...t.palette.mode==="light"?{backgroundColor:t.palette.grey[100],color:t.palette.grey[700]}:{backgroundColor:t.palette.grey[700],color:t.palette.grey[100]},borderRadius:2,"&:hover, &:focus":{...t.palette.mode==="light"?{backgroundColor:t.palette.grey[200]}:{backgroundColor:t.palette.grey[600]}},"&:active":{boxShadow:t.shadows[0],...t.palette.mode==="light"?{backgroundColor:de(t.palette.grey[200],.12)}:{backgroundColor:de(t.palette.grey[600],.12)}}}))),gs=L(fs)({width:24,height:16});function js(t){const{slots:c={},slotProps:a={},...j}=t,d=t;return e.jsx("li",{children:e.jsx(ms,{focusRipple:!0,...j,ownerState:d,children:e.jsx(gs,{as:c.CollapsedIcon,ownerState:d,...a.collapsedIcon})})})}function ys(t){return Te("MuiBreadcrumbs",t)}const vs=Ae("MuiBreadcrumbs",["root","ol","li","separator"]),Cs=t=>{const{classes:c}=t;return $e({root:["root"],li:["li"],ol:["ol"],separator:["separator"]},ys,c)},bs=L(h,{name:"MuiBreadcrumbs",slot:"Root",overridesResolver:(t,c)=>[{[`& .${vs.li}`]:c.li},c.root]})({}),ks=L("ol",{name:"MuiBreadcrumbs",slot:"Ol"})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"}),Ss=L("li",{name:"MuiBreadcrumbs",slot:"Separator"})({display:"flex",userSelect:"none",marginLeft:8,marginRight:8});function ws(t,c,a,j){return t.reduce((d,B,n)=>(n<t.length-1?d=d.concat(B,e.jsx(Ss,{"aria-hidden":!0,className:c,ownerState:j,children:a},`separator-${n}`)):d.push(B),d),[])}const Fs=o.forwardRef(function(c,a){const j=Le({props:c,name:"MuiBreadcrumbs"}),{children:d,className:B,component:n="nav",slots:W={},slotProps:A={},expandText:N="Show path",itemsAfterCollapse:T=1,itemsBeforeCollapse:M=1,maxItems:D=8,separator:l="/",...y}=j,[P,x]=o.useState(!1),v={...j,component:n,expanded:P,expandText:N,itemsAfterCollapse:T,itemsBeforeCollapse:M,maxItems:D,separator:l},z=Cs(v),I=We({elementType:W.CollapsedIcon,externalSlotProps:A.collapsedIcon,ownerState:v}),$=o.useRef(null),E=i=>{const f=()=>{x(!0);const k=$.current.querySelector("a[href],button,[tabindex]");k&&k.focus()};return M+T>=i.length?i:[...i.slice(0,M),e.jsx(js,{"aria-label":N,slots:{CollapsedIcon:W.CollapsedIcon},slotProps:{collapsedIcon:I},onClick:f},"ellipsis"),...i.slice(i.length-T,i.length)]},b=o.Children.toArray(d).filter(i=>o.isValidElement(i)).map((i,f)=>e.jsx("li",{className:z.li,children:i},`child-${f}`));return e.jsx(bs,{ref:a,component:n,color:"textSecondary",className:Ne(z.root,B),ownerState:v,...y,children:e.jsx(ks,{className:z.ol,ref:$,ownerState:v,children:ws(P||D&&b.length<=D?b:E(b),z.separator,l,v)})})});/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Ms=Q("file-audio",Bs);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],Ps=Q("file-plus",Ds);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]],Is=Q("file-video",zs),Os=()=>{const{workspaceId:t}=He(),c=Ve(),[a,j]=o.useState(null),[d,B]=o.useState([]),[n,W]=o.useState(""),[A,N]=o.useState(),[T,M]=o.useState(!0),[D,l]=o.useState(null),[y,P]=o.useState([]),[x,v]=o.useState(null),[z,I]=o.useState(!1),[$,E]=o.useState(!1),[b,i]=o.useState({open:!1,file:null}),[f,k]=o.useState({open:!1,file:null}),[m,S]=o.useState(""),[H,J]=o.useState(""),[V,U]=o.useState([]),[je,ee]=o.useState(!1),[ye,se]=o.useState(!1),[X,te]=o.useState(null),ve=s=>{if(s.isDirectory)return e.jsx(us,{size:20,color:"#1976d2"});const r=s.name.split(".").pop()?.toLowerCase();return["txt","md","readme","log","csv"].includes(r||"")?e.jsx(ps,{size:20,color:"#666"}):["js","ts","jsx","tsx","html","css","scss","py","java","cpp","c","h","json","xml","yaml","yml"].includes(r||"")?e.jsx(ss,{size:20,color:"#4caf50"}):["jpg","jpeg","png","gif","bmp","svg","webp","ico"].includes(r||"")?e.jsx(hs,{size:20,color:"#ff9800"}):["mp4","avi","mov","wmv","flv","webm","mkv"].includes(r||"")?e.jsx(Is,{size:20,color:"#e91e63"}):["mp3","wav","flac","aac","ogg","wma"].includes(r||"")?e.jsx(Ms,{size:20,color:"#9c27b0"}):["zip","rar","7z","tar","gz","bz2"].includes(r||"")?e.jsx(is,{size:20,color:"#795548"}):["config","conf","ini","properties","env"].includes(r||"")?e.jsx(ts,{size:20,color:"#607d8b"}):e.jsx(xs,{size:20,color:"#757575"})},Ce=async()=>{if(t)try{const s=await F.getWorkspace(t);if(!s){l("工作区不存在");return}j(s)}catch(s){l("加载工作区信息失败"),console.error("加载工作区失败:",s)}},p=async(s="")=>{if(t)try{M(!0),l(null);const r=await F.getWorkspaceFilesAdvanced(t,s);B(r.files),W(r.currentPath),N(r.parentPath)}catch(r){l(r instanceof Error?r.message:"加载文件列表失败"),console.error("加载文件失败:",r)}finally{M(!1)}};o.useEffect(()=>{Ce(),p()},[t]);const be=()=>{c("/settings/workspace")},ke=s=>{if(!s.isDirectory)return;const r=n===a?.path?s.name:`${n.replace(a?.path||"","").replace(/^\//,"")}/${s.name}`;P([...y,n]),p(r)},Se=()=>{if(y.length>0){const s=y[y.length-1],r=y.slice(0,-1);P(r);const u=s===a?.path?"":s.replace(a?.path||"","").replace(/^\//,"");p(u)}else A!==void 0&&p(A)},we=()=>{P([]),p()},Fe=s=>{if(s===0)return"0 B";const r=1024,u=["B","KB","MB","GB"],w=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,w)).toFixed(2))+" "+u[w]},re=(s,r)=>{s.preventDefault(),v({mouseX:s.clientX-2,mouseY:s.clientY-4,file:r})},Z=()=>{v(null)},ae=async()=>{if(!(!t||!m.trim()))try{const s=await F.createFolder(t,n,m.trim());s.success?(I(!1),S(""),p(n===a?.path?"":n.replace(a?.path||"","").replace(/^\//,""))):l(s.error||"创建文件夹失败")}catch(s){l("创建文件夹失败"),console.error("创建文件夹失败:",s)}},oe=async()=>{if(!(!t||!m.trim()))try{let s=m.trim();s.includes(".")||(s+=".txt");const r=await F.createFile(t,n,s);r.success?(E(!1),S(""),p(n===a?.path?"":n.replace(a?.path||"","").replace(/^\//,""))):l(r.error||"创建文件失败")}catch(s){l("创建文件失败"),console.error("创建文件失败:",s)}},Be=async()=>{if(!(!t||!f.file))try{const s=await F.deleteItem(t,f.file.path,f.file.isDirectory);s.success?(k({open:!1,file:null}),p(n===a?.path?"":n.replace(a?.path||"","").replace(/^\//,""))):l(s.error||"删除失败")}catch(s){l("删除失败"),console.error("删除失败:",s)}},ne=async()=>{if(!(!t||!b.file||!m.trim()))try{const s=await F.renameItem(t,b.file.path,m.trim());s.success?(i({open:!1,file:null}),S(""),p(n===a?.path?"":n.replace(a?.path||"","").replace(/^\//,""))):l(s.error||"重命名失败")}catch(s){l("重命名失败"),console.error("重命名失败:",s)}},le=async()=>{if(!t||!H.trim()){U([]);return}try{ee(!0);const s=await F.searchFiles(t,H.trim());s.success&&s.files?U(s.files):l(s.error||"搜索失败")}catch(s){l("搜索失败"),console.error("搜索失败:",s)}finally{ee(!1)}},ie=()=>{J(""),U([])},Me=s=>{te(s),se(!0)},De=()=>{se(!1),te(null)},Pe=async s=>{if(X)try{await rs.writeFile({path:X.path,content:s,encoding:"utf8",append:!1});const r=n===a?.path?"":n.replace(a?.path||"","").replace(/^\//,"");p(r)}catch(r){throw new Error("保存文件失败: "+(r instanceof Error?r.message:String(r)))}},ze=()=>{if(!a)return[];const s=[{label:a.name,path:a.path,isRoot:!0}];if(n!==a.path){const u=n.replace(a.path,"").replace(/^\//,"").split("/").filter(w=>w);u.forEach((w,ce)=>{s.push({label:w,path:`${a.path}/${u.slice(0,ce+1).join("/")}`,isRoot:!1})})}return s};if(!a)return e.jsx(g,{sx:{p:2},children:e.jsx(ue,{severity:"error",children:"工作区不存在"})});const G=ze();return e.jsxs(g,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs(qe,{position:"static",color:"default",elevation:1,children:[e.jsxs(Ye,{children:[e.jsx(R,{edge:"start",onClick:be,sx:{mr:2},children:e.jsx(pe,{})}),e.jsxs(g,{sx:{flex:1},children:[e.jsx(h,{variant:"h6",noWrap:!0,children:a.name}),e.jsx(h,{variant:"caption",color:"text.secondary",noWrap:!0,children:a.path})]}),e.jsx(R,{onClick:()=>I(!0),title:"创建文件夹",children:e.jsx(as,{})}),e.jsx(R,{onClick:()=>E(!0),title:"创建文件",children:e.jsx(Ps,{})})]}),e.jsxs(g,{sx:{px:2,pb:1},children:[e.jsx(q,{fullWidth:!0,size:"small",placeholder:"搜索文件...",value:H,onChange:s=>{J(s.target.value),s.target.value===""&&ie()},onKeyDown:s=>s.key==="Enter"&&le(),slotProps:{input:{endAdornment:e.jsxs(g,{sx:{display:"flex"},children:[H&&e.jsx(R,{onClick:ie,size:"small",children:"×"}),e.jsx(R,{onClick:le,disabled:je,children:e.jsx(cs,{})})]})}}}),V.length>0&&e.jsxs(h,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["找到 ",V.length," 个结果"]})]})]}),e.jsx(_e,{sx:{p:2,borderRadius:0},elevation:0,children:e.jsx(Fs,{separator:e.jsx(Oe,{fontSize:"small"}),children:G.map((s,r)=>e.jsxs(Ke,{component:"button",variant:"body2",onClick:()=>{s.isRoot&&we()},sx:{display:"flex",alignItems:"center",textDecoration:"none",color:r===G.length-1?"text.primary":"primary.main","&:hover":{textDecoration:r===G.length-1?"none":"underline"}},children:[s.isRoot&&e.jsx(os,{size:16,style:{marginRight:4}}),s.label]},r))})}),e.jsxs(g,{sx:{flex:1,overflow:"auto"},children:[D&&e.jsx(ue,{severity:"error",sx:{m:2},onClose:()=>l(null),children:D}),T?e.jsx(g,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(h,{children:"加载中..."})}):d.length===0?e.jsxs(g,{sx:{textAlign:"center",mt:8,px:2},children:[e.jsx(ds,{size:64,style:{color:"#666",marginBottom:16}}),e.jsx(h,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"文件夹为空"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"此文件夹中没有文件或子文件夹"})]}):e.jsxs(Ue,{children:[(y.length>0||A!==void 0)&&e.jsxs(e.Fragment,{children:[e.jsx(he,{children:e.jsxs(ge,{onClick:Se,children:[e.jsx(xe,{children:e.jsx(pe,{})}),e.jsx(fe,{primary:"返回上级目录"})]})}),e.jsx(Xe,{})]}),(V.length>0?V:d).map((s,r)=>e.jsx(he,{disablePadding:!0,secondaryAction:e.jsx(R,{edge:"end",onClick:u=>re(u,s),size:"small",children:e.jsx(ns,{})}),children:e.jsxs(ge,{onClick:()=>s.isDirectory?ke(s):Me(s),onContextMenu:u=>re(u,s),children:[e.jsx(xe,{children:ve(s)}),e.jsx(fe,{primary:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{variant:"body1",noWrap:!0,children:s.name}),s.isDirectory&&e.jsx(Ge,{label:"文件夹",size:"small",variant:"outlined"})]}),secondary:!s.isDirectory&&e.jsxs(h,{variant:"caption",color:"text.secondary",children:[Fe(s.size)," • ",Ze(s.modifiedTime).format("YYYY-MM-DD HH:mm")]})})]})},r))]})]}),e.jsxs(Qe,{open:x!==null,onClose:Z,anchorReference:"anchorPosition",anchorPosition:x!==null?{top:x.mouseY,left:x.mouseX}:void 0,children:[e.jsxs(me,{onClick:()=>{i({open:!0,file:x?.file||null}),S(x?.file?.name||""),Z()},children:[e.jsx(Je,{size:16,style:{marginRight:8}}),"重命名"]}),e.jsxs(me,{onClick:()=>{k({open:!0,file:x?.file||null}),Z()},children:[e.jsx(es,{size:16,style:{marginRight:8}}),"删除"]})]}),e.jsxs(Y,{open:z,onClose:()=>I(!1),children:[e.jsx(_,{children:"创建文件夹"}),e.jsx(K,{children:e.jsx(q,{autoFocus:!0,margin:"dense",label:"文件夹名称",fullWidth:!0,variant:"outlined",value:m,onChange:s=>S(s.target.value),onKeyDown:s=>s.key==="Enter"&&ae()})}),e.jsxs(O,{children:[e.jsx(C,{onClick:()=>I(!1),children:"取消"}),e.jsx(C,{onClick:ae,variant:"contained",children:"创建"})]})]}),e.jsxs(Y,{open:$,onClose:()=>E(!1),children:[e.jsx(_,{children:"创建文件"}),e.jsx(K,{children:e.jsx(q,{autoFocus:!0,margin:"dense",label:"文件名称",fullWidth:!0,variant:"outlined",value:m,onChange:s=>S(s.target.value),onKeyDown:s=>s.key==="Enter"&&oe(),helperText:"如果不指定扩展名，将自动添加 .txt"})}),e.jsxs(O,{children:[e.jsx(C,{onClick:()=>E(!1),children:"取消"}),e.jsx(C,{onClick:oe,variant:"contained",children:"创建"})]})]}),e.jsxs(Y,{open:b.open,onClose:()=>i({open:!1,file:null}),children:[e.jsx(_,{children:"重命名"}),e.jsx(K,{children:e.jsx(q,{autoFocus:!0,margin:"dense",label:"新名称",fullWidth:!0,variant:"outlined",value:m,onChange:s=>S(s.target.value),onKeyDown:s=>s.key==="Enter"&&ne()})}),e.jsxs(O,{children:[e.jsx(C,{onClick:()=>i({open:!1,file:null}),children:"取消"}),e.jsx(C,{onClick:ne,variant:"contained",children:"重命名"})]})]}),e.jsxs(Y,{open:f.open,onClose:()=>k({open:!1,file:null}),children:[e.jsx(_,{children:"确认删除"}),e.jsx(K,{children:e.jsxs(h,{children:['确定要删除 "',f.file?.name,'" 吗？此操作无法撤销。']})}),e.jsxs(O,{children:[e.jsx(C,{onClick:()=>k({open:!1,file:null}),children:"取消"}),e.jsx(C,{onClick:Be,variant:"contained",color:"error",children:"删除"})]})]}),e.jsx(ls,{open:ye,file:X,onClose:De,onSave:Pe})]})};export{Os as default};
