import{u as N,r as E,j as e,B as p,a as m,A as G,T as Y,I as M,b as V,d as s,P as y,a5 as X,aN as H,e as W,g as O,X as P,Y as h,af as k,aO as C,f as K,C as Q,aP as Z,a4 as I,aQ as q,Z as D,D as ee,aR as re,aS as ae,aT as oe,aU as u,aV as B,aW as g,aX as te,aY as U}from"./index-Bp4oiTTd.js";import{C as se}from"./Container-BxbxJHnK.js";import{F as ie}from"./folder-C81CAi5A.js";import"./useThemeProps-KfL3eMu5.js";const ne="AetherLink/backups",pe=()=>{const $=N(),[S,T]=E.useState(!1),[v,F]=E.useState({open:!1,message:"",severity:"info"}),[o,_]=E.useState({includeChats:!0,includeAssistants:!0,includeSettings:!0,includeLocalStorage:!0,includeIndexedDB:!0}),z=()=>{$("/settings/data")},c=(r,l="info")=>{F({open:!0,message:r,severity:l})},L=()=>{F({...v,open:!1})},A=async r=>{try{return await navigator.clipboard.writeText(r),!0}catch(l){console.error("复制到剪贴板失败:",l);try{const a=document.createElement("textarea");a.value=r,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select();const t=document.execCommand("copy");return document.body.removeChild(a),t}catch(a){return console.error("备用剪贴板方法也失败:",a),!1}}},w=r=>l=>{_({...o,[r]:l.target.checked})},J=async()=>{try{T(!0);const r={timestamp:Date.now(),appInfo:{version:"1.0.0",name:"AetherLink",backupVersion:3}};if(o.includeChats){const n=await ae();r.topics=n}if(o.includeAssistants){const n=await oe();r.assistants=n}if(o.includeSettings){const n=localStorage.getItem("settings");r.settings=n?JSON.parse(n):{}}if(o.includeLocalStorage){const n={};for(let j=0;j<localStorage.length;j++){const x=localStorage.key(j);if(x&&x!=="settings"&&!x.startsWith("aetherlink-migration")&&x!=="idb-migration-done")try{const f=localStorage.getItem(x);if(f)try{n[x]=JSON.parse(f)}catch{n[x]=f}}catch(f){console.error(`读取localStorage项 "${x}" 失败:`,f)}}r.localStorage=n}r.backupSettings={location:localStorage.getItem("backup-location")||ne,storageType:localStorage.getItem("backup-storage-type")||"documents"};const l=new Date().toISOString().replace(/[:.]/g,"-"),a=[];o.includeChats&&a.push("Chats"),o.includeAssistants&&a.push("Assistants"),o.includeSettings&&a.push("Settings"),o.includeLocalStorage&&a.push("LocalStorage");const t=`AetherLink_FullBackup_${a.join("_")}_${l}.json`,i=JSON.stringify(r,null,2),d=t;await u.writeFile({path:d,data:i,directory:g.Cache,encoding:B.UTF8});const b=await u.getUri({path:d,directory:g.Cache});if(b&&b.uri)try{await te.share({title:"保存完整应用备份",text:"选择位置保存完整备份文件",url:b.uri,dialogTitle:"选择保存位置"}),c('请在系统分享菜单中选择"保存到设备"或文件管理器应用',"info")}catch(n){console.error("分享文件失败:",n);try{await U.open({filePath:b.uri,contentType:"application/json"}),c('文件已打开，请使用"另存为"保存到您想要的位置',"info")}catch(j){console.error("打开文件失败:",j),await R(t,i)}}else await R(t,i)}catch(r){console.error("创建完整备份失败:",r),c("创建备份失败: "+r.message,"error")}finally{T(!1)}},R=async(r,l)=>{try{const a="Download";try{await u.mkdir({path:a,directory:g.External,recursive:!0})}catch(d){console.log("目录可能已存在:",d)}const t=`${a}/${r}`;await u.writeFile({path:t,data:l,directory:g.External,encoding:B.UTF8});const i=await u.getUri({path:t,directory:g.External});if(i&&i.uri)try{await U.open({filePath:i.uri,contentType:"application/json"});const d=await A(i.uri);c(`备份已保存到下载目录: ${i.uri}${d?" (已复制到剪贴板)":""}`,"success")}catch(d){console.error("打开文件失败，但文件已保存:",d);const b=await A(i.uri);c(`备份已保存到下载目录: ${i.uri}${b?" (已复制到剪贴板)":""}`,"success")}else c("备份已保存到下载目录","success")}catch(a){console.error("保存到下载目录失败:",a);try{await u.writeFile({path:r,data:l,directory:g.External,encoding:B.UTF8});const t=await u.getUri({path:r,directory:g.External});if(t&&t.uri){const i=await A(t.uri);c(`备份已保存到内部存储根目录: ${t.uri}${i?" (已复制到剪贴板)":""}`,"success")}else c("备份已保存到内部存储根目录","success")}catch(t){console.error("保存到内部存储根目录也失败:",t),c("保存备份失败: "+t.message,"error")}}};return e.jsxs(p,{sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",bgcolor:r=>r.palette.mode==="light"?m(r.palette.primary.main,.02):m(r.palette.background.default,.9)},children:[e.jsx(G,{position:"fixed",elevation:0,sx:{zIndex:r=>r.zIndex.drawer+1,bgcolor:"background.paper",color:"text.primary",borderBottom:1,borderColor:"divider",backdropFilter:"blur(8px)"},children:e.jsxs(Y,{children:[e.jsx(M,{edge:"start",onClick:z,"aria-label":"back",sx:{color:r=>r.palette.primary.main},children:e.jsx(V,{})}),e.jsx(s,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"高级备份"})]})}),e.jsx(p,{sx:{flexGrow:1,overflowY:"auto",p:2,mt:8,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"3px"}},children:e.jsxs(se,{maxWidth:"sm",sx:{my:2},children:[e.jsxs(y,{elevation:0,sx:{p:3,mb:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(X,{sx:{width:56,height:56,bgcolor:"#9333EA",fontSize:"1.5rem",mr:2,boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:e.jsx(H,{})}),e.jsxs(p,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"完整应用备份"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"自定义备份内容并导出到您选择的位置"})]})]}),e.jsx(W,{sx:{my:2}}),e.jsx(O,{severity:"info",variant:"outlined",sx:{mb:3,borderRadius:2,"& .MuiAlert-icon":{color:"#9333EA"}},children:"高级备份功能允许您选择需要备份的数据类型，并将所有数据保存到自定义位置。 此功能非常适合在应用更新前或跨设备迁移时使用。"}),e.jsx(s,{variant:"subtitle1",sx:{mb:2,fontWeight:600,color:"text.primary"},children:"选择要备份的数据:"}),e.jsxs(P,{sx:{mb:3},children:[e.jsx(y,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.05)",borderColor:r=>m(r.palette.primary.main,.3)}},children:e.jsx(h,{sx:{p:0},children:e.jsx(k,{control:e.jsx(C,{checked:o.includeChats,onChange:w("includeChats"),color:"primary",sx:{ml:2}}),label:e.jsxs(p,{sx:{py:1},children:[e.jsx(s,{variant:"body1",fontWeight:500,children:"聊天记录"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"包含所有对话历史和消息"})]}),sx:{width:"100%"}})})}),e.jsx(y,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.05)",borderColor:r=>m(r.palette.primary.main,.3)}},children:e.jsx(h,{sx:{p:0},children:e.jsx(k,{control:e.jsx(C,{checked:o.includeAssistants,onChange:w("includeAssistants"),color:"primary",sx:{ml:2}}),label:e.jsxs(p,{sx:{py:1},children:[e.jsx(s,{variant:"body1",fontWeight:500,children:"助手数据"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"包含所有自定义助手及其关联话题"})]}),sx:{width:"100%"}})})}),e.jsx(y,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.05)",borderColor:r=>m(r.palette.primary.main,.3)}},children:e.jsx(h,{sx:{p:0},children:e.jsx(k,{control:e.jsx(C,{checked:o.includeSettings,onChange:w("includeSettings"),color:"primary",sx:{ml:2}}),label:e.jsxs(p,{sx:{py:1},children:[e.jsx(s,{variant:"body1",fontWeight:500,children:"应用设置"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"包含主题、模型、API密钥等设置"})]}),sx:{width:"100%"}})})}),e.jsx(y,{elevation:0,sx:{mb:2,borderRadius:2,border:"1px solid",borderColor:"divider",overflow:"hidden",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.05)",borderColor:r=>m(r.palette.primary.main,.3)}},children:e.jsx(h,{sx:{p:0},children:e.jsx(k,{control:e.jsx(C,{checked:o.includeLocalStorage,onChange:w("includeLocalStorage"),color:"primary",sx:{ml:2}}),label:e.jsxs(p,{sx:{py:1},children:[e.jsx(s,{variant:"body1",fontWeight:500,children:"本地存储数据"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"包含所有其他应用数据（偏好设置、历史记录等）"})]}),sx:{width:"100%"}})})})]}),e.jsx(K,{variant:"contained",startIcon:S?e.jsx(Q,{size:24,color:"inherit"}):e.jsx(Z,{}),onClick:J,disabled:S||!o.includeChats&&!o.includeAssistants&&!o.includeSettings&&!o.includeLocalStorage,fullWidth:!0,sx:{py:1.5,borderRadius:2,background:"linear-gradient(90deg, #9333EA, #754AB4)",fontWeight:600,"&:hover":{background:"linear-gradient(90deg, #8324DB, #6D3CAF)"}},children:S?"正在创建备份...":"创建完整备份"})]}),e.jsxs(y,{elevation:0,sx:{p:3,borderRadius:2,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsx(s,{variant:"h6",sx:{mb:2,fontWeight:600,backgroundImage:"linear-gradient(90deg, #9333EA, #754AB4)",backgroundClip:"text",color:"transparent"},children:"备份说明"}),e.jsx(W,{sx:{mb:2}}),e.jsxs(P,{disablePadding:!0,children:[e.jsxs(h,{sx:{px:0,py:1.5},children:[e.jsx(I,{children:e.jsx(q,{style:{color:"#9333EA"}})}),e.jsx(D,{primary:e.jsx(s,{variant:"body1",fontWeight:500,children:"备份将保存为JSON文件"}),secondary:"您可以选择保存位置，便于跨设备迁移"})]}),e.jsxs(h,{sx:{px:0,py:1.5},children:[e.jsx(I,{children:e.jsx(ie,{style:{color:"#9333EA"}})}),e.jsx(D,{primary:e.jsx(s,{variant:"body1",fontWeight:500,children:"推荐保存到云端"}),secondary:"如Google Drive、Dropbox或其他云存储服务"})]}),e.jsxs(h,{sx:{px:0,py:1.5},children:[e.jsx(I,{children:e.jsx(ee,{style:{color:"#9333EA"}})}),e.jsx(D,{primary:e.jsx(s,{variant:"body1",fontWeight:500,children:"定期备份"}),secondary:"建议在重要更新或更改前创建备份"})]})]})]})]})}),e.jsx(re,{open:v.open,autoHideDuration:6e3,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(O,{onClose:L,severity:v.severity,sx:{width:"100%",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},variant:"filled",children:v.message})})]})};export{pe as default};
