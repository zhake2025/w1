import{aA as l,p,bA as o,aU as w,aW as m}from"./index-5OteHtpV.js";const u="workspaces";class y{async validateFolderPath(t){try{return t.trim()?{success:!0}:{success:!1,error:"路径不能为空"}}catch(r){return console.error("验证文件夹路径失败:",r),{success:!1,error:"路径验证失败"}}}async createWorkspace(t){try{if(!t.name.trim())return{success:!1,error:"工作区名称不能为空"};if(!t.path.trim())return{success:!1,error:"文件夹路径不能为空"};if((await this.getWorkspaces()).workspaces.some(n=>n.name.toLowerCase()===t.name.toLowerCase()))return{success:!1,error:"工作区名称已存在"};const e={id:l(),name:t.name,path:t.path,description:t.description,createdAt:new Date().toISOString(),lastAccessedAt:new Date().toISOString()},c=await this.getWorkspaces();return c.workspaces.push(e),await p.saveSetting(u,c.workspaces),{success:!0,data:e}}catch(r){return console.error("创建工作区失败:",r),{success:!1,error:"创建工作区失败，请重试"}}}async getWorkspaces(){try{const t=await p.getSetting(u)||[];return{workspaces:t.sort((r,s)=>new Date(s.lastAccessedAt||s.createdAt).getTime()-new Date(r.lastAccessedAt||r.createdAt).getTime()),total:t.length}}catch(t){return console.error("获取工作区列表失败:",t),{workspaces:[],total:0}}}async getWorkspace(t){try{return(await this.getWorkspaces()).workspaces.find(s=>s.id===t)||null}catch(r){return console.error("获取工作区详情失败:",r),null}}async deleteWorkspace(t){try{const r=await this.getWorkspaces(),s=r.workspaces.filter(e=>e.id!==t);return s.length===r.workspaces.length?{success:!1,error:"工作区不存在"}:(await p.saveSetting(u,s),{success:!0})}catch(r){return console.error("删除工作区失败:",r),{success:!1,error:"删除工作区失败，请重试"}}}async updateLastAccessed(t){try{const r=await this.getWorkspaces(),s=r.workspaces.find(e=>e.id===t);s&&(s.lastAccessedAt=new Date().toISOString(),await p.saveSetting(u,r.workspaces))}catch(r){console.error("更新访问时间失败:",r)}}async getWorkspaceFilesAdvanced(t,r=""){try{const s=await this.getWorkspace(t);if(!s)throw new Error("工作区不存在");await this.updateLastAccessed(t);const e=r?`${s.path}/${r}`:s.path,n=(await o.listDirectory({path:e,showHidden:!1,sortBy:"name",sortOrder:"asc"})).files.map(a=>({name:a.name,path:a.path,size:a.size,isDirectory:a.type==="directory",type:a.type,modifiedTime:a.mtime,extension:a.name&&a.name.includes(".")?a.name.split(".").pop():void 0}));return n.sort((a,i)=>a.isDirectory&&!i.isDirectory?-1:!a.isDirectory&&i.isDirectory?1:a.name.localeCompare(i.name)),{files:n,currentPath:e,parentPath:r&&r.includes("/")?r.split("/").slice(0,-1).join("/"):void 0}}catch(s){return console.error("获取工作区文件失败:",s),this.getWorkspaceFiles(t,r)}}async getWorkspaceFiles(t,r=""){try{const s=await this.getWorkspace(t);if(!s)throw new Error("工作区不存在");await this.updateLastAccessed(t);const e=r?`${s.path}/${r}`:s.path,c=await w.readdir({path:e,directory:m.External});if(!c.files)return{files:[],currentPath:e,parentPath:r?s.path:void 0};const n=c.files.map(a=>({name:a.name,path:a.uri,size:a.size||0,isDirectory:a.type==="directory",type:a.type||"file",modifiedTime:a.mtime||Date.now(),extension:a.name&&a.name.includes(".")?a.name.split(".").pop():void 0}));return n.sort((a,i)=>a.isDirectory&&!i.isDirectory?-1:!a.isDirectory&&i.isDirectory?1:a.name.localeCompare(i.name)),{files:n,currentPath:e,parentPath:r&&r.includes("/")?r.split("/").slice(0,-1).join("/"):void 0}}catch(s){throw console.error("获取工作区文件失败:",s),new Error("无法读取工作区文件，请检查路径是否存在或权限是否足够")}}async createFolder(t,r,s){try{if(!await this.getWorkspace(t))return{success:!1,error:"工作区不存在"};const c=`${r}/${s}`;return await o.createDirectory({path:c,recursive:!1}),{success:!0}}catch(e){return console.error("创建文件夹失败:",e),{success:!1,error:"创建文件夹失败: "+(e instanceof Error?e.message:String(e))}}}async createFile(t,r,s,e=""){try{return await this.getWorkspace(t)?(await o.createTextFile(r,s,e),{success:!0}):{success:!1,error:"工作区不存在"}}catch(c){return console.error("创建文件失败:",c),{success:!1,error:"创建文件失败: "+(c instanceof Error?c.message:String(c))}}}async deleteItem(t,r,s){try{return await this.getWorkspace(t)?(s?await o.deleteDirectory({path:r}):await o.deleteFile({path:r}),{success:!0}):{success:!1,error:"工作区不存在"}}catch(e){return console.error("删除项目失败:",e),{success:!1,error:"删除失败: "+(e instanceof Error?e.message:String(e))}}}async renameItem(t,r,s){try{return await this.getWorkspace(t)?(await o.renameFile({path:r,newName:s}),{success:!0}):{success:!1,error:"工作区不存在"}}catch(e){return console.error("重命名失败:",e),{success:!1,error:"重命名失败: "+(e instanceof Error?e.message:String(e))}}}async copyItem(t,r,s){try{return await this.getWorkspace(t)?(await o.copyFile({sourcePath:r,destinationPath:s,overwrite:!1}),{success:!0}):{success:!1,error:"工作区不存在"}}catch(e){return console.error("复制失败:",e),{success:!1,error:"复制失败: "+(e instanceof Error?e.message:String(e))}}}async moveItem(t,r,s){try{return await this.getWorkspace(t)?(await o.moveFile({sourcePath:r,destinationPath:s}),{success:!0}):{success:!1,error:"工作区不存在"}}catch(e){return console.error("移动失败:",e),{success:!1,error:"移动失败: "+(e instanceof Error?e.message:String(e))}}}async readFileContent(t,r){try{return await this.getWorkspace(t)?{success:!0,content:(await o.readFile({path:r,encoding:"utf8"})).content}:{success:!1,error:"工作区不存在"}}catch(s){return console.error("读取文件失败:",s),{success:!1,error:"读取文件失败: "+(s instanceof Error?s.message:String(s))}}}async writeFileContent(t,r,s){try{return await this.getWorkspace(t)?(await o.writeFile({path:r,content:s,encoding:"utf8",append:!1}),{success:!0}):{success:!1,error:"工作区不存在"}}catch(e){return console.error("写入文件失败:",e),{success:!1,error:"写入文件失败: "+(e instanceof Error?e.message:String(e))}}}async searchFiles(t,r,s="name"){try{const e=await this.getWorkspace(t);return e?{success:!0,files:(await o.searchFiles({directory:e.path,query:r,searchType:s,fileTypes:[],maxResults:100,recursive:!0})).files.map(a=>({name:a.name,path:a.path,size:a.size,isDirectory:a.type==="directory",type:a.type,modifiedTime:a.mtime,extension:a.name.includes(".")?a.name.split(".").pop():void 0}))}:{success:!1,error:"工作区不存在"}}catch(e){return console.error("搜索文件失败:",e),{success:!1,error:"搜索文件失败: "+(e instanceof Error?e.message:String(e))}}}}const f=new y;export{f as w};
