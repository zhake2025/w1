import{a0 as O,V as A,j as o,I,bk as H,f as L,B as S,d as w,a1 as P,a2 as x,S as T,a5 as $,K as M}from"./index-BFQp9Otg.js";import{L as R}from"./ListSubheader-DnPPHmr2.js";const V=({selectedModel:s,onClick:c,displayStyle:z="icon"})=>{const g=O(),i=A(d=>d.settings.providers||[]),u=d=>{const p=i.find(v=>v.id===d);return p?p.name:d},l=d=>{if(d.length<=18)return`${.875}rem`;const y=d.length/18,W=.875*Math.max(1/Math.sqrt(y),.65/.875);return`${Math.max(W,.65)}rem`};if(z==="icon")return o.jsx(I,{color:"inherit",size:"small",onClick:c,children:o.jsx(H,{size:20})});const m=s?u(s.provider||""):"",f=s?.name||"GPT-4",b=l(f);return o.jsx(L,{variant:"outlined",size:"small",onClick:c,sx:{borderColor:"divider",color:"text.primary",textTransform:"none",minWidth:"auto",px:1.5,py:.5},children:o.jsxs(S,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",minWidth:0},children:[o.jsx(w,{variant:"body2",sx:{fontWeight:500,fontSize:b,color:g.palette.text.primary,maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:1.1},title:f,children:f}),m&&o.jsx(w,{variant:"caption",sx:{fontSize:"0.65rem",color:g.palette.text.secondary,lineHeight:1,mt:.25,maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:m,children:m})]})})},N=({selectedModel:s,availableModels:c,handleModelSelect:z,displayStyle:g="text"})=>{const i=O(),u=P(i.breakpoints.down("sm")),l=A(e=>e.settings.providers||[]),m=x.useCallback(e=>{const r=l.find(t=>t.id===e);return r?r.name:e},[l]),f=x.useCallback(e=>l.find(r=>r.id===e),[l]),b=x.useMemo(()=>{const e={};c.forEach(t=>{const a=t.provider||t.providerType||"unknown";e[a]||(e[a]=[]),e[a].push(t)});const r=Object.keys(e).sort((t,a)=>{const n=l.findIndex(C=>C.id===t),h=l.findIndex(C=>C.id===a);if(n!==-1&&h!==-1)return n-h;if(n!==-1)return-1;if(h!==-1)return 1;const B=m(t),F=m(a);return B.localeCompare(F)});return{groups:e,sortedGroups:r}},[c,m,l]),d=e=>{const r=e.target.value;if(!(!r||typeof r!="string"))try{const[t,a]=r.split("---"),n=c.find(h=>h.id===t&&(h.provider||"")===a);n?setTimeout(()=>{z(n)},0):console.error("未找到匹配的模型:",t,a)}catch(t){console.error("处理模型选择时出错:",t)}},p=x.useCallback(e=>`${e.id}---${e.provider||""}`,[]),v=x.useCallback(()=>{if(!s)return"";const e=c.find(t=>t.id===s.id&&(t.provider||"")===(s.provider||""));if(e)return p(e);const r=c.find(t=>t.id===s.id);return p(r||s)},[s,p,c]),[k,y]=x.useState(!1),j=()=>y(!0),W=()=>y(!1);return o.jsxs(S,{sx:{position:"relative"},children:[o.jsx(V,{selectedModel:s,onClick:j,displayStyle:g}),o.jsx(T,{open:k,onClose:W,onOpen:j,value:v(),onChange:d,displayEmpty:!0,renderValue:()=>null,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:k?"auto":"none","& .MuiSelect-select":{padding:0,border:"none",bgcolor:"transparent"},"& .MuiSelect-icon":{display:"none"},"&:before":{display:"none"},"&:after":{display:"none"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},MenuProps:{disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:!0,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{maxHeight:u?"50vh":"70vh",minHeight:u?150:300,width:u?"85vw":"auto",maxWidth:u?"85vw":400,minWidth:u?"300px":280,mt:.5,...u&&{maxWidth:"calc(100vw - 32px)",marginLeft:"auto",marginRight:"auto"},boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)",bgcolor:i.palette.mode==="dark"?"#2A2A2A":i.palette.background.paper,borderRadius:1,"& .MuiList-root":{py:0,bgcolor:"transparent","&:focus":{outline:"none"}}}},root:{slotProps:{backdrop:{invisible:!0,sx:{backgroundColor:"transparent"}}}}}},children:b.sortedGroups.flatMap(e=>{const r=m(e),t=f(e),a=b.groups[e];return[o.jsxs(R,{sx:{bgcolor:i.palette.mode==="dark"?"#3A3A3A":"#F5F5F5",fontWeight:600,fontSize:"0.8rem",py:.75,px:2,minHeight:32,display:"flex",alignItems:"center",gap:.75,position:"sticky",top:0,zIndex:10,borderBottom:`1px solid ${i.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`,"&:not(:first-of-type)":{borderTop:`1px solid ${i.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"}`}},children:[o.jsx($,{sx:{width:16,height:16,bgcolor:t?.color||i.palette.primary.main,fontSize:"0.65rem"},children:t?.avatar||r[0]}),r]},`header-${e}`),...a.map(n=>{const h=p(n);return o.jsx(M,{value:h,sx:{py:1,pl:3,pr:2,minHeight:40,bgcolor:"transparent","&:hover":{bgcolor:i.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.04)"},"&.Mui-selected":{bgcolor:i.palette.mode==="dark"?"rgba(33, 150, 243, 0.2)":"rgba(33, 150, 243, 0.1)","&:hover":{bgcolor:i.palette.mode==="dark"?"rgba(33, 150, 243, 0.3)":"rgba(33, 150, 243, 0.15)"}}},children:o.jsx(S,{sx:{display:"flex",alignItems:"center",width:"100%",maxWidth:"100%"},children:o.jsxs(S,{sx:{flex:1,minWidth:0},children:[o.jsx(w,{variant:"body2",sx:{fontWeight:500,fontSize:"0.875rem",lineHeight:1.3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},title:n.name,children:n.name}),n.description&&o.jsx(w,{variant:"caption",color:"text.secondary",sx:{display:"block",fontSize:"0.75rem",lineHeight:1.2,mt:.25,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},title:n.description,children:n.description})]})})},h)}).filter(Boolean)].filter(Boolean)})})]})};export{N as D,V as U};
