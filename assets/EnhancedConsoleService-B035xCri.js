class r{static instance;entries=[];maxEntries=1e3;listeners=[];originalConsole={};isIntercepting=!1;groupLevel=0;counts=new Map;constructor(){this.setupConsoleInterception()}static getInstance(){return r.instance||(r.instance=new r),r.instance}setupConsoleInterception(){if(this.isIntercepting)return;["log","info","warn","error","debug","trace"].forEach(e=>{this.originalConsole[e]=console[e].bind(console),console[e]=(...n)=>{if(e==="error"&&n.length>0){const s=String(n[0]||"");if(s.includes("non-boolean attribute `button`")||s.includes("Received `%s` for a non-boolean attribute `%s`")&&n.length>1&&String(n[1]).includes("true")&&String(n[2]).includes("button")||s.includes("The Menu component doesn't accept a Fragment as a child")||s.includes("[@use-gesture]: The drag target has its `touch-action` style property set to `auto`")||s.includes("Selector unknown returned the root state")||s.includes("This can lead to unnecessary rerenders"))return}this.originalConsole[e](...n),this.addEntry({id:this.generateId(),timestamp:Date.now(),level:e,args:this.serializeArgs(n),stack:e==="error"||e==="warn"?this.getStackTrace():void 0,groupLevel:this.groupLevel})}}),this.originalConsole.group=console.group.bind(console),this.originalConsole.groupEnd=console.groupEnd.bind(console),console.group=(...e)=>{this.originalConsole.group(...e),this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"group",args:this.serializeArgs(e),groupLevel:this.groupLevel}),this.groupLevel++},console.groupEnd=()=>{this.originalConsole.groupEnd(),this.groupLevel=Math.max(0,this.groupLevel-1),this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"groupEnd",args:[],groupLevel:this.groupLevel})},this.originalConsole.clear=console.clear.bind(console),console.clear=()=>{this.originalConsole.clear(),this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"clear",args:["Console was cleared"],groupLevel:0})},window.addEventListener("error",e=>{this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"error",args:[`Uncaught ${e.error?.name||"Error"}: ${e.error?.message||e.message}`],stack:e.error?.stack,groupLevel:this.groupLevel})}),window.addEventListener("unhandledrejection",e=>{this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"error",args:[`Uncaught (in promise) ${e.reason}`],stack:e.reason?.stack,groupLevel:this.groupLevel})}),this.isIntercepting=!0}generateId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}serializeArgs(t){return t.map(e=>{if(e===null)return null;if(e!==void 0){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Error)return{__type:"Error",name:e.name,message:e.message,stack:e.stack};if(e instanceof Element)return{__type:"Element",tagName:e.tagName,id:e.id,className:e.className,outerHTML:e.outerHTML.substring(0,200)+(e.outerHTML.length>200?"...":"")};try{return JSON.parse(JSON.stringify(e))}catch{return String(e)}}})}getStackTrace(){const t=new Error().stack;return t?t.split(`
`).slice(3).join(`
`):""}addEntry(t){this.entries.push(t),this.entries.length>this.maxEntries&&(this.entries=this.entries.slice(-this.maxEntries)),this.notifyListeners()}notifyListeners(){this.listeners.forEach(t=>{try{t([...this.entries])}catch(e){this.originalConsole.error("Error in console listener:",e)}})}getEntries(){return[...this.entries]}getFilteredEntries(t){return this.entries.filter(e=>{if(!t.levels.has(e.level))return!1;if(t.searchText){const n=t.searchText.toLowerCase();if(!e.args.map(i=>String(i)).join(" ").toLowerCase().includes(n))return!1}return!0})}addListener(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}}clear(){this.entries=[],this.groupLevel=0,this.counts.clear(),this.notifyListeners()}executeCommand(t){try{const e=window.eval(t);this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"log",args:[`> ${t}`,e],groupLevel:this.groupLevel})}catch(e){this.addEntry({id:this.generateId(),timestamp:Date.now(),level:"error",args:[`> ${t}`,e],stack:e.stack,groupLevel:this.groupLevel})}}formatArg(t){if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean")return String(t);if(t&&t.__type==="Error")return`${t.name}: ${t.message}`;if(t&&t.__type==="Element")return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;try{return JSON.stringify(t,null,2)}catch{return String(t)}}getArgType(t){return t===null?"null":t===void 0?"undefined":t&&t.__type?t.__type:typeof t}}export{r as default};
