/**
 * 增强的聊天布局样式
 * 确保聊天框始终在消息下方，为手势操作留出空间
 */

/* 聊天输入框包装器 - 确保始终在底部且不遮挡内容 */
.chat-input-wrapper {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: transparent;
  pointer-events: auto; /* 修复：允许正常交互 */
}

/* 实际的输入框容器 */
.chat-input-wrapper .chat-input-container {
  pointer-events: auto; /* 确保输入框可以交互 */
  margin: 0 12px 0 16px; /* 左边留出更多空间给手势，右边保持对称 */
  background: var(--mui-palette-background-paper);
  border: 1px solid var(--mui-palette-divider);
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 12px 16px;
  padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
  position: relative;
  left: 0;
  right: 0;
  min-height: 60px; /* 确保有足够的点击区域 */
}

/* 消息列表容器 - 确保有足够的底部空间 */
.enhanced-chat-messages-container {
  padding-bottom: calc(env(safe-area-inset-bottom) + 120px) !important;
  padding-left: 8px; /* 为左滑手势留出空间 */
  padding-right: 8px;
  box-sizing: border-box;
}

/* 手机端优化 */
@media (max-width: 768px) {
  .chat-input-wrapper .chat-input-container {
    margin: 0 8px 0 20px; /* 手机端左边留出更多空间 */
    padding: 10px 14px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
    border-radius: 12px 12px 0 0;
  }
  
  .enhanced-chat-messages-container {
    padding-left: 4px;
    padding-right: 4px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 100px) !important;
  }
}

/* 平板端优化 */
@media (min-width: 769px) and (max-width: 1024px) {
  .chat-input-wrapper .chat-input-container {
    margin: 0 16px 0 24px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .enhanced-chat-messages-container {
    padding-left: 12px;
    padding-right: 12px;
    max-width: 740px;
    margin: 0 auto;
  }
}

/* 桌面端优化 */
@media (min-width: 1025px) {
  .chat-input-wrapper .chat-input-container {
    margin: 0 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .enhanced-chat-messages-container {
    padding-left: 16px;
    padding-right: 16px;
    max-width: 840px;
    margin: 0 auto;
  }
}

/* iOS PWA 特殊处理 */
@media (display-mode: standalone) {
  .platform-ios .chat-input-wrapper .chat-input-container {
    margin: 0 10px 0 18px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 15px);
    border-radius: 14px 14px 0 0;
  }
  
  .platform-ios .enhanced-chat-messages-container {
    padding-left: 6px;
    padding-right: 6px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 130px) !important;
  }
}

/* iOS 虚拟键盘处理 */
@supports (-webkit-touch-callout: none) {
  .platform-ios.keyboard-visible .chat-input-wrapper .chat-input-container {
    margin: 0 8px 0 16px;
    padding-bottom: 10px;
    transition: all 0.3s ease-in-out;
    -webkit-transition: all 0.3s ease-in-out;
  }
  
  .platform-ios.keyboard-visible .enhanced-chat-messages-container {
    padding-left: 4px;
    padding-right: 4px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 140px) !important;
    transition: padding 0.3s ease-in-out;
  }
}

/* Android 特殊处理 */
.platform-android .chat-input-wrapper .chat-input-container {
  margin: 0 10px 0 18px;
}

.platform-android .enhanced-chat-messages-container {
  padding-bottom: calc(env(safe-area-inset-bottom) + 110px) !important;
}

/* 确保输入框内部元素正确布局 */
.chat-input-wrapper .chat-input-container > * {
  position: relative;
  z-index: 1;
  pointer-events: auto; /* 确保内部元素可以交互 */
}

/* 输入框聚焦时的增强效果 */
.chat-input-wrapper .chat-input-container:focus-within {
  box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.12);
  border-color: var(--mui-palette-primary-main);
}

/* 确保所有输入相关元素都可以点击 */
.chat-input-wrapper input,
.chat-input-wrapper textarea,
.chat-input-wrapper button,
.chat-input-wrapper [role="button"],
.chat-input-wrapper .MuiInputBase-root,
.chat-input-wrapper .MuiTextField-root,
.chat-input-wrapper .MuiButton-root {
  pointer-events: auto !important;
  cursor: pointer;
}

.chat-input-wrapper input,
.chat-input-wrapper textarea {
  cursor: text !important;
}

/* 横屏模式优化 */
@media (orientation: landscape) and (max-height: 600px) {
  .chat-input-wrapper .chat-input-container {
    padding: 8px 12px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 8px);
  }
  
  .enhanced-chat-messages-container {
    padding-bottom: calc(env(safe-area-inset-bottom) + 80px) !important;
  }
}

/* 确保在所有情况下输入框都不会遮挡消息 */
.chat-page-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  height: 100dvh;
}

.chat-content-area {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.chat-input-area {
  flex-shrink: 0;
  position: relative;
  z-index: 1000;
}